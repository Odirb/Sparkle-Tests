!function(){var globalObject="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};!function(factory){"function"==typeof define&&define.amd?define(["./base"],factory):(globalObject.msWriteProfilerMark&&msWriteProfilerMark("WinJS.4.4 4.4.0.winjs.2015.10.2 ui.js,StartTM"),factory("object"==typeof exports&&"string"!=typeof exports.nodeName?require("./base"):globalObject.WinJS),globalObject.msWriteProfilerMark&&msWriteProfilerMark("WinJS.4.4 4.4.0.winjs.2015.10.2 ui.js,StopTM"))}(function(WinJS){var require=WinJS.Utilities._require,define=WinJS.Utilities._define;define("WinJS/VirtualizedDataSource/_VirtualizedDataSourceImpl",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../_Signal","../Utilities/_UI"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,Promise,Scheduler,_Signal,_UI){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{VirtualizedDataSource:_Base.Namespace._lazy(function(){function _baseDataSourceConstructor(listDataAdapter,options){function profilerMarkStart(text){var message="WinJS.UI.VirtualizedDataSource:"+dataSourceID+":"+text+",StartTM";_WriteProfilerMark(message),_Log.log&&_Log.log(message,"winjs vds","perf")}function profilerMarkEnd(text){var message="WinJS.UI.VirtualizedDataSource:"+dataSourceID+":"+text+",StopTM";_WriteProfilerMark(message),_Log.log&&_Log.log(message,"winjs vds","perf")}function isNonNegativeNumber(n){return"number"==typeof n&&n>=0}function isNonNegativeInteger(n){return isNonNegativeNumber(n)&&n===Math.floor(n)}function validateIndexReturned(index){if(null===index)index=void 0;else if(void 0!==index&&!isNonNegativeInteger(index))throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidIndexReturned",strings.invalidIndexReturned);return index}function validateCountReturned(count){if(null===count)count=void 0;else if(void 0!==count&&!isNonNegativeInteger(count)&&count!==CountResult.unknown)throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidCountReturned",strings.invalidCountReturned);return count}function createSlot(){var handle=(nextHandle++).toString(),slotNew={handle:handle,item:null,itemNew:null,fetchListeners:null,cursorCount:0,bindingMap:null};return handleMap[handle]=slotNew,slotNew}function createPrimarySlot(){return createSlot()}function insertSlot(slot,slotNext){slot.prev=slotNext.prev,slot.next=slotNext,slot.prev.next=slot,slotNext.prev=slot}function removeSlot(slot){slot.lastInSequence&&(delete slot.lastInSequence,slot.prev.lastInSequence=!0),slot.firstInSequence&&(delete slot.firstInSequence,slot.next.firstInSequence=!0),slot.prev.next=slot.next,slot.next.prev=slot.prev}function sequenceStart(slot){for(;!slot.firstInSequence;)slot=slot.prev;return slot}function sequenceEnd(slot){for(;!slot.lastInSequence;)slot=slot.next;return slot}function moveSequenceBefore(slotNext,slotFirst,slotLast){return slotFirst.prev.next=slotLast.next,slotLast.next.prev=slotFirst.prev,slotFirst.prev=slotNext.prev,slotLast.next=slotNext,slotFirst.prev.next=slotFirst,slotNext.prev=slotLast,!0}function moveSequenceAfter(slotPrev,slotFirst,slotLast){return slotFirst.prev.next=slotLast.next,slotLast.next.prev=slotFirst.prev,slotFirst.prev=slotPrev,slotLast.next=slotPrev.next,slotPrev.next=slotFirst,slotLast.next.prev=slotLast,!0}function mergeSequences(slotPrev){delete slotPrev.lastInSequence,delete slotPrev.next.firstInSequence}function splitSequence(slotPrev){var slotNext=slotPrev.next;slotPrev.lastInSequence=!0,slotNext.firstInSequence=!0,slotNext===slotListEnd&&changeSlotIndex(slotListEnd,void 0)}function insertAndMergeSlot(slot,slotNext,mergeWithPrev,mergeWithNext){insertSlot(slot,slotNext);var slotPrev=slot.prev;slotPrev.lastInSequence&&(mergeWithPrev?delete slotPrev.lastInSequence:slot.firstInSequence=!0,mergeWithNext?delete slotNext.firstInSequence:slot.lastInSequence=!0)}function setSlotKey(slot,key){slot.key=key,keyMap[slot.key]=slot}function setSlotIndex(slot,index,indexMapForSlot){+index===index&&(slot.index=index,indexMapForSlot[index]=slot,indexUpdateDeferred||(slot.firstInSequence&&slot.prev&&slot.prev.index===index-1&&mergeSequences(slot.prev),slot.lastInSequence&&slot.next&&slot.next.index===index+1&&mergeSequences(slot)))}function createAndAddSlot(slotNext,indexMapForSlot){var slotNew=indexMapForSlot===indexMap?createPrimarySlot():createSlot();return insertSlot(slotNew,slotNext),slotNew}function createSlotSequence(slotNext,index,indexMapForSlot){var slotNew=createAndAddSlot(slotNext,indexMapForSlot);return slotNew.firstInSequence=!0,slotNew.lastInSequence=!0,setSlotIndex(slotNew,index,indexMapForSlot),slotNew}function createPrimarySlotSequence(slotNext,index){return createSlotSequence(slotNext,index,indexMap)}function addSlotBefore(slotNext,indexMapForSlot){var slotNew=createAndAddSlot(slotNext,indexMapForSlot);return delete slotNext.firstInSequence,slotNew.prev.index===slotNew.index-1?delete slotNew.prev.lastInSequence:slotNew.firstInSequence=!0,setSlotIndex(slotNew,slotNext.index-1,indexMapForSlot),slotNew}function addSlotAfter(slotPrev,indexMapForSlot){var slotNew=createAndAddSlot(slotPrev.next,indexMapForSlot);return delete slotPrev.lastInSequence,slotNew.next.index===slotNew.index+1?delete slotNew.next.firstInSequence:slotNew.lastInSequence=!0,setSlotIndex(slotNew,slotPrev.index+1,indexMapForSlot),slotNew}function reinsertSlot(slot,slotNext,mergeWithPrev,mergeWithNext){insertAndMergeSlot(slot,slotNext,mergeWithPrev,mergeWithNext),keyMap[slot.key]=slot,void 0!==slot.index&&(indexMap[slot.index]=slot)}function removeSlotPermanently(slot){removeSlot(slot),slot.key&&delete keyMap[slot.key],void 0!==slot.index&&indexMap[slot.index]===slot&&delete indexMap[slot.index];var bindingMap=slot.bindingMap;for(var listBindingID in bindingMap){var handle=bindingMap[listBindingID].handle;handle&&handleMap[handle]===slot&&delete handleMap[handle]}handleMap[slot.handle]===slot&&delete handleMap[slot.handle]}function slotPermanentlyRemoved(slot){return!handleMap[slot.handle]}function successorFromIndex(index,indexMapForSlot,listStart,listEnd,skipPreviousIndex){var slotNext=skipPreviousIndex?null:indexMapForSlot[index-1];if(slotNext&&(slotNext.next!==listEnd||listEnd.firstInSequence))slotNext=slotNext.next;else if(slotNext=indexMapForSlot[index+1],!slotNext){slotNext=listStart.next;for(var lastSequenceStart;;){if(slotNext.firstInSequence&&(lastSequenceStart=slotNext),!(index>=slotNext.index)||slotNext===listEnd)break;slotNext=slotNext.next}slotNext!==listEnd||listEnd.firstInSequence||(slotNext=lastSequenceStart&&void 0===lastSequenceStart.index?lastSequenceStart:void 0)}return slotNext}function isPlaceholder(slot){return!slot.item&&!slot.itemNew&&slot!==slotListEnd}function defineHandleProperty(item,handle){Object.defineProperty(item,"handle",{value:handle,writable:!1,enumerable:!1,configurable:!0})}function defineCommonItemProperties(item,slot,handle){defineHandleProperty(item,handle),Object.defineProperty(item,"index",{get:function(){for(;slot.slotMergedWith;)slot=slot.slotMergedWith;return slot.index},enumerable:!1,configurable:!0})}function validateData(data){if(void 0===data)return data;var dataValidated=JSON.stringify(data);if(void 0===dataValidated)throw new _ErrorFromName("WinJS.UI.ListDataSource.ObjectIsNotValidJson",strings.objectIsNotValidJson);return dataValidated}function itemSignature(item){return listDataAdapter.itemSignature?listDataAdapter.itemSignature(item.data):validateData(item.data)}function prepareSlotItem(slot){var item=slot.itemNew;slot.itemNew=null,item&&(item=Object.create(item),defineCommonItemProperties(item,slot,slot.handle),listDataAdapter.compareByIdentity||(slot.signature=itemSignature(item))),slot.item=item,delete slot.indexRequested,delete slot.keyRequested}function slotRetained(slot){return slot.bindingMap||slot.cursorCount>0}function slotRequested(slot){return slotRetained(slot)||slot.fetchListeners||slot.directFetchListeners}function slotLive(slot){return slotRequested(slot)||!slot.firstInSequence&&slotRetained(slot.prev)||!slot.lastInSequence&&slotRetained(slot.next)||!itemsFromIndex&&(!slot.firstInSequence&&slot.prev!==slotsStart&&!(slot.prev.item||slot.prev.itemNew))|(!slot.lastInSequence&&slot.next!==slotListEnd&&!(slot.next.item||slot.next.itemNew))}function deleteUnnecessarySlot(slot){splitSequence(slot),removeSlotPermanently(slot)}function reduceReleasedSlotCount(){if(!editsQueued){lastSlotReleased&&!slotPermanentlyRemoved(lastSlotReleased)||(lastSlotReleased=slotListEnd.prev);for(var slotPrev=lastSlotReleased.prev,slotNext=lastSlotReleased.next,releasedSlotsFound=0,considerDeletingSlot=function(slotToDelete){slotToDelete===slotListEnd||slotLive(slotToDelete)||(releasedSlotsFound<=cacheSize?releasedSlotsFound++:deleteUnnecessarySlot(slotToDelete))};slotPrev||slotNext;){if(slotPrev){var slotPrevToDelete=slotPrev;slotPrev=slotPrevToDelete.prev,slotPrevToDelete!==slotsStart&&considerDeletingSlot(slotPrevToDelete)}if(slotNext){var slotNextToDelete=slotNext;slotNext=slotNextToDelete.next,slotNextToDelete!==slotsEnd&&considerDeletingSlot(slotNextToDelete)}}releasedSlots=0}}function releaseSlotIfUnrequested(slot){slotRequested(slot)||(releasedSlots++,editsQueued||refreshInProgress||(lastSlotReleased=slot,releasedSlots>cacheSize&&!reduceReleasedSlotCountPosted&&(reduceReleasedSlotCountPosted=!0,Scheduler.schedule(function(){reduceReleasedSlotCountPosted=!1,reduceReleasedSlotCount()},Scheduler.Priority.idle,null,"WinJS.UI.VirtualizedDataSource.releaseSlotIfUnrequested"))))}function forEachBindingRecord(callback){for(var listBindingID in bindingMap)callback(bindingMap[listBindingID])}function forEachBindingRecordOfSlot(slot,callback){for(var listBindingID in slot.bindingMap)callback(slot.bindingMap[listBindingID].bindingRecord,listBindingID)}function handlerToNotify(bindingRecord){return bindingRecord.notificationsSent||(bindingRecord.notificationsSent=!0,bindingRecord.notificationHandler.beginNotifications&&bindingRecord.notificationHandler.beginNotifications()),bindingRecord.notificationHandler}function finishNotifications(){editsInProgress||dataNotificationsInProgress||forEachBindingRecord(function(bindingRecord){bindingRecord.notificationsSent&&(bindingRecord.notificationsSent=!1,bindingRecord.notificationHandler.endNotifications&&bindingRecord.notificationHandler.endNotifications())})}function handleForBinding(slot,listBindingID){var bindingMap=slot.bindingMap;if(bindingMap){var slotBinding=bindingMap[listBindingID];if(slotBinding){var handle=slotBinding.handle;if(handle)return handle}}return slot.handle}function itemForBinding(item,handle){return item&&item.handle!==handle&&(item=Object.create(item),defineHandleProperty(item,handle)),item}function changeCount(count){var oldCount=knownCount;knownCount=count,forEachBindingRecord(function(bindingRecord){bindingRecord.notificationHandler&&bindingRecord.notificationHandler.countChanged&&handlerToNotify(bindingRecord).countChanged(knownCount,oldCount)})}function sendIndexChangedNotifications(slot,indexOld){forEachBindingRecordOfSlot(slot,function(bindingRecord,listBindingID){bindingRecord.notificationHandler.indexChanged&&handlerToNotify(bindingRecord).indexChanged(handleForBinding(slot,listBindingID),slot.index,indexOld)})}function changeSlotIndex(slot,index){var indexOld=slot.index;if(void 0!==indexOld&&indexMap[indexOld]===slot&&delete indexMap[indexOld],+index===index)setSlotIndex(slot,index,indexMap);else{if(+indexOld!==indexOld)return;delete slot.index}sendIndexChangedNotifications(slot,indexOld)}function insertionNotificationRecipients(slot,slotPrev,slotNext,mergeWithPrev,mergeWithNext){var bindingMapRecipients={};if((mergeWithPrev||!slotPrev.lastInSequence)&&(mergeWithNext||!slotNext.firstInSequence))if(slotPrev===slotsStart)if(slotNext===slotListEnd)for(var listBindingID in bindingMap)bindingMapRecipients[listBindingID]=bindingMap[listBindingID];else for(var listBindingID in slotNext.bindingMap)bindingMapRecipients[listBindingID]=bindingMap[listBindingID];else if(slotNext===slotListEnd||slotNext.bindingMap)for(var listBindingID in slotPrev.bindingMap)(slotNext===slotListEnd||slotNext.bindingMap[listBindingID])&&(bindingMapRecipients[listBindingID]=bindingMap[listBindingID]);for(var listBindingID in slot.bindingMap)bindingMapRecipients[listBindingID]=bindingMap[listBindingID];return bindingMapRecipients}function sendInsertedNotification(slot){var listBindingID,slotPrev=slot.prev,slotNext=slot.next,bindingMapRecipients=insertionNotificationRecipients(slot,slotPrev,slotNext);for(listBindingID in bindingMapRecipients){var bindingRecord=bindingMapRecipients[listBindingID];bindingRecord.notificationHandler&&handlerToNotify(bindingRecord).inserted(bindingRecord.itemPromiseFromKnownSlot(slot),slotPrev.lastInSequence||slotPrev===slotsStart?null:handleForBinding(slotPrev,listBindingID),slotNext.firstInSequence||slotNext===slotListEnd?null:handleForBinding(slotNext,listBindingID))}}function changeSlot(slot){var itemOld=slot.item;prepareSlotItem(slot),forEachBindingRecordOfSlot(slot,function(bindingRecord,listBindingID){var handle=handleForBinding(slot,listBindingID);handlerToNotify(bindingRecord).changed(itemForBinding(slot.item,handle),itemForBinding(itemOld,handle))})}function moveSlot(slot,slotMoveBefore,mergeWithPrev,mergeWithNext,skipNotifications){var listBindingID,slotMoveAfter=slotMoveBefore.prev;if(slotMoveBefore===slot){if(!slot.firstInSequence||!mergeWithPrev)return;slotMoveBefore=slot.next}else if(slotMoveAfter===slot){if(!slot.lastInSequence||!mergeWithNext)return;slotMoveAfter=slot.prev}if(!skipNotifications){var bindingMapRecipients=insertionNotificationRecipients(slot,slotMoveAfter,slotMoveBefore,mergeWithPrev,mergeWithNext);for(listBindingID in bindingMapRecipients){var bindingRecord=bindingMapRecipients[listBindingID];handlerToNotify(bindingRecord).moved(bindingRecord.itemPromiseFromKnownSlot(slot),(slotMoveAfter.lastInSequence||slotMoveAfter===slot.prev)&&!mergeWithPrev||slotMoveAfter===slotsStart?null:handleForBinding(slotMoveAfter,listBindingID),(slotMoveBefore.firstInSequence||slotMoveBefore===slot.next)&&!mergeWithNext||slotMoveBefore===slotListEnd?null:handleForBinding(slotMoveBefore,listBindingID))}forEachBindingRecord(function(bindingRecord){bindingRecord.adjustCurrentSlot(slot)})}removeSlot(slot),insertAndMergeSlot(slot,slotMoveBefore,mergeWithPrev,mergeWithNext)}function deleteSlot(slot,mirage){completeFetchPromises(slot,!0),forEachBindingRecordOfSlot(slot,function(bindingRecord,listBindingID){handlerToNotify(bindingRecord).removed(handleForBinding(slot,listBindingID),mirage)}),forEachBindingRecord(function(bindingRecord){bindingRecord.adjustCurrentSlot(slot)}),removeSlotPermanently(slot)}function deleteMirageSequence(slot){for(;!slot.firstInSequence;)slot=slot.prev;var last;do{last=slot.lastInSequence;var slotNext=slot.next;deleteSlot(slot,!0),slot=slotNext}while(!last)}function adjustedIndex(slot){var undefinedIndex;if(!slot)return undefinedIndex;for(var delta=0;!slot.firstInSequence;)delta++,slot=slot.prev;return"number"==typeof slot.indexNew?slot.indexNew+delta:"number"==typeof slot.index?slot.index+delta:undefinedIndex}function updateNewIndicesAfterSlot(slot,indexDelta){for(slot=slot.next;slot;slot=slot.next)if(slot.firstInSequence){var indexNew=void 0!==slot.indexNew?slot.indexNew:slot.index;void 0!==indexNew&&(slot.indexNew=indexNew+indexDelta)}countDelta+=indexDelta,indexUpdateDeferred=!0,refreshInProgress?beginRefresh():currentRefreshID++}function updateNewIndices(slot,indexDelta){if(slot.firstInSequence){var indexNew;if(indexDelta<0)indexNew=slot.indexNew,void 0!==indexNew?delete slot.indexNew:indexNew=slot.index,slot.lastInSequence||(slot=slot.next,void 0!==indexNew&&(slot.indexNew=indexNew));else if(!slot.lastInSequence){var slotNext=slot.next;indexNew=slotNext.indexNew,void 0!==indexNew?delete slotNext.indexNew:indexNew=slotNext.index,void 0!==indexNew&&(slot.indexNew=indexNew)}}updateNewIndicesAfterSlot(slot,indexDelta)}function updateNewIndicesFromIndex(index,indexDelta){for(var slot=slotsStart;slot!==slotListEnd;slot=slot.next){var indexNew=slot.indexNew;if(void 0!==indexNew&&index<=indexNew){updateNewIndicesAfterSlot(slot,indexDelta);break}}}function updateIndices(){var slot,slotFirstInSequence,indexNew;for(slot=slotsStart;;slot=slot.next){if(slot.firstInSequence){if(slotFirstInSequence=slot,void 0!==slot.indexNew){if(indexNew=slot.indexNew,delete slot.indexNew,isNaN(indexNew))break}else indexNew=slot.index;slot!==slotsStart&&slot.prev.index===indexNew-1&&mergeSequences(slot.prev)}if(slot.lastInSequence)for(var index=indexNew,slotUpdate=slotFirstInSequence;slotUpdate!==slot.next;slotUpdate=slotUpdate.next)index!==slotUpdate.index&&changeSlotIndex(slotUpdate,index),+index===index&&index++;if(slot===slotListEnd)break}for(;slot!==slotsEnd;slot=slot.next)void 0!==slot.index&&slot!==slotListEnd&&changeSlotIndex(slot,void 0);indexUpdateDeferred=!1,countDelta&&+knownCount===knownCount&&(getCountPromise?getCountPromise.reset():changeCount(knownCount+countDelta),countDelta=0)}function createFetchPromise(slot,listenersProperty,listenerID,listBindingID,onComplete){if(slot.item)return new Promise(function(complete){onComplete?onComplete(complete,slot.item):complete(slot.item)});var listener={listBindingID:listBindingID,retained:!1};return slot[listenersProperty]||(slot[listenersProperty]={}),slot[listenersProperty][listenerID]=listener,listener.promise=new Promise(function(complete,error){listener.complete=onComplete?function(item){onComplete(complete,item)}:complete,listener.error=error},function(){for(;slot.slotMergedWith;)slot=slot.slotMergedWith;var fetchListeners=slot[listenersProperty];if(fetchListeners){if(delete fetchListeners[listenerID],Object.keys(fetchListeners).length>0)return;delete slot[listenersProperty]}releaseSlotIfUnrequested(slot)}),listener.promise}function completePromises(item,listeners){for(var listenerID in listeners)listeners[listenerID].complete(item)}function completeFetchPromises(slot,completeSynchronously){var fetchListeners=slot.fetchListeners,directFetchListeners=slot.directFetchListeners;if(fetchListeners||directFetchListeners){prepareSlotItem(slot);var item=slot.item,completeOrQueuePromises=function(listeners){completeSynchronously?completePromises(item,listeners):fetchCompleteCallbacks.push(function(){completePromises(item,listeners)})};directFetchListeners&&(slot.directFetchListeners=null,completeOrQueuePromises(directFetchListeners)),fetchListeners&&(slot.fetchListeners=null,completeOrQueuePromises(fetchListeners)),releaseSlotIfUnrequested(slot)}}function callFetchCompleteCallbacks(){var callbacks=fetchCompleteCallbacks;fetchCompleteCallbacks=[];for(var i=0,len=callbacks.length;i<len;i++)callbacks[i]()}function returnDirectFetchError(slot,error){var directFetchListeners=slot.directFetchListeners;if(directFetchListeners){slot.directFetchListeners=null;for(var listenerID in directFetchListeners)directFetchListeners[listenerID].error(error);releaseSlotIfUnrequested(slot)}}function requestSlot(slot){return slot.firstInSequence&&addSlotBefore(slot,indexMap),slot.lastInSequence&&addSlotAfter(slot,indexMap),slot.itemNew&&prepareSlotItem(slot),postFetch(),slot}function requestSlotBefore(slotNext){if(!slotNext.firstInSequence){var slotPrev=slotNext.prev;return slotPrev===slotsStart?null:requestSlot(slotPrev)}return requestSlot(addSlotBefore(slotNext,indexMap))}function requestSlotAfter(slotPrev){if(!slotPrev.lastInSequence){var slotNext=slotPrev.next;return slotNext===slotListEnd?null:requestSlot(slotNext)}return requestSlot(addSlotAfter(slotPrev,indexMap))}function itemDirectlyFromSlot(slot){return slot?createFetchPromise(slot,"directFetchListeners",(nextListenerID++).toString()):Promise.wrap(null)}function validateKey(key){if("string"!=typeof key||!key)throw new _ErrorFromName("WinJS.UI.ListDataSource.KeyIsInvalid",strings.keyIsInvalid)}function createSlotForKey(key){var slot=createPrimarySlotSequence(slotsEnd);return setSlotKey(slot,key),slot.keyRequested=!0,slot}function slotFromKey(key,hints){validateKey(key);var slot=keyMap[key];return slot||(slot=createSlotForKey(key),slot.hints=hints),requestSlot(slot)}function slotFromIndex(index){if("number"!=typeof index||index<0)throw new _ErrorFromName("WinJS.UI.ListDataSource.IndexIsInvalid",strings.indexIsInvalid);if(slotListEnd.index<=index)return null;var slot=indexMap[index];if(!slot){var slotNext=successorFromIndex(index,indexMap,slotsStart,slotListEnd);if(!slotNext)return null;slotNext===slotListEnd&&index>=slotListEnd&&changeSlotIndex(slotListEnd,void 0),slot=slotNext.prev.index===index-1?addSlotAfter(slotNext.prev,indexMap):slotNext.index===index+1?addSlotBefore(slotNext,indexMap):createPrimarySlotSequence(slotNext,index)}return slot.item||(slot.indexRequested=!0),requestSlot(slot)}function slotFromDescription(description){var slot=createPrimarySlotSequence(slotsEnd);return slot.description=description,requestSlot(slot)}function setStatus(statusNew){if(statusPending=statusNew,status!==statusPending){var dispatch=function(){statusChangePosted=!1,status!==statusPending&&(status=statusPending,that.dispatchEvent(statusChangedEvent,status))};statusPending===DataSourceStatus.failure?dispatch():statusChangePosted||(statusChangePosted=!0,_Global.setTimeout(dispatch,40))}}function slotFetchInProgress(slot){var fetchID=slot.fetchID;return fetchID&&fetchesInProgress[fetchID]}function setFetchID(slot,fetchID){slot.fetchID=fetchID}function newFetchID(){var fetchID=nextFetchID;return nextFetchID++,fetchesInProgress[fetchID]=!0,fetchID}function setFetchIDs(slot,countBefore,countAfter){var fetchID=newFetchID();setFetchID(slot,fetchID);for(var slotBefore=slot;!slotBefore.firstInSequence&&countBefore>0;)slotBefore=slotBefore.prev,countBefore--,setFetchID(slotBefore,fetchID);for(var slotAfter=slot;!slotAfter.lastInSequence&&countAfter>0;)slotAfter=slotAfter.next,countAfter--,setFetchID(slotAfter,fetchID);return fetchID}function addMarkers(fetchResult){var items=fetchResult.items,offset=fetchResult.offset,totalCount=fetchResult.totalCount,absoluteIndex=fetchResult.absoluteIndex,atStart=fetchResult.atStart,atEnd=fetchResult.atEnd;if(isNonNegativeNumber(absoluteIndex)){if(isNonNegativeNumber(totalCount)){var itemsLength=items.length;absoluteIndex-offset+itemsLength===totalCount&&(atEnd=!0)}offset===absoluteIndex&&(atStart=!0)}atStart&&(items.unshift(startMarker),fetchResult.offset++),atEnd&&items.push(endMarker)}function resultsValid(slot,refreshID,fetchID){return delete fetchesInProgress[fetchID],refreshID===currentRefreshID&&!slotPermanentlyRemoved(slot)||(postFetch(),!1)}function fetchItems(slot,fetchID,promiseItems,index){var refreshID=currentRefreshID;promiseItems.then(function(fetchResult){if(!fetchResult.items||!fetchResult.items.length)return Promise.wrapError(new _ErrorFromName(FetchError.doesNotExist));var perfID="itemsFetched id="+fetchID+" count="+fetchResult.items.length;profilerMarkStart(perfID),resultsValid(slot,refreshID,fetchID)&&(+index===index&&(fetchResult.absoluteIndex=index),addMarkers(fetchResult),processResults(slot,fetchResult.items,fetchResult.offset,fetchResult.totalCount,fetchResult.absoluteIndex)),profilerMarkEnd(perfID)}).then(null,function(error){resultsValid(slot,refreshID,fetchID)&&processErrorResult(slot,error)})}function fetchItemsForIndex(indexRequested,slot,fetchID,promiseItems){var refreshID=currentRefreshID;promiseItems.then(function(fetchResult){if(!fetchResult.items||!fetchResult.items.length)return Promise.wrapError(new _ErrorFromName(FetchError.doesNotExist));var perfID="itemsFetched id="+fetchID+" count="+fetchResult.items.length;profilerMarkStart(perfID),resultsValid(slot,refreshID,fetchID)&&(fetchResult.absoluteIndex=indexRequested,addMarkers(fetchResult),processResultsForIndex(indexRequested,slot,fetchResult.items,fetchResult.offset,fetchResult.totalCount,fetchResult.absoluteIndex)),profilerMarkEnd(perfID)}).then(null,function(){resultsValid(slot,refreshID,fetchID)&&processErrorResultForIndex(indexRequested,slot,refreshID)})}function fetchItemsFromStart(slot,count){var fetchID=setFetchIDs(slot,0,count-1);itemsFromStart?fetchItems(slot,fetchID,itemsFromStart(fetchID,count),0):fetchItems(slot,fetchID,itemsFromIndex(fetchID,0,0,count-1),0)}function fetchItemsFromEnd(slot,count){var fetchID=setFetchIDs(slot,count-1,0);fetchItems(slot,fetchID,itemsFromEnd(fetchID,count))}function fetchItemsFromKey(slot,countBefore,countAfter){var fetchID=setFetchIDs(slot,countBefore,countAfter);fetchItems(slot,fetchID,itemsFromKey(fetchID,slot.key,countBefore,countAfter,slot.hints))}function fetchItemsFromIndex(slot,countBefore,countAfter){var index=slot.index;if(countBefore>index&&(countBefore=index),itemsFromIndex){var fetchID=setFetchIDs(slot,countBefore,countAfter);fetchItems(slot,fetchID,itemsFromIndex(fetchID,index,countBefore,countAfter),index)}else if(slot.key)fetchItemsFromKey(slot,countBefore,countAfter);else{var slotSearch,delta,slotClosest=slotsStart,closestDelta=index+1;for(slotSearch=slot.prev;slotSearch!==slotsStart;slotSearch=slotSearch.prev)if(void 0!==slotSearch.index&&slotSearch.key){delta=index-slotSearch.index,closestDelta>delta&&(closestDelta=delta,slotClosest=slotSearch);break}for(slotSearch=slot.next;slotSearch!==slotListEnd;slotSearch=slotSearch.next)if(void 0!==slotSearch.index&&slotSearch.key){delta=slotSearch.index-index,closestDelta>delta&&(closestDelta=delta,slotClosest=slotSearch);break}if(slotClosest===slotsStart){var fetchID=setFetchIDs(slot,0,index+1);fetchItemsForIndex(0,slot,fetchID,itemsFromStart(fetchID,index+1))}else{var fetchBefore=Math.max(slotClosest.index-index,0),fetchAfter=Math.max(index-slotClosest.index,0),fetchID=setFetchIDs(slotClosest,fetchBefore,fetchAfter);fetchItemsForIndex(slotClosest.index,slot,fetchID,itemsFromKey(fetchID,slotClosest.key,fetchBefore,fetchAfter,slot.hints))}}}function fetchItemsFromDescription(slot,countBefore,countAfter){var fetchID=setFetchIDs(slot,countBefore,countAfter);fetchItems(slot,fetchID,itemsFromDescription(fetchID,slot.description,countBefore,countAfter))}function fetchItemsForAllSlots(){if(!refreshInProgress){for(var slotFirstPlaceholder,placeholderCount,slotRequestedByKey,requestedKeyOffset,slotRequestedByDescription,requestedDescriptionOffset,slotRequestedByIndex,requestedIndexOffset,fetchInProgress=!1,fetchesInProgress=!1,slot=slotsStart.next;slot!==slotsEnd;){var slotNext=slot.next;if(slot!==slotListEnd&&isPlaceholder(slot)&&(fetchesInProgress=!0,slotFirstPlaceholder?placeholderCount++:(slotFirstPlaceholder=slot,placeholderCount=1),slotFetchInProgress(slot)&&(fetchInProgress=!0),slot.keyRequested&&!slotRequestedByKey&&(slotRequestedByKey=slot,requestedKeyOffset=placeholderCount-1),void 0===slot.description||slotRequestedByDescription||(slotRequestedByDescription=slot,requestedDescriptionOffset=placeholderCount-1),slot.indexRequested&&!slotRequestedByIndex&&(slotRequestedByIndex=slot,requestedIndexOffset=placeholderCount-1),slot.lastInSequence||slotNext===slotsEnd||!isPlaceholder(slotNext))){if(fetchInProgress)fetchInProgress=!1;else{if(resultsProcessed=!1,!slotFirstPlaceholder.firstInSequence&&slotFirstPlaceholder.prev.key&&itemsFromKey?fetchItemsFromKey(slotFirstPlaceholder.prev,0,placeholderCount):!slot.lastInSequence&&slotNext.key&&itemsFromKey?fetchItemsFromKey(slotNext,placeholderCount,0):slotFirstPlaceholder.prev!==slotsStart||slotFirstPlaceholder.firstInSequence||!itemsFromStart&&!itemsFromIndex?slotNext===slotListEnd&&!slot.lastInSequence&&itemsFromEnd?fetchItemsFromEnd(slot,placeholderCount):slotRequestedByKey?fetchItemsFromKey(slotRequestedByKey,requestedKeyOffset,placeholderCount-1-requestedKeyOffset):slotRequestedByDescription?fetchItemsFromDescription(slotRequestedByDescription,requestedDescriptionOffset,placeholderCount-1-requestedDescriptionOffset):slotRequestedByIndex?fetchItemsFromIndex(slotRequestedByIndex,requestedIndexOffset,placeholderCount-1-requestedIndexOffset):"number"==typeof slotFirstPlaceholder.index?fetchItemsFromIndex(slotFirstPlaceholder,placeholderCount-1,0):deleteMirageSequence(slotFirstPlaceholder):fetchItemsFromStart(slotFirstPlaceholder,placeholderCount),resultsProcessed)return void postFetch();if(refreshInProgress)return}slotFirstPlaceholder=slotRequestedByIndex=slotRequestedByKey=null}slot=slotNext}setStatus(fetchesInProgress?DataSourceStatus.waiting:DataSourceStatus.ready)}}function postFetch(){fetchesPosted||(fetchesPosted=!0,Scheduler.schedule(function(){fetchesPosted=!1,fetchItemsForAllSlots(),finishNotifications()},Scheduler.Priority.max,null,"WinJS.UI.ListDataSource._fetch"))}function itemChanged(slot){var itemNew=slot.itemNew;if(!itemNew)return!1;var item=slot.item;for(var property in item)switch(property){case"data":break;default:if(item[property]!==itemNew[property])return!0}return listDataAdapter.compareByIdentity?item.data!==itemNew.data:slot.signature!==itemSignature(itemNew)}function changeSlotIfNecessary(slot){slotRequested(slot)?itemChanged(slot)?changeSlot(slot):slot.itemNew=null:slot.item=null}function updateSlotItem(slot){slot.item?changeSlotIfNecessary(slot):completeFetchPromises(slot)}function updateSlot(slot,item){slot.key||setSlotKey(slot,item.key),slot.itemNew=item,updateSlotItem(slot)}function sendMirageNotifications(slot,slotToDiscard,listBindingIDsToDelete){var bindingMap=slotToDiscard.bindingMap;if(bindingMap)for(var listBindingID in listBindingIDsToDelete)if(bindingMap[listBindingID]){var fetchListeners=slotToDiscard.fetchListeners;for(var listenerID in fetchListeners){var listener=fetchListeners[listenerID];listener.listBindingID===listBindingID&&listener.retained&&(delete fetchListeners[listenerID],listener.complete(null))}var bindingRecord=bindingMap[listBindingID].bindingRecord;handlerToNotify(bindingRecord).removed(handleForBinding(slotToDiscard,listBindingID),!0,handleForBinding(slot,listBindingID)),slotToDiscard.bindingMap&&delete slotToDiscard.bindingMap[listBindingID]}}function mergeSlots(slot,slotToDiscard){if(slot.index!==slotToDiscard.index){var indexOld=slotToDiscard.index;slotToDiscard.index=slot.index,sendIndexChangedNotifications(slotToDiscard,indexOld)}slotToDiscard.slotMergedWith=slot;var bindingMap=slotToDiscard.bindingMap;for(var listBindingID in bindingMap){slot.bindingMap||(slot.bindingMap={});var slotBinding=bindingMap[listBindingID];slotBinding.handle||(slotBinding.handle=slotToDiscard.handle),handleMap[slotBinding.handle]=slot,slot.bindingMap[listBindingID]=slotBinding}forEachBindingRecord(function(bindingRecord){bindingRecord.adjustCurrentSlot(slotToDiscard,slot)});var item=slotToDiscard.itemNew||slotToDiscard.item;if(item&&(item=Object.create(item),defineCommonItemProperties(item,slot,slot.handle),updateSlot(slot,item)),slot.item)slotToDiscard.directFetchListeners&&fetchCompleteCallbacks.push(function(){completePromises(slot.item,slotToDiscard.directFetchListeners)}),slotToDiscard.fetchListeners&&fetchCompleteCallbacks.push(function(){completePromises(slot.item,slotToDiscard.fetchListeners)});else{var listenerID;for(listenerID in slotToDiscard.directFetchListeners)slot.directFetchListeners||(slot.directFetchListeners={}),slot.directFetchListeners[listenerID]=slotToDiscard.directFetchListeners[listenerID];for(listenerID in slotToDiscard.fetchListeners)slot.fetchListeners||(slot.fetchListeners={}),slot.fetchListeners[listenerID]=slotToDiscard.fetchListeners[listenerID]}slot.itemNew&&completeFetchPromises(slot),slotToDiscard.handle=(nextHandle++).toString(),splitSequence(slotToDiscard),removeSlotPermanently(slotToDiscard)}function mergeSlotsAndItem(slot,slotToDiscard,item){slotToDiscard&&slotToDiscard.key&&(item||(item=slotToDiscard.itemNew||slotToDiscard.item),delete slotToDiscard.key,delete keyMap[item.key],slotToDiscard.itemNew=null,slotToDiscard.item=null),item&&updateSlot(slot,item),slotToDiscard&&mergeSlots(slot,slotToDiscard);
}function slotFromResult(result){if("object"!=typeof result)throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidItemReturned",strings.invalidItemReturned);if(result===startMarker)return slotsStart;if(result===endMarker)return slotListEnd;if(result.key)return _BaseUtils.validation&&validateKey(result.key),keyMap[result.key];throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidKeyReturned",strings.invalidKeyReturned)}function matchSlot(slot,result){var slotExisting=slotFromResult(result);slotExisting===slot&&(slotExisting=null),slotExisting&&sendMirageNotifications(slot,slotExisting,slot.bindingMap),mergeSlotsAndItem(slot,slotExisting,result)}function promoteSlot(slot,item,index,insertionPoint){if(item&&slot.key&&slot.key!==item.key)return beginRefresh(),!1;var slotWithIndex=indexMap[index];if(slotWithIndex)if(slotWithIndex===slot)slotWithIndex=null;else{if(slotWithIndex.key&&(slot.key||item&&slotWithIndex.key!==item.key))return beginRefresh(),!1;if(!slot.key&&slotWithIndex.bindingMap)return!1}var slotWithKey;if(item)if(slotWithKey=keyMap[item.key],slotWithKey===slot)slotWithKey=null;else if(slotWithKey&&slotWithKey.bindingMap)return!1;return slotWithIndex?(sendMirageNotifications(slot,slotWithIndex,slot.bindingMap),delete indexMap[index],changeSlotIndex(slot,index),slot.prev.index===index-1&&mergeSequences(slot.prev),slot.next.index===index+1&&mergeSequences(slot),insertionPoint.slotNext=slotWithIndex.slotNext,item||(item=slotWithIndex.itemNew||slotWithIndex.item,item&&(slotWithKey=keyMap[item.key]))):changeSlotIndex(slot,index),slotWithKey&&slotWithIndex!==slotWithKey&&sendMirageNotifications(slot,slotWithKey,slot.bindingMap),mergeSlotsAndItem(slot,slotWithKey,item),slotWithIndex&&slotWithIndex!==slotWithKey&&mergeSlots(slot,slotWithIndex),!0}function mergeAdjacentSlot(slotExisting,slot,listBindingIDsToDelete){if(slot.key&&slotExisting.key&&slot.key!==slotExisting.key)return beginRefresh(),!1;for(var listBindingID in slotExisting.bindingMap)listBindingIDsToDelete[listBindingID]=!0;return sendMirageNotifications(slotExisting,slot,listBindingIDsToDelete),mergeSlotsAndItem(slotExisting,slot),!0}function mergeSlotsBefore(slot,slotExisting){for(var listBindingIDsToDelete={};slot;){var slotPrev=slot.firstInSequence?null:slot.prev;if(slotExisting.firstInSequence||slotExisting.prev!==slotsStart){if(slotExisting=slotExisting.firstInSequence?addSlotBefore(slotExisting,indexMap):slotExisting.prev,!mergeAdjacentSlot(slotExisting,slot,listBindingIDsToDelete))return}else deleteSlot(slot,!0);slot=slotPrev}}function mergeSlotsAfter(slot,slotExisting){for(var listBindingIDsToDelete={};slot;){var slotNext=slot.lastInSequence?null:slot.next;if(slotExisting.lastInSequence||slotExisting.next!==slotListEnd){if(slotExisting=slotExisting.lastInSequence?addSlotAfter(slotExisting,indexMap):slotExisting.next,!mergeAdjacentSlot(slotExisting,slot,listBindingIDsToDelete))return}else deleteSlot(slot,!0);slot=slotNext}}function mergeSequencePairs(sequencePairsToMerge){for(var i=0;i<sequencePairsToMerge.length;i++){var sequencePairToMerge=sequencePairsToMerge[i];mergeSlotsBefore(sequencePairToMerge.slotBeforeSequence,sequencePairToMerge.slotFirstInSequence),mergeSlotsAfter(sequencePairToMerge.slotAfterSequence,sequencePairToMerge.slotLastInSequence)}}function removeMirageIndices(countMax,indexFirstKnown){function removePlaceholdersAfterSlot(slotRemoveAfter){for(var slot2=slotListEnd.prev;!(slot2.index<countMax)&&slot2!==slotRemoveAfter;){var slotPrev2=slot2.prev;void 0!==slot2.index&&deleteSlot(slot2,!0),slot2=slotPrev2}placeholdersAtEnd=0}for(var placeholdersAtEnd=0,slot=slotListEnd.prev;!(slot.index<countMax)||placeholdersAtEnd>0;){var slotPrev=slot.prev;if(slot===slotsStart){removePlaceholdersAfterSlot(slotsStart);break}if(slot.key){if(slot.index>=countMax)return beginRefresh(),!1;if(!(slot.index>=indexFirstKnown))return itemsFromKey?fetchItemsFromKey(slot,0,placeholdersAtEnd):fetchItemsFromIndex(slot,0,placeholdersAtEnd),!1;removePlaceholdersAfterSlot(slot)}else slot.indexRequested||slot.firstInSequence?removePlaceholdersAfterSlot(slotPrev):placeholdersAtEnd++;slot=slotPrev}return!0}function processResults(slot,results,offset,count,index){var perfId="WinJS.UI.ListDataSource.processResults";return profilerMarkStart(perfId),index=validateIndexReturned(index),count=validateCountReturned(count),editsQueued?void profilerMarkEnd(perfId):(indexUpdateDeferred&&updateIndices(),!isNonNegativeNumber(count)&&count!==CountResult.unknown||count===knownCount||slotListEnd.firstInSequence?(resultsProcessed=!0,function(){var i,j,slotExisting,slotBefore,resultsCount=results.length;if("number"!=typeof index)for(i=0;i<resultsCount;i++)if(slotExisting=slotFromResult(results[i]),slotExisting&&void 0!==slotExisting.index){index=slotExisting.index+offset-i;break}"number"==typeof index&&results[resultsCount-1]===endMarker?count=index-offset+resultsCount-1:!isNonNegativeNumber(count)||void 0!==index&&null!==index||(index=count-(resultsCount-1)+offset),isNonNegativeNumber(count)&&!removeMirageIndices(count,index-offset)&&(count=void 0);var offsetMap=new Array(resultsCount);for(i=0;i<resultsCount;i++){var slotBestMatch=null;if(slotExisting=slotFromResult(results[i])){if(i>0&&!slotExisting.firstInSequence&&slotExisting.prev.key&&slotExisting.prev.key!==results[i-1].key||"number"==typeof index&&void 0!==slotExisting.index&&slotExisting.index!==index-offset+i)return void beginRefresh();(slotExisting===slotsStart||slotExisting===slotListEnd||slotExisting.bindingMap)&&(slotBestMatch=slotExisting)}if("number"==typeof index&&(slotExisting=indexMap[index-offset+i])){if(slotExisting.key&&slotExisting.key!==results[i].key)return void beginRefresh();!slotBestMatch&&slotExisting.bindingMap&&(slotBestMatch=slotExisting)}if(i===offset){if(slot.key&&slot.key!==results[i].key||"number"==typeof slot.index&&"number"==typeof index&&slot.index!==index)return void beginRefresh();slotBestMatch||(slotBestMatch=slot)}offsetMap[i]=slotBestMatch}for(i=0;i<resultsCount;i++)slotExisting=offsetMap[i],slotExisting&&void 0!==slotExisting.index&&slotExisting!==slotsStart&&slotExisting!==slotListEnd&&matchSlot(slotExisting,results[i]);var slotBeforeSequence,slotAfterSequence,sequencePairsToMerge=[],firstSequence=!0;for(i=0;i<resultsCount;i++)if(slotExisting=offsetMap[i],slotExisting&&slotExisting!==slotListEnd){var iLast=i;if(void 0===slotExisting.index){var insertionPoint={};promoteSlot(slotExisting,results[i],index-offset+i,insertionPoint);var result,slotFirstInSequence=slotExisting,slotLastInSequence=slotExisting;for(j=i-1;!slotFirstInSequence.firstInSequence&&(result=results[j],result!==startMarker);j--){var index2=index-offset+j;if(index2<0)break;if(!promoteSlot(slotFirstInSequence.prev,result,index2,insertionPoint))break;slotFirstInSequence=slotFirstInSequence.prev,j>=0&&(offsetMap[j]=slotFirstInSequence)}for(j=i+1;!slotLastInSequence.lastInSequence&&(result=results[j],result!==endMarker&&j!==count||slotLastInSequence.next===slotListEnd)&&(slotLastInSequence.next===slotListEnd||promoteSlot(slotLastInSequence.next,result,index-offset+j,insertionPoint))&&(slotLastInSequence=slotLastInSequence.next,j<resultsCount&&(offsetMap[j]=slotLastInSequence),iLast=j,slotLastInSequence!==slotListEnd);j++);if(slotBeforeSequence=slotFirstInSequence.firstInSequence?null:slotFirstInSequence.prev,slotAfterSequence=slotLastInSequence.lastInSequence?null:slotLastInSequence.next,slotBeforeSequence&&splitSequence(slotBeforeSequence),slotAfterSequence&&splitSequence(slotLastInSequence),"number"==typeof index){if(slotLastInSequence===slotListEnd)slotBeforeSequence&&moveSequenceAfter(slotListEnd,sequenceStart(slotBeforeSequence),slotBeforeSequence);else{var slotInsertBefore=insertionPoint.slotNext;slotInsertBefore||(slotInsertBefore=successorFromIndex(slotLastInSequence.index,indexMap,slotsStart,slotListEnd,!0)),moveSequenceBefore(slotInsertBefore,slotFirstInSequence,slotLastInSequence)}slotFirstInSequence.prev.index===slotFirstInSequence.index-1&&mergeSequences(slotFirstInSequence.prev),slotLastInSequence.next.index===slotLastInSequence.index+1&&mergeSequences(slotLastInSequence)}else firstSequence||(slotBefore=offsetMap[i-1],slotBefore&&(slotFirstInSequence.prev!==slotBefore&&(slotLastInSequence===slotListEnd?(slotBeforeSequence&&moveSequenceAfter(slotListEnd,sequenceStart(slotBeforeSequence),slotBeforeSequence),moveSequenceBefore(slotFirstInSequence,sequenceStart(slotBefore),slotBefore)):moveSequenceAfter(slotBefore,slotFirstInSequence,slotLastInSequence)),mergeSequences(slotBefore)));if(firstSequence=!1,refreshRequested)return;sequencePairsToMerge.push({slotBeforeSequence:slotBeforeSequence,slotFirstInSequence:slotFirstInSequence,slotLastInSequence:slotLastInSequence,slotAfterSequence:slotAfterSequence})}i!==offset||slotExisting===slot||slotPermanentlyRemoved(slot)||(slotBeforeSequence=slot.firstInSequence?null:slot.prev,slotAfterSequence=slot.lastInSequence?null:slot.next,sendMirageNotifications(slotExisting,slot,slotExisting.bindingMap),mergeSlots(slotExisting,slot),sequencePairsToMerge.push({slotBeforeSequence:slotBeforeSequence,slotFirstInSequence:slotExisting,slotLastInSequence:slotExisting,slotAfterSequence:slotAfterSequence})),i=iLast}for(isNonNegativeNumber(count)&&slotListEnd.index!==count&&changeSlotIndex(slotListEnd,count),mergeSequencePairs(sequencePairsToMerge),i=0;i<resultsCount;i++)if(slotExisting=offsetMap[i]){for(j=i-1;j>=0;j--){var slotAfter=offsetMap[j+1];matchSlot(offsetMap[j]=slotAfter.firstInSequence?addSlotBefore(offsetMap[j+1],indexMap):slotAfter.prev,results[j])}for(j=i+1;j<resultsCount;j++)slotBefore=offsetMap[j-1],slotExisting=offsetMap[j],slotExisting?slotExisting.firstInSequence&&(slotExisting.prev!==slotBefore&&moveSequenceAfter(slotBefore,slotExisting,sequenceEnd(slotExisting)),mergeSequences(slotBefore)):matchSlot(offsetMap[j]=slotBefore.lastInSequence?addSlotAfter(slotBefore,indexMap):slotBefore.next,results[j]);break}delete slot.description}(),refreshRequested||(void 0!==count&&count!==knownCount&&changeCount(count),postFetch()),finishNotifications(),callFetchCompleteCallbacks(),void profilerMarkEnd(perfId)):(beginRefresh(),void profilerMarkEnd(perfId)))}function processErrorResult(slot,error){switch(error.name){case FetchError.noResponse:setStatus(DataSourceStatus.failure),returnDirectFetchError(slot,error);break;case FetchError.doesNotExist:slot.indexRequested?removeMirageIndices(slot.index):(slot.keyRequested||slot.description)&&deleteMirageSequence(slot),finishNotifications(),beginRefresh()}}function processResultsForIndex(indexRequested,slot,results,offset,count,index){index=validateIndexReturned(index),count=validateCountReturned(count);var indexFirst=indexRequested-offset,resultsCount=results.length;if(slot.index>=indexFirst&&slot.index<indexFirst+resultsCount)processResults(slot,results,slot.index-indexFirst,count,slot.index);else if(offset===resultsCount-1&&indexRequested<slot.index||isNonNegativeNumber(count)&&count<=slot.index)processErrorResult(slot,new _ErrorFromName(FetchError.doesNotExist));else if(slot.index<indexFirst){var fetchID=setFetchIDs(slot,0,indexFirst-slot.index);fetchItemsForIndex(indexFirst,slot,fetchID,itemsFromKey(fetchID,results[0].key,indexFirst-slot.index,0))}else{var indexLast=indexFirst+resultsCount-1,fetchID=setFetchIDs(slot,slot.index-indexLast,0);fetchItemsForIndex(indexLast,slot,fetchID,itemsFromKey(fetchID,results[resultsCount-1].key,0,slot.index-indexLast))}}function processErrorResultForIndex(indexRequested,slot,error){switch(error.name){case FetchError.doesNotExist:indexRequested===slotsStart.index?(removeMirageIndices(0),processErrorResult(slot,error)):beginRefresh();break;default:processErrorResult(slot,error)}}function identifyRefreshCycle(){for(var start=0;start<refreshHistory.length&&"beginRefresh"!==refreshHistory[start].kind;start++);for(var end=start;end<refreshHistory.length&&"beginRefresh"!==refreshHistory[end].kind;end++);if(end>start&&end+(end-start)<refreshHistory.length){for(var match=!0,length=end-start,i=0;i<length;i++)if(refreshHistory[start+i].kind!==refreshHistory[end+i].kind){match=!1;break}if(match&&_Log.log){_Log.log(strings.refreshCycleIdentified,"winjs vds","error");for(var i=start;i<end;i++)_Log.log(""+(i-start)+": "+JSON.stringify(refreshHistory[i]),"winjs vds","error")}return match}}function resetRefreshState(){return++beginRefreshCount>MAX_BEGINREFRESH_COUNT&&identifyRefreshCycle()?void setStatus(DataSourceStatus.failure):(refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"beginRefresh"},refreshStart={firstInSequence:!0,lastInSequence:!0,index:-1},refreshEnd={firstInSequence:!0,lastInSequence:!0},refreshStart.next=refreshEnd,refreshEnd.prev=refreshStart,refreshItemsFetched=!1,refreshCount=void 0,keyFetchIDs={},refreshKeyMap={},refreshIndexMap={},refreshIndexMap[-1]=refreshStart,void(deletedKeys={}))}function beginRefresh(){if(!refreshRequested){if(refreshRequested=!0,setStatus(DataSourceStatus.waiting),waitForRefresh)return waitForRefresh=!1,void applyNextEdit();if(!editsQueued){var refreshID=++currentRefreshID;refreshInProgress=!0,refreshFetchesInProgress=0,Scheduler.schedule(function(){if(currentRefreshID===refreshID){refreshRequested=!1,resetRefreshState();for(var slot=slotsStart.next;slot!==slotsEnd;){var slotNext=slot.next;slotLive(slot)||slot===slotListEnd||deleteUnnecessarySlot(slot),slot=slotNext}startRefreshFetches()}},Scheduler.Priority.high,null,"WinJS.VirtualizedDataSource.beginRefresh")}}}function requestRefresh(){return refreshSignal=refreshSignal||new _Signal,beginRefresh(),refreshSignal.promise}function resultsValidForRefresh(refreshID,fetchID){return delete fetchesInProgress[fetchID],refreshID===currentRefreshID&&(refreshFetchesInProgress--,!0)}function fetchItemsForRefresh(key,fromStart,fetchID,promiseItems,index){var refreshID=currentRefreshID;refreshFetchesInProgress++,promiseItems.then(function(fetchResult){if(!fetchResult.items||!fetchResult.items.length)return Promise.wrapError(new _ErrorFromName(FetchError.doesNotExist));var perfID="itemsFetched id="+fetchID+" count="+fetchResult.items.length;profilerMarkStart(perfID),resultsValidForRefresh(refreshID,fetchID)&&(addMarkers(fetchResult),processRefreshResults(key,fetchResult.items,fetchResult.offset,fetchResult.totalCount,"number"==typeof index?index:fetchResult.absoluteIndex)),profilerMarkEnd(perfID)}).then(null,function(error){resultsValidForRefresh(refreshID,fetchID)&&processRefreshErrorResult(key,fromStart,error)})}function refreshRange(slot,fetchID,countBefore,countAfter){if(itemsFromKey)fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromKey(fetchID,slot.key,countBefore,countAfter,slot.hints));else{var searchDelta=10,index=slot.index;refreshIndexMap[index]&&refreshIndexMap[index].firstInSequence?fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromIndex(fetchID,index-1,Math.min(countBefore+searchDelta,index)-1,countAfter+1+searchDelta),index-1):refreshIndexMap[index]&&refreshIndexMap[index].lastInSequence?fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromIndex(fetchID,index+1,Math.min(countBefore+searchDelta,index)+1,countAfter-1+searchDelta),index+1):fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromIndex(fetchID,index,Math.min(countBefore+searchDelta,index),countAfter+searchDelta),index)}}function refreshFirstItem(fetchID){itemsFromStart?fetchItemsForRefresh(null,!0,fetchID,itemsFromStart(fetchID,1),0):itemsFromIndex&&fetchItemsForRefresh(null,!0,fetchID,itemsFromIndex(fetchID,0,0,0),0)}function keyFetchInProgress(key){return fetchesInProgress[keyFetchIDs[key]]}function refreshRanges(slotFirst,allRanges){for(var slotFetchFirst,slotRefreshFirst,fetchID,refreshFetchExtra=3,refreshID=currentRefreshID,fetchCount=0,slot=slotFirst;slot!==slotsEnd;slot=slot.next){if(!slotFetchFirst&&slot.key&&!deletedKeys[slot.key]&&!keyFetchInProgress(slot.key)){var slotRefresh=refreshKeyMap[slot.key];(!slotRefresh||slotRefresh.firstInSequence||slotRefresh.lastInSequence)&&(slotFetchFirst=slot,slotRefreshFirst=slotRefresh,fetchID=newFetchID())}if(slotFetchFirst){var keyAlreadyFetched=keyFetchInProgress(slot.key);if(deletedKeys[slot.key]||refreshKeyMap[slot.key]||keyAlreadyFetched||(slot.key&&(keyFetchIDs[slot.key]=fetchID),fetchCount++),slot.lastInSequence||slot.next===slotListEnd||keyAlreadyFetched){if(refreshRange(slotFetchFirst,fetchID,!slotRefreshFirst||slotRefreshFirst.firstInSequence?refreshFetchExtra:0,fetchCount-1+refreshFetchExtra),!allRanges)break;slotFetchFirst=null,fetchCount=0}}else slot.key&&isPlaceholder(slot)&&!deletedKeys[slot.key]&&(refreshKeyMap[slot.key]||(fetchID=newFetchID(),fetchItemsForRefresh(slot.key,!1,fetchID,itemsFromKey(fetchID,slot.key,1,1,slot.hints))))}0!==refreshFetchesInProgress||refreshItemsFetched||currentRefreshID!==refreshID||refreshFirstItem(newFetchID())}function startRefreshFetches(){var refreshID=currentRefreshID;do synchronousProgress=!1,reentrantContinue=!0,refreshRanges(slotsStart.next,!0),reentrantContinue=!1;while(0===refreshFetchesInProgress&&synchronousProgress&&currentRefreshID===refreshID&&refreshInProgress);0===refreshFetchesInProgress&&currentRefreshID===refreshID&&concludeRefresh()}function continueRefresh(key){var refreshID=currentRefreshID;if(key){var slotContinue=keyMap[key];slotContinue||(slotContinue=slotsStart.next);do synchronousRefresh=!1,reentrantRefresh=!0,refreshRanges(slotContinue,!1),reentrantRefresh=!1;while(synchronousRefresh&&currentRefreshID===refreshID&&refreshInProgress)}reentrantContinue?synchronousProgress=!0:0===refreshFetchesInProgress&&currentRefreshID===refreshID&&startRefreshFetches()}function slotRefreshFromResult(result){if("object"==typeof result&&result){if(result===startMarker)return refreshStart;if(result===endMarker)return refreshEnd;if(result.key)return refreshKeyMap[result.key];throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidKeyReturned",strings.invalidKeyReturned)}throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidItemReturned",strings.invalidItemReturned)}function processRefreshSlotIndex(slot,expectedIndex){for(;void 0===slot.index;){if(setSlotIndex(slot,expectedIndex,refreshIndexMap),slot.firstInSequence)return!0;slot=slot.prev,expectedIndex--}return slot.index===expectedIndex||(beginRefresh(),!1)}function setRefreshSlotResult(slotRefresh,result){slotRefresh.key=result.key,refreshKeyMap[slotRefresh.key]=slotRefresh,slotRefresh.item=result}function lastRefreshInsertionPoint(){for(var slotNext=refreshEnd;!slotNext.firstInSequence;)if(slotNext=slotNext.prev,slotNext===refreshStart)return null;return slotNext}function processRefreshResults(key,results,offset,count,index){index=validateIndexReturned(index),count=validateCountReturned(count);var keyPresent=!1;refreshItemsFetched=!0;var indexFirst=index-offset,result=results[0];result.key===key&&(keyPresent=!0);var slot=slotRefreshFromResult(result);if(slot){if(+indexFirst===indexFirst&&!processRefreshSlotIndex(slot,indexFirst))return}else{if(refreshIndexMap[indexFirst])return void beginRefresh();var slotPrev;if(void 0!==index&&(slotPrev=refreshIndexMap[indexFirst-1])){if(!slotPrev.lastInSequence)return void beginRefresh();slot=addSlotAfter(slotPrev,refreshIndexMap)}else{var slotSuccessor=+indexFirst===indexFirst?successorFromIndex(indexFirst,refreshIndexMap,refreshStart,refreshEnd):lastRefreshInsertionPoint(refreshStart,refreshEnd);if(!slotSuccessor)return void beginRefresh();slot=createSlotSequence(slotSuccessor,indexFirst,refreshIndexMap)}setRefreshSlotResult(slot,results[0])}for(var resultsCount=results.length,i=1;i<resultsCount;i++){result=results[i],result.key===key&&(keyPresent=!0);var slotNext=slotRefreshFromResult(result);if(slotNext){if(void 0!==slot.index&&!processRefreshSlotIndex(slotNext,slot.index+1))return;if(slotNext!==slot.next){if(!slot.lastInSequence||!slotNext.firstInSequence)return void beginRefresh();var slotLast=sequenceEnd(slotNext);if(slotLast!==refreshEnd)moveSequenceAfter(slot,slotNext,slotLast);else{var slotFirst=sequenceStart(slot);if(slotFirst===refreshStart)return void beginRefresh();moveSequenceBefore(slotNext,slotFirst,slot)}mergeSequences(slot)}else slot.lastInSequence&&mergeSequences(slot)}else{if(!slot.lastInSequence)return void beginRefresh();slotNext=addSlotAfter(slot,refreshIndexMap),setRefreshSlotResult(slotNext,result)}slot=slotNext}if(keyPresent||(deletedKeys[key]=!0),!isNonNegativeNumber(count)&&!refreshEnd.firstInSequence){var indexLast=refreshEnd.prev.index;void 0!==indexLast&&(count=indexLast+1)}if(isNonNegativeNumber(count)||count===CountResult.unknown){if(isNonNegativeNumber(refreshCount)){if(count!==refreshCount)return void beginRefresh()}else refreshCount=count;isNonNegativeNumber(refreshCount)&&!refreshIndexMap[refreshCount]&&setSlotIndex(refreshEnd,refreshCount,refreshIndexMap)}reentrantRefresh?synchronousRefresh=!0:continueRefresh(key)}function processRefreshErrorResult(key,fromStart,error){switch(error.name){case FetchError.noResponse:setStatus(DataSourceStatus.failure);break;case FetchError.doesNotExist:fromStart?(setSlotIndex(refreshEnd,0,refreshIndexMap),refreshCount=0,concludeRefresh()):(deletedKeys[key]=!0,reentrantRefresh?synchronousRefresh=!0:continueRefresh(key))}}function slotFromSlotRefresh(slotRefresh){return slotRefresh===refreshStart?slotsStart:slotRefresh===refreshEnd?slotListEnd:keyMap[slotRefresh.key]}function slotRefreshFromSlot(slot){return slot===slotsStart?refreshStart:slot===slotListEnd?refreshEnd:refreshKeyMap[slot.key]}function mergeSequencesForRefresh(slotPrev){mergeSequences(slotPrev),slotPrev.next.mergedForRefresh=!0}function copyRefreshSlotData(slotRefresh,slot){setSlotKey(slot,slotRefresh.key),slot.itemNew=slotRefresh.item}function addNewSlotFromRefresh(slotRefresh,slotNext,insertAfter){var slotNew=createPrimarySlot();copyRefreshSlotData(slotRefresh,slotNew),insertAndMergeSlot(slotNew,slotNext,insertAfter,!insertAfter);var index=slotRefresh.index;return+index!==index&&(index=insertAfter?slotNew.prev.index+1:slotNext.next.index-1),setSlotIndex(slotNew,index,indexMap),slotNew}function matchSlotForRefresh(slotExisting,slot,slotRefresh){slotExisting?(sendMirageNotifications(slotExisting,slot,slotExisting.bindingMap),mergeSlotsAndItem(slotExisting,slot,slotRefresh.item)):(copyRefreshSlotData(slotRefresh,slot),slot.indexRequested&&updateSlotItem(slot))}function updateSlotForRefresh(slotExisting,slot,slotRefresh){return!slot.key&&(slotExisting?(slotRefresh.mergeWithPrev=!slot.firstInSequence,slotRefresh.mergeWithNext=!slot.lastInSequence):slotRefresh.stationary=!0,matchSlotForRefresh(slotExisting,slot,slotRefresh),!0)}function indexForRefresh(slot){var indexNew;if(slot.indexRequested)indexNew=slot.index;else{var slotRefresh=slotRefreshFromSlot(slot);slotRefresh&&(indexNew=slotRefresh.index)}return indexNew}function concludeRefresh(){beginRefreshCount=0,refreshHistory=new Array(100),refreshHistoryPos=-1,indexUpdateDeferred=!0,keyFetchIDs={};var i,j,slot,slotPrev,slotNext,slotBefore,slotAfter,slotRefresh,slotExisting,slotFirstInSequence,sequenceCountOld,sequenceOld,sequenceOldPrev,sequenceOldBestMatch,sequenceCountNew,sequenceNew,index,offset,sequencesOld=[],sequencesNew=[];for(sequenceCountNew=0,slotRefresh=refreshStart;slotRefresh;slotRefresh=slotRefresh.next)slotRefresh.sequenceNumber=sequenceCountNew,slotRefresh.firstInSequence&&(slotFirstInSequence=slotRefresh),slotRefresh.lastInSequence&&(sequencesNew[sequenceCountNew]={first:slotFirstInSequence,last:slotRefresh,matchingItems:0},sequenceCountNew++);for(lastSlotReleased=null,releasedSlots=0,slot=slotsStart.next;slot!==slotsEnd;)slotRefresh=refreshKeyMap[slot.key],slotNext=slot.next,slot!==slotListEnd&&(slotLive(slot)?slot.key&&!slotRefresh?deleteSlot(slot,!1):0===refreshCount||slot.indexRequested&&slot.index>=refreshCount?deleteSlot(slot,!0):slot.item||slot.keyRequested?slot.itemNew=slotRefresh.item:slot.key&&(slot.keyRequested||(delete keyMap[slot.key],delete slot.key),slot.itemNew=null):deleteUnnecessarySlot(slot)),slot=slotNext;for(slot=slotsStart.next;slot!==slotListEnd;)slotNext=slot.next,slot.indexRequested&&(slotRefresh=refreshIndexMap[slot.index],slotRefresh&&matchSlotForRefresh(slotFromSlotRefresh(slotRefresh),slot,slotRefresh)),slot=slotNext;var bestMatch,bestMatchCount,slotIndexRequested,sequenceIndexEnd,sequenceOldEnd,previousBestMatch=0,newSequenceCounts=[];for(sequenceCountOld=0,slot=slotsStart;slot!==slotsEnd;slot=slot.next){if(slot.firstInSequence)for(slotFirstInSequence=slot,slotIndexRequested=null,i=0;i<sequenceCountNew;i++)newSequenceCounts[i]=0;if(slot.indexRequested&&(slotIndexRequested=slot),slotRefresh=slotRefreshFromSlot(slot),slotRefresh&&newSequenceCounts[slotRefresh.sequenceNumber]++,slot.lastInSequence){for(bestMatchCount=0,i=previousBestMatch;i<sequenceCountNew;i++)bestMatchCount<newSequenceCounts[i]&&(bestMatchCount=newSequenceCounts[i],bestMatch=i);sequenceOld={first:slotFirstInSequence,last:slot,sequenceNew:bestMatchCount>0?sequencesNew[bestMatch]:void 0,matchingItems:bestMatchCount},slotIndexRequested&&(sequenceOld.indexRequested=!0,sequenceOld.stationarySlot=slotIndexRequested),sequencesOld[sequenceCountOld]=sequenceOld,slot===slotListEnd&&(sequenceIndexEnd=sequenceCountOld,sequenceOldEnd=sequenceOld),sequenceCountOld++,void 0!==sequencesNew[bestMatch].first.index&&(previousBestMatch=bestMatch)}}sequencesOld[0].sequenceNew!==sequencesNew[0]&&(splitSequence(slotsStart),sequencesOld[0].first=slotsStart.next,sequencesOld.unshift({first:slotsStart,last:slotsStart,sequenceNew:sequencesNew[0],matchingItems:1}),sequenceIndexEnd++,sequenceCountOld++);var listEndObserved=!slotListEnd.firstInSequence;for(sequenceOldEnd.sequenceNew!==sequencesNew[sequenceCountNew-1]&&(splitSequence(slotListEnd.prev),sequenceOldEnd.last=slotListEnd.prev,sequenceIndexEnd++,sequencesOld.splice(sequenceIndexEnd,0,{first:slotListEnd,last:slotListEnd,sequenceNew:sequencesNew[sequenceCountNew-1],matchingItems:1}),sequenceCountOld++,sequenceOldEnd=sequencesOld[sequenceIndexEnd]),i=0;i<sequenceCountOld;i++)sequenceNew=sequencesOld[i].sequenceNew,sequenceNew&&sequenceNew.matchingItems<sequencesOld[i].matchingItems&&(sequenceNew.matchingItems=sequencesOld[i].matchingItems,sequenceNew.sequenceOld=sequencesOld[i]);for(sequencesNew[sequenceCountNew-1].sequenceOld=sequenceOldEnd,sequenceOldEnd.stationarySlot=slotListEnd,sequencesNew[0].sequenceOld=sequencesOld[0],sequencesOld[0].stationarySlot=slotsStart,i=0;i<=sequenceIndexEnd;i++)sequenceOld=sequencesOld[i],sequenceOld.sequenceNew&&(sequenceOldBestMatch=sequenceOld.sequenceNew.sequenceOld)===sequenceOldPrev&&sequenceOldPrev.last!==slotListEnd?(mergeSequencesForRefresh(sequenceOldBestMatch.last),sequenceOldBestMatch.last=sequenceOld.last,delete sequencesOld[i]):sequenceOldPrev=sequenceOld;for(sequenceOldPrev=null,i=sequenceIndexEnd;i>=0;i--)sequenceOld=sequencesOld[i],sequenceOld&&(sequenceOld.sequenceNew&&(sequenceOldBestMatch=sequenceOld.sequenceNew.sequenceOld)===sequenceOldPrev&&sequenceOld.last!==slotListEnd?(mergeSequencesForRefresh(sequenceOld.last),sequenceOldBestMatch.first=sequenceOld.first,delete sequencesOld[i]):sequenceOldPrev=sequenceOld);listEndObserved&&delete slotListEnd.mergedForRefresh;var sequencePairsToMerge=[];for(i=sequenceIndexEnd+1;i<sequenceCountOld;i++)if(sequenceOld=sequencesOld[i],sequenceOld&&(!sequenceOld.sequenceNew||sequenceOld.sequenceNew.sequenceOld!==sequenceOld)){var orderPreserved=!0,slotRefreshFirst=null,slotRefreshLast=null,sequenceLength=0;for(slotRefresh=slotRefreshFromSlot(sequenceOld.first),slotRefresh&&(slotRefreshFirst=slotRefreshLast=slotRefresh,sequenceLength=1),slot=sequenceOld.first;slot!==sequenceOld.last;slot=slot.next){var slotRefreshNext=slotRefreshFromSlot(slot.next);if(slotRefresh&&slotRefreshNext&&(slotRefresh.lastInSequence||slotRefresh.next!==slotRefreshNext)){orderPreserved=!1;break}slotRefresh&&!slotRefreshFirst&&(slotRefreshFirst=slotRefreshLast=slotRefresh),slotRefreshNext&&slotRefreshFirst&&(slotRefreshLast=slotRefreshNext,sequenceLength++),slotRefresh=slotRefreshNext}if(orderPreserved&&slotRefreshFirst&&void 0!==slotRefreshFirst.index){var indexBefore;slotRefreshFirst.firstInSequence||(slotBefore=slotFromSlotRefresh(slotRefreshFirst.prev),slotBefore&&(indexBefore=slotBefore.index));var indexAfter;if(slotRefreshLast.lastInSequence||(slotAfter=slotFromSlotRefresh(slotRefreshLast.next),slotAfter&&(indexAfter=slotAfter.index)),(!slotAfter||slotAfter.lastInSequence||slotAfter.mergedForRefresh)&&(void 0===indexBefore||void 0===indexAfter||indexAfter-indexBefore-1>=sequenceLength)){for(sequenceOld.locationJustDetermined=!0,slotRefresh=slotRefreshFirst;slotRefresh.locationJustDetermined=!0,slotRefresh!==slotRefreshLast;slotRefresh=slotRefresh.next);var slotFirstInSequence=slotFromSlotRefresh(slotRefreshFirst),slotLastInSequence=slotFromSlotRefresh(slotRefreshLast);sequencePairsToMerge.push({slotBeforeSequence:slotFirstInSequence.firstInSequence?null:slotFirstInSequence.prev,slotFirstInSequence:slotFirstInSequence,slotLastInSequence:slotLastInSequence,slotAfterSequence:slotLastInSequence.lastInSequence?null:slotLastInSequence.next})}}}for(i=0;i<sequenceCountOld;i++)if(sequenceOld=sequencesOld[i],sequenceOld&&!sequenceOld.indexRequested&&!sequenceOld.locationJustDetermined&&(!sequenceOld.sequenceNew||sequenceOld.sequenceNew.sequenceOld!==sequenceOld)){sequenceOld.sequenceNew=null,slot=sequenceOld.first;var sequenceEndReached;do{if(sequenceEndReached=slot===sequenceOld.last,slotNext=slot.next,slot!==slotsStart&&slot!==slotListEnd&&slot!==slotsEnd&&!slot.item&&!slot.keyRequested)if(deleteSlot(slot,!0),sequenceOld.first===slot){if(sequenceOld.last===slot){delete sequencesOld[i];break}sequenceOld.first=slot.next}else sequenceOld.last===slot&&(sequenceOld.last=slot.prev);slot=slotNext}while(!sequenceEndReached)}for(i=0;i<sequenceCountNew;i++){for(sequenceNew=sequencesNew[i],slotRefresh=sequenceNew.first;!slotFromSlotRefresh(slotRefresh)&&!slotRefresh.lastInSequence;slotRefresh=slotRefresh.next);if(slotRefresh.lastInSequence&&!slotFromSlotRefresh(slotRefresh))sequenceNew.firstInner=sequenceNew.lastInner=null;else{for(sequenceNew.firstInner=slotRefresh,slotRefresh=sequenceNew.last;!slotFromSlotRefresh(slotRefresh);slotRefresh=slotRefresh.prev);sequenceNew.lastInner=slotRefresh}}for(i=0;i<sequenceCountNew;i++)if(sequenceNew=sequencesNew[i],sequenceNew&&sequenceNew.firstInner&&(sequenceOld=sequenceNew.sequenceOld)){var ordinal=0;for(slot=sequenceOld.first;!0&&(slotRefresh=slotRefreshFromSlot(slot),slotRefresh&&slotRefresh.sequenceNumber===sequenceNew.firstInner.sequenceNumber&&(slotRefresh.ordinal=ordinal),!slot.lastInSequence);slot=slot.next,ordinal++);var piles=[];for(slotRefresh=sequenceNew.firstInner;!0;slotRefresh=slotRefresh.next){if(ordinal=slotRefresh.ordinal,void 0!==ordinal){for(var searchFirst=0,searchLast=piles.length-1;searchFirst<=searchLast;){var searchMidpoint=Math.floor(.5*(searchFirst+searchLast));piles[searchMidpoint].ordinal<ordinal?searchFirst=searchMidpoint+1:searchLast=searchMidpoint-1}piles[searchFirst]=slotRefresh,searchFirst>0&&(slotRefresh.predecessor=piles[searchFirst-1])}if(slotRefresh===sequenceNew.lastInner)break}var stationaryItems=[],stationaryItemCount=piles.length;for(slotRefresh=piles[stationaryItemCount-1],j=stationaryItemCount;j--;)slotRefresh.stationary=!0,stationaryItems[j]=slotRefresh,slotRefresh=slotRefresh.predecessor;sequenceOld.stationarySlot=slotFromSlotRefresh(stationaryItems[0]),slotRefresh=stationaryItems[0],slot=slotFromSlotRefresh(slotRefresh),slotPrev=slot.prev;for(var sequenceBoundaryReached=slot.firstInSequence;!slotRefresh.firstInSequence;)if(slotRefresh=slotRefresh.prev,slotExisting=slotFromSlotRefresh(slotRefresh),!slotExisting||slotRefresh.locationJustDetermined)for(;!sequenceBoundaryReached&&slotPrev!==slotsStart&&(slot=slotPrev,slotPrev=slot.prev,sequenceBoundaryReached=slot.firstInSequence,!updateSlotForRefresh(slotExisting,slot,slotRefresh)););for(j=0;j<stationaryItemCount-1;j++){slotRefresh=stationaryItems[j],slot=slotFromSlotRefresh(slotRefresh);var slotExisting,slotRefreshStop=stationaryItems[j+1],slotRefreshMergePoint=null,slotStop=slotFromSlotRefresh(slotRefreshStop);
for(slotNext=slot.next,slotRefresh=slotRefresh.next;slotRefresh!==slotRefreshStop&&!slotRefreshMergePoint&&slot!==slotStop;slotRefresh=slotRefresh.next)if(slotExisting=slotFromSlotRefresh(slotRefresh),!slotExisting||slotRefresh.locationJustDetermined)for(;slotNext!==slotStop;){if(slotNext.mergedForRefresh){slotRefreshMergePoint=slotRefresh.prev;break}if(slot=slotNext,slotNext=slot.next,updateSlotForRefresh(slotExisting,slot,slotRefresh))break}if(slotRefreshMergePoint)for(slotPrev=slotStop.prev,slotRefresh=slotRefreshStop.prev;slotRefresh!==slotRefreshMergePoint&&slotStop!==slot;slotRefresh=slotRefresh.prev)if(slotExisting=slotFromSlotRefresh(slotRefresh),!slotExisting||slotRefresh.locationJustDetermined)for(;slotPrev!==slot&&(slotStop=slotPrev,slotPrev=slotStop.prev,!updateSlotForRefresh(slotExisting,slotStop,slotRefresh)););for(;slotNext!==slotStop;)slot=slotNext,slotNext=slot.next,slot!==slotsStart&&isPlaceholder(slot)&&!slot.keyRequested&&deleteSlot(slot)}for(slotRefresh=stationaryItems[stationaryItemCount-1],slot=slotFromSlotRefresh(slotRefresh),slotNext=slot.next,sequenceBoundaryReached=slot.lastInSequence;!slotRefresh.lastInSequence;)if(slotRefresh=slotRefresh.next,slotExisting=slotFromSlotRefresh(slotRefresh),!slotExisting||slotRefresh.locationJustDetermined)for(;!sequenceBoundaryReached&&slotNext!==slotListEnd&&(slot=slotNext,slotNext=slot.next,sequenceBoundaryReached=slot.lastInSequence,!updateSlotForRefresh(slotExisting,slot,slotRefresh)););}for(i=0;i<sequenceCountNew;i++)if(sequenceNew=sequencesNew[i],sequenceNew.firstInner)for(slotPrev=null,slotRefresh=sequenceNew.firstInner;!0;slotRefresh=slotRefresh.next){if(slot=slotFromSlotRefresh(slotRefresh)){if(!slotRefresh.stationary){var slotMoveBefore,mergeWithPrev=!1,mergeWithNext=!1;if(slotPrev)slotMoveBefore=slotPrev.next,mergeWithPrev=!0;else{var slotRefreshStationary;for(slotRefreshStationary=sequenceNew.firstInner;!slotRefreshStationary.stationary&&slotRefreshStationary!==sequenceNew.lastInner;slotRefreshStationary=slotRefreshStationary.next);if(slotRefreshStationary.stationary)slotMoveBefore=slotFromSlotRefresh(slotRefreshStationary),mergeWithNext=!0;else if(index=slotRefresh.index,0===index)slotMoveBefore=slotsStart.next,mergeWithPrev=!0;else if(void 0===index)slotMoveBefore=slotsEnd;else{slotMoveBefore=slotsStart.next;for(var lastSequenceStart=null;;){if(slotMoveBefore.firstInSequence&&(lastSequenceStart=slotMoveBefore),index<slotMoveBefore.index&&lastSequenceStart||slotMoveBefore===slotListEnd)break;slotMoveBefore=slotMoveBefore.next}!slotMoveBefore.firstInSequence&&lastSequenceStart&&(slotMoveBefore=lastSequenceStart)}}slot.mergedForRefresh&&(delete slot.mergedForRefresh,slot.lastInSequence||(slot.next.mergedForRefresh=!0)),mergeWithPrev=mergeWithPrev||slotRefresh.mergeWithPrev,mergeWithNext=mergeWithNext||slotRefresh.mergeWithNext;var skipNotifications=slotRefresh.locationJustDetermined;moveSlot(slot,slotMoveBefore,mergeWithPrev,mergeWithNext,skipNotifications),skipNotifications&&mergeWithNext&&(slotMoveBefore.mergedForRefresh=!0)}slotPrev=slot}if(slotRefresh===sequenceNew.lastInner)break}for(i=0;i<sequenceCountNew;i++)if(sequenceNew=sequencesNew[i],sequenceNew.firstInner)for(slotPrev=null,slotRefresh=sequenceNew.firstInner;!0;slotRefresh=slotRefresh.next){if(slot=slotFromSlotRefresh(slotRefresh),!slot){var slotInsertBefore;if(slotPrev)slotInsertBefore=slotPrev.next;else{var slotRefreshOld;for(slotRefreshOld=sequenceNew.firstInner;!slotFromSlotRefresh(slotRefreshOld);slotRefreshOld=slotRefreshOld.next);slotInsertBefore=slotFromSlotRefresh(slotRefreshOld)}slot=addNewSlotFromRefresh(slotRefresh,slotInsertBefore,!!slotPrev);var slotRefreshNext=slotRefreshFromSlot(slotInsertBefore);slotInsertBefore.mergedForRefresh||slotRefreshNext&&slotRefreshNext.locationJustDetermined||(prepareSlotItem(slot),sendInsertedNotification(slot))}if(slotPrev=slot,slotRefresh===sequenceNew.lastInner)break}indexMap=[];var indexFirst=-1;for(slot=slotsStart,offset=0;slot!==slotsEnd;offset++){var slotNext=slot.next;if(slot.firstInSequence&&(slotFirstInSequence=slot,offset=0),void 0===indexFirst){var indexNew=indexForRefresh(slot);void 0!==indexNew&&(indexFirst=indexNew-offset)}if(void 0!==indexFirst&&!slot.lastInSequence){var indexNewNext=indexForRefresh(slot.next);if(void 0!==indexNewNext&&indexNewNext!==indexFirst+offset+1){splitSequence(slot);for(var first=!0,slotMove=slot.next,lastInSequence=!1;!lastInSequence&&slotMove!==slotListEnd;){var slotMoveNext=slotMove.next;lastInSequence=slotMove.lastInSequence,moveSlot(slotMove,slotMoveNext,!first,!1),first=!1,slotMove=slotMoveNext}}}if(slot.lastInSequence){index=indexFirst;for(var slotUpdate=slotFirstInSequence;slotUpdate!==slotNext;){var slotUpdateNext=slotUpdate.next;if(index>=refreshCount&&slotUpdate!==slotListEnd)deleteSlot(slotUpdate,!0);else{var slotWithIndex=indexMap[index];index!==slotUpdate.index?(delete indexMap[index],changeSlotIndex(slotUpdate,index)):+index===index&&indexMap[index]!==slotUpdate&&(indexMap[index]=slotUpdate),slotUpdate.itemNew&&updateSlotItem(slotUpdate),slotWithIndex&&(slotUpdate.key?(sendMirageNotifications(slotUpdate,slotWithIndex,slotUpdate.bindingMap),mergeSlots(slotUpdate,slotWithIndex),+index===index&&(indexMap[index]=slotUpdate)):(sendMirageNotifications(slotWithIndex,slotUpdate,slotWithIndex.bindingMap),mergeSlots(slotWithIndex,slotUpdate),+index===index&&(indexMap[index]=slotWithIndex))),+index===index&&index++}slotUpdate=slotUpdateNext}indexFirst=void 0}slot=slotNext}var listEndReached,indexMax=-2;for(slot=slotsStart,offset=0;slot!==slotsEnd;offset++){var slotNext=slot.next;if(slot.firstInSequence&&(slotFirstInSequence=slot,offset=0),delete slot.mergedForRefresh,slot.lastInSequence)if(void 0===slotFirstInSequence.index){slotBefore=slotFirstInSequence.prev;var slotRefreshBefore;slotBefore&&(slotRefreshBefore=slotRefreshFromSlot(slotBefore))&&!slotRefreshBefore.lastInSequence&&(slotRefresh=slotRefreshFromSlot(slot))&&slotRefresh.prev===slotRefreshBefore?(moveSequenceAfter(slotBefore,slotFirstInSequence,slot),mergeSequences(slotBefore)):slot===slotListEnd||listEndReached||moveSequenceBefore(slotsEnd,slotFirstInSequence,slot)}else{if(indexMax<slot.index&&!listEndReached)indexMax=slot.index;else{for(slotAfter=slotsStart.next;slotAfter.index<slot.index;slotAfter=slotAfter.next);for(var slotMove=slotFirstInSequence;slotMove!==slotNext;){var slotMoveNext=slotMove.next;slotRefresh=slotRefreshFromSlot(slotMove),moveSlot(slotMove,slotAfter,slotAfter.prev.index===slotMove.index-1,slotAfter.index===slotMove.index+1,slotRefresh&&slotRefresh.locationJustDetermined),slotMove=slotMoveNext}}slotBefore=slotFirstInSequence.prev,slotBefore&&slotBefore.index===slotFirstInSequence.index-1&&mergeSequences(slotBefore)}slot===slotListEnd&&(listEndReached=!0),slot=slotNext}indexUpdateDeferred=!1,mergeSequencePairs(sequencePairsToMerge),void 0!==refreshCount&&refreshCount!==knownCount&&changeCount(refreshCount),finishNotifications();var fetchResults=[];for(i=0;i<sequenceCountNew;i++){sequenceNew=sequencesNew[i];var results=[];slot=null,offset=0;var slotOffset;for(slotRefresh=sequenceNew.first;!0&&(slotRefresh===refreshStart?results.push(startMarker):slotRefresh===refreshEnd?results.push(endMarker):(results.push(slotRefresh.item),slot||(slot=slotFromSlotRefresh(slotRefresh),slotOffset=offset)),!slotRefresh.lastInSequence);slotRefresh=slotRefresh.next,offset++);slot&&fetchResults.push({slot:slot,results:results,offset:slotOffset})}for(resetRefreshState(),refreshInProgress=!1,callFetchCompleteCallbacks(),i=0;i<fetchResults.length;i++){var fetchResult=fetchResults[i];processResults(fetchResult.slot,fetchResult.results,fetchResult.offset,knownCount,fetchResult.slot.index)}if(refreshSignal){var signal=refreshSignal;refreshSignal=null,signal.complete()}postFetch()}function queueEdit(applyEdit,editType,complete,error,keyUpdate,updateSlots,undo){var editQueueTail=editQueue.prev,edit={prev:editQueueTail,next:editQueue,applyEdit:applyEdit,editType:editType,complete:complete,error:error,keyUpdate:keyUpdate};editQueueTail.next=edit,editQueue.prev=edit,editsQueued=!0,(refreshRequested||refreshInProgress)&&(currentRefreshID++,refreshInProgress=!1,refreshRequested=!0),editQueue.next===edit&&applyNextEdit(),edit.failed||(updateSlots(),edit.undo=undo),editsInProgress||completeEdits()}function dequeueEdit(){firstEditInProgress=!1;var editNext=editQueue.next.next;editQueue.next=editNext,editNext.prev=editQueue}function discardEditQueue(){for(;editQueue.prev!==editQueue;){var editLast=editQueue.prev;editLast.error&&editLast.error(new _ErrorFromName(EditError.canceled)),editLast.undo&&!refreshRequested&&editLast.undo(),editQueue.prev=editLast.prev}editQueue.next=editQueue,editsInProgress=!1,completeEdits()}function attemptEdit(edit){function continueEdits(){waitForRefresh||(reentrant?synchronousEdit=!0:applyNextEdit())}function onEditComplete(item){if(item){var slot;if(keyUpdate&&keyUpdate.key!==item.key){var keyNew=item.key;if(edit.undo){if(slot=keyUpdate.slot){var keyOld=slot.key;keyOld&&delete keyMap[keyOld],setSlotKey(slot,keyNew),slot.itemNew=item,slot.item?(changeSlot(slot),finishNotifications()):completeFetchPromises(slot)}}else keyUpdate.key=keyNew}else edit.editType===EditType.change&&(slot.itemNew=item,reentrant||changeSlotIfNecessary(slot))}dequeueEdit(),edit.complete&&edit.complete(item),continueEdits()}function onEditError(error){switch(error.Name){case EditError.noResponse:return setStatus(DataSourceStatus.failure),waitForRefresh=!0,void(firstEditInProgress=!1);case EditError.notPermitted:break;case EditError.noLongerMeaningful:beginRefresh()}edit.failed=!0,dequeueEdit(),discardEditQueue(),edit.error&&edit.error(error),continueEdits()}if(!firstEditInProgress){var reentrant=!0,keyUpdate=edit.keyUpdate;listDataAdapter.beginEdits&&!beginEditsCalled&&(beginEditsCalled=!0,listDataAdapter.beginEdits()),firstEditInProgress=!0,edit.applyEdit().then(onEditComplete,onEditError),reentrant=!1}}function applyNextEdit(){for(;editQueue.next!==editQueue;)if(synchronousEdit=!1,attemptEdit(editQueue.next),!synchronousEdit)return;concludeEdits()}function completeEdits(){updateIndices(),finishNotifications(),callFetchCompleteCallbacks(),editQueue.next===editQueue&&concludeEdits()}function concludeEdits(){editsQueued=!1,listDataAdapter.endEdits&&beginEditsCalled&&!editsInProgress&&(beginEditsCalled=!1,listDataAdapter.endEdits()),refreshRequested?(refreshRequested=!1,beginRefresh()):postFetch()}function getSlotForEdit(key){return validateKey(key),keyMap[key]||createSlotForKey(key)}function insertNewSlot(key,itemNew,slotInsertBefore,mergeWithPrev,mergeWithNext){var slot=createPrimarySlot();return insertAndMergeSlot(slot,slotInsertBefore,mergeWithPrev,mergeWithNext),key&&setSlotKey(slot,key),slot.itemNew=itemNew,updateNewIndices(slot,1),editsInProgress||dataNotificationsInProgress||(slot.firstInSequence||"number"!=typeof slot.prev.index?slot.lastInSequence||"number"!=typeof slot.next.index||setSlotIndex(slot,slot.next.index-1,indexMap):setSlotIndex(slot,slot.prev.index+1,indexMap)),prepareSlotItem(slot),sendInsertedNotification(slot),slot}function insertItem(key,data,slotInsertBefore,append,applyEdit){var keyUpdate={key:key};return new Promise(function(complete,error){queueEdit(applyEdit,EditType.insert,complete,error,keyUpdate,function(){if(slotInsertBefore){var itemNew={key:keyUpdate.key,data:data};keyUpdate.slot=insertNewSlot(keyUpdate.key,itemNew,slotInsertBefore,append,!append)}},function(){var slot=keyUpdate.slot;slot&&(updateNewIndices(slot,-1),deleteSlot(slot,!1))})})}function moveItem(slot,slotMoveBefore,append,applyEdit){return new Promise(function(complete,error){var mergeAdjacent,slotNext,firstInSequence,lastInSequence;queueEdit(applyEdit,EditType.move,complete,error,null,function(){slotNext=slot.next,firstInSequence=slot.firstInSequence,lastInSequence=slot.lastInSequence;var slotPrev=slot.prev;mergeAdjacent="number"!=typeof slot.index&&(firstInSequence||!slotPrev.item)&&(lastInSequence||!slotNext.item),updateNewIndices(slot,-1),moveSlot(slot,slotMoveBefore,append,!append),updateNewIndices(slot,1),mergeAdjacent&&(splitSequence(slotPrev),firstInSequence||mergeSlotsBefore(slotPrev,slot),lastInSequence||mergeSlotsAfter(slotNext,slot))},function(){mergeAdjacent?beginRefresh():(updateNewIndices(slot,-1),moveSlot(slot,slotNext,!firstInSequence,!lastInSequence),updateNewIndices(slot,1))})})}function ListDataNotificationHandler(){function completeNotification(){dataNotificationsInProgress||(updateIndices(),finishNotifications(),callFetchCompleteCallbacks())}this.invalidateAll=function(){return 0===knownCount?(this.reload(),Promise.wrap()):requestRefresh()},this.reload=function(){getCountPromise&&getCountPromise.cancel(),refreshSignal&&refreshSignal.cancel();for(var slot=slotsStart.next;slot!==slotsEnd;slot=slot.next){var fetchListeners=slot.fetchListeners;for(var listenerID in fetchListeners)fetchListeners[listenerID].promise.cancel();var directFetchListeners=slot.directFetchListeners;for(var listenerID in directFetchListeners)directFetchListeners[listenerID].promise.cancel()}resetState(),forEachBindingRecord(function(bindingRecord){bindingRecord.notificationHandler&&bindingRecord.notificationHandler.reload()})},this.beginNotifications=function(){dataNotificationsInProgress=!0},this.inserted=function(newItem,previousKey,nextKey,index){if(editsQueued)beginRefresh();else{var key=newItem.key,slotPrev=keyMap[previousKey],slotNext=keyMap[nextKey],havePreviousKey="string"==typeof previousKey,haveNextKey="string"==typeof nextKey;if(havePreviousKey?slotNext&&!slotNext.firstInSequence&&(slotPrev=slotNext.prev):haveNextKey&&slotPrev&&!slotPrev.lastInSequence&&(slotNext=slotPrev.next),(havePreviousKey||haveNextKey)&&!slotPrev&&!slotNext&&slotsStart.next===slotListEnd)return void beginRefresh();if(keyMap[key])return void beginRefresh();if(slotPrev&&slotNext&&(slotPrev.next!==slotNext||slotPrev.lastInSequence||slotNext.firstInSequence))return void beginRefresh();if(slotPrev&&(slotPrev.keyRequested||slotPrev.indexRequested)||slotNext&&(slotNext.keyRequested||slotNext.indexRequested))return void beginRefresh();if(slotPrev||slotNext)insertNewSlot(key,newItem,slotNext?slotNext:slotPrev.next,!!slotPrev,!!slotNext);else if(slotsStart.next===slotListEnd)insertNewSlot(key,newItem,slotsStart.next,!0,!0);else{if(void 0===index)return void beginRefresh();updateNewIndicesFromIndex(index,1)}completeNotification()}},this.changed=function(item){if(editsQueued)beginRefresh();else{var key=item.key,slot=keyMap[key];slot&&(slot.keyRequested?beginRefresh():(slot.itemNew=item,slot.item&&(changeSlot(slot),completeNotification())))}},this.moved=function(item,previousKey,nextKey,oldIndex,newIndex){if(editsQueued)beginRefresh();else{var key=item.key,slot=keyMap[key],slotPrev=keyMap[previousKey],slotNext=keyMap[nextKey];slot&&slot.keyRequested||slotPrev&&slotPrev.keyRequested||slotNext&&slotNext.keyRequested?beginRefresh():slot?slotPrev&&slotNext&&(slotPrev.next!==slotNext||slotPrev.lastInSequence||slotNext.firstInSequence)?beginRefresh():slotPrev||slotNext?(updateNewIndices(slot,-1),moveSlot(slot,slotNext?slotNext:slotPrev.next,!!slotPrev,!!slotNext),updateNewIndices(slot,1),completeNotification()):(updateNewIndices(slot,-1),deleteSlot(slot,!1),void 0!==oldIndex&&(oldIndex<newIndex&&newIndex--,updateNewIndicesFromIndex(newIndex,1)),completeNotification()):slotPrev||slotNext?(void 0!==oldIndex&&(updateNewIndicesFromIndex(oldIndex,-1),oldIndex<newIndex&&newIndex--),this.inserted(item,previousKey,nextKey,newIndex)):void 0!==oldIndex&&(updateNewIndicesFromIndex(oldIndex,-1),oldIndex<newIndex&&newIndex--,updateNewIndicesFromIndex(newIndex,1),completeNotification())}},this.removed=function(key,index){if(editsQueued)beginRefresh();else{var slot;slot="string"==typeof key?keyMap[key]:indexMap[index],slot?slot.keyRequested?beginRefresh():(updateNewIndices(slot,-1),deleteSlot(slot,!1),completeNotification()):void 0!==index&&(updateNewIndicesFromIndex(index,-1),completeNotification())}},this.endNotifications=function(){dataNotificationsInProgress=!1,completeNotification()}}function resetState(){setStatus(DataSourceStatus.ready),getCountPromise=null,beginEditsCalled=!1,editsInProgress=!1,firstEditInProgress=!1,editQueue={},editQueue.next=editQueue,editQueue.prev=editQueue,editsQueued=!1,waitForRefresh=!1,countDelta=0,indexUpdateDeferred=!1,nextTempKey=0,fetchesInProgress={},fetchCompleteCallbacks=[],knownCount=CountResult.unknown,slotsStart={firstInSequence:!0,lastInSequence:!0,index:-1},slotListEnd={firstInSequence:!0,lastInSequence:!0},slotsEnd={firstInSequence:!0,lastInSequence:!0},slotsStart.next=slotListEnd,slotListEnd.prev=slotsStart,slotListEnd.next=slotsEnd,slotsEnd.prev=slotListEnd,handleMap={},keyMap={},indexMap={},indexMap[-1]=slotsStart,releasedSlots=0,lastSlotReleased=null,reduceReleasedSlotCountPosted=!1,refreshRequested=!1,refreshInProgress=!1,refreshSignal=null}var listDataNotificationHandler,cacheSize,status,statusPending,statusChangePosted,bindingMap,nextListBindingID,nextHandle,nextListenerID,getCountPromise,resultsProcessed,beginEditsCalled,editsInProgress,firstEditInProgress,editQueue,editsQueued,synchronousEdit,waitForRefresh,dataNotificationsInProgress,countDelta,indexUpdateDeferred,nextTempKey,currentRefreshID,fetchesPosted,nextFetchID,fetchesInProgress,fetchCompleteCallbacks,startMarker,endMarker,knownCount,slotsStart,slotListEnd,slotsEnd,handleMap,keyMap,indexMap,releasedSlots,lastSlotReleased,reduceReleasedSlotCountPosted,refreshRequested,refreshInProgress,refreshSignal,refreshFetchesInProgress,refreshItemsFetched,refreshCount,refreshStart,refreshEnd,keyFetchIDs,refreshKeyMap,refreshIndexMap,deletedKeys,synchronousProgress,reentrantContinue,synchronousRefresh,reentrantRefresh,itemsFromKey,itemsFromIndex,itemsFromStart,itemsFromEnd,itemsFromDescription,beginRefreshCount=0,refreshHistory=new Array(100),refreshHistoryPos=-1;listDataAdapter.itemsFromKey&&(itemsFromKey=function(fetchID,key,countBefore,countAfter,hints){var perfID="fetchItemsFromKey id="+fetchID+" key="+key+" countBefore="+countBefore+" countAfter="+countAfter;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromKey",key:key,countBefore:countBefore,countAfter:countAfter};var result=listDataAdapter.itemsFromKey(key,countBefore,countAfter,hints);return profilerMarkEnd(perfID),result}),listDataAdapter.itemsFromIndex&&(itemsFromIndex=function(fetchID,index,countBefore,countAfter){var perfID="fetchItemsFromIndex id="+fetchID+" index="+index+" countBefore="+countBefore+" countAfter="+countAfter;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromIndex",index:index,countBefore:countBefore,countAfter:countAfter};var result=listDataAdapter.itemsFromIndex(index,countBefore,countAfter);return profilerMarkEnd(perfID),result}),listDataAdapter.itemsFromStart&&(itemsFromStart=function(fetchID,count){var perfID="fetchItemsFromStart id="+fetchID+" count="+count;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromStart",count:count};var result=listDataAdapter.itemsFromStart(count);return profilerMarkEnd(perfID),result}),listDataAdapter.itemsFromEnd&&(itemsFromEnd=function(fetchID,count){var perfID="fetchItemsFromEnd id="+fetchID+" count="+count;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromEnd",count:count};var result=listDataAdapter.itemsFromEnd(count);return profilerMarkEnd(perfID),result}),listDataAdapter.itemsFromDescription&&(itemsFromDescription=function(fetchID,description,countBefore,countAfter){var perfID="fetchItemsFromDescription id="+fetchID+" desc="+description+" countBefore="+countBefore+" countAfter="+countAfter;profilerMarkStart(perfID),refreshHistory[++refreshHistoryPos%refreshHistory.length]={kind:"itemsFromDescription",description:description,countBefore:countBefore,countAfter:countAfter};var result=listDataAdapter.itemsFromDescription(description,countBefore,countAfter);return profilerMarkEnd(perfID),result});var dataSourceID=++uniqueID,that=this,EditType={insert:"insert",change:"change",move:"move",remove:"remove"};if(!listDataAdapter)throw new _ErrorFromName("WinJS.UI.ListDataSource.ListDataAdapterIsInvalid",strings.listDataAdapterIsInvalid);cacheSize=listDataAdapter.compareByIdentity?0:200,options&&"number"==typeof options.cacheSize&&(cacheSize=options.cacheSize),listDataAdapter.setNotificationHandler&&(listDataNotificationHandler=new ListDataNotificationHandler,listDataAdapter.setNotificationHandler(listDataNotificationHandler)),status=DataSourceStatus.ready,statusChangePosted=!1,bindingMap={},nextListBindingID=0,nextHandle=1,nextListenerID=0,currentRefreshID=0,fetchesPosted=!1,nextFetchID=1,startMarker={},endMarker={},resetState(),this.createListBinding=function(notificationHandler){function retainSlotForCursor(slot){slot&&slot.cursorCount++}function releaseSlotForCursor(slot){slot&&0===--slot.cursorCount&&releaseSlotIfUnrequested(slot)}function moveCursor(slot){retainSlotForCursor(slot),releaseSlotForCursor(slotCurrent),slotCurrent=slot}function adjustCurrentSlot(slot,slotNew){slot===slotCurrent&&(slotNew||(slotNew=!slotCurrent||slotCurrent.lastInSequence||slotCurrent.next===slotListEnd?null:slotCurrent.next),moveCursor(slotNew))}function releaseSlotFromListBinding(slot){var bindingMap=slot.bindingMap,bindingHandle=bindingMap[listBindingID].handle;delete slot.bindingMap[listBindingID];var releaseBindingMap=!0,releaseHandle=!0;for(var listBindingID2 in bindingMap)if(releaseBindingMap=!1,bindingHandle&&bindingMap[listBindingID2].handle===bindingHandle){releaseHandle=!1;break}bindingHandle&&releaseHandle&&delete handleMap[bindingHandle],releaseBindingMap&&(slot.bindingMap=null,releaseSlotIfUnrequested(slot))}function retainItem(slot,listenerID){slot.bindingMap||(slot.bindingMap={});var slotBinding=slot.bindingMap[listBindingID];if(slotBinding?slotBinding.count++:slot.bindingMap[listBindingID]={bindingRecord:bindingMap[listBindingID],count:1},slot.fetchListeners){var listener=slot.fetchListeners[listenerID];listener&&(listener.retained=!0)}}function releaseItem(handle){var slot=handleMap[handle];if(slot){var slotBinding=slot.bindingMap[listBindingID];if(0===--slotBinding.count){var fetchListeners=slot.fetchListeners;for(var listenerID in fetchListeners){var listener=fetchListeners[listenerID];listener.listBindingID===listBindingID&&(listener.retained=!1)}releaseSlotFromListBinding(slot)}}}function itemPromiseFromKnownSlot(slot){var handle=handleForBinding(slot,listBindingID),listenerID=(nextListenerID++).toString(),itemPromise=createFetchPromise(slot,"fetchListeners",listenerID,listBindingID,function(complete,item){complete(itemForBinding(item,handle))});return defineCommonItemProperties(itemPromise,slot,handle),notificationHandler&&(itemPromise.retain=function(){return listBinding._retainItem(slot,listenerID),itemPromise},itemPromise.release=function(){listBinding._releaseItem(handle)}),itemPromise}function itemPromiseFromSlot(slot){var itemPromise;return!released&&slot?itemPromise=itemPromiseFromKnownSlot(slot):(released?(itemPromise=new Promise(function(){}),itemPromise.cancel()):itemPromise=Promise.wrap(null),defineHandleProperty(itemPromise,null),notificationHandler&&(itemPromise.retain=function(){return itemPromise},itemPromise.release=function(){})),moveCursor(slot),itemPromise}var listBindingID=(nextListBindingID++).toString(),slotCurrent=null,released=!1;bindingMap[listBindingID]={notificationHandler:notificationHandler,notificationsSent:!1,adjustCurrentSlot:adjustCurrentSlot,itemPromiseFromKnownSlot:itemPromiseFromKnownSlot};var listBinding={_retainItem:function(slot,listenerID){retainItem(slot,listenerID)},_releaseItem:function(handle){releaseItem(handle)},jumpToItem:function(item){return itemPromiseFromSlot(item?handleMap[item.handle]:null)},current:function(){return itemPromiseFromSlot(slotCurrent)},previous:function(){return itemPromiseFromSlot(slotCurrent?requestSlotBefore(slotCurrent):null)},next:function(){return itemPromiseFromSlot(slotCurrent?requestSlotAfter(slotCurrent):null)},releaseItem:function(item){this._releaseItem(item.handle)},release:function(){released=!0,releaseSlotForCursor(slotCurrent),slotCurrent=null;for(var slot=slotsStart.next;slot!==slotsEnd;){var slotNext=slot.next,fetchListeners=slot.fetchListeners;for(var listenerID in fetchListeners){var listener=fetchListeners[listenerID];listener.listBindingID===listBindingID&&(listener.promise.cancel(),delete fetchListeners[listenerID])}slot.bindingMap&&slot.bindingMap[listBindingID]&&releaseSlotFromListBinding(slot),slot=slotNext}delete bindingMap[listBindingID]}};return(itemsFromStart||itemsFromIndex)&&(listBinding.first=function(){return itemPromiseFromSlot(requestSlotAfter(slotsStart))}),itemsFromEnd&&(listBinding.last=function(){return itemPromiseFromSlot(requestSlotBefore(slotListEnd))}),itemsFromKey&&(listBinding.fromKey=function(key,hints){return itemPromiseFromSlot(slotFromKey(key,hints))}),(itemsFromIndex||itemsFromStart&&itemsFromKey)&&(listBinding.fromIndex=function(index){return itemPromiseFromSlot(slotFromIndex(index))}),itemsFromDescription&&(listBinding.fromDescription=function(description){return itemPromiseFromSlot(slotFromDescription(description))}),listBinding},this.invalidateAll=function(){return requestRefresh()};var countedCancelation=function(incomingPromise,dataSource){var signal=new _Signal;incomingPromise.then(function(v){signal.complete(v)},function(e){signal.error(e)});var resultPromise=signal.promise.then(null,function(e){return"WinJS.UI.VirtualizedDataSource.resetCount"===e.name?(getCountPromise=null,incomingPromise=dataSource.getCount()):Promise.wrapError(e)}),count=0,currentGetCountPromise={get:function(){return count++,new Promise(function(c,e){resultPromise.then(c,e)},function(){0===--count&&(signal.promise.cancel(),incomingPromise.cancel(),currentGetCountPromise===getCountPromise&&(getCountPromise=null))})},reset:function(){signal.error(new _ErrorFromName("WinJS.UI.VirtualizedDataSource.resetCount"))},cancel:function(){signal.promise.cancel(),incomingPromise.cancel(),currentGetCountPromise===getCountPromise&&(getCountPromise=null)}};return currentGetCountPromise};this.getCount=function(){if(listDataAdapter.getCount){var that=this;return Promise.wrap().then(function(){if(editsInProgress||editsQueued)return knownCount;var requestPromise;if(!getCountPromise){var relatedGetCountPromise;requestPromise=listDataAdapter.getCount();var synchronous;requestPromise.then(function(){getCountPromise===relatedGetCountPromise&&(getCountPromise=null),synchronous=!0},function(){getCountPromise===relatedGetCountPromise&&(getCountPromise=null),synchronous=!0}),countDelta=0,synchronous||(relatedGetCountPromise=getCountPromise=countedCancelation(requestPromise,that))}return getCountPromise?getCountPromise.get():requestPromise}).then(function(count){if(!isNonNegativeInteger(count)&&void 0!==count)throw new _ErrorFromName("WinJS.UI.ListDataSource.InvalidRequestedCountReturned",strings.invalidRequestedCountReturned);return count!==knownCount&&(knownCount===CountResult.unknown?knownCount=count:(changeCount(count),finishNotifications())),0===count&&(slotsStart.next!==slotListEnd||slotListEnd.next!==slotsEnd?beginRefresh():slotsStart.lastInSequence&&(mergeSequences(slotsStart),slotListEnd.index=0)),count}).then(null,function(error){return error.name===_UI.CountError.noResponse?(setStatus(DataSourceStatus.failure),knownCount):Promise.wrapError(error)})}return Promise.wrap(knownCount)},itemsFromKey&&(this.itemFromKey=function(key,hints){return itemDirectlyFromSlot(slotFromKey(key,hints))}),(itemsFromIndex||itemsFromStart&&itemsFromKey)&&(this.itemFromIndex=function(index){return itemDirectlyFromSlot(slotFromIndex(index))}),itemsFromDescription&&(this.itemFromDescription=function(description){return itemDirectlyFromSlot(slotFromDescription(description))}),this.beginEdits=function(){editsInProgress=!0},listDataAdapter.insertAtStart&&(this.insertAtStart=function(key,data){return insertItem(key,data,slotsStart.lastInSequence?null:slotsStart.next,!0,function(){return listDataAdapter.insertAtStart(key,data)})}),listDataAdapter.insertBefore&&(this.insertBefore=function(key,data,nextKey){var slotNext=getSlotForEdit(nextKey);return insertItem(key,data,slotNext,!1,function(){return listDataAdapter.insertBefore(key,data,nextKey,adjustedIndex(slotNext))})}),listDataAdapter.insertAfter&&(this.insertAfter=function(key,data,previousKey){var slotPrev=getSlotForEdit(previousKey);return insertItem(key,data,slotPrev?slotPrev.next:null,!0,function(){return listDataAdapter.insertAfter(key,data,previousKey,adjustedIndex(slotPrev))})}),listDataAdapter.insertAtEnd&&(this.insertAtEnd=function(key,data){return insertItem(key,data,slotListEnd.firstInSequence?null:slotListEnd,!1,function(){return listDataAdapter.insertAtEnd(key,data)})}),listDataAdapter.change&&(this.change=function(key,newData){var slot=getSlotForEdit(key);return new Promise(function(complete,error){var itemOld;queueEdit(function(){return listDataAdapter.change(key,newData,adjustedIndex(slot))},EditType.change,complete,error,null,function(){itemOld=slot.item,slot.itemNew={key:key,data:newData},itemOld?changeSlot(slot):completeFetchPromises(slot)},function(){itemOld?(slot.itemNew=itemOld,changeSlot(slot)):beginRefresh()})})}),listDataAdapter.moveToStart&&(this.moveToStart=function(key){var slot=getSlotForEdit(key);return moveItem(slot,slotsStart.next,!0,function(){return listDataAdapter.moveToStart(key,adjustedIndex(slot))})}),listDataAdapter.moveBefore&&(this.moveBefore=function(key,nextKey){var slot=getSlotForEdit(key),slotNext=getSlotForEdit(nextKey);return moveItem(slot,slotNext,!1,function(){return listDataAdapter.moveBefore(key,nextKey,adjustedIndex(slot),adjustedIndex(slotNext))})}),listDataAdapter.moveAfter&&(this.moveAfter=function(key,previousKey){var slot=getSlotForEdit(key),slotPrev=getSlotForEdit(previousKey);return moveItem(slot,slotPrev.next,!0,function(){return listDataAdapter.moveAfter(key,previousKey,adjustedIndex(slot),adjustedIndex(slotPrev))})}),listDataAdapter.moveToEnd&&(this.moveToEnd=function(key){var slot=getSlotForEdit(key);return moveItem(slot,slotListEnd,!1,function(){return listDataAdapter.moveToEnd(key,adjustedIndex(slot))})}),listDataAdapter.remove&&(this.remove=function(key){validateKey(key);var slot=keyMap[key];return new Promise(function(complete,error){var slotNext,firstInSequence,lastInSequence;queueEdit(function(){return listDataAdapter.remove(key,adjustedIndex(slot))},EditType.remove,complete,error,null,function(){slot&&(slotNext=slot.next,firstInSequence=slot.firstInSequence,lastInSequence=slot.lastInSequence,updateNewIndices(slot,-1),deleteSlot(slot,!1))},function(){slot&&(reinsertSlot(slot,slotNext,!firstInSequence,!lastInSequence),updateNewIndices(slot,1),sendInsertedNotification(slot))})})}),this.endEdits=function(){editsInProgress=!1,completeEdits()}}var MAX_BEGINREFRESH_COUNT=100,uniqueID=1,DataSourceStatus=_UI.DataSourceStatus,CountResult=_UI.CountResult,FetchError=_UI.FetchError,EditError=_UI.EditError,strings={get listDataAdapterIsInvalid(){return"Invalid argument: listDataAdapter must be an object or an array."},get indexIsInvalid(){return"Invalid argument: index must be a non-negative integer."},get keyIsInvalid(){return"Invalid argument: key must be a string."},get invalidItemReturned(){return"Error: data adapter returned item that is not an object."},get invalidKeyReturned(){return"Error: data adapter returned item with undefined or null key."},get invalidIndexReturned(){return"Error: data adapter should return undefined, null or a non-negative integer for the index."},get invalidCountReturned(){return"Error: data adapter should return undefined, null, CountResult.unknown, or a non-negative integer for the count."},get invalidRequestedCountReturned(){return"Error: data adapter should return CountResult.unknown, CountResult.failure, or a non-negative integer for the count.";
},get refreshCycleIdentified(){return"refresh cycle found, likely data inconsistency"}},statusChangedEvent="statuschanged",VDS=_Base.Class.define(function(){},{_baseDataSourceConstructor:_baseDataSourceConstructor,_isVirtualizedDataSource:!0},{supportedForProcessing:!1});return _Base.Class.mix(VDS,_Events.eventMixin),VDS})})}),define("WinJS/VirtualizedDataSource/_GroupDataSource",["exports","../Core/_Base","../Core/_ErrorFromName","../Promise","../Scheduler","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(exports,_Base,_ErrorFromName,Promise,Scheduler,_UI,VirtualizedDataSource){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_GroupDataSource:_Base.Namespace._lazy(function(){function errorDoesNotExist(){return new _ErrorFromName(_UI.FetchError.doesNotExist)}function groupReady(group){return group&&group.firstReached&&group.lastReached}var batchSizeDefault=101,ListNotificationHandler=_Base.Class.define(function(groupDataAdapter){this._groupDataAdapter=groupDataAdapter},{beginNotifications:function(){},inserted:function(itemPromise,previousHandle,nextHandle){this._groupDataAdapter._inserted(itemPromise,previousHandle,nextHandle)},changed:function(newItem,oldItem){this._groupDataAdapter._changed(newItem,oldItem)},moved:function(itemPromise,previousHandle,nextHandle){this._groupDataAdapter._moved(itemPromise,previousHandle,nextHandle)},removed:function(handle,mirage){this._groupDataAdapter._removed(handle,mirage)},countChanged:function(newCount,oldCount){0===newCount&&0!==oldCount&&this._groupDataAdapter.invalidateGroups()},indexChanged:function(handle,newIndex,oldIndex){this._groupDataAdapter._indexChanged(handle,newIndex,oldIndex)},endNotifications:function(){this._groupDataAdapter._endNotifications()},reload:function(){this._groupDataAdapter._reload()}},{supportedForProcessing:!1}),GroupDataAdapter=_Base.Class.define(function(listDataSource,groupKey,groupData,options){this._listBinding=listDataSource.createListBinding(new ListNotificationHandler(this)),this._groupKey=groupKey,this._groupData=groupData,this._initializeState(),this._batchSize=batchSizeDefault,this._count=null,options&&("number"==typeof options.groupCountEstimate&&(this._count=options.groupCountEstimate<0?null:Math.max(options.groupCountEstimate,1)),"number"==typeof options.batchSize&&(this._batchSize=options.batchSize+1)),this._listBinding.last&&(this.itemsFromEnd=function(count){var that=this;return this._fetchItems(function(){return that._lastGroup},function(failed){if(failed)return!1;var count=that._count;return+count!==count||(count>0||void 0)},function(){that._fetchBatch(that._listBinding.last(),that._batchSize-1,0)},count-1,0)})},{setNotificationHandler:function(notificationHandler){this._listDataNotificationHandler=notificationHandler},compareByIdentity:!0,itemsFromKey:function(key,countBefore,countAfter,hints){var that=this;return this._fetchItems(function(){return that._keyMap[key]},function(){var lastGroup=that._lastGroup;return!lastGroup||(+lastGroup.index!==lastGroup.index||void 0)},function(){hints=hints||{};var itemPromise="string"==typeof hints.groupMemberKey&&that._listBinding.fromKey?that._listBinding.fromKey(hints.groupMemberKey):"number"==typeof hints.groupMemberIndex&&that._listBinding.fromIndex?that._listBinding.fromIndex(hints.groupMemberIndex):void 0!==hints.groupMemberDescription&&that._listBinding.fromDescription?that._listBinding.fromDescription(hints.groupMemberDescription):that._listBinding.first(),fetchBefore=Math.floor(.5*(that._batchSize-1));that._fetchBatch(itemPromise,fetchBefore,that._batchSize-1-fetchBefore)},countBefore,countAfter)},itemsFromIndex:function(index,countBefore,countAfter){var that=this;return this._fetchItems(function(){return that._indexMap[index]},function(){var lastGroup=that._lastGroup;return!lastGroup||(+lastGroup.index!==lastGroup.index||(index<=lastGroup.index||void 0))},function(){that._fetchNextIndex()},countBefore,countAfter)},getCount:function(){if(this._lastGroup&&"number"==typeof this._lastGroup.index)return Promise.wrap(this._count);var that=this,countPromise=new Promise(function(complete){var fetch={initialBatch:function(){that._fetchNextIndex()},getGroup:function(){return null},countBefore:0,countAfter:0,complete:function(failed){failed&&(that._count=0);var count=that._count;return"number"==typeof count&&(complete(count),!0)}};that._fetchQueue.push(fetch),that._itemBatch||that._continueFetch(fetch)});return"number"==typeof this._count?Promise.wrap(this._count):countPromise},invalidateGroups:function(){this._beginRefresh(),this._initializeState()},_initializeState:function(){this._count=null,this._indexMax=null,this._keyMap={},this._indexMap={},this._lastGroup=null,this._handleMap={},this._fetchQueue=[],this._itemBatch=null,this._itemsToFetch=0,this._indicesChanged=!1},_releaseItem:function(item){delete this._handleMap[item.handle],this._listBinding.releaseItem(item)},_processBatch:function(){for(var previousItem=null,previousGroup=null,firstItemInGroup=null,itemsSinceStart=0,failed=!0,i=0;i<this._batchSize;i++){var item=this._itemBatch[i],groupKey=item?this._groupKey(item):null;if(item&&(failed=!1),previousGroup&&null!==groupKey&&groupKey===previousGroup.key)itemsSinceStart++,previousGroup.lastItem===previousItem?(previousGroup.lastItem.handle!==previousGroup.firstItem.handle&&this._releaseItem(previousGroup.lastItem),previousGroup.lastItem=item,this._handleMap[item.handle]=previousGroup,previousGroup.size++):previousGroup.firstItem===item&&(previousGroup.firstItem.handle!==previousGroup.lastItem.handle&&this._releaseItem(previousGroup.firstItem),previousGroup.firstItem=firstItemInGroup,this._handleMap[firstItemInGroup.handle]=previousGroup,previousGroup.size+=itemsSinceStart);else{var index=null;if(previousGroup&&(previousGroup.lastReached=!0,"number"==typeof previousGroup.index&&(index=previousGroup.index+1)),item){var group=this._keyMap[groupKey];if(group||(group={key:groupKey,data:this._groupData(item),firstItem:item,lastItem:item,size:1},this._keyMap[group.key]=group,this._handleMap[item.handle]=group),i>0&&(group.firstReached=!0,previousGroup||(index=0)),"number"!=typeof group.index&&"number"==typeof index){for(var group2=group;group2;group2=this._nextGroup(group2))group2.index=index,this._indexMap[index]=group2,index++;this._indexMax=index,"number"==typeof this._count&&!this._lastGroup&&this._count<=this._indexMax&&(this._count=this._indexMax+1)}firstItemInGroup=item,itemsSinceStart=0,previousGroup=group}else previousGroup&&(this._lastGroup=previousGroup,"number"==typeof previousGroup.index&&(this._count=previousGroup.index+1),this._listDataNotificationHandler.invalidateAll(),previousGroup=null)}previousItem=item}var fetch;for(fetch=this._fetchQueue[0];fetch&&fetch.complete(failed);fetch=this._fetchQueue[0])this._fetchQueue.splice(0,1);if(fetch){var that=this;Scheduler.schedule(function(){that._continueFetch(fetch)},Scheduler.Priority.normal,null,"WinJS.UI._GroupDataSource._continueFetch")}else this._itemBatch=null},_processPromise:function(itemPromise,batchIndex){itemPromise.retain(),this._itemBatch[batchIndex]=itemPromise;var that=this;itemPromise.then(function(item){that._itemBatch[batchIndex]=item,0===--that._itemsToFetch&&that._processBatch()})},_fetchBatch:function(itemPromise,countBefore){this._itemBatch=new Array(this._batchSize),this._itemsToFetch=this._batchSize,this._processPromise(itemPromise,countBefore);var batchIndex;for(this._listBinding.jumpToItem(itemPromise),batchIndex=countBefore-1;batchIndex>=0;batchIndex--)this._processPromise(this._listBinding.previous(),batchIndex);for(this._listBinding.jumpToItem(itemPromise),batchIndex=countBefore+1;batchIndex<this._batchSize;batchIndex++)this._processPromise(this._listBinding.next(),batchIndex)},_fetchAdjacent:function(item,after){this._fetchBatch(this._listBinding.fromKey?this._listBinding.fromKey(item.key):this._listBinding.fromIndex(item.index),after?0:this._batchSize-1,after?this._batchSize-1:0)},_fetchNextIndex:function(){var groupHighestIndex=this._indexMap[this._indexMax-1];groupHighestIndex?this._fetchAdjacent(groupHighestIndex.lastItem,!0):this._fetchBatch(this._listBinding.first(),1,this._batchSize-2)},_continueFetch:function(fetch){if(fetch.initialBatch)fetch.initialBatch(),fetch.initialBatch=null;else{var group=fetch.getGroup();if(group){var groupPrev,groupNext;group.firstReached?group.lastReached?fetch.countBefore>0&&0!==group.index&&!groupReady(groupPrev=this._previousGroup(group))?this._fetchAdjacent(groupPrev&&groupPrev.lastReached?groupPrev.firstItem:group.firstItem,!1):(groupNext=this._nextGroup(group),this._fetchAdjacent(groupNext&&groupNext.firstReached?groupNext.lastItem:group.lastItem,!0)):this._fetchAdjacent(group.lastItem,!0):this._fetchAdjacent(group.firstItem,!1)}else this._fetchNextIndex()}},_fetchComplete:function(group,countBefore,countAfter,firstRequest,complete){if(groupReady(group)){var groupPrev=this._previousGroup(group);if(firstRequest||groupReady(groupPrev)||0===group.index||0===countBefore){var groupNext=this._nextGroup(group);if(firstRequest||groupReady(groupNext)||this._lastGroup===group||0===countAfter){for(var countAvailableBefore=0,groupFirst=group;countAvailableBefore<countBefore&&(groupPrev=this._previousGroup(groupFirst),groupReady(groupPrev));)groupFirst=groupPrev,countAvailableBefore++;for(var countAvailableAfter=0,groupLast=group;countAvailableAfter<countAfter&&(groupNext=this._nextGroup(groupLast),groupReady(groupNext));)groupLast=groupNext,countAvailableAfter++;for(var len=countAvailableBefore+1+countAvailableAfter,items=new Array(len),i=0;i<len;i++){var item={key:groupFirst.key,data:groupFirst.data,firstItemKey:groupFirst.firstItem.key,groupSize:groupFirst.size},firstItemIndex=groupFirst.firstItem.index;"number"==typeof firstItemIndex&&(item.firstItemIndexHint=firstItemIndex),items[i]=item,groupFirst=this._nextGroup(groupFirst)}var result={items:items,offset:countAvailableBefore};return result.totalCount="number"==typeof this._count?this._count:_UI.CountResult.unknown,"number"==typeof group.index&&(result.absoluteIndex=group.index),groupLast===this._lastGroup&&(result.atEnd=!0),complete(result),!0}}}return!1},_fetchItems:function(getGroup,mayExist,fetchInitialBatch,countBefore,countAfter){var that=this;return new Promise(function(complete,error){function fetchComplete(failed){var group2=getGroup();return group2?that._fetchComplete(group2,countBefore,countAfter,firstRequest,complete,error):firstRequest&&!mayExist(failed)?(error(errorDoesNotExist()),!0):failureCount>2?(error(errorDoesNotExist()),!0):(failed?failureCount++:failureCount=0,!1)}var group=getGroup(),firstRequest=!group,failureCount=0;if(!fetchComplete()){var fetch={initialBatch:firstRequest?fetchInitialBatch:null,getGroup:getGroup,countBefore:countBefore,countAfter:countAfter,complete:fetchComplete};that._fetchQueue.push(fetch),that._itemBatch||that._continueFetch(fetch)}})},_previousGroup:function(group){return group&&group.firstReached?(this._listBinding.jumpToItem(group.firstItem),this._handleMap[this._listBinding.previous().handle]):null},_nextGroup:function(group){return group&&group.lastReached?(this._listBinding.jumpToItem(group.lastItem),this._handleMap[this._listBinding.next().handle]):null},_invalidateIndices:function(group){this._count=null,this._lastGroup=null,"number"==typeof group.index&&(this._indexMax=group.index>0?group.index:null);for(var group2=group;group2&&"number"==typeof group2.index;group2=this._nextGroup(group2))delete this._indexMap[group2.index],group2.index=null},_releaseGroup:function(group){this._invalidateIndices(group),delete this._keyMap[group.key],this._lastGroup===group&&(this._lastGroup=null),group.firstItem!==group.lastItem&&this._releaseItem(group.firstItem),this._releaseItem(group.lastItem)},_beginRefresh:function(){if(this._fetchQueue=[],this._itemBatch){for(var i=0;i<this._batchSize;i++){var item=this._itemBatch[i];item&&(item.cancel&&item.cancel(),this._listBinding.releaseItem(item))}this._itemBatch=null}this._itemsToFetch=0,this._listDataNotificationHandler.invalidateAll()},_processInsertion:function(item,previousHandle,nextHandle){var groupPrev=this._handleMap[previousHandle],groupNext=this._handleMap[nextHandle],groupKey=null;groupPrev&&(groupPrev.lastReached&&previousHandle===groupPrev.lastItem.handle&&(groupKey=this._groupKey(item))!==groupPrev.key?this._lastGroup===groupPrev&&(this._lastGroup=null,this._count=null):this._releaseGroup(groupPrev),this._beginRefresh()),groupNext&&groupNext!==groupPrev&&(this._invalidateIndices(groupNext),groupNext.firstReached&&nextHandle===groupNext.firstItem.handle&&(null!==groupKey?groupKey:this._groupKey(item))!==groupNext.key||this._releaseGroup(groupNext),this._beginRefresh())},_processRemoval:function(handle){var group=this._handleMap[handle];if(!group||handle!==group.firstItem.handle&&handle!==group.lastItem.handle){if(this._itemBatch)for(var i=0;i<this._batchSize;i++){var item=this._itemBatch[i];if(item&&item.handle===handle){this._beginRefresh();break}}}else this._releaseGroup(group),this._beginRefresh()},_inserted:function(itemPromise,previousHandle,nextHandle){var that=this;itemPromise.then(function(item){that._processInsertion(item,previousHandle,nextHandle)})},_changed:function(newItem,oldItem){var group=this._handleMap[newItem.handle];if(group&&newItem.handle===group.firstItem.handle&&(this._releaseGroup(group),this._beginRefresh()),this._groupKey(newItem)!==this._groupKey(oldItem)){this._listBinding.jumpToItem(newItem);var previousHandle=this._listBinding.previous().handle;this._listBinding.jumpToItem(newItem);var nextHandle=this._listBinding.next().handle;this._processRemoval(newItem.handle),this._processInsertion(newItem,previousHandle,nextHandle)}},_moved:function(itemPromise,previousHandle,nextHandle){this._processRemoval(itemPromise.handle);var that=this;itemPromise.then(function(item){that._processInsertion(item,previousHandle,nextHandle)})},_removed:function(handle,mirage){mirage||this._processRemoval(handle)},_indexChanged:function(handle,newIndex,oldIndex){"number"==typeof oldIndex&&(this._indicesChanged=!0)},_endNotifications:function(){if(this._indicesChanged){this._indicesChanged=!1;for(var key in this._keyMap){var group=this._keyMap[key];if(group.firstReached&&group.lastReached){var newSize=group.lastItem.index+1-group.firstItem.index;isNaN(newSize)||(group.size=newSize)}}this._beginRefresh()}},_reload:function(){this._initializeState(),this._listDataNotificationHandler.reload()}},{supportedForProcessing:!1});return _Base.Class.derive(VirtualizedDataSource.VirtualizedDataSource,function(listDataSource,groupKey,groupData,options){var groupDataAdapter=new GroupDataAdapter(listDataSource,groupKey,groupData,options);this._baseDataSourceConstructor(groupDataAdapter),this.extensions={invalidateGroups:function(){groupDataAdapter.invalidateGroups()}}},{},{supportedForProcessing:!1})})})}),define("WinJS/VirtualizedDataSource/_GroupedItemDataSource",["../Core/_Base","./_GroupDataSource"],function(_Base,_GroupDataSource){"use strict";_Base.Namespace.define("WinJS.UI",{computeDataSourceGroups:function(listDataSource,groupKey,groupData,options){function createGroupedItem(item){if(item){var groupedItem=Object.create(item);return groupedItem.groupKey=groupKey(item),groupData&&(groupedItem.groupData=groupData(item)),groupedItem}return null}function createGroupedItemPromise(itemPromise){var groupedItemPromise=Object.create(itemPromise);return groupedItemPromise.then=function(onComplete,onError,onCancel){return itemPromise.then(function(item){return onComplete(createGroupedItem(item))},onError,onCancel)},groupedItemPromise}var groupedItemDataSource=Object.create(listDataSource);groupedItemDataSource.createListBinding=function(notificationHandler){var groupedNotificationHandler;notificationHandler?(groupedNotificationHandler=Object.create(notificationHandler),groupedNotificationHandler.inserted=function(itemPromise,previousHandle,nextHandle){return notificationHandler.inserted(createGroupedItemPromise(itemPromise),previousHandle,nextHandle)},groupedNotificationHandler.changed=function(newItem,oldItem){return notificationHandler.changed(createGroupedItem(newItem),createGroupedItem(oldItem))},groupedNotificationHandler.moved=function(itemPromise,previousHandle,nextHandle){return notificationHandler.moved(createGroupedItemPromise(itemPromise),previousHandle,nextHandle)}):groupedNotificationHandler=null;for(var listBinding=listDataSource.createListBinding(groupedNotificationHandler),groupedItemListBinding=Object.create(listBinding),listBindingMethods=["first","last","fromDescription","jumpToItem","current"],i=0,len=listBindingMethods.length;i<len;i++)!function(listBindingMethod){listBinding[listBindingMethod]&&(groupedItemListBinding[listBindingMethod]=function(){return createGroupedItemPromise(listBinding[listBindingMethod].apply(listBinding,arguments))})}(listBindingMethods[i]);return listBinding.fromKey&&(groupedItemListBinding.fromKey=function(key){return createGroupedItemPromise(listBinding.fromKey(key))}),listBinding.fromIndex&&(groupedItemListBinding.fromIndex=function(index){return createGroupedItemPromise(listBinding.fromIndex(index))}),groupedItemListBinding.prev=function(){return createGroupedItemPromise(listBinding.prev())},groupedItemListBinding.next=function(){return createGroupedItemPromise(listBinding.next())},groupedItemListBinding};for(var listDataSourceMethods=["itemFromKey","itemFromIndex","itemFromDescription","insertAtStart","insertBefore","insertAfter","insertAtEnd","change","moveToStart","moveBefore","moveAfter","moveToEnd"],i=0,len=listDataSourceMethods.length;i<len;i++)!function(listDataSourceMethod){listDataSource[listDataSourceMethod]&&(groupedItemDataSource[listDataSourceMethod]=function(){return createGroupedItemPromise(listDataSource[listDataSourceMethod].apply(listDataSource,arguments))})}(listDataSourceMethods[i]);["addEventListener","removeEventListener","dispatchEvent"].forEach(function(methodName){listDataSource[methodName]&&(groupedItemDataSource[methodName]=function(){return listDataSource[methodName].apply(listDataSource,arguments)})});var groupDataSource=null;return Object.defineProperty(groupedItemDataSource,"groups",{get:function(){return groupDataSource||(groupDataSource=new _GroupDataSource._GroupDataSource(listDataSource,groupKey,groupData,options)),groupDataSource},enumerable:!0,configurable:!0}),groupedItemDataSource}})}),define("WinJS/VirtualizedDataSource/_StorageDataSource",["exports","../Core/_WinRT","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_WriteProfilerMark","../Animations","../Promise","../Utilities/_UI","./_VirtualizedDataSourceImpl"],function(exports,_WinRT,_Global,_Base,_ErrorFromName,_WriteProfilerMark,Animations,Promise,_UI,VirtualizedDataSource){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{StorageDataSource:_Base.Namespace._lazy(function(){var StorageDataAdapter=_Base.Class.define(function(query,options){_WriteProfilerMark("WinJS.UI.StorageDataSource:constructor,StartTM");var library,mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.singleItem,size=256,flags=_WinRT.Windows.Storage.FileProperties.ThumbnailOptions.useCurrentScale,delayLoad=!0;if("Pictures"===query?(mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.picturesView,library=_WinRT.Windows.Storage.KnownFolders.picturesLibrary,size=190):"Music"===query?(mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.musicView,library=_WinRT.Windows.Storage.KnownFolders.musicLibrary,size=256):"Documents"===query?(mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.documentsView,library=_WinRT.Windows.Storage.KnownFolders.documentsLibrary,size=40):"Videos"===query&&(mode=_WinRT.Windows.Storage.FileProperties.ThumbnailMode.videosView,library=_WinRT.Windows.Storage.KnownFolders.videosLibrary,size=190),library){var queryOptions=new _WinRT.Windows.Storage.Search.QueryOptions;queryOptions.folderDepth=_WinRT.Windows.Storage.Search.FolderDepth.deep,queryOptions.indexerOption=_WinRT.Windows.Storage.Search.IndexerOption.useIndexerWhenAvailable,this._query=library.createFileQueryWithOptions(queryOptions)}else this._query=query;if(options){if("number"==typeof options.mode&&(mode=options.mode),"number"==typeof options.requestedThumbnailSize)size=Math.max(1,Math.min(options.requestedThumbnailSize,1024));else switch(mode){case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.picturesView:case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.videosView:size=190;break;case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.documentsView:case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.listView:size=40;break;case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.musicView:case _WinRT.Windows.Storage.FileProperties.ThumbnailMode.singleItem:size=256}"number"==typeof options.thumbnailOptions&&(flags=options.thumbnailOptions),"boolean"==typeof options.waitForFileLoad&&(delayLoad=!options.waitForFileLoad)}this._loader=new _WinRT.Windows.Storage.BulkAccess.FileInformationFactory(this._query,mode,size,flags,delayLoad),this.compareByIdentity=!1,this.firstDataRequest=!0,_WriteProfilerMark("WinJS.UI.StorageDataSource:constructor,StopTM")},{setNotificationHandler:function(notificationHandler){this._notificationHandler=notificationHandler,this._query.addEventListener("contentschanged",function(){notificationHandler.invalidateAll()}),this._query.addEventListener("optionschanged",function(){notificationHandler.invalidateAll()})},itemsFromEnd:function(count){var that=this;return _WriteProfilerMark("WinJS.UI.StorageDataSource:itemsFromEnd,info"),this.getCount().then(function(totalCount){return 0===totalCount?Promise.wrapError(new _ErrorFromName(_UI.FetchError.doesNotExist)):that.itemsFromIndex(totalCount-1,Math.min(totalCount-1,count-1),1)})},itemsFromIndex:function(index,countBefore,countAfter){function listener(ev){that._notificationHandler.changed(that._item(ev.target))}countBefore+countAfter>64&&(countBefore=Math.min(countBefore,32),countAfter=64-(countBefore+1));var first=index-countBefore,count=countBefore+1+countAfter,that=this;that.firstDataRequest&&(that.firstDataRequest=!1,count=Math.max(count,32));var perfId="WinJS.UI.StorageDataSource:itemsFromIndex("+first+"-"+(first+count-1)+")";return _WriteProfilerMark(perfId+",StartTM"),this._loader.getItemsAsync(first,count).then(function(itemsVector){var vectorSize=itemsVector.size;if(vectorSize<=countBefore)return Promise.wrapError(new _ErrorFromName(_UI.FetchError.doesNotExist));var items=new Array(vectorSize),localItemsVector=new Array(vectorSize);itemsVector.getMany(0,localItemsVector);for(var i=0;i<vectorSize;i++)items[i]=that._item(localItemsVector[i]),localItemsVector[i].addEventListener("propertiesupdated",listener);var result={items:items,offset:countBefore,absoluteIndex:index};return vectorSize<count&&(result.totalCount=first+vectorSize),_WriteProfilerMark(perfId+",StopTM"),result})},itemsFromDescription:function(description,countBefore,countAfter){var that=this;return _WriteProfilerMark("WinJS.UI.StorageDataSource:itemsFromDescription,info"),this._query.findStartIndexAsync(description).then(function(index){return that.itemsFromIndex(index,countBefore,countAfter)})},getCount:function(){return _WriteProfilerMark("WinJS.UI.StorageDataSource:getCount,info"),this._query.getItemCountAsync()},itemSignature:function(item){return item.folderRelativeId},_item:function(item){return{key:item.path||item.folderRelativeId,data:item}}},{supportedForProcessing:!1});return _Base.Class.derive(VirtualizedDataSource.VirtualizedDataSource,function(query,options){this._baseDataSourceConstructor(new StorageDataAdapter(query,options))},{},{loadThumbnail:function(item,image){var thumbnailUpdateHandler,thumbnailPromise,shouldRespondToThumbnailUpdate=!1;return new Promise(function(complete){var tagSupplied=!!image,processThumbnail=function(thumbnail){if(thumbnail){var url=_Global.URL.createObjectURL(thumbnail,{oneTimeOnly:!0});thumbnailPromise=thumbnailPromise?thumbnailPromise.then(function(image){return item.loadImage(url,image)}):item.loadImage(url,image).then(function(image){return item.isOnScreen().then(function(visible){var imagePromise;return visible&&tagSupplied?imagePromise=Animations.fadeIn(image).then(function(){return image}):(image.style.opacity=1,imagePromise=Promise.wrap(image)),imagePromise})}),thumbnail.type===_WinRT.Windows.Storage.FileProperties.ThumbnailType.icon||thumbnail.returnedSmallerCachedSize||(_WriteProfilerMark("WinJS.UI.StorageDataSource:loadThumbnail complete,info"),item.data.removeEventListener("thumbnailupdated",thumbnailUpdateHandler),shouldRespondToThumbnailUpdate=!1,thumbnailPromise=thumbnailPromise.then(function(image){thumbnailUpdateHandler=null,thumbnailPromise=null,complete(image)}))}};thumbnailUpdateHandler=function(e){shouldRespondToThumbnailUpdate&&processThumbnail(e.target.thumbnail)},item.data.addEventListener("thumbnailupdated",thumbnailUpdateHandler),shouldRespondToThumbnailUpdate=!0,processThumbnail(item.data.thumbnail)},function(){item.data.removeEventListener("thumbnailupdated",thumbnailUpdateHandler),shouldRespondToThumbnailUpdate=!1,thumbnailUpdateHandler=null,thumbnailPromise&&(thumbnailPromise.cancel(),thumbnailPromise=null)})},supportedForProcessing:!1})})})}),define("WinJS/VirtualizedDataSource",["./VirtualizedDataSource/_VirtualizedDataSourceImpl","./VirtualizedDataSource/_GroupDataSource","./VirtualizedDataSource/_GroupedItemDataSource","./VirtualizedDataSource/_StorageDataSource"],function(){}),define("WinJS/Vui",["require","exports","./Core/_Global","./Utilities/_ElementUtilities"],function(require,exports,_Global,_ElementUtilities){function _handleListeningModeStateChanged(e){if(!e.defaultPrevented){var target=e.target,transitionHandler=Handlers[target.tagName];if(transitionHandler)switch(e.state){case ListeningModeStates.active:target[Properties.vuiData]||_ElementUtilities.hasClass(target,ClassNames.active)?(_ElementUtilities.removeClass(target,ClassNames.disambiguation),transitionHandler.reactivate(target,e.label)):(_ElementUtilities.addClass(target,ClassNames.active),transitionHandler.activate(target,e.label));break;case ListeningModeStates.disambiguation:_ElementUtilities.addClass(target,ClassNames.active),_ElementUtilities.addClass(target,ClassNames.disambiguation),transitionHandler.disambiguate(target,e.label);break;case ListeningModeStates.inactive:_ElementUtilities.removeClass(target,ClassNames.active),_ElementUtilities.removeClass(target,ClassNames.disambiguation),transitionHandler.deactivate(target)}}}var Handlers,Properties={vuiData:"_winVuiData"},ClassNames={active:"win-vui-active",disambiguation:"win-vui-disambiguation"},EventNames={ListeningModeStateChanged:"ListeningStateChanged"},ListeningModeStates={active:"active",disambiguation:"disambiguation",inactive:"inactive"};!function(Handlers){Handlers.BUTTON={activate:function(element,label){var vuiData={nodes:[],width:element.style.width,height:element.style.height},cs=_ElementUtilities._getComputedStyle(element);for(element.style.width=cs.width,element.style.height=cs.height;element.childNodes.length;)vuiData.nodes.push(element.removeChild(element.childNodes[0]));element[Properties.vuiData]=vuiData,element.textContent=label},disambiguate:function(element,label){element.textContent=label},reactivate:function(element,label){element.textContent=label},deactivate:function(element){element.innerHTML="";var vuiData=element[Properties.vuiData];element.style.width=vuiData.width,element.style.height=vuiData.height,vuiData.nodes.forEach(function(node){return element.appendChild(node)}),delete element[Properties.vuiData]}}}(Handlers||(Handlers={})),_Global.document&&_Global.document.addEventListener(EventNames.ListeningModeStateChanged,_handleListeningModeStateChanged)}),define("WinJS/_Accents",["require","exports","./Core/_Global","./Core/_WinRT","./Core/_Base","./Core/_BaseUtils","./Utilities/_ElementUtilities"],function(require,exports,_Global,_WinRT,_Base,_BaseUtils,_ElementUtilities){function createAccentRule(selector,props){rules.push({selector:selector,props:props}),scheduleWriteRules()}function scheduleWriteRules(){0!==rules.length&&writeRulesTOHandle===-1&&(writeRulesTOHandle=_BaseUtils._setImmediate(function(){writeRulesTOHandle=-1,cleanup();var inverseThemeSelector=isDarkTheme?Constants.lightThemeSelector:Constants.darkThemeSelector,inverseThemeHoverSelector=Constants.hoverSelector+" "+inverseThemeSelector,style=_Global.document.createElement("style");style.id=Constants.accentStyleId,style.textContent=rules.map(function(rule){var body="  "+rule.props.map(function(prop){return prop.name+": "+colors[prop.value]+";"}).join("\n  "),selectorSplit=rule.selector.split(",").map(function(str){return sanitizeSpaces(str)}),selector=selectorSplit.join(",\n"),css=selector+" {\n"+body+"\n}",isThemedColor=rule.props.some(function(prop){return 0!==prop.value});if(isThemedColor){var inverseBody="  "+rule.props.map(function(prop){return prop.name+": "+colors[prop.value?prop.value+3:prop.value]+";"}).join("\n  "),themedSelectors=[];selectorSplit.forEach(function(sel){if(sel.indexOf(Constants.hoverSelector)!==-1&&sel.indexOf(inverseThemeHoverSelector)===-1){themedSelectors.push(sel.replace(Constants.hoverSelector,inverseThemeHoverSelector));var selWithoutHover=sel.replace(Constants.hoverSelector,"").trim();CSSSelectorTokens.indexOf(selWithoutHover[0])!==-1&&themedSelectors.push(sel.replace(Constants.hoverSelector+" ",inverseThemeHoverSelector))}else themedSelectors.push(inverseThemeSelector+" "+sel),CSSSelectorTokens.indexOf(sel[0])!==-1&&themedSelectors.push(inverseThemeSelector+sel);css+="\n"+themedSelectors.join(",\n")+" {\n"+inverseBody+"\n}"})}return css}).join("\n"),_Global.document.head.appendChild(style)}))}function handleColorsChanged(){var uiColor=(_WinRT.Windows.UI.ViewManagement.UIColorType,UISettings.getColorValue(_WinRT.Windows.UI.ViewManagement.UIColorType.accent)),accent=colorToString(uiColor,1);colors[0]!==accent&&(colors.length=0,colors.push(accent,colorToString(uiColor,isDarkTheme?.6:.4),colorToString(uiColor,isDarkTheme?.8:.6),colorToString(uiColor,isDarkTheme?.9:.7),colorToString(uiColor,isDarkTheme?.4:.6),colorToString(uiColor,isDarkTheme?.6:.8),colorToString(uiColor,isDarkTheme?.7:.9)),scheduleWriteRules())}function colorToString(color,alpha){return"rgba("+color.r+","+color.g+","+color.b+","+alpha+")"}function sanitizeSpaces(str){return str.replace(/  /g," ").replace(/  /g," ").trim()}function cleanup(){var style=_Global.document.head.querySelector("#"+Constants.accentStyleId);style&&style.parentNode.removeChild(style)}function _reset(){rules.length=0,cleanup()}var Constants={accentStyleId:"WinJSAccentsStyle",themeDetectionTag:"winjs-themedetection-tag",hoverSelector:"html.win-hoverable",lightThemeSelector:".win-ui-light",darkThemeSelector:".win-ui-dark"},CSSSelectorTokens=[".","#",":"],UISettings=null,colors=[],isDarkTheme=!1,rules=[],writeRulesTOHandle=-1;!function(ColorTypes){ColorTypes[ColorTypes.accent=0]="accent",ColorTypes[ColorTypes.listSelectRest=1]="listSelectRest",ColorTypes[ColorTypes.listSelectHover=2]="listSelectHover",ColorTypes[ColorTypes.listSelectPress=3]="listSelectPress",ColorTypes[ColorTypes._listSelectRestInverse=4]="_listSelectRestInverse",ColorTypes[ColorTypes._listSelectHoverInverse=5]="_listSelectHoverInverse",ColorTypes[ColorTypes._listSelectPressInverse=6]="_listSelectPressInverse"}(exports.ColorTypes||(exports.ColorTypes={}));var ColorTypes=exports.ColorTypes;exports.createAccentRule=createAccentRule;var tag=_Global.document.createElement(Constants.themeDetectionTag);_Global.document.head.appendChild(tag);var cs=_ElementUtilities._getComputedStyle(tag);isDarkTheme="0"===cs.opacity,tag.parentElement.removeChild(tag);try{UISettings=new _WinRT.Windows.UI.ViewManagement.UISettings,UISettings.addEventListener("colorvalueschanged",handleColorsChanged),handleColorsChanged()}catch(e){colors.push("rgb(0, 120, 215)","rgba(0, 120, 215, "+(isDarkTheme?"0.6":"0.4")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.8":"0.6")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.9":"0.7")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.4":"0.6")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.6":"0.8")+")","rgba(0, 120, 215, "+(isDarkTheme?"0.7":"0.9")+")");
}var toPublish={ColorTypes:ColorTypes,createAccentRule:createAccentRule,_colors:colors,_reset:_reset,_isDarkTheme:isDarkTheme};_Base.Namespace.define("WinJS.UI._Accents",toPublish)}),define("require-style",{load:function(id){throw new Error("Dynamic load not allowed: "+id)}}),define("require-style!less/styles-intrinsic",[],function(){}),define("require-style!less/colors-intrinsic",[],function(){}),define("WinJS/Controls/IntrinsicControls",["../Utilities/_Hoverable","../_Accents","require-style!less/styles-intrinsic","require-style!less/colors-intrinsic"],function(_Hoverable,_Accents){"use strict";_Accents.createAccentRule(".win-link,         .win-progress-bar,         .win-progress-ring,         .win-ring",[{name:"color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule("::selection,         .win-button.win-button-primary,         .win-dropdown option:checked,         select[multiple].win-dropdown option:checked",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-textbox:focus,         .win-textarea:focus,         .win-textbox:focus:hover,         .win-textarea:focus:hover",[{name:"border-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-textbox::-ms-clear:hover:not(:active),         .win-textbox::-ms-reveal:hover:not(:active)",[{name:"color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-checkbox:checked::-ms-check,         .win-textbox::-ms-clear:active,         .win-textbox::-ms-reveal:active",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-progress-bar::-webkit-progress-value,         .win-progress-ring::-webkit-progress-value,         .win-ring::-webkit-progress-value",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-progress-bar:not(:indeterminate)::-moz-progress-bar,         .win-progress-ring:not(:indeterminate)::-moz-progress-bar,         .win-ring:not(:indeterminate)::-moz-progress-bar",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-checkbox:indeterminate::-ms-check,         .win-checkbox:hover:indeterminate::-ms-check,         .win-radio:checked::-ms-check",[{name:"border-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-slider::-ms-thumb,         .win-slider::-ms-fill-lower",[{name:"background",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-slider::-webkit-slider-thumb",[{name:"background",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-slider::-moz-range-thumb",[{name:"background",value:_Accents.ColorTypes.accent}])}),define("WinJS/Controls/ElementResizeInstrument/_ElementResizeInstrument",["require","exports","../../Core/_BaseUtils","../../Core/_Base","../../Core/_Global","../../Core/_Log","../../Core/_ErrorFromName","../../Core/_Events","../../Promise","../../Utilities/_ElementUtilities"],function(require,exports,_BaseUtils,_Base,_Global,_Log,_ErrorFromName,_Events,Promise,_ElementUtilities){"use strict";var styleText="display: block;position:absolute;top: 0;left: 0;height: 100%;width: 100%;overflow: hidden;pointer-events: none;z-index: -1;",className="win-resizeinstrument",objData="about:blank",eventNames={resize:"resize",_ready:"_ready"},contentWindowResizeEvent="resize",isMS="msHighContrastAdjust"in document.documentElement.style,_ElementResizeInstrument=function(){function _ElementResizeInstrument(){var _this=this;this._disposed=!1,this._elementLoaded=!1,this._running=!1,this._objectWindowResizeHandlerBound=this._objectWindowResizeHandler.bind(this);var objEl=_Global.document.createElement("OBJECT");objEl.setAttribute("style",styleText),isMS?objEl.style.visibility="hidden":objEl.data=objData,objEl.type="text/html",objEl.winControl=this,_ElementUtilities.addClass(objEl,className),_ElementUtilities.addClass(objEl,"win-disposable"),this._element=objEl,this._elementLoadPromise=new Promise(function(c){objEl.onload=function(){_this._disposed||(_this._elementLoaded=!0,_this._objWindow.addEventListener(contentWindowResizeEvent,_this._objectWindowResizeHandlerBound),c())}})}return Object.defineProperty(_ElementResizeInstrument.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(_ElementResizeInstrument.prototype,"_objWindow",{get:function(){return this._elementLoaded&&this._element.contentDocument&&this._element.contentDocument.defaultView||null},enumerable:!0,configurable:!0}),_ElementResizeInstrument.prototype.addedToDom=function(){var _this=this;if(!this._disposed){var objEl=this.element;if(!_Global.document.body.contains(objEl))throw new _ErrorFromName("WinJS.UI._ElementResizeInstrument","ElementResizeInstrument initialization failed");_Log.log&&"static"===_ElementUtilities._getComputedStyle(objEl.parentElement).position&&_Log.log("_ElementResizeInstrument can only detect size changes that are made to it's nearest positioned ancestor. Its parent element is not currently positioned."),!this._elementLoaded&&isMS&&(objEl.data="about:blank"),this._elementLoadPromise.then(function(){_this._running=!0,_this.dispatchEvent(eventNames._ready,null);var initialResizeTimeout=Promise.timeout(50),handleInitialResize=function(){_this.removeEventListener(eventNames.resize,handleInitialResize),initialResizeTimeout.cancel()};_this.addEventListener(eventNames.resize,handleInitialResize),initialResizeTimeout.then(function(){_this._objectWindowResizeHandler()})})}},_ElementResizeInstrument.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._elementLoadPromise.cancel(),this._objWindow&&this._objWindow.removeEventListener.call(this._objWindow,contentWindowResizeEvent,this._objectWindowResizeHandlerBound),this._running=!1)},_ElementResizeInstrument.prototype.addEventListener=function(type,listener,useCapture){},_ElementResizeInstrument.prototype.dispatchEvent=function(type,eventProperties){return!1},_ElementResizeInstrument.prototype.removeEventListener=function(type,listener,useCapture){},_ElementResizeInstrument.prototype._objectWindowResizeHandler=function(){var _this=this;this._running&&this._batchResizeEvents(function(){_this._fireResizeEvent()})},_ElementResizeInstrument.prototype._batchResizeEvents=function(handleResizeFn){this._pendingResizeAnimationFrameId&&_BaseUtils._cancelAnimationFrame(this._pendingResizeAnimationFrameId),this._pendingResizeAnimationFrameId=_BaseUtils._requestAnimationFrame(function(){handleResizeFn()})},_ElementResizeInstrument.prototype._fireResizeEvent=function(){this._disposed||this.dispatchEvent(eventNames.resize,null)},_ElementResizeInstrument.EventNames=eventNames,_ElementResizeInstrument}();exports._ElementResizeInstrument=_ElementResizeInstrument,_Base.Class.mix(_ElementResizeInstrument,_Events.eventMixin)}),define("WinJS/Controls/ElementResizeInstrument",["require","exports"],function(require,exports){function getModule(){return module||require(["./ElementResizeInstrument/_ElementResizeInstrument"],function(m){module=m}),module._ElementResizeInstrument}var module=null,publicMembers=Object.create({},{_ElementResizeInstrument:{get:function(){return getModule()}}});return publicMembers}),define("WinJS/Controls/ItemContainer/_Constants",["exports","../../Core/_Base"],function(exports,_Base){"use strict";var members={};members._listViewClass="win-listview",members._viewportClass="win-viewport",members._rtlListViewClass="win-rtl",members._horizontalClass="win-horizontal",members._verticalClass="win-vertical",members._scrollableClass="win-surface",members._itemsContainerClass="win-itemscontainer",members._listHeaderContainerClass="win-headercontainer",members._listFooterContainerClass="win-footercontainer",members._padderClass="win-itemscontainer-padder",members._proxyClass="_win-proxy",members._itemClass="win-item",members._itemBoxClass="win-itembox",members._itemsBlockClass="win-itemsblock",members._containerClass="win-container",members._containerEvenClass="win-container-even",members._containerOddClass="win-container-odd",members._backdropClass="win-backdrop",members._footprintClass="win-footprint",members._groupsClass="win-groups",members._selectedClass="win-selected",members._selectionBorderClass="win-selectionborder",members._selectionBackgroundClass="win-selectionbackground",members._selectionCheckmarkClass="win-selectioncheckmark",members._selectionCheckmarkBackgroundClass="win-selectioncheckmarkbackground",members._pressedClass="win-pressed",members._headerClass="win-groupheader",members._headerContainerClass="win-groupheadercontainer",members._groupLeaderClass="win-groupleader",members._progressClass="win-progress",members._revealedClass="win-revealed",members._itemFocusClass="win-focused",members._itemFocusOutlineClass="win-focusedoutline",members._zoomingXClass="win-zooming-x",members._zoomingYClass="win-zooming-y",members._listLayoutClass="win-listlayout",members._gridLayoutClass="win-gridlayout",members._headerPositionTopClass="win-headerpositiontop",members._headerPositionLeftClass="win-headerpositionleft",members._structuralNodesClass="win-structuralnodes",members._singleItemsBlockClass="win-single-itemsblock",members._uniformGridLayoutClass="win-uniformgridlayout",members._uniformListLayoutClass="win-uniformlistlayout",members._cellSpanningGridLayoutClass="win-cellspanninggridlayout",members._laidOutClass="win-laidout",members._nonDraggableClass="win-nondraggable",members._nonSelectableClass="win-nonselectable",members._dragOverClass="win-dragover",members._dragSourceClass="win-dragsource",members._clipClass="win-clip",members._selectionModeClass="win-selectionmode",members._noCSSGrid="win-nocssgrid",members._hidingSelectionMode="win-hidingselectionmode",members._hidingSelectionModeAnimationTimeout=250,members._INVALID_INDEX=-1,members._UNINITIALIZED=-1,members._LEFT_MSPOINTER_BUTTON=0,members._RIGHT_MSPOINTER_BUTTON=2,members._TAP_END_THRESHOLD=10,members._DEFAULT_PAGES_TO_LOAD=5,members._DEFAULT_PAGE_LOAD_THRESHOLD=2,members._MIN_AUTOSCROLL_RATE=150,members._MAX_AUTOSCROLL_RATE=1500,members._AUTOSCROLL_THRESHOLD=100,members._AUTOSCROLL_DELAY=50,members._DEFERRED_ACTION=250,members._DEFERRED_SCROLL_END=250,members._SELECTION_CHECKMARK="",members._LISTVIEW_PROGRESS_DELAY=2e3;var ScrollToPriority={uninitialized:0,low:1,medium:2,high:3},ViewChange={rebuild:0,remeasure:1,relayout:2,realize:3};members._ScrollToPriority=ScrollToPriority,members._ViewChange=ViewChange,_Base.Namespace._moduleDefine(exports,"WinJS.UI",members)}),define("WinJS/Controls/ItemContainer/_ItemEventsHandler",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","./_Constants"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_WriteProfilerMark,Animations,_TransitionAnimation,Promise,_ElementUtilities,_UI,_Constants){"use strict";var transformNames=_BaseUtils._browserStyleEquivalents.transform;_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_ItemEventsHandler:_Base.Namespace._lazy(function(){function createNodeWithClass(className,skipAriaHidden){var element=_Global.document.createElement("div");return element.className=className,skipAriaHidden||element.setAttribute("aria-hidden",!0),element}var PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",ItemEventsHandler=_Base.Class.define(function(site){this._site=site,this._work=[],this._animations={}},{dispose:function(){this._disposed||(this._disposed=!0,_ElementUtilities._removeEventListener(_Global,"pointerup",this._resetPointerDownStateBound),_ElementUtilities._removeEventListener(_Global,"pointercancel",this._resetPointerDownStateBound))},onPointerDown:function(eventObject){_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerDown,StartTM");var leftButton,rightButton,site=this._site,touchInput=eventObject.pointerType===PT_TOUCH;if(site.pressedElement=eventObject.target,_WinRT.Windows.UI.Input.PointerPoint){var currentPoint=this._getCurrentPoint(eventObject),pointProps=currentPoint.properties;touchInput||pointProps.isInverted||pointProps.isEraser||pointProps.isMiddleButtonPressed?leftButton=rightButton=!1:(rightButton=pointProps.isRightButtonPressed,leftButton=!rightButton&&pointProps.isLeftButtonPressed)}else leftButton=eventObject.button===_Constants._LEFT_MSPOINTER_BUTTON,rightButton=eventObject.button===_Constants._RIGHT_MSPOINTER_BUTTON;this._DragStartBound=this._DragStartBound||this.onDragStart.bind(this),this._PointerEnterBound=this._PointerEnterBound||this.onPointerEnter.bind(this),this._PointerLeaveBound=this._PointerLeaveBound||this.onPointerLeave.bind(this);var isInteractive=this._isInteractive(eventObject.target),currentPressedIndex=site.indexForItemElement(eventObject.target),currentPressedHeaderIndex=site.indexForHeaderElement(eventObject.target),mustSetCapture=!isInteractive&&currentPressedIndex!==_Constants._INVALID_INDEX;if((touchInput||leftButton)&&this._site.pressedEntity.index===_Constants._INVALID_INDEX&&!isInteractive&&(currentPressedHeaderIndex===_Constants._INVALID_INDEX?this._site.pressedEntity={type:_UI.ObjectType.item,index:currentPressedIndex}:this._site.pressedEntity={type:_UI.ObjectType.groupHeader,index:currentPressedHeaderIndex},this._site.pressedEntity.index!==_Constants._INVALID_INDEX)){this._site.pressedPosition=_ElementUtilities._getCursorPos(eventObject);var allowed=site.verifySelectionAllowed(this._site.pressedEntity);this._canSelect=allowed.canSelect,this._canTapSelect=allowed.canTapSelect,this._site.pressedEntity.type===_UI.ObjectType.item?(this._site.pressedItemBox=site.itemBoxAtIndex(this._site.pressedEntity.index),this._site.pressedContainer=site.containerAtIndex(this._site.pressedEntity.index),this._site.animatedElement=this._site.pressedContainer,this._site.pressedHeader=null,this._togglePressed(!0,eventObject),this._site.pressedContainer.addEventListener("dragstart",this._DragStartBound),touchInput||(_ElementUtilities._addEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),_ElementUtilities._addEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1))):(this._site.pressedHeader=this._site.headerFromElement(eventObject.target),_BaseUtils.isPhone?(this._site.animatedElement=this._site.pressedHeader,this._togglePressed(!0,eventObject)):(this._site.pressedItemBox=null,this._site.pressedContainer=null,this._site.animatedElement=null)),this._resetPointerDownStateBound||(this._resetPointerDownStateBound=this._resetPointerDownStateForPointerId.bind(this)),touchInput||(_ElementUtilities._addEventListener(_Global,"pointerup",this._resetPointerDownStateBound,!1),_ElementUtilities._addEventListener(_Global,"pointercancel",this._resetPointerDownStateBound,!1)),this._pointerId=eventObject.pointerId,this._pointerRightButton=rightButton}if(mustSetCapture&&touchInput)try{_ElementUtilities._setPointerCapture(site.canvasProxy,eventObject.pointerId)}catch(e){return void _WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")}this._site.pressedEntity.type===_UI.ObjectType.item&&this._selectionAllowed()&&this._multiSelection()&&this._site.pressedEntity.index!==_Constants._INVALID_INDEX&&site.selection._getFocused().index!==_Constants._INVALID_INDEX&&site.selection._pivot===_Constants._INVALID_INDEX&&(site.selection._pivot=site.selection._getFocused().index),_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerDown,StopTM")},onPointerEnter:function(eventObject){this._site.pressedContainer&&this._pointerId===eventObject.pointerId&&this._togglePressed(!0,eventObject)},onPointerLeave:function(eventObject){this._site.pressedContainer&&this._pointerId===eventObject.pointerId&&this._togglePressed(!1,eventObject)},onDragStart:function(){this._resetPressedContainer()},_resetPressedContainer:function(){(this._site.pressedContainer||this._site.pressedHeader)&&this._site.animatedElement&&(this._togglePressed(!1),this._site.pressedContainer&&(this._site.pressedContainer.style[transformNames.scriptName]="",this._site.pressedContainer.removeEventListener("dragstart",this._DragStartBound),_ElementUtilities._removeEventListener(this._site.pressedContainer,"pointerenter",this._PointerEnterBound,!1),_ElementUtilities._removeEventListener(this._site.pressedContainer,"pointerleave",this._PointerLeaveBound,!1)))},onClick:function(eventObject){if(!this._skipClick){var entity={type:_UI.ObjectType.item,index:this._site.indexForItemElement(eventObject.target)};if(entity.index===_Constants._INVALID_INDEX&&(entity.index=this._site.indexForHeaderElement(eventObject.target),entity.index!==_Constants._INVALID_INDEX&&(entity.type=_UI.ObjectType.groupHeader)),entity.index!==_Constants._INVALID_INDEX&&(_ElementUtilities.hasClass(eventObject.target,this._site.accessibleItemClass)||_ElementUtilities.hasClass(eventObject.target,_Constants._headerClass))){var allowed=this._site.verifySelectionAllowed(entity);allowed.canTapSelect&&this.handleTap(entity),this._site.fireInvokeEvent(entity,eventObject.target)}}},onPointerUp:function(eventObject){_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerUp,StartTM");var site=this._site;this._skipClick=!0;var that=this;_BaseUtils._yieldForEvents(function(){that._skipClick=!1});try{_ElementUtilities._releasePointerCapture(site.canvasProxy,eventObject.pointerId)}catch(e){}var touchInput=eventObject.pointerType===PT_TOUCH,releasedElement=this._releasedElement(eventObject),releasedIndex=site.indexForItemElement(releasedElement),releasedHeaderIndex=releasedElement&&_ElementUtilities.hasClass(releasedElement,_Constants._headerContainerClass)?site.indexForHeaderElement(site.pressedHeader):site.indexForHeaderElement(releasedElement);if(this._pointerId===eventObject.pointerId){var releasedEntity;if(releasedEntity=releasedHeaderIndex===_Constants._INVALID_INDEX?{type:_UI.ObjectType.item,index:releasedIndex}:{type:_UI.ObjectType.groupHeader,index:releasedHeaderIndex},this._resetPressedContainer(),this._site.pressedEntity.type===_UI.ObjectType.item&&releasedEntity.type===_UI.ObjectType.item&&this._site.pressedContainer&&this._site.pressedEntity.index===releasedEntity.index)if(eventObject.shiftKey||(site.selection._pivot=_Constants._INVALID_INDEX),eventObject.shiftKey){if(this._selectionAllowed()&&this._multiSelection()&&site.selection._pivot!==_Constants._INVALID_INDEX){var firstIndex=Math.min(this._site.pressedEntity.index,site.selection._pivot),lastIndex=Math.max(this._site.pressedEntity.index,site.selection._pivot),additive=this._pointerRightButton||eventObject.ctrlKey||site.tapBehavior===_UI.TapBehavior.toggleSelect;site.selectRange(firstIndex,lastIndex,additive)}}else eventObject.ctrlKey&&this.toggleSelectionIfAllowed(this._site.pressedEntity.index);if(this._site.pressedHeader||this._site.pressedContainer){var upPosition=_ElementUtilities._getCursorPos(eventObject),isTap=Math.abs(upPosition.left-this._site.pressedPosition.left)<=_Constants._TAP_END_THRESHOLD&&Math.abs(upPosition.top-this._site.pressedPosition.top)<=_Constants._TAP_END_THRESHOLD;this._pointerRightButton||eventObject.ctrlKey||eventObject.shiftKey||!(touchInput&&isTap||!touchInput&&this._site.pressedEntity.index===releasedEntity.index&&this._site.pressedEntity.type===releasedEntity.type)||(releasedEntity.type===_UI.ObjectType.groupHeader?(this._site.pressedHeader=site.headerAtIndex(releasedEntity.index),this._site.pressedItemBox=null,this._site.pressedContainer=null):(this._site.pressedItemBox=site.itemBoxAtIndex(releasedEntity.index),this._site.pressedContainer=site.containerAtIndex(releasedEntity.index),this._site.pressedHeader=null),this._canTapSelect&&this.handleTap(this._site.pressedEntity),this._site.fireInvokeEvent(this._site.pressedEntity,this._site.pressedItemBox||this._site.pressedHeader))}this._site.pressedEntity.index!==_Constants._INVALID_INDEX&&site.changeFocus(this._site.pressedEntity,!0,!1,!0),this.resetPointerDownState()}_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerUp,StopTM")},onPointerCancel:function(eventObject){this._pointerId===eventObject.pointerId&&(_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSPointerCancel,info"),this.resetPointerDownState())},onLostPointerCapture:function(eventObject){this._pointerId===eventObject.pointerId&&(_WriteProfilerMark("WinJS.UI._ItemEventsHandler:MSLostPointerCapture,info"),this.resetPointerDownState())},onContextMenu:function(eventObject){this._shouldSuppressContextMenu(eventObject.target)&&eventObject.preventDefault()},onMSHoldVisual:function(eventObject){this._shouldSuppressContextMenu(eventObject.target)&&eventObject.preventDefault()},onDataChanged:function(){this.resetPointerDownState()},toggleSelectionIfAllowed:function(itemIndex){this._selectionAllowed(itemIndex)&&this._toggleItemSelection(itemIndex)},handleTap:function(entity){if(entity.type!==_UI.ObjectType.groupHeader){var site=this._site,selection=site.selection;this._selectionAllowed(entity.index)&&this._selectOnTap()&&(site.tapBehavior===_UI.TapBehavior.toggleSelect?this._toggleItemSelection(entity.index):site.selectionMode!==_UI.SelectionMode.multi&&selection._isIncluded(entity.index)||selection.set(entity.index))}},_toggleItemSelection:function(itemIndex){var site=this._site,selection=site.selection,selected=selection._isIncluded(itemIndex);site.selectionMode===_UI.SelectionMode.single?selected?selection.clear():selection.set(itemIndex):selected?selection.remove(itemIndex):selection.add(itemIndex)},_getCurrentPoint:function(eventObject){return _WinRT.Windows.UI.Input.PointerPoint.getCurrentPoint(eventObject.pointerId)},_containedInElementWithClass:function(element,className){if(element.parentNode)for(var matches=element.parentNode.querySelectorAll("."+className+", ."+className+" *"),i=0,len=matches.length;i<len;i++)if(matches[i]===element)return!0;return!1},_isSelected:function(index){return this._site.selection._isIncluded(index)},_isInteractive:function(element){return this._containedInElementWithClass(element,"win-interactive")},_shouldSuppressContextMenu:function(element){var containerElement=this._site.containerFromElement(element);return this._selectionAllowed()&&containerElement&&!this._isInteractive(element)},_togglePressed:function(add,eventObject){var isHeader=this._site.pressedEntity.type===_UI.ObjectType.groupHeader;!isHeader&&_ElementUtilities.hasClass(this._site.pressedItemBox,_Constants._nonSelectableClass)||this._staticMode(isHeader)||(add?_ElementUtilities.addClass(this._site.animatedElement,_Constants._pressedClass):_ElementUtilities.removeClass(this._site.animatedElement,_Constants._pressedClass))},_resetPointerDownStateForPointerId:function(eventObject){this._pointerId===eventObject.pointerId&&this.resetPointerDownState()},resetPointerDownState:function(){this._site.pressedElement=null,_ElementUtilities._removeEventListener(_Global,"pointerup",this._resetPointerDownStateBound),_ElementUtilities._removeEventListener(_Global,"pointercancel",this._resetPointerDownStateBound),this._resetPressedContainer(),this._site.pressedContainer=null,this._site.animatedElement=null,this._site.pressedHeader=null,this._site.pressedItemBox=null,this._site.pressedEntity={type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},this._pointerId=null},_releasedElement:function(eventObject){return _Global.document.elementFromPoint(eventObject.clientX,eventObject.clientY)},_applyUIInBatches:function(work){function applyUI(){that._work.length>0?(that._flushUIBatches(),that._paintedThisFrame=_BaseUtils._requestAnimationFrame(applyUI.bind(that))):that._paintedThisFrame=null}var that=this;this._work.push(work),this._paintedThisFrame||applyUI()},_flushUIBatches:function(){if(this._work.length>0){var workItems=this._work;this._work=[];for(var i=0;i<workItems.length;i++)workItems[i]()}},_selectionAllowed:function(itemIndex){var item=void 0!==itemIndex?this._site.itemAtIndex(itemIndex):null,itemSelectable=!(item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass));return itemSelectable&&this._site.selectionMode!==_UI.SelectionMode.none},_multiSelection:function(){return this._site.selectionMode===_UI.SelectionMode.multi},_selectOnTap:function(){return this._site.tapBehavior===_UI.TapBehavior.toggleSelect||this._site.tapBehavior===_UI.TapBehavior.directSelect},_staticMode:function(isHeader){return isHeader?this._site.headerTapBehavior===_UI.GroupHeaderTapBehavior.none:this._site.tapBehavior===_UI.TapBehavior.none&&this._site.selectionMode===_UI.SelectionMode.none}},{setAriaSelected:function(itemElement,isSelected){var ariaSelected="true"===itemElement.getAttribute("aria-selected");isSelected!==ariaSelected&&itemElement.setAttribute("aria-selected",isSelected)},renderSelection:function(itemBox,element,selected,aria,container){if(!ItemEventsHandler._selectionTemplate){ItemEventsHandler._selectionTemplate=[],ItemEventsHandler._selectionTemplate.push(createNodeWithClass(_Constants._selectionBackgroundClass)),ItemEventsHandler._selectionTemplate.push(createNodeWithClass(_Constants._selectionBorderClass)),ItemEventsHandler._selectionTemplate.push(createNodeWithClass(_Constants._selectionCheckmarkBackgroundClass));var checkmark=createNodeWithClass(_Constants._selectionCheckmarkClass);checkmark.textContent=_Constants._SELECTION_CHECKMARK,ItemEventsHandler._selectionTemplate.push(checkmark)}if(selected!==_ElementUtilities._isSelectionRendered(itemBox)){if(selected){itemBox.insertBefore(ItemEventsHandler._selectionTemplate[0].cloneNode(!0),itemBox.firstElementChild);for(var i=1,len=ItemEventsHandler._selectionTemplate.length;i<len;i++)itemBox.appendChild(ItemEventsHandler._selectionTemplate[i].cloneNode(!0))}else for(var nodes=itemBox.querySelectorAll(_ElementUtilities._selectionPartsSelector),i=0,len=nodes.length;i<len;i++)itemBox.removeChild(nodes[i]);_ElementUtilities[selected?"addClass":"removeClass"](itemBox,_Constants._selectedClass),container&&_ElementUtilities[selected?"addClass":"removeClass"](container,_Constants._selectedClass)}aria&&ItemEventsHandler.setAriaSelected(element,selected)}});return ItemEventsHandler})})}),define("WinJS/Controls/ListView/_SelectionManager",["exports","../../Core/_Global","../../Core/_Base","../../Promise","../../_Signal","../../Utilities/_UI","../ItemContainer/_Constants"],function(exports,_Global,_Base,Promise,_Signal,_UI,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_ItemSet:_Base.Namespace._lazy(function(){var _ItemSet=_Base.Class.define(function(listView,ranges,count){this._listView=listView,this._ranges=ranges,this._itemsCount=count});return _ItemSet.prototype={getRanges:function(){for(var ranges=[],i=0,len=this._ranges.length;i<len;i++){var range=this._ranges[i];ranges.push({firstIndex:range.firstIndex,lastIndex:range.lastIndex,firstKey:range.firstKey,lastKey:range.lastKey})}return ranges},getItems:function(){return exports.getItemsFromRanges(this._listView._itemsManager.dataSource,this._ranges)},isEverything:function(){return this.count()===this._itemsCount},count:function(){for(var count=0,i=0,len=this._ranges.length;i<len;i++){var range=this._ranges[i];count+=range.lastIndex-range.firstIndex+1}return count},getIndices:function(){for(var indices=[],i=0,len=this._ranges.length;i<len;i++)for(var range=this._ranges[i],n=range.firstIndex;n<=range.lastIndex;n++)indices.push(n);return indices}},_ItemSet}),getItemsFromRanges:function(dataSource,ranges){function getIndices(){for(var indices=[],i=0,len=ranges.length;i<len;i++)for(var range=ranges[i],j=range.firstIndex;j<=range.lastIndex;j++)indices.push(j);return Promise.wrap(indices)}var listBinding=dataSource.createListBinding(),promises=[];return getIndices().then(function(indices){for(var i=0;i<indices.length;i++)promises.push(listBinding.fromIndex(indices[i]));return Promise.join(promises).then(function(items){return listBinding.release(),items})})},_Selection:_Base.Namespace._lazy(function(){function isEverythingRange(ranges){return ranges&&0===ranges.firstIndex&&ranges.lastIndex===Number.MAX_VALUE}return _Base.Class.derive(exports._ItemSet,function(listView,indexesAndRanges){this._listView=listView,this._itemsCount=-1,this._ranges=[],indexesAndRanges&&this.set(indexesAndRanges)},{clear:function(){return this._releaseRanges(this._ranges),this._ranges=[],Promise.wrap()},set:function(items){if(isEverythingRange(items))return this.selectAll();this._releaseRanges(this._ranges),this._ranges=[];var that=this;return this._execute("_set",items).then(function(){return that._ranges.sort(function(left,right){return left.firstIndex-right.firstIndex}),that._ensureKeys()}).then(function(){return that._ensureCount()})},add:function(items){if(isEverythingRange(items))return this.selectAll();var that=this;return this._execute("_add",items).then(function(){return that._ensureKeys()}).then(function(){return that._ensureCount()})},remove:function(items){var that=this;return this._execute("_remove",items).then(function(){return that._ensureKeys()})},selectAll:function(){var that=this;return that._ensureCount().then(function(){if(that._itemsCount){var range={firstIndex:0,lastIndex:that._itemsCount-1};return that._retainRange(range),that._releaseRanges(that._ranges),that._ranges=[range],that._ensureKeys()}})},_execute:function(operation,items){function toRange(type,first,last){var retVal={};return retVal["first"+type]=first,retVal["last"+type]=last,retVal}function handleKeys(range){var binding=that._getListBinding(),promise=Promise.join([binding.fromKey(range.firstKey),binding.fromKey(range.lastKey)]).then(function(items){return items[0]&&items[1]&&(range.firstIndex=items[0].index,range.lastIndex=items[1].index,that[operation](range)),range});promises.push(promise)}for(var that=this,keysSupported=!!that._getListBinding().fromKey,array=Array.isArray(items)?items:[items],promises=[Promise.wrap()],i=0,len=array.length;i<len;i++){var item=array[i];"number"==typeof item?this[operation](toRange("Index",item,item)):item&&(keysSupported&&void 0!==item.key?handleKeys(toRange("Key",item.key,item.key)):keysSupported&&void 0!==item.firstKey&&void 0!==item.lastKey?handleKeys(toRange("Key",item.firstKey,item.lastKey)):void 0!==item.index&&"number"==typeof item.index?this[operation](toRange("Index",item.index,item.index)):void 0!==item.firstIndex&&void 0!==item.lastIndex&&"number"==typeof item.firstIndex&&"number"==typeof item.lastIndex&&this[operation](toRange("Index",item.firstIndex,item.lastIndex)))}return Promise.join(promises)},_set:function(range){this._retainRange(range),this._ranges.push(range)},_add:function(newRange){for(var range,inserted,mergeWithPrev,that=this,prev=null,merge=function(left,right){right.lastIndex>left.lastIndex&&(left.lastIndex=right.lastIndex,left.lastKey=right.lastKey,left.lastPromise&&left.lastPromise.release(),left.lastPromise=that._getListBinding().fromIndex(left.lastIndex).retain())},i=0,len=this._ranges.length;i<len;i++){if(range=this._ranges[i],newRange.firstIndex<range.firstIndex){mergeWithPrev=prev&&newRange.firstIndex<prev.lastIndex+1,mergeWithPrev?(inserted=i-1,merge(prev,newRange)):(this._insertRange(i,newRange),inserted=i);break}if(newRange.firstIndex===range.firstIndex){merge(range,newRange),inserted=i;break}prev=range}if(void 0===inserted){var last=this._ranges.length?this._ranges[this._ranges.length-1]:null,mergeWithLast=last&&newRange.firstIndex<last.lastIndex+1;mergeWithLast?merge(last,newRange):(this._retainRange(newRange),this._ranges.push(newRange))}else{for(prev=null,i=inserted+1,len=this._ranges.length;i<len;i++){if(range=this._ranges[i],newRange.lastIndex<range.firstIndex){mergeWithPrev=prev&&prev.lastIndex>newRange.lastIndex,mergeWithPrev&&merge(this._ranges[inserted],prev),this._removeRanges(inserted+1,i-inserted-1);break}if(newRange.lastIndex===range.firstIndex){merge(this._ranges[inserted],range),this._removeRanges(inserted+1,i-inserted);break}prev=range}i>=len&&(merge(this._ranges[inserted],this._ranges[len-1]),
this._removeRanges(inserted+1,len-inserted-1))}},_remove:function(toRemove){function retainPromise(index){return that._getListBinding().fromIndex(index).retain()}for(var that=this,ranges=[],i=0,len=this._ranges.length;i<len;i++){var range=this._ranges[i];range.lastIndex<toRemove.firstIndex||range.firstIndex>toRemove.lastIndex?ranges.push(range):range.firstIndex<toRemove.firstIndex&&range.lastIndex>=toRemove.firstIndex&&range.lastIndex<=toRemove.lastIndex?(ranges.push({firstIndex:range.firstIndex,firstKey:range.firstKey,firstPromise:range.firstPromise,lastIndex:toRemove.firstIndex-1,lastPromise:retainPromise(toRemove.firstIndex-1)}),range.lastPromise.release()):range.lastIndex>toRemove.lastIndex&&range.firstIndex>=toRemove.firstIndex&&range.firstIndex<=toRemove.lastIndex?(ranges.push({firstIndex:toRemove.lastIndex+1,firstPromise:retainPromise(toRemove.lastIndex+1),lastIndex:range.lastIndex,lastKey:range.lastKey,lastPromise:range.lastPromise}),range.firstPromise.release()):range.firstIndex<toRemove.firstIndex&&range.lastIndex>toRemove.lastIndex?(ranges.push({firstIndex:range.firstIndex,firstKey:range.firstKey,firstPromise:range.firstPromise,lastIndex:toRemove.firstIndex-1,lastPromise:retainPromise(toRemove.firstIndex-1)}),ranges.push({firstIndex:toRemove.lastIndex+1,firstPromise:retainPromise(toRemove.lastIndex+1),lastIndex:range.lastIndex,lastKey:range.lastKey,lastPromise:range.lastPromise})):(range.firstPromise.release(),range.lastPromise.release())}this._ranges=ranges},_ensureKeys:function(){for(var promises=[Promise.wrap()],that=this,ensureKey=function(which,range){var keyProperty=which+"Key";if(range[keyProperty])return Promise.wrap();var promise=range[which+"Promise"];return promise.then(function(item){item&&(range[keyProperty]=item.key)}),promise},i=0,len=this._ranges.length;i<len;i++){var range=this._ranges[i];promises.push(ensureKey("first",range)),promises.push(ensureKey("last",range))}return Promise.join(promises).then(function(){that._ranges=that._ranges.filter(function(range){return range.firstKey&&range.lastKey})}),Promise.join(promises)},_mergeRanges:function(target,source){target.lastIndex=source.lastIndex,target.lastKey=source.lastKey},_isIncluded:function(index){if(this.isEverything())return!0;for(var i=0,len=this._ranges.length;i<len;i++){var range=this._ranges[i];if(range.firstIndex<=index&&index<=range.lastIndex)return!0}return!1},_ensureCount:function(){var that=this;return this._listView._itemsCount().then(function(count){that._itemsCount=count})},_insertRange:function(index,newRange){this._retainRange(newRange),this._ranges.splice(index,0,newRange)},_removeRanges:function(index,howMany){for(var i=0;i<howMany;i++)this._releaseRange(this._ranges[index+i]);this._ranges.splice(index,howMany)},_retainRange:function(range){range.firstPromise||(range.firstPromise=this._getListBinding().fromIndex(range.firstIndex).retain()),range.lastPromise||(range.lastPromise=this._getListBinding().fromIndex(range.lastIndex).retain())},_retainRanges:function(){for(var i=0,len=this._ranges.length;i<len;i++)this._retainRange(this._ranges[i])},_releaseRange:function(range){range.firstPromise.release(),range.lastPromise.release()},_releaseRanges:function(ranges){for(var i=0,len=ranges.length;i<len;++i)this._releaseRange(ranges[i])},_getListBinding:function(){return this._listView._itemsManager._listBinding}},{supportedForProcessing:!1})}),_SelectionManager:_Base.Namespace._lazy(function(){var _SelectionManager=function(listView){this._listView=listView,this._selected=new exports._Selection(this._listView),this._pivot=_Constants._INVALID_INDEX,this._focused={type:_UI.ObjectType.item,index:0},this._pendingChange=Promise.wrap()};return _SelectionManager.prototype={count:function(){return this._selected.count()},getIndices:function(){return this._selected.getIndices()},getItems:function(){return this._selected.getItems()},getRanges:function(){return this._selected.getRanges()},isEverything:function(){return this._selected.isEverything()},set:function(items){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=new exports._Selection(that._listView);return newSelection.set(items).then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},clear:function(){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=new exports._Selection(that._listView);return newSelection.clear().then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},add:function(items){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=that._cloneSelection();return newSelection.add(items).then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},remove:function(items){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=that._cloneSelection();return newSelection.remove(items).then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},selectAll:function(){var that=this,signal=new _Signal;return this._synchronize(signal).then(function(){var newSelection=new exports._Selection(that._listView);return newSelection.selectAll().then(function(){that._set(newSelection),signal.complete()},function(error){return newSelection.clear(),signal.complete(),Promise.wrapError(error)})})},_synchronize:function(signal){var that=this;return this._listView._versionManager.unlocked.then(function(){var currentPendingChange=that._pendingChange;return that._pendingChange=Promise.join([currentPendingChange,signal.promise]).then(function(){}),currentPendingChange})},_reset:function(){this._pivot=_Constants._INVALID_INDEX,this._setFocused({type:_UI.ObjectType.item,index:0},this._keyboardFocused()),this._pendingChange.cancel(),this._pendingChange=Promise.wrap(),this._selected.clear(),this._selected=new exports._Selection(this._listView)},_dispose:function(){this._selected.clear(),this._selected=null,this._listView=null},_set:function(newSelection){var that=this;return this._fireSelectionChanging(newSelection).then(function(approved){return approved?(that._selected.clear(),that._selected=newSelection,that._listView._updateSelection(),that._fireSelectionChanged()):newSelection.clear(),approved})},_fireSelectionChanging:function(newSelection){var eventObject=_Global.document.createEvent("CustomEvent"),newSelectionUpdated=Promise.wrap();eventObject.initCustomEvent("selectionchanging",!0,!0,{newSelection:newSelection,preventTapBehavior:function(){},setPromise:function(promise){newSelectionUpdated=promise}});var approved=this._listView._element.dispatchEvent(eventObject);return newSelectionUpdated.then(function(){return approved})},_fireSelectionChanged:function(){var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent("selectionchanged",!0,!1,null),this._listView._element.dispatchEvent(eventObject)},_getFocused:function(){return{type:this._focused.type,index:this._focused.index}},_setFocused:function(entity,keyboardFocused){this._focused={type:entity.type,index:entity.index},this._focusedByKeyboard=keyboardFocused},_keyboardFocused:function(){return this._focusedByKeyboard},_updateCount:function(count){this._selected._itemsCount=count},_isIncluded:function(index){return this._selected._isIncluded(index)},_cloneSelection:function(){var newSelection=new exports._Selection(this._listView);return newSelection._ranges=this._selected.getRanges(),newSelection._itemsCount=this._selected._itemsCount,newSelection._retainRanges(),newSelection}},_SelectionManager.supportedForProcessing=!1,_SelectionManager})})}),define("WinJS/Controls/ListView/_BrowseMode",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Animations","../../Promise","../../Utilities/_ElementUtilities","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_SelectionManager"],function(exports,_Global,_Base,_BaseUtils,Animations,Promise,_ElementUtilities,_UI,_Constants,_ItemEventsHandler,_SelectionManager){"use strict";var transformName=_BaseUtils._browserStyleEquivalents.transform.scriptName;_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_SelectionMode:_Base.Namespace._lazy(function(){function clampToRange(first,last,x){return Math.max(first,Math.min(last,x))}function dispatchKeyboardNavigating(element,oldEntity,newEntity){var navigationEvent=_Global.document.createEvent("CustomEvent");return navigationEvent.initCustomEvent("keyboardnavigating",!0,!0,{oldFocus:oldEntity.index,oldFocusType:oldEntity.type,newFocus:newEntity.index,newFocusType:newEntity.type}),element.dispatchEvent(navigationEvent)}var _SelectionMode=_Base.Class.define(function(modeSite){this.inboundFocusHandled=!1,this._pressedContainer=null,this._pressedItemBox=null,this._pressedHeader=null,this._pressedEntity={type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},this._pressedPosition=null,this.initialize(modeSite)},{_dispose:function(){this._itemEventsHandler&&this._itemEventsHandler.dispose(),this._setNewFocusItemOffsetPromise&&this._setNewFocusItemOffsetPromise.cancel()},initialize:function(modeSite){function createArrowHandler(direction,clampToBounds){var handler=function(oldFocus){return modeSite._view.getAdjacent(oldFocus,direction)};return handler.clampToBounds=clampToBounds,handler}this.site=modeSite,this._keyboardNavigationHandlers={},this._keyboardAcceleratorHandlers={};var site=this.site,that=this;this._itemEventsHandler=new _ItemEventsHandler._ItemEventsHandler(Object.create({containerFromElement:function(element){return site._view.items.containerFrom(element)},indexForItemElement:function(element){return site._view.items.index(element)},indexForHeaderElement:function(element){return site._groups.index(element)},itemBoxAtIndex:function(index){return site._view.items.itemBoxAt(index)},itemAtIndex:function(index){return site._view.items.itemAt(index)},headerAtIndex:function(index){return site._groups.group(index).header},headerFromElement:function(element){return site._groups.headerFrom(element)},containerAtIndex:function(index){return site._view.items.containerAt(index)},isZombie:function(){return site._isZombie()},getItemPosition:function(entity){return site._getItemPosition(entity)},rtl:function(){return site._rtl()},fireInvokeEvent:function(entity,itemElement){return that._fireInvokeEvent(entity,itemElement)},verifySelectionAllowed:function(index){return that._verifySelectionAllowed(index)},changeFocus:function(newFocus,skipSelection,ctrlKeyDown,skipEnsureVisible,keyboardFocused){return site._changeFocus(newFocus,skipSelection,ctrlKeyDown,skipEnsureVisible,keyboardFocused)},selectRange:function(firstIndex,lastIndex,additive){return that._selectRange(firstIndex,lastIndex,additive)}},{pressedEntity:{enumerable:!0,get:function(){return that._pressedEntity},set:function(value){that._pressedEntity=value}},pressedContainerScaleTransform:{enumerable:!0,get:function(){return that._pressedContainerScaleTransform},set:function(value){that._pressedContainerScaleTransform=value}},pressedContainer:{enumerable:!0,get:function(){return that._pressedContainer},set:function(value){that._pressedContainer=value}},pressedItemBox:{enumerable:!0,get:function(){return that._pressedItemBox},set:function(value){that._pressedItemBox=value}},pressedHeader:{enumerable:!0,get:function(){return that._pressedHeader},set:function(value){return that._pressedHeader=value}},pressedPosition:{enumerable:!0,get:function(){return that._pressedPosition},set:function(value){that._pressedPosition=value}},pressedElement:{enumerable:!0,set:function(value){that._pressedElement=value}},eventHandlerRoot:{enumerable:!0,get:function(){return site._viewport}},selectionMode:{enumerable:!0,get:function(){return site._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return _Constants._itemClass}},canvasProxy:{enumerable:!0,get:function(){return site._canvasProxy}},tapBehavior:{enumerable:!0,get:function(){return site._tap}},headerTapBehavior:{enumerable:!0,get:function(){return site._groupHeaderTap}},draggable:{enumerable:!0,get:function(){return site.itemsDraggable||site.itemsReorderable}},selection:{enumerable:!0,get:function(){return site._selection}},customFootprintParent:{enumerable:!0,get:function(){return null}}}));var Key=_ElementUtilities.Key;this._keyboardNavigationHandlers[Key.upArrow]=createArrowHandler(Key.upArrow),this._keyboardNavigationHandlers[Key.downArrow]=createArrowHandler(Key.downArrow),this._keyboardNavigationHandlers[Key.leftArrow]=createArrowHandler(Key.leftArrow),this._keyboardNavigationHandlers[Key.rightArrow]=createArrowHandler(Key.rightArrow),this._keyboardNavigationHandlers[Key.pageUp]=createArrowHandler(Key.pageUp,!0),this._keyboardNavigationHandlers[Key.pageDown]=createArrowHandler(Key.pageDown,!0),this._keyboardNavigationHandlers[Key.home]=function(oldFocus){return!that.site._header||oldFocus.type!==_UI.ObjectType.groupHeader&&oldFocus.type!==_UI.ObjectType.footer?Promise.wrap({type:oldFocus.type!==_UI.ObjectType.footer?oldFocus.type:_UI.ObjectType.groupHeader,index:0}):Promise.wrap({type:_UI.ObjectType.header,index:0})},this._keyboardNavigationHandlers[Key.end]=function(oldFocus){if(!that.site._footer||oldFocus.type!==_UI.ObjectType.groupHeader&&oldFocus.type!==_UI.ObjectType.header){if(oldFocus.type===_UI.ObjectType.groupHeader||oldFocus.type===_UI.ObjectType.header)return Promise.wrap({type:_UI.ObjectType.groupHeader,index:site._groups.length()-1});var lastIndex=that.site._view.lastItemIndex();return lastIndex>=0?Promise.wrap({type:oldFocus.type,index:lastIndex}):Promise.cancel}return Promise.wrap({type:_UI.ObjectType.footer,index:0})},this._keyboardAcceleratorHandlers[Key.a]=function(){that.site._multiSelection()&&that._selectAll()}},staticMode:function(){return this.site._tap===_UI.TapBehavior.none&&this.site._selectionMode===_UI.SelectionMode.none},itemUnrealized:function(index,itemBox){if(this._pressedEntity.type!==_UI.ObjectType.groupHeader&&(this._pressedEntity.index===index&&this._resetPointerDownState(),this._itemBeingDragged(index)))for(var i=this._draggedItemBoxes.length-1;i>=0;i--)this._draggedItemBoxes[i]===itemBox&&(_ElementUtilities.removeClass(itemBox,_Constants._dragSourceClass),this._draggedItemBoxes.splice(i,1))},_fireInvokeEvent:function(entity,itemElement){function fireInvokeEventImpl(dataSource,isHeader){var listBinding=dataSource.createListBinding(),promise=listBinding.fromIndex(entity.index),eventName=isHeader?"groupheaderinvoked":"iteminvoked";promise.done(function(){listBinding.release()});var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent(eventName,!0,!0,isHeader?{groupHeaderPromise:promise,groupHeaderIndex:entity.index}:{itemPromise:promise,itemIndex:entity.index}),itemElement.dispatchEvent(eventObject)&&that.site._defaultInvoke(entity)}if(itemElement){var that=this;entity.type===_UI.ObjectType.groupHeader?this.site._groupHeaderTap===_UI.GroupHeaderTapBehavior.invoke&&entity.index!==_Constants._INVALID_INDEX&&fireInvokeEventImpl(this.site.groupDataSource,!0):this.site._tap===_UI.TapBehavior.none||entity.index===_Constants._INVALID_INDEX||this.site._isInSelectionMode()||fireInvokeEventImpl(this.site.itemDataSource,!1)}},_verifySelectionAllowed:function(entity){if(entity.type===_UI.ObjectType.groupHeader)return{canSelect:!1,canTapSelect:!1};var itemIndex=entity.index,site=this.site,item=this.site._view.items.itemAt(itemIndex);if(!site._selectionAllowed()||!site._selectOnTap()||item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass))return{canSelect:!1,canTapSelect:!1};var selected=site._selection._isIncluded(itemIndex),single=!site._multiSelection(),newSelection=site._selection._cloneSelection();selected?single?newSelection.clear():newSelection.remove(itemIndex):single?newSelection.set(itemIndex):newSelection.add(itemIndex);var included,eventObject=_Global.document.createEvent("CustomEvent"),newSelectionUpdated=Promise.wrap(),completed=!1,preventTap=!1;eventObject.initCustomEvent("selectionchanging",!0,!0,{newSelection:newSelection,preventTapBehavior:function(){preventTap=!0},setPromise:function(promise){newSelectionUpdated=promise}});var defaultBehavior=site._element.dispatchEvent(eventObject);newSelectionUpdated.then(function(){completed=!0,included=newSelection._isIncluded(itemIndex),newSelection.clear()});var canSelect=defaultBehavior&&completed&&(selected||included);return{canSelect:canSelect,canTapSelect:canSelect&&!preventTap}},_containedInElementWithClass:function(element,className){if(element.parentNode)for(var matches=element.parentNode.querySelectorAll("."+className+", ."+className+" *"),i=0,len=matches.length;i<len;i++)if(matches[i]===element)return!0;return!1},_isDraggable:function(element){return!this._containedInElementWithClass(element,_Constants._nonDraggableClass)},_isInteractive:function(element){return this._containedInElementWithClass(element,"win-interactive")},_resetPointerDownState:function(){this._itemEventsHandler.resetPointerDownState()},onPointerDown:function(eventObject){this._itemEventsHandler.onPointerDown(eventObject)},onclick:function(eventObject){this._itemEventsHandler.onClick(eventObject)},onPointerUp:function(eventObject){this._itemEventsHandler.onPointerUp(eventObject)},onPointerCancel:function(eventObject){this._itemEventsHandler.onPointerCancel(eventObject)},onLostPointerCapture:function(eventObject){this._itemEventsHandler.onLostPointerCapture(eventObject)},onContextMenu:function(eventObject){this._itemEventsHandler.onContextMenu(eventObject)},onMSHoldVisual:function(eventObject){this._itemEventsHandler.onMSHoldVisual(eventObject)},onDataChanged:function(eventObject){this._itemEventsHandler.onDataChanged(eventObject)},_removeTransform:function(element,transform){transform&&element.style[transformName].indexOf(transform)!==-1&&(element.style[transformName]=element.style[transformName].replace(transform,""))},_selectAll:function(){var unselectableRealizedItems=[];this.site._view.items.each(function(index,item){item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass)&&unselectableRealizedItems.push(index)}),this.site._selection.selectAll(),unselectableRealizedItems.length>0&&this.site._selection.remove(unselectableRealizedItems)},_selectRange:function(firstIndex,lastIndex,additive){for(var ranges=[],currentStartRange=-1,i=firstIndex;i<=lastIndex;i++){var item=this.site._view.items.itemAt(i);item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass)?currentStartRange!==-1&&(ranges.push({firstIndex:currentStartRange,lastIndex:i-1}),currentStartRange=-1):currentStartRange===-1&&(currentStartRange=i)}currentStartRange!==-1&&ranges.push({firstIndex:currentStartRange,lastIndex:lastIndex}),ranges.length>0&&this.site._selection[additive?"add":"set"](ranges)},onDragStart:function(eventObject){if(this._pressedEntity={type:_UI.ObjectType.item,index:this.site._view.items.index(eventObject.target)},this.site._selection._pivot=_Constants._INVALID_INDEX,this._pressedEntity.index===_Constants._INVALID_INDEX||!this.site.itemsDraggable&&!this.site.itemsReorderable||this.site._view.animating||!this._isDraggable(eventObject.target)||this._pressedElement&&this._isInteractive(this._pressedElement))eventObject.preventDefault();else{this._dragging=!0,this._dragDataTransfer=eventObject.dataTransfer,this._pressedPosition=_ElementUtilities._getCursorPos(eventObject),this._dragInfo=null,this._lastEnteredElement=eventObject.target,this.site._selection._isIncluded(this._pressedEntity.index)?this._dragInfo=this.site.selection:(this._draggingUnselectedItem=!0,this._dragInfo=new _SelectionManager._Selection(this.site,[{firstIndex:this._pressedEntity.index,lastIndex:this._pressedEntity.index}]));var dropTarget=this.site.itemsReorderable,event=_Global.document.createEvent("CustomEvent");if(event.initCustomEvent("itemdragstart",!0,!1,{dataTransfer:eventObject.dataTransfer,dragInfo:this._dragInfo}),eventObject.dataTransfer.setData("text",""),eventObject.dataTransfer.setDragImage){var pressedItemData=this.site._view.items.itemDataAt(this._pressedEntity.index);if(pressedItemData&&pressedItemData.container){var rect=pressedItemData.container.getBoundingClientRect();eventObject.dataTransfer.setDragImage(pressedItemData.container,eventObject.clientX-rect.left,eventObject.clientY-rect.top)}}this.site.element.dispatchEvent(event),this.site.itemsDraggable&&!this.site.itemsReorderable&&(this._firedDragEnter||this._fireDragEnterEvent(eventObject.dataTransfer)&&(dropTarget=!0,this._dragUnderstood=!0)),dropTarget&&(this._addedDragOverClass=!0,_ElementUtilities.addClass(this.site._element,_Constants._dragOverClass)),this._draggedItemBoxes=[];var that=this,sourceElement=eventObject.target;sourceElement.addEventListener("dragend",function itemDragEnd(eventObject){sourceElement.removeEventListener("dragend",itemDragEnd),that.onDragEnd(eventObject)}),_BaseUtils._yieldForDomModification(function(){if(that._dragging)for(var indicesSelected=that._dragInfo.getIndices(),i=0,len=indicesSelected.length;i<len;i++){var itemData=that.site._view.items.itemDataAt(indicesSelected[i]);itemData&&itemData.itemBox&&that._addDragSourceClass(itemData.itemBox)}})}},onDragEnter:function(eventObject){var eventHandled=this._dragUnderstood;this._lastEnteredElement=eventObject.target,this._exitEventTimer&&(_Global.clearTimeout(this._exitEventTimer),this._exitEventTimer=0),this._firedDragEnter||this._fireDragEnterEvent(eventObject.dataTransfer)&&(eventHandled=!0),(eventHandled||this._dragging&&this.site.itemsReorderable)&&(eventObject.preventDefault(),this._dragUnderstood=!0,this._addedDragOverClass||(this._addedDragOverClass=!0,_ElementUtilities.addClass(this.site._element,_Constants._dragOverClass))),this._pointerLeftRegion=!1},onDragLeave:function(eventObject){eventObject.target===this._lastEnteredElement&&(this._pointerLeftRegion=!0,this._handleExitEvent())},fireDragUpdateEvent:function(){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent("itemdragchanged",!0,!1,{dataTransfer:this._dragDataTransfer,dragInfo:this._dragInfo}),this.site.element.dispatchEvent(event)},_fireDragEnterEvent:function(dataTransfer){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent("itemdragenter",!0,!0,{dataTransfer:dataTransfer});var dropTarget=!this.site.element.dispatchEvent(event);return this._firedDragEnter=!0,dropTarget},_fireDragBetweenEvent:function(index,insertAfterIndex,dataTransfer){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent("itemdragbetween",!0,!0,{index:index,insertAfterIndex:insertAfterIndex,dataTransfer:dataTransfer}),this.site.element.dispatchEvent(event)},_fireDropEvent:function(index,insertAfterIndex,dataTransfer){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent("itemdragdrop",!0,!0,{index:index,insertAfterIndex:insertAfterIndex,dataTransfer:dataTransfer}),this.site.element.dispatchEvent(event)},_handleExitEvent:function(){this._exitEventTimer&&(_Global.clearTimeout(this._exitEventTimer),this._exitEventTimer=0);var that=this;this._exitEventTimer=_Global.setTimeout(function(){if(!that.site._disposed&&that._pointerLeftRegion){if(that.site._layout.dragLeave&&that.site._layout.dragLeave(),that._pointerLeftRegion=!1,that._dragUnderstood=!1,that._lastEnteredElement=null,that._lastInsertPoint=null,that._dragBetweenDisabled=!1,that._firedDragEnter){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent("itemdragleave",!0,!1,{}),that.site.element.dispatchEvent(event),that._firedDragEnter=!1}that._addedDragOverClass&&(that._addedDragOverClass=!1,_ElementUtilities.removeClass(that.site._element,_Constants._dragOverClass)),that._exitEventTimer=0,that._stopAutoScroll()}},40)},_getEventPositionInElementSpace:function(element,eventObject){var elementRect={left:0,top:0};try{elementRect=element.getBoundingClientRect()}catch(err){}var computedStyle=_ElementUtilities._getComputedStyle(element,null),paddingLeft=parseInt(computedStyle.paddingLeft),paddingTop=parseInt(computedStyle.paddingTop),borderLeft=parseInt(computedStyle.borderLeftWidth),borderTop=parseInt(computedStyle.borderTopWidth),clientX=eventObject.clientX,clientY=eventObject.clientY,position={x:+clientX===clientX?clientX-elementRect.left-paddingLeft-borderLeft:0,y:+clientY===clientY?clientY-elementRect.top-paddingTop-borderTop:0};return this.site._rtl()&&(position.x=elementRect.right-elementRect.left-position.x),position},_getPositionInCanvasSpace:function(eventObject){var scrollLeft=this.site._horizontal()?this.site.scrollPosition:0,scrollTop=this.site._horizontal()?0:this.site.scrollPosition,position=this._getEventPositionInElementSpace(this.site.element,eventObject);return{x:position.x+scrollLeft,y:position.y+scrollTop}},_itemBeingDragged:function(itemIndex){return!!this._dragging&&(this._draggingUnselectedItem&&this._dragInfo._isIncluded(itemIndex)||!this._draggingUnselectedItem&&this.site._isSelected(itemIndex))},_addDragSourceClass:function(itemBox){this._draggedItemBoxes.push(itemBox),_ElementUtilities.addClass(itemBox,_Constants._dragSourceClass),itemBox.parentNode&&_ElementUtilities.addClass(itemBox.parentNode,_Constants._footprintClass)},renderDragSourceOnRealizedItem:function(itemIndex,itemBox){this._itemBeingDragged(itemIndex)&&this._addDragSourceClass(itemBox)},onDragOver:function(eventObject){if(this._dragUnderstood){this._pointerLeftRegion=!1,eventObject.preventDefault();var cursorPositionInCanvas=this._getPositionInCanvasSpace(eventObject),cursorPositionInRoot=this._getEventPositionInElementSpace(this.site.element,eventObject);if(this._checkAutoScroll(cursorPositionInRoot.x,cursorPositionInRoot.y),this.site._layout.hitTest)if(this._autoScrollFrame)this._lastInsertPoint&&(this.site._layout.dragLeave(),this._lastInsertPoint=null);else{var insertPoint=this.site._view.hitTest(cursorPositionInCanvas.x,cursorPositionInCanvas.y);insertPoint.insertAfterIndex=clampToRange(-1,this.site._cachedCount-1,insertPoint.insertAfterIndex),this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===insertPoint.insertAfterIndex&&this._lastInsertPoint.index===insertPoint.index||(this._dragBetweenDisabled=!this._fireDragBetweenEvent(insertPoint.index,insertPoint.insertAfterIndex,eventObject.dataTransfer),this._dragBetweenDisabled?this.site._layout.dragLeave():this.site._layout.dragOver(cursorPositionInCanvas.x,cursorPositionInCanvas.y,this._dragInfo)),this._lastInsertPoint=insertPoint}}},_clearDragProperties:function(){if(this._addedDragOverClass&&(this._addedDragOverClass=!1,_ElementUtilities.removeClass(this.site._element,_Constants._dragOverClass)),this._draggedItemBoxes){for(var i=0,len=this._draggedItemBoxes.length;i<len;i++)_ElementUtilities.removeClass(this._draggedItemBoxes[i],_Constants._dragSourceClass),this._draggedItemBoxes[i].parentNode&&_ElementUtilities.removeClass(this._draggedItemBoxes[i].parentNode,_Constants._footprintClass);this._draggedItemBoxes=[]}this.site._layout.dragLeave(),this._dragging=!1,this._dragInfo=null,this._draggingUnselectedItem=!1,this._dragDataTransfer=null,this._lastInsertPoint=null,this._resetPointerDownState(),this._lastEnteredElement=null,this._dragBetweenDisabled=!1,this._firedDragEnter=!1,this._dragUnderstood=!1,this._stopAutoScroll()},onDragEnd:function(){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent("itemdragend",!0,!1,{}),this.site.element.dispatchEvent(event),this._clearDragProperties()},_findFirstAvailableInsertPoint:function(selectedItems,startIndex,searchForwards){for(var indicesSelected=selectedItems.getIndices(),dropIndexInSelection=-1,count=this.site._cachedCount,selectionCount=indicesSelected.length,startIndexInSelection=-1,dropIndex=startIndex,i=0;i<selectionCount;i++)if(indicesSelected[i]===dropIndex){dropIndexInSelection=i,startIndexInSelection=i;break}for(;dropIndexInSelection>=0&&dropIndex>=0;)searchForwards?(dropIndex++,dropIndexInSelection<selectionCount&&indicesSelected[dropIndexInSelection+1]===dropIndex&&dropIndex<count?dropIndexInSelection++:dropIndex>=count?(searchForwards=!1,dropIndex=startIndex,dropIndexInSelection=startIndexInSelection):dropIndexInSelection=-1):(dropIndex--,dropIndexInSelection>0&&indicesSelected[dropIndexInSelection-1]===dropIndex?dropIndexInSelection--:dropIndexInSelection=-1);return dropIndex},_reorderItems:function(dropIndex,reorderedItems,reorderingUnselectedItem,useMoveBefore,ensureVisibleAtEnd){var site=this.site,updateSelection=function(items){reorderingUnselectedItem?site._selection.remove({key:items[0].key}):site._selection.set({firstKey:items[0].key,lastKey:items[items.length-1].key}),ensureVisibleAtEnd&&site.ensureVisible(site._selection._getFocused())};reorderedItems.getItems().then(function(items){var ds=site.itemDataSource;if(dropIndex===-1){ds.beginEdits();for(var i=items.length-1;i>=0;i--)ds.moveToStart(items[i].key);ds.endEdits(),updateSelection(items)}else{var listBinding=ds.createListBinding();listBinding.fromIndex(dropIndex).then(function(item){if(listBinding.release(),ds.beginEdits(),useMoveBefore)for(var i=0,len=items.length;i<len;i++)ds.moveBefore(items[i].key,item.key);else for(var i=items.length-1;i>=0;i--)ds.moveAfter(items[i].key,item.key);ds.endEdits(),updateSelection(items)})}})},onDrop:function(eventObject){if(this._draggedItemBoxes)for(var i=0,len=this._draggedItemBoxes.length;i<len;i++)this._draggedItemBoxes[i].parentNode&&_ElementUtilities.removeClass(this._draggedItemBoxes[i].parentNode,_Constants._footprintClass);if(!this._dragBetweenDisabled){var cursorPosition=this._getPositionInCanvasSpace(eventObject),dropLocation=this.site._view.hitTest(cursorPosition.x,cursorPosition.y),dropIndex=clampToRange(-1,this.site._cachedCount-1,dropLocation.insertAfterIndex),allowDrop=!0;if(this._lastInsertPoint&&this._lastInsertPoint.insertAfterIndex===dropIndex&&this._lastInsertPoint.index===dropLocation.index||(allowDrop=this._fireDragBetweenEvent(dropLocation.index,dropIndex,eventObject.dataTransfer)),allowDrop&&(this._lastInsertPoint=null,this.site._layout.dragLeave(),this._fireDropEvent(dropLocation.index,dropIndex,eventObject.dataTransfer)&&this._dragging&&this.site.itemsReorderable)){if(this._dragInfo.isEverything()||this.site._groupsEnabled())return;dropIndex=this._findFirstAvailableInsertPoint(this._dragInfo,dropIndex,!1),this._reorderItems(dropIndex,this._dragInfo,this._draggingUnselectedItem)}}this._clearDragProperties(),eventObject.preventDefault()},_checkAutoScroll:function(x,y){var viewportSize=this.site._getViewportLength(),horizontal=this.site._horizontal(),cursorPositionInViewport=horizontal?x:y,canvasSize=this.site._viewport[horizontal?"scrollWidth":"scrollHeight"],scrollPosition=Math.floor(this.site.scrollPosition),travelRate=0;if(cursorPositionInViewport<_Constants._AUTOSCROLL_THRESHOLD?travelRate=cursorPositionInViewport-_Constants._AUTOSCROLL_THRESHOLD:cursorPositionInViewport>viewportSize-_Constants._AUTOSCROLL_THRESHOLD&&(travelRate=cursorPositionInViewport-(viewportSize-_Constants._AUTOSCROLL_THRESHOLD)),travelRate=Math.round(travelRate/_Constants._AUTOSCROLL_THRESHOLD*(_Constants._MAX_AUTOSCROLL_RATE-_Constants._MIN_AUTOSCROLL_RATE)),(0===scrollPosition&&travelRate<0||scrollPosition>=canvasSize-viewportSize&&travelRate>0)&&(travelRate=0),0===travelRate)this._autoScrollDelay&&(_Global.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0);else if(!this._autoScrollDelay&&!this._autoScrollFrame){var that=this;this._autoScrollDelay=_Global.setTimeout(function(){if(that._autoScrollRate){that._lastDragTimeout=_BaseUtils._now();var nextFrame=function(){if(!that._autoScrollRate&&that._autoScrollFrame||that.site._disposed)that._stopAutoScroll();else{
var currentTime=_BaseUtils._now(),delta=that._autoScrollRate*((currentTime-that._lastDragTimeout)/1e3);delta=delta<0?Math.min(-1,delta):Math.max(1,delta);var newScrollPos={};newScrollPos[that.site._scrollProperty]=that.site._viewportScrollPosition+delta,_ElementUtilities.setScrollPosition(that.site._viewport,newScrollPos),that._lastDragTimeout=currentTime,that._autoScrollFrame=_BaseUtils._requestAnimationFrame(nextFrame)}};that._autoScrollFrame=_BaseUtils._requestAnimationFrame(nextFrame)}},_Constants._AUTOSCROLL_DELAY)}this._autoScrollRate=travelRate},_stopAutoScroll:function(){this._autoScrollDelay&&(_Global.clearTimeout(this._autoScrollDelay),this._autoScrollDelay=0),this._autoScrollRate=0,this._autoScrollFrame=0},onKeyDown:function(eventObject){function setNewFocus(newEntity,skipSelection,clampToBounds){function setNewFocusImpl(maxIndex){var moveView=!0,invalidIndex=!1;if(clampToBounds?newEntity.index=Math.max(0,Math.min(maxIndex,newEntity.index)):(newEntity.index<0||newEntity.index>maxIndex)&&(invalidIndex=!0),!invalidIndex&&(oldEntity.index!==newEntity.index||oldEntity.type!==newEntity.type)){var changeFocus=dispatchKeyboardNavigating(site._element,oldEntity,newEntity);changeFocus&&(moveView=!1,that._setNewFocusItemOffsetPromise&&that._setNewFocusItemOffsetPromise.cancel(),site._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.high,function(){return that._setNewFocusItemOffsetPromise=site._getItemOffset(oldEntity,!0).then(function(range){range=site._convertFromCanvasCoordinates(range);var oldItemOffscreen=range.end<=site.scrollPosition||range.begin>=site.scrollPosition+site._getViewportLength()-1;return that._setNewFocusItemOffsetPromise=site._getItemOffset(newEntity).then(function(range){that._setNewFocusItemOffsetPromise=null;var retVal={position:site.scrollPosition,direction:"right"};return oldItemOffscreen&&(site._selection._setFocused(newEntity,!0),range=site._convertFromCanvasCoordinates(range),newEntity.index>oldEntity.index?(retVal.direction="right",retVal.position=range.end-site._getViewportLength()):(retVal.direction="left",retVal.position=range.begin)),site._changeFocus(newEntity,skipSelection,ctrlKeyDown,oldItemOffscreen,!0),oldItemOffscreen?retVal:Promise.cancel},function(error){return site._changeFocus(newEntity,skipSelection,ctrlKeyDown,!0,!0),Promise.wrapError(error)}),that._setNewFocusItemOffsetPromise},function(error){return site._changeFocus(newEntity,skipSelection,ctrlKeyDown,!0,!0),Promise.wrapError(error)}),that._setNewFocusItemOffsetPromise},!0))}return moveView&&(site._selection._setFocused(oldEntity,!0),site.ensureVisible(oldEntity)),invalidIndex?{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX}:newEntity}return newEntity.type===_UI.ObjectType.item?Promise.wrap(view.lastItemIndex()).then(setNewFocusImpl):newEntity.type===_UI.ObjectType.groupHeader?Promise.wrap(site._groups.length()-1).then(setNewFocusImpl):Promise.wrap(0).then(setNewFocusImpl)}var that=this,site=this.site,view=site._view,oldEntity=site._selection._getFocused(),handled=!0,ctrlKeyDown=eventObject.ctrlKey,Key=_ElementUtilities.Key,keyCode=eventObject.keyCode,rtl=site._rtl();if(!this._isInteractive(eventObject.target)){if(eventObject.ctrlKey&&!eventObject.altKey&&!eventObject.shiftKey&&this._keyboardAcceleratorHandlers[keyCode]&&this._keyboardAcceleratorHandlers[keyCode](),site.itemsReorderable&&!eventObject.ctrlKey&&eventObject.altKey&&eventObject.shiftKey&&oldEntity.type===_UI.ObjectType.item&&(keyCode===Key.leftArrow||keyCode===Key.rightArrow||keyCode===Key.upArrow||keyCode===Key.downArrow)){var selection=site._selection,focusedIndex=oldEntity.index,movingUnselectedItem=!1,processReorder=!0;if(!selection.isEverything()){if(!selection._isIncluded(focusedIndex)){var item=site._view.items.itemAt(focusedIndex);item&&_ElementUtilities.hasClass(item,_Constants._nonDraggableClass)?processReorder=!1:(movingUnselectedItem=!0,selection=new _SelectionManager._Selection(this.site,[{firstIndex:focusedIndex,lastIndex:focusedIndex}]))}if(processReorder){var dropIndex=focusedIndex;keyCode===Key.rightArrow?dropIndex+=rtl?-1:1:keyCode===Key.leftArrow?dropIndex+=rtl?1:-1:keyCode===Key.upArrow?dropIndex--:dropIndex++;var movingAhead=dropIndex>focusedIndex,searchForward=movingAhead;movingAhead&&dropIndex>=this.site._cachedCount&&(searchForward=!1,dropIndex=this.site._cachedCount-1),dropIndex=this._findFirstAvailableInsertPoint(selection,dropIndex,searchForward),dropIndex=Math.min(Math.max(-1,dropIndex),this.site._cachedCount-1);var reportedInsertAfterIndex=dropIndex-(movingAhead||dropIndex===-1?0:1),reportedIndex=dropIndex,groupsEnabled=this.site._groupsEnabled();if(groupsEnabled){var groups=this.site._groups,groupIndex=dropIndex>-1?groups.groupFromItem(dropIndex):0;movingAhead?groups.group(groupIndex).startIndex===dropIndex&&reportedInsertAfterIndex--:groupIndex<groups.length()-1&&dropIndex===groups.group(groupIndex+1).startIndex-1&&reportedInsertAfterIndex++}if(this._fireDragBetweenEvent(reportedIndex,reportedInsertAfterIndex,null)&&this._fireDropEvent(reportedIndex,reportedInsertAfterIndex,null)){if(groupsEnabled)return;this._reorderItems(dropIndex,selection,movingUnselectedItem,!movingAhead,!0)}}}}else if(eventObject.altKey)handled=!1;else if(this._keyboardNavigationHandlers[keyCode])this._keyboardNavigationHandlers[keyCode](oldEntity).then(function(newEntity){if(newEntity.index!==oldEntity.index||newEntity.type!==oldEntity.type){var clampToBounds=that._keyboardNavigationHandlers[keyCode].clampToBounds;newEntity.type!==_UI.ObjectType.groupHeader&&eventObject.shiftKey&&site._selectionAllowed()&&site._multiSelection()?(site._selection._pivot===_Constants._INVALID_INDEX&&(site._selection._pivot=oldEntity.index),setNewFocus(newEntity,!0,clampToBounds).then(function(newEntity){if(newEntity.index!==_Constants._INVALID_INDEX){var firstIndex=Math.min(newEntity.index,site._selection._pivot),lastIndex=Math.max(newEntity.index,site._selection._pivot),additive=eventObject.ctrlKey||site._tap===_UI.TapBehavior.toggleSelect;that._selectRange(firstIndex,lastIndex,additive)}})):(site._selection._pivot=_Constants._INVALID_INDEX,setNewFocus(newEntity,!1,clampToBounds))}else handled=!1});else if(eventObject.ctrlKey||keyCode!==Key.enter)oldEntity.type!==_UI.ObjectType.groupHeader&&(eventObject.ctrlKey&&keyCode===Key.enter||keyCode===Key.space)?(this._itemEventsHandler.toggleSelectionIfAllowed(oldEntity.index),site._changeFocus(oldEntity,!0,ctrlKeyDown,!1,!0)):keyCode===Key.escape&&site._selection.count()>0?(site._selection._pivot=_Constants._INVALID_INDEX,site._selection.clear()):handled=!1;else{var element=oldEntity.type===_UI.ObjectType.groupHeader?site._groups.group(oldEntity.index).header:site._view.items.itemBoxAt(oldEntity.index);if(element){oldEntity.type===_UI.ObjectType.groupHeader?(this._pressedHeader=element,this._pressedItemBox=null,this._pressedContainer=null):(this._pressedItemBox=element,this._pressedContainer=site._view.items.containerAt(oldEntity.index),this._pressedHeader=null);var allowed=this._verifySelectionAllowed(oldEntity);allowed.canTapSelect&&this._itemEventsHandler.handleTap(oldEntity),this._fireInvokeEvent(oldEntity,element)}}this._keyDownHandled=handled,handled&&(eventObject.stopPropagation(),eventObject.preventDefault())}keyCode===Key.tab&&(this.site._keyboardFocusInbound=!0)},onKeyUp:function(eventObject){this._keyDownHandled&&(eventObject.stopPropagation(),eventObject.preventDefault())},onTabEntered:function(eventObject){if(0!==this.site._groups.length()||this.site._hasHeaderOrFooter){var site=this.site,focused=site._selection._getFocused(),forward=eventObject.detail,inboundFocus=!site._hasKeyboardFocus||eventObject.target===site._viewport;if(inboundFocus)if(this.inboundFocusHandled=!0,focused.index=focused.index===_Constants._INVALID_INDEX?0:focused.index,forward||!this.site._supportsGroupHeaderKeyboarding&&!this.site._hasHeaderOrFooter){var entity={type:_UI.ObjectType.item};focused.type===_UI.ObjectType.groupHeader?(entity.index=site._groupFocusCache.getIndexForGroup(focused.index),dispatchKeyboardNavigating(site._element,focused,entity)?site._changeFocus(entity,!0,!1,!1,!0):site._changeFocus(focused,!0,!1,!1,!0)):(entity.index=focused.type!==_UI.ObjectType.item?site._groupFocusCache.getLastFocusedItemIndex():focused.index,site._changeFocus(entity,!0,!1,!1,!0)),eventObject.preventDefault()}else{var entity={type:_UI.ObjectType.groupHeader};this.site._hasHeaderOrFooter?this.site._lastFocusedElementInGroupTrack.type===_UI.ObjectType.groupHeader&&this.site._supportsGroupHeaderKeyboarding?(entity.index=site._groups.groupFromItem(focused.index),dispatchKeyboardNavigating(site._element,focused,entity)?site._changeFocus(entity,!0,!1,!1,!0):site._changeFocus(focused,!0,!1,!1,!0)):(entity.type=this.site._lastFocusedElementInGroupTrack.type,entity.index=0,site._changeFocus(entity,!0,!1,!1,!0)):focused.type!==_UI.ObjectType.groupHeader&&this.site._supportsGroupHeaderKeyboarding?(entity.index=site._groups.groupFromItem(focused.index),dispatchKeyboardNavigating(site._element,focused,entity)?site._changeFocus(entity,!0,!1,!1,!0):site._changeFocus(focused,!0,!1,!1,!0)):(entity.index=focused.index,site._changeFocus(entity,!0,!1,!1,!0)),eventObject.preventDefault()}}},onTabExiting:function(eventObject){if(this.site._hasHeaderOrFooter||this.site._supportsGroupHeaderKeyboarding&&0!==this.site._groups.length()){var site=this.site,focused=site._selection._getFocused(),forward=eventObject.detail;if(forward){var entity=null;if(focused.type===_UI.ObjectType.item){var lastType=this.site._lastFocusedElementInGroupTrack.type;if(lastType!==_UI.ObjectType.header&&lastType!==_UI.ObjectType.footer&&this.site._supportsGroupHeaderKeyboarding)var entity={type:_UI.ObjectType.groupHeader,index:site._groups.groupFromItem(focused.index)};else var entity={type:lastType===_UI.ObjectType.item?_UI.ObjectType.header:lastType,index:0}}entity&&dispatchKeyboardNavigating(site._element,focused,entity)&&(site._changeFocus(entity,!0,!1,!1,!0),eventObject.preventDefault())}else if(!forward&&focused.type!==_UI.ObjectType.item){var targetIndex=0;targetIndex=focused.type===_UI.ObjectType.groupHeader?site._groupFocusCache.getIndexForGroup(focused.index):focused.type===_UI.ObjectType.header?0:site._view.lastItemIndex();var entity={type:_UI.ObjectType.item,index:targetIndex};dispatchKeyboardNavigating(site._element,focused,entity)&&(site._changeFocus(entity,!0,!1,!1,!0),eventObject.preventDefault())}}}});return _SelectionMode})})}),define("WinJS/Controls/ListView/_ErrorMessages",["exports","../../Core/_Base","../../Core/_Resources"],function(exports,_Base,_Resources){"use strict";_Base.Namespace._moduleDefine(exports,null,{modeIsInvalid:{get:function(){return"Invalid argument: mode must be one of following values: 'none', 'single' or 'multi'."}},loadingBehaviorIsDeprecated:{get:function(){return"Invalid configuration: loadingBehavior is deprecated. The control will default this property to 'randomAccess'. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoad is deprecated. The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},pagesToLoadThresholdIsDeprecated:{get:function(){return"Invalid configuration: pagesToLoadThreshold is deprecated.  The control will not use this property. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},automaticallyLoadPagesIsDeprecated:{get:function(){return"Invalid configuration: automaticallyLoadPages is deprecated. The control will default this property to false. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},invalidTemplate:{get:function(){return"Invalid template: Templates must be created before being passed to the ListView, and must contain a valid tree of elements."}},loadMorePagesIsDeprecated:{get:function(){return"loadMorePages is deprecated. Invoking this function will not have any effect. Please refer to the 'ListView loading behaviors' SDK Sample for guidance on how to implement incremental load behavior."}},disableBackdropIsDeprecated:{get:function(){return"Invalid configuration: disableBackdrop is deprecated. Style: .win-listview .win-container.win-backdrop { background-color:transparent; } instead."}},backdropColorIsDeprecated:{get:function(){return"Invalid configuration: backdropColor is deprecated. Style: .win-listview .win-container.win-backdrop { rgba(155,155,155,0.23); } instead."}},itemInfoIsDeprecated:{get:function(){return"GridLayout.itemInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},groupInfoIsDeprecated:{get:function(){return"GridLayout.groupInfo may be altered or unavailable in future versions. Instead, use CellSpanningLayout."}},resetItemIsDeprecated:{get:function(){return"resetItem may be altered or unavailable in future versions. Instead, mark the element as disposable using WinJS.Utilities.markDisposable."}},resetGroupHeaderIsDeprecated:{get:function(){return"resetGroupHeader may be altered or unavailable in future versions. Instead, mark the header element as disposable using WinJS.Utilities.markDisposable."}},maxRowsIsDeprecated:{get:function(){return"GridLayout.maxRows may be altered or unavailable in future versions. Instead, use the maximumRowsOrColumns property."}},swipeOrientationDeprecated:{get:function(){return"Invalid configuration: swipeOrientation is deprecated. The control will default this property to 'none'"}},swipeBehaviorDeprecated:{get:function(){return"Invalid configuration: swipeBehavior is deprecated. The control will default this property to 'none'"}}})}),define("WinJS/Controls/ListView/_GroupFocusCache",["exports","../../Core/_Base"],function(exports,_Base){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_GroupFocusCache:_Base.Namespace._lazy(function(){return _Base.Class.define(function(listView){this._listView=listView,this.clear()},{updateCache:function(groupKey,itemKey,itemIndex){this._lastFocusedItemKey=itemKey,this._lastFocusedItemIndex=itemIndex,itemIndex=""+itemIndex,this._itemToIndex[itemKey]=itemIndex,this._groupToItem[groupKey]=itemKey},deleteItem:function(itemKey){if(itemKey===this._lastFocusedItemKey&&(this._lastFocusedItemKey=null,this._lastFocusedItemIndex=0),this._itemToIndex[itemKey])for(var that=this,keys=Object.keys(this._groupToItem),i=0,len=keys.length;i<len;i++){var key=keys[i];if(that._groupToItem[key]===itemKey){that.deleteGroup(key);break}}},deleteGroup:function(groupKey){var itemKey=this._groupToItem[groupKey];itemKey&&delete this._itemToIndex[itemKey],delete this._groupToItem[groupKey]},updateItemIndex:function(itemKey,itemIndex){itemKey===this._lastFocusedItemKey&&(this._lastFocusedItemIndex=itemIndex),this._itemToIndex[itemKey]&&(this._itemToIndex[itemKey]=""+itemIndex)},getIndexForGroup:function(groupIndex){var groupKey=this._listView._groups.group(groupIndex).key,itemKey=this._groupToItem[groupKey];return itemKey&&this._itemToIndex[itemKey]?+this._itemToIndex[itemKey]:this._listView._groups.fromKey(groupKey).group.startIndex},clear:function(){this._groupToItem={},this._itemToIndex={},this._lastFocusedItemIndex=0,this._lastFocusedItemKey=null},getLastFocusedItemIndex:function(){return this._lastFocusedItemIndex}})}),_UnsupportedGroupFocusCache:_Base.Namespace._lazy(function(){return _Base.Class.define(null,{updateCache:function(groupKey,itemKey,itemIndex){this._lastFocusedItemKey=itemKey,this._lastFocusedItemIndex=itemIndex},deleteItem:function(itemKey){itemKey===this._lastFocusedItemKey&&(this._lastFocusedItemKey=null,this._lastFocusedItemIndex=0)},deleteGroup:function(){},updateItemIndex:function(itemKey,itemIndex){itemKey===this._lastFocusedItemKey&&(this._lastFocusedItemIndex=itemIndex)},getIndexForGroup:function(){return 0},clear:function(){this._lastFocusedItemIndex=0,this._lastFocusedItemKey=null},getLastFocusedItemIndex:function(){return this._lastFocusedItemIndex}})})})}),define("WinJS/Controls/ListView/_GroupsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_ItemsManager","../../Utilities/_UI","../ItemContainer/_Constants"],function(exports,_Base,Promise,_Dispose,_ElementUtilities,_ItemsManager,_UI,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_GroupsContainerBase:_Base.Namespace._lazy(function(){return _Base.Class.define(function(){},{index:function(element){var header=this.headerFrom(element);if(header)for(var i=0,len=this.groups.length;i<len;i++)if(header===this.groups[i].header)return i;return _Constants._INVALID_INDEX},headerFrom:function(element){for(;element&&!_ElementUtilities.hasClass(element,_Constants._headerClass);)element=element.parentNode;return element},requestHeader:function(index){this._waitingHeaderRequests=this._waitingHeaderRequests||{},this._waitingHeaderRequests[index]||(this._waitingHeaderRequests[index]=[]);var that=this;return new Promise(function(complete){var group=that.groups[index];group&&group.header?complete(group.header):that._waitingHeaderRequests[index].push(complete)})},notify:function(index,header){if(this._waitingHeaderRequests&&this._waitingHeaderRequests[index]){for(var requests=this._waitingHeaderRequests[index],i=0,len=requests.length;i<len;i++)requests[i](header);this._waitingHeaderRequests[index]=[]}},groupFromImpl:function(fromGroup,toGroup,comp){if(toGroup<fromGroup)return null;var center=fromGroup+Math.floor((toGroup-fromGroup)/2),centerGroup=this.groups[center];return comp(centerGroup,center)?this.groupFromImpl(fromGroup,center-1,comp):center<toGroup&&!comp(this.groups[center+1],center+1)?this.groupFromImpl(center+1,toGroup,comp):center},groupFrom:function(comp){if(this.groups.length>0){var lastGroupIndex=this.groups.length-1,lastGroup=this.groups[lastGroupIndex];return comp(lastGroup,lastGroupIndex)?this.groupFromImpl(0,this.groups.length-1,comp):lastGroupIndex}return null},groupFromItem:function(itemIndex){return this.groupFrom(function(group){return itemIndex<group.startIndex})},groupFromOffset:function(offset){return this.groupFrom(function(group){return offset<group.offset})},group:function(index){return this.groups[index]},length:function(){return this.groups.length},cleanUp:function(){if(this.listBinding){for(var i=0,len=this.groups.length;i<len;i++){var group=this.groups[i];group.userData&&this.listBinding.releaseItem(group.userData)}this.listBinding.release()}},_dispose:function(){this.cleanUp()},synchronizeGroups:function(){var that=this;return this.pendingChanges=[],this.ignoreChanges=!0,this.groupDataSource.invalidateAll().then(function(){return Promise.join(that.pendingChanges)}).then(function(){if(that._listView._ifZombieDispose())return Promise.cancel}).then(function(){that.ignoreChanges=!1},function(error){return that.ignoreChanges=!1,Promise.wrapError(error)})},fromKey:function(key){for(var i=0,len=this.groups.length;i<len;i++){var group=this.groups[i];if(group.key===key)return{group:group,index:i}}return null},fromHandle:function(handle){for(var i=0,len=this.groups.length;i<len;i++){var group=this.groups[i];if(group.handle===handle)return{group:group,index:i}}return null}})}),_UnvirtualizedGroupsContainer:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._GroupsContainerBase,function(listView,groupDataSource){this._listView=listView,this.groupDataSource=groupDataSource,this.groups=[],this.pendingChanges=[],this.dirty=!0;var that=this,notificationHandler={beginNotifications:function(){that._listView._versionManager.beginNotifications()},endNotifications:function(){that._listView._versionManager.endNotifications(),that._listView._ifZombieDispose()||!that.ignoreChanges&&that._listView._groupsChanged&&that._listView._scheduleUpdate()},indexChanged:function(){that._listView._versionManager.receivedNotification(),that._listView._ifZombieDispose()||this.scheduleUpdate()},itemAvailable:function(){},countChanged:function(newCount){that._listView._versionManager.receivedNotification(),that._listView._writeProfilerMark("groupCountChanged("+newCount+"),info"),that._listView._ifZombieDispose()||this.scheduleUpdate()},changed:function(newItem){if(that._listView._versionManager.receivedNotification(),!that._listView._ifZombieDispose()){var groupEntry=that.fromKey(newItem.key);groupEntry&&(that._listView._writeProfilerMark("groupChanged("+groupEntry.index+"),info"),groupEntry.group.userData=newItem,groupEntry.group.startIndex=newItem.firstItemIndexHint,this.markToRemove(groupEntry.group)),this.scheduleUpdate()}},removed:function(itemHandle){if(that._listView._versionManager.receivedNotification(),that._listView._groupRemoved(itemHandle),!that._listView._ifZombieDispose()){var groupEntry=that.fromHandle(itemHandle);if(groupEntry){that._listView._writeProfilerMark("groupRemoved("+groupEntry.index+"),info"),that.groups.splice(groupEntry.index,1);var index=that.groups.indexOf(groupEntry.group,groupEntry.index);index>-1&&that.groups.splice(index,1),this.markToRemove(groupEntry.group)}this.scheduleUpdate()}},inserted:function(itemPromise,previousHandle,nextHandle){if(that._listView._versionManager.receivedNotification(),!that._listView._ifZombieDispose()){that._listView._writeProfilerMark("groupInserted,info");var notificationHandler=this;itemPromise.retain().then(function(item){var index;if(index=previousHandle||nextHandle||that.groups.length?notificationHandler.findIndex(previousHandle,nextHandle):0,index!==-1){var newGroup={key:item.key,startIndex:item.firstItemIndexHint,userData:item,handle:itemPromise.handle};that.groups.splice(index,0,newGroup)}notificationHandler.scheduleUpdate()}),that.pendingChanges.push(itemPromise)}},moved:function(itemPromise,previousHandle,nextHandle){if(that._listView._versionManager.receivedNotification(),!that._listView._ifZombieDispose()){that._listView._writeProfilerMark("groupMoved,info");var notificationHandler=this;itemPromise.then(function(item){var newIndex=notificationHandler.findIndex(previousHandle,nextHandle),groupEntry=that.fromKey(item.key);if(groupEntry)that.groups.splice(groupEntry.index,1),newIndex!==-1&&(groupEntry.index<newIndex&&newIndex--,groupEntry.group.key=item.key,groupEntry.group.userData=item,groupEntry.group.startIndex=item.firstItemIndexHint,that.groups.splice(newIndex,0,groupEntry.group));else if(newIndex!==-1){var newGroup={key:item.key,startIndex:item.firstItemIndexHint,userData:item,handle:itemPromise.handle};that.groups.splice(newIndex,0,newGroup),itemPromise.retain()}notificationHandler.scheduleUpdate()}),that.pendingChanges.push(itemPromise)}},reload:function(){that._listView._versionManager.receivedNotification(),that._listView._ifZombieDispose()||that._listView._processReload()},markToRemove:function(group){if(group.header){var header=group.header;group.header=null,group.left=-1,group.width=-1,group.decorator=null,group.tabIndex=-1,header.tabIndex=-1,that._listView._groupsToRemove[_ElementUtilities._uniqueID(header)]={group:group,header:header}}},scheduleUpdate:function(){that.dirty=!0,that.ignoreChanges||(that._listView._groupsChanged=!0)},findIndex:function(previousHandle,nextHandle){var groupEntry,index=-1;return previousHandle&&(groupEntry=that.fromHandle(previousHandle),groupEntry&&(index=groupEntry.index+1)),index===-1&&nextHandle&&(groupEntry=that.fromHandle(nextHandle),groupEntry&&(index=groupEntry.index)),index},removeElements:function(group){if(group.header){var parentNode=group.header.parentNode;parentNode&&(_Dispose.disposeSubTree(group.header),parentNode.removeChild(group.header)),group.header=null,group.left=-1,group.width=-1}}};this.listBinding=this.groupDataSource.createListBinding(notificationHandler)},{initialize:function(){this.initializePromise&&this.initializePromise.cancel(),this._listView._writeProfilerMark("GroupsContainer_initialize,StartTM");var that=this;return this.initializePromise=this.groupDataSource.getCount().then(function(count){for(var promises=[],i=0;i<count;i++)promises.push(that.listBinding.fromIndex(i).retain());return Promise.join(promises)}).then(function(groups){that.groups=[];for(var i=0,len=groups.length;i<len;i++){var group=groups[i];that.groups.push({key:group.key,startIndex:group.firstItemIndexHint,handle:group.handle,userData:group})}that._listView._writeProfilerMark("GroupsContainer_initialize groups("+groups.length+"),info"),that._listView._writeProfilerMark("GroupsContainer_initialize,StopTM")},function(error){return that._listView._writeProfilerMark("GroupsContainer_initialize,StopTM"),Promise.wrapError(error)}),this.initializePromise},renderGroup:function(index){if(this._listView.groupHeaderTemplate){var group=this.groups[index];return Promise.wrap(this._listView._groupHeaderRenderer(Promise.wrap(group.userData))).then(_ItemsManager._normalizeRendererReturn)}return Promise.wrap(null)},setDomElement:function(index,headerElement){this.groups[index].header=headerElement,this.notify(index,headerElement)},removeElements:function(){for(var elements=this._listView._groupsToRemove||{},keys=Object.keys(elements),focusedItemPurged=!1,focused=this._listView._selection._getFocused(),i=0,len=keys.length;i<len;i++){var group=elements[keys[i]],header=group.header,groupData=group.group;if(focusedItemPurged||focused.type!==_UI.ObjectType.groupHeader||groupData.userData.index!==focused.index||(this._listView._unsetFocusOnItem(),focusedItemPurged=!0),header){var parentNode=header.parentNode;parentNode&&(_Dispose._disposeElement(header),parentNode.removeChild(header))}}focusedItemPurged&&this._listView._setFocusOnItem(focused),this._listView._groupsToRemove={}},resetGroups:function(){for(var groups=this.groups.slice(0),i=0,len=groups.length;i<len;i++){var group=groups[i];this.listBinding&&group.userData&&this.listBinding.releaseItem(group.userData)}this.groups.length=0,this.dirty=!0}})}),_NoGroups:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._GroupsContainerBase,function(listView){this._listView=listView,this.groups=[{startIndex:0}],this.dirty=!0},{synchronizeGroups:function(){return Promise.wrap()},addItem:function(){return Promise.wrap(this.groups[0])},resetGroups:function(){this.groups=[{startIndex:0}],delete this.pinnedItem,delete this.pinnedOffset,this.dirty=!0},renderGroup:function(){return Promise.wrap(null)},ensureFirstGroup:function(){return Promise.wrap(this.groups[0])},groupOf:function(){return Promise.wrap(this.groups[0])},removeElements:function(){}})})})}),define("WinJS/Controls/ListView/_Helpers",["exports","../../Core/_Base","../ItemContainer/_Constants"],function(exports,_Base,_Constants){"use strict";function nodeListToArray(nodeList){return Array.prototype.slice.call(nodeList)}function repeat(strings,count){if("string"==typeof strings)return repeat([strings],count);var result=new Array(Math.floor(count/strings.length)+1).join(strings.join(""));return result+=strings.slice(0,count%strings.length).join("")}function stripedContainers(count,nextItemIndex){var containersMarkup,evenStripe=_Constants._containerEvenClass,oddStripe=_Constants._containerOddClass,stripes=nextItemIndex%2===0?[evenStripe,oddStripe]:[oddStripe,evenStripe],pairOfContainers=["<div class='win-container "+stripes[0]+" win-backdrop'></div>","<div class='win-container "+stripes[1]+" win-backdrop'></div>"];return containersMarkup=repeat(pairOfContainers,count)}_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_nodeListToArray:nodeListToArray,_repeat:repeat,_stripedContainers:stripedContainers})}),define("WinJS/Controls/ListView/_ItemsContainer",["exports","../../Core/_Base","../../Promise","../../Utilities/_ElementUtilities","../ItemContainer/_Constants"],function(exports,_Base,Promise,_ElementUtilities,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_ItemsContainer:_Base.Namespace._lazy(function(){var _ItemsContainer=function(site){this.site=site,this._itemData={},this.waitingItemRequests={}};return _ItemsContainer.prototype={requestItem:function(itemIndex){this.waitingItemRequests[itemIndex]||(this.waitingItemRequests[itemIndex]=[]);var that=this,promise=new Promise(function(complete){var itemData=that._itemData[itemIndex];itemData&&!itemData.detached&&itemData.element?complete(itemData.element):that.waitingItemRequests[itemIndex].push(complete)});return promise},removeItem:function(index){delete this._itemData[index]},removeItems:function(){this._itemData={},this.waitingItemRequests={}},setItemAt:function(itemIndex,itemData){this._itemData[itemIndex]=itemData,itemData.detached||this.notify(itemIndex,itemData)},notify:function(itemIndex,itemData){if(this.waitingItemRequests[itemIndex]){for(var requests=this.waitingItemRequests[itemIndex],i=0;i<requests.length;i++)requests[i](itemData.element);this.waitingItemRequests[itemIndex]=[]}},elementAvailable:function(itemIndex){var itemData=this._itemData[itemIndex];itemData.detached=!1,this.notify(itemIndex,itemData)},itemAt:function(itemIndex){var itemData=this._itemData[itemIndex];return itemData?itemData.element:null},itemDataAt:function(itemIndex){return this._itemData[itemIndex]},containerAt:function(itemIndex){var itemData=this._itemData[itemIndex];return itemData?itemData.container:null},itemBoxAt:function(itemIndex){var itemData=this._itemData[itemIndex];return itemData?itemData.itemBox:null},itemBoxFrom:function(element){for(;element&&!_ElementUtilities.hasClass(element,_Constants._itemBoxClass);)element=element.parentNode;return element},containerFrom:function(element){for(;element&&!_ElementUtilities.hasClass(element,_Constants._containerClass);)element=element.parentNode;return element},index:function(element){var item=this.containerFrom(element);if(item)for(var index in this._itemData)if(this._itemData[index].container===item)return parseInt(index,10);return _Constants._INVALID_INDEX},each:function(callback){for(var index in this._itemData)if(this._itemData.hasOwnProperty(index)){var itemData=this._itemData[index];callback(parseInt(index,10),itemData.element,itemData)}},eachIndex:function(callback){for(var index in this._itemData)if(callback(parseInt(index,10)))break},count:function(){return Object.keys(this._itemData).length}},_ItemsContainer})})}),define("WinJS/Controls/ListView/_Layouts",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations/_TransitionAnimation","../../Promise","../../Scheduler","../../_Signal","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","./_ErrorMessages"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,_WriteProfilerMark,_TransitionAnimation,Promise,Scheduler,_Signal,_Dispose,_ElementUtilities,_SafeHtml,_UI,_Constants,_ErrorMessages){"use strict";function uniqueCssClassName(prefix){return"_win-dynamic-"+prefix+"-"+nextCssClassId++}function flushDynamicCssRules(){var i,j,ruleSuffix,rules=layoutStyleElem.sheet.cssRules,classCount=staleClassNames.length;for(i=0;i<classCount;i++)for(ruleSuffix="."+staleClassNames[i]+" ",j=rules.length-1;j>=0;j--)rules[j].selectorText.indexOf(ruleSuffix)!==-1&&layoutStyleElem.sheet.deleteRule(j);staleClassNames=[]}function addDynamicCssRule(uniqueToken,site,selector,body){flushDynamicCssRules();var rule="."+_Constants._listViewClass+" ."+uniqueToken+" "+selector+" { "+body+"}",perfId="_addDynamicCssRule:"+uniqueToken+",info";site?site._writeProfilerMark(perfId):_WriteProfilerMark("WinJS.UI.ListView:Layout"+perfId),layoutStyleElem.sheet.insertRule(rule,0)}function deleteDynamicCssRule(uniqueToken){staleClassNames.push(uniqueToken)}function clampToRange(first,last,x){return Math.max(first,Math.min(last,x));
}function getDimension(element,property){return _ElementUtilities.convertToPixels(element,_ElementUtilities._getComputedStyle(element,null)[property])}function getOuter(side,element){return getDimension(element,"margin"+side)+getDimension(element,"border"+side+"Width")+getDimension(element,"padding"+side)}function getOuterHeight(element){return getOuter("Top",element)+getOuter("Bottom",element)}function getOuterWidth(element){return getOuter("Left",element)+getOuter("Right",element)}function forEachContainer(itemsContainer,callback){if(itemsContainer.items)for(var i=0,len=itemsContainer.items.length;i<len;i++)callback(itemsContainer.items[i],i);else for(var b=0,index=0;b<itemsContainer.itemsBlocks.length;b++)for(var block=itemsContainer.itemsBlocks[b],i=0,len=block.items.length;i<len;i++)callback(block.items[i],index++)}function containerFromIndex(itemsContainer,index){if(index<0)return null;if(itemsContainer.items)return index<itemsContainer.items.length?itemsContainer.items[index]:null;var blockSize=itemsContainer.itemsBlocks[0].items.length,blockIndex=Math.floor(index/blockSize),offset=index%blockSize;return blockIndex<itemsContainer.itemsBlocks.length&&offset<itemsContainer.itemsBlocks[blockIndex].items.length?itemsContainer.itemsBlocks[blockIndex].items[offset]:null}function getItemsContainerTree(itemsContainer,tree){for(var itemsContainerTree,i=0,treeLength=tree.length;i<treeLength;i++)if(tree[i].itemsContainer.element===itemsContainer){itemsContainerTree=tree[i].itemsContainer;break}return itemsContainerTree}function getItemsContainerLength(itemsContainer){var blocksCount,itemsCount;return itemsContainer.itemsBlocks?(blocksCount=itemsContainer.itemsBlocks.length,itemsCount=blocksCount>0?itemsContainer.itemsBlocks[0].items.length*(blocksCount-1)+itemsContainer.itemsBlocks[blocksCount-1].items.length:0):itemsCount=itemsContainer.items.length,itemsCount}function getEnvironmentSupportInformation(site){if(!environmentDetails){var surface=_Global.document.createElement("div");surface.style.width="500px",surface.style.visibility="hidden";var flexRoot=_Global.document.createElement("div");flexRoot.style.cssText+="width: 500px; height: 200px; display: -webkit-flex; display: flex",_SafeHtml.setInnerHTMLUnsafe(flexRoot,"<div style='height: 100%; display: -webkit-flex; display: flex; flex-flow: column wrap; align-content: flex-start; -webkit-flex-flow: column wrap; -webkit-align-content: flex-start'><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div><div style='width: 100px; height: 100px'></div></div>"),surface.appendChild(flexRoot),site.viewport.insertBefore(surface,site.viewport.firstChild);var canMeasure=surface.offsetWidth>0,expectedWidth=200;canMeasure&&(environmentDetails={supportsCSSGrid:!!("-ms-grid-row"in _Global.document.documentElement.style),nestedFlexTooLarge:flexRoot.firstElementChild.offsetWidth>expectedWidth,nestedFlexTooSmall:flexRoot.firstElementChild.offsetWidth<expectedWidth}),site.readyToMeasure(),site.viewport.removeChild(surface)}return environmentDetails}function normalizeLayoutPromises(retVal){return Promise.is(retVal)?{realizedRangeComplete:retVal,layoutComplete:retVal}:"object"==typeof retVal&&retVal&&retVal.layoutComplete?retVal:{realizedRangeComplete:Promise.wrap(),layoutComplete:Promise.wrap()}}function getMargins(element){return{left:getDimension(element,"marginLeft"),right:getDimension(element,"marginRight"),top:getDimension(element,"marginTop"),bottom:getDimension(element,"marginBottom")}}var Key=_ElementUtilities.Key,uniqueID=_ElementUtilities._uniqueID,strings={get itemInfoIsInvalid(){return"Invalid argument: An itemInfo function must be provided which returns an object with numeric width and height properties."},get groupInfoResultIsInvalid(){return"Invalid result: groupInfo result for cell spanning groups must include the following numeric properties: cellWidth and cellHeight."}},layoutStyleElem=_Global.document.createElement("style");_Global.document.head.appendChild(layoutStyleElem);var nextCssClassId=0,staleClassNames=[],browserStyleEquivalents=_BaseUtils._browserStyleEquivalents,transformNames=browserStyleEquivalents.transform,transitionScriptName=_BaseUtils._browserStyleEquivalents.transition.scriptName,dragBetweenTransition=transformNames.cssName+" cubic-bezier(0.1, 0.9, 0.2, 1) 167ms",dragBetweenDistance=12,environmentDetails=null;_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Layout:_Base.Class.define(function(){}),_LayoutCommon:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports.Layout,null,{groupHeaderPosition:{enumerable:!0,get:function(){return this._groupHeaderPosition},set:function(position){this._groupHeaderPosition=position,this._invalidateLayout()}},initialize:function(site,groupsEnabled){site._writeProfilerMark("Layout:initialize,info"),this._inListMode||_ElementUtilities.addClass(site.surface,_Constants._gridLayoutClass),this._backdropColorClassName&&_ElementUtilities.addClass(site.surface,this._backdropColorClassName),this._disableBackdropClassName&&_ElementUtilities.addClass(site.surface,this._disableBackdropClassName),this._groups=[],this._groupMap={},this._oldGroupHeaderPosition=null,this._usingStructuralNodes=!1,this._site=site,this._groupsEnabled=groupsEnabled,this._resetAnimationCaches(!0)},orientation:{enumerable:!0,get:function(){return this._orientation},set:function(orientation){this._orientation=orientation,this._horizontal="horizontal"===orientation,this._invalidateLayout()}},uninitialize:function(){function cleanGroups(groups){var i,len=groups.length;for(i=0;i<len;i++)groups[i].cleanUp(!0)}var perfId="Layout:uninitialize,info";this._elementsToMeasure={},this._site?(this._site._writeProfilerMark(perfId),_ElementUtilities.removeClass(this._site.surface,_Constants._gridLayoutClass),_ElementUtilities.removeClass(this._site.surface,_Constants._headerPositionTopClass),_ElementUtilities.removeClass(this._site.surface,_Constants._headerPositionLeftClass),_ElementUtilities.removeClass(this._site.surface,_Constants._structuralNodesClass),_ElementUtilities.removeClass(this._site.surface,_Constants._singleItemsBlockClass),_ElementUtilities.removeClass(this._site.surface,_Constants._noCSSGrid),this._site.surface.style.cssText="",this._groups&&(cleanGroups(this._groups),this._groups=null,this._groupMap=null),this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this._resetMeasurements(),this._oldGroupHeaderPosition=null,this._usingStructuralNodes=!1,this._envInfo=null,this._backdropColorClassName&&(_ElementUtilities.removeClass(this._site.surface,this._backdropColorClassName),deleteDynamicCssRule(this._backdropColorClassName),this._backdropColorClassName=null),this._disableBackdropClassName&&(_ElementUtilities.removeClass(this._site.surface,this._disableBackdropClassName),deleteDynamicCssRule(this._disableBackdropClassName),this._disableBackdropClassName=null),this._site=null,this._groupsEnabled=null,this._animationsRunning&&this._animationsRunning.cancel(),this._animatingItemsBlocks={}):_WriteProfilerMark("WinJS.UI.ListView:"+perfId)},numberOfItemsPerItemsBlock:{get:function(){function allGroupsAreUniform(){var i,groupCount=that._site.groupCount;for(i=0;i<groupCount;i++)if(that._isCellSpanning(i))return!1;return!0}var that=this;return that._measureItem(0).then(function(){return that._sizes.viewportContentSize!==that._getViewportCrossSize()&&that._viewportSizeChanged(that._getViewportCrossSize()),allGroupsAreUniform()?that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall?(that._usingStructuralNodes=!0,Number.MAX_VALUE):(that._usingStructuralNodes=exports._LayoutCommon._barsPerItemsBlock>0,exports._LayoutCommon._barsPerItemsBlock*that._itemsPerBar):(that._usingStructuralNodes=!1,null)})}},layout:function(tree,changedRange,modifiedItems,modifiedGroups){function copyItemsContainerTree(itemsContainer){function copyItems(itemsContainer){if(that._usingStructuralNodes){var items=[];return itemsContainer.itemsBlocks.forEach(function(itemsBlock){items=items.concat(itemsBlock.items.slice(0))}),items}return itemsContainer.items.slice(0)}return{element:itemsContainer.element,items:copyItems(itemsContainer)}}function updateGroups(){function createGroup(groupInfo,itemsContainer){var GroupType=groupInfo.enableCellSpanning?Groups.CellSpanningGroup:Groups.UniformGroup;return new GroupType(that,itemsContainer)}var i,oldRealizedItemRange=that._groups.length>0?that._getRealizationRange():null,newGroups=[],prepared=[],cleanUpDom={},newGroupMap={},currentIndex=0,len=tree.length;for(i=0;i<len;i++){var oldChangedRealizedRangeInGroup=null,groupInfo=that._getGroupInfo(i),groupKey=that._site.groupFromIndex(i).key,oldGroup=that._groupMap[groupKey],wasCellSpanning=oldGroup instanceof Groups.CellSpanningGroup,isCellSpanning=groupInfo.enableCellSpanning;if(oldGroup)if(wasCellSpanning!==isCellSpanning)cleanUpDom[groupKey]=!0;else{var firstChangedIndexInGroup=Math.max(0,changedRange.firstIndex-oldGroup.startIndex),oldRealizedItemRangeInGroup=that._rangeForGroup(oldGroup,oldRealizedItemRange);oldRealizedItemRangeInGroup&&firstChangedIndexInGroup<=oldRealizedItemRangeInGroup.lastIndex&&(oldChangedRealizedRangeInGroup={firstIndex:Math.max(firstChangedIndexInGroup,oldRealizedItemRangeInGroup.firstIndex),lastIndex:oldRealizedItemRangeInGroup.lastIndex})}var prepareLayoutPromise,group=createGroup(groupInfo,tree[i].itemsContainer.element);prepareLayoutPromise=group.prepareLayoutWithCopyOfTree?group.prepareLayoutWithCopyOfTree(copyItemsContainerTree(tree[i].itemsContainer),oldChangedRealizedRangeInGroup,oldGroup,{groupInfo:groupInfo,startIndex:currentIndex}):group.prepareLayout(getItemsContainerLength(tree[i].itemsContainer),oldChangedRealizedRangeInGroup,oldGroup,{groupInfo:groupInfo,startIndex:currentIndex}),prepared.push(prepareLayoutPromise),currentIndex+=group.count,newGroups.push(group),newGroupMap[groupKey]=group}return Promise.join(prepared).then(function(){for(var currentOffset=0,i=0,len=newGroups.length;i<len;i++){var group=newGroups[i];group.offset=currentOffset,currentOffset+=that._getGroupSize(group)}Object.keys(that._groupMap).forEach(function(deletedKey){var skipDomCleanUp=!cleanUpDom[deletedKey];that._groupMap[deletedKey].cleanUp(skipDomCleanUp)}),that._groups=newGroups,that._groupMap=newGroupMap})}function layoutGroupContent(groupIndex,realizedItemRange,doRealizedRange){var beforeRealizedRange,group=that._groups[groupIndex],firstChangedIndexInGroup=Math.max(0,changedRange.firstIndex-group.startIndex),realizedItemRangeInGroup=that._rangeForGroup(group,realizedItemRange);return doRealizedRange?void group.layoutRealizedRange(firstChangedIndexInGroup,realizedItemRangeInGroup):(realizedItemRangeInGroup||(beforeRealizedRange=group.startIndex+group.count-1<realizedItemRange.firstIndex),group.layoutUnrealizedRange(firstChangedIndexInGroup,realizedItemRangeInGroup,beforeRealizedRange))}function layoutRealizedRange(){if(0!==that._groups.length){var i,realizedItemRange=that._getRealizationRange(),len=tree.length,firstChangedGroup=site.groupIndexFromItemIndex(changedRange.firstIndex);for(i=firstChangedGroup;i<len;i++)layoutGroupContent(i,realizedItemRange,!0),that._layoutGroup(i)}}function layoutUnrealizedRange(){if(0===that._groups.length)return Promise.wrap();var realizedItemRange=that._getRealizationRange(),lastGroupBefore=site.groupIndexFromItemIndex(realizedItemRange.firstIndex-1),firstGroupAfter=site.groupIndexFromItemIndex(realizedItemRange.lastIndex+1),firstChangedGroup=site.groupIndexFromItemIndex(changedRange.firstIndex),layoutPromises=[],groupCount=that._groups.length,stop=!1,before=lastGroupBefore,after=Math.max(firstChangedGroup,firstGroupAfter);for(after=Math.max(before+1,after);!stop;)stop=!0,before>=firstChangedGroup&&(layoutPromises.push(layoutGroupContent(before,realizedItemRange,!1)),stop=!1,before--),after<groupCount&&(layoutPromises.push(layoutGroupContent(after,realizedItemRange,!1)),stop=!1,after++);return Promise.join(layoutPromises)}var realizedRangePromise,that=this,site=that._site,layoutPerfId="Layout.layout",realizedRangePerfId=layoutPerfId+":realizedRange";return that._site._writeProfilerMark(layoutPerfId+",StartTM"),that._site._writeProfilerMark(realizedRangePerfId+",StartTM"),realizedRangePromise=that._measureItem(0).then(function(){return _ElementUtilities[that._usingStructuralNodes?"addClass":"removeClass"](that._site.surface,_Constants._structuralNodesClass),_ElementUtilities[that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall?"addClass":"removeClass"](that._site.surface,_Constants._singleItemsBlockClass),that._sizes.viewportContentSize!==that._getViewportCrossSize()&&that._viewportSizeChanged(that._getViewportCrossSize()),that._cacheRemovedElements(modifiedItems,that._cachedItemRecords,that._cachedInsertedItemRecords,that._cachedRemovedItems,!1),that._cacheRemovedElements(modifiedGroups,that._cachedHeaderRecords,that._cachedInsertedHeaderRecords,that._cachedRemovedHeaders,!0),updateGroups()}).then(function(){that._syncDomWithGroupHeaderPosition(tree);var surfaceLength=0;if(that._groups.length>0){var lastGroup=that._groups[that._groups.length-1];surfaceLength=lastGroup.offset+that._getGroupSize(lastGroup)}that._horizontal?(that._groupsEnabled&&that._groupHeaderPosition===HeaderPosition.left?site.surface.style.cssText+=";height:"+that._sizes.surfaceContentSize+"px;-ms-grid-columns: ("+that._sizes.headerContainerWidth+"px auto)["+tree.length+"]":site.surface.style.height=that._sizes.surfaceContentSize+"px",(that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall)&&(site.surface.style.width=surfaceLength+"px")):(that._groupsEnabled&&that._groupHeaderPosition===HeaderPosition.top?site.surface.style.cssText+=";width:"+that._sizes.surfaceContentSize+"px;-ms-grid-rows: ("+that._sizes.headerContainerHeight+"px auto)["+tree.length+"]":site.surface.style.width=that._sizes.surfaceContentSize+"px",(that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall)&&(site.surface.style.height=surfaceLength+"px")),layoutRealizedRange(),that._layoutAnimations(modifiedItems,modifiedGroups),that._site._writeProfilerMark(realizedRangePerfId+":complete,info"),that._site._writeProfilerMark(realizedRangePerfId+",StopTM")},function(error){return that._site._writeProfilerMark(realizedRangePerfId+":canceled,info"),that._site._writeProfilerMark(realizedRangePerfId+",StopTM"),Promise.wrapError(error)}),that._layoutPromise=realizedRangePromise.then(function(){return layoutUnrealizedRange().then(function(){that._site._writeProfilerMark(layoutPerfId+":complete,info"),that._site._writeProfilerMark(layoutPerfId+",StopTM")},function(error){return that._site._writeProfilerMark(layoutPerfId+":canceled,info"),that._site._writeProfilerMark(layoutPerfId+",StopTM"),Promise.wrapError(error)})}),{realizedRangeComplete:realizedRangePromise,layoutComplete:that._layoutPromise}},itemsFromRange:function(firstPixel,lastPixel){return this._rangeContainsItems(firstPixel,lastPixel)?{firstIndex:this._firstItemFromRange(firstPixel),lastIndex:this._lastItemFromRange(lastPixel)}:{firstIndex:0,lastIndex:-1}},getAdjacent:function(currentItem,pressedKey){function handleArrowKeys(){var currentItemInGroup={type:currentItem.type,index:currentItem.index-group.startIndex},newItem=group.getAdjacent(currentItemInGroup,adjustedKey);if("boundary"===newItem){var prevGroup=that._groups[groupIndex-1],nextGroup=that._groups[groupIndex+1],lastGroupIndex=that._groups.length-1;if(adjustedKey===Key.leftArrow){if(0===groupIndex)return currentItem;if(prevGroup instanceof Groups.UniformGroup&&group instanceof Groups.UniformGroup){var coordinates=that._indexToCoordinate(currentItemInGroup.index),currentSlot=that._horizontal?coordinates.row:coordinates.column,indexOfLastBar=Math.floor((prevGroup.count-1)/that._itemsPerBar),startOfLastBar=indexOfLastBar*that._itemsPerBar;return{type:_UI.ObjectType.item,index:prevGroup.startIndex+Math.min(prevGroup.count-1,startOfLastBar+currentSlot)}}return{type:_UI.ObjectType.item,index:group.startIndex-1}}if(adjustedKey===Key.rightArrow){if(groupIndex===lastGroupIndex)return currentItem;if(group instanceof Groups.UniformGroup&&nextGroup instanceof Groups.UniformGroup){var coordinates=that._indexToCoordinate(currentItemInGroup.index),currentSlot=that._horizontal?coordinates.row:coordinates.column;return{type:_UI.ObjectType.item,index:nextGroup.startIndex+Math.min(nextGroup.count-1,currentSlot)}}return{type:_UI.ObjectType.item,index:nextGroup.startIndex}}return currentItem}return newItem.index+=group.startIndex,newItem}var that=this,groupIndex=that._site.groupIndexFromItemIndex(currentItem.index),group=that._groups[groupIndex],adjustedKey=that._adjustedKeyForOrientationAndBars(that._adjustedKeyForRTL(pressedKey),group instanceof Groups.CellSpanningGroup);if(currentItem.type||(currentItem.type=_UI.ObjectType.item),currentItem.type===_UI.ObjectType.item||pressedKey!==Key.pageUp&&pressedKey!==Key.pageDown){if(currentItem.type===_UI.ObjectType.header&&adjustedKey===Key.rightArrow)return{type:that._groupsEnabled?_UI.ObjectType.groupHeader:_UI.ObjectType.footer,index:0};if(currentItem.type===_UI.ObjectType.footer&&adjustedKey===Key.leftArrow)return{type:that._groupsEnabled?_UI.ObjectType.groupHeader:_UI.ObjectType.header,index:0};if(currentItem.type===_UI.ObjectType.groupHeader){if(adjustedKey===Key.leftArrow){var desiredIndex=currentItem.index-1;return desiredIndex=that._site.header?desiredIndex:Math.max(0,desiredIndex),{type:desiredIndex>-1?_UI.ObjectType.groupHeader:_UI.ObjectType.header,index:desiredIndex>-1?desiredIndex:0}}if(adjustedKey===Key.rightArrow){var desiredIndex=currentItem.index+1;return desiredIndex=that._site.header?desiredIndex:Math.min(that._groups.length-1,currentItem.index+1),{type:desiredIndex>=that._groups.length?_UI.ObjectType.header:_UI.ObjectType.groupHeader,index:desiredIndex>=that._groups.length?0:desiredIndex}}return currentItem}}else{var itemIndex=0;itemIndex=currentItem.type===_UI.ObjectType.groupHeader?that._groups[currentItem.index].startIndex:currentItem.type===_UI.ObjectType.header?0:that._groups[that._groups.length-1].count-1,currentItem={type:_UI.ObjectType.item,index:itemIndex}}switch(that._adjustedKeyForRTL(pressedKey)){case Key.upArrow:case Key.leftArrow:case Key.downArrow:case Key.rightArrow:return handleArrowKeys();default:return exports._LayoutCommon.prototype._getAdjacentForPageKeys.call(that,currentItem,pressedKey)}},hitTest:function(x,y){var result,sizes=this._sizes;x-=sizes.layoutOriginX,y-=sizes.layoutOriginY;var groupIndex=this._groupFromOffset(this._horizontal?x:y),group=this._groups[groupIndex];return this._horizontal?x-=group.offset:y-=group.offset,this._groupsEnabled&&(this._groupHeaderPosition===HeaderPosition.left?x-=sizes.headerContainerWidth:y-=sizes.headerContainerHeight),result=group.hitTest(x,y),result.index+=group.startIndex,result.insertAfterIndex+=group.startIndex,result},setupAnimations:function(){if(0===this._groups.length)return void this._resetAnimationCaches();if(!Object.keys(this._cachedItemRecords).length){this._site._writeProfilerMark("Animation:setupAnimations,StartTM");for(var realizationRange=this._getRealizationRange(),tree=this._site.tree,itemIndex=0,horizontal="horizontal"===this.orientation,i=0,treeLength=tree.length;i<treeLength;i++){var groupBundle=tree[i],groupHasAtleastOneItemRealized=!1,group=this._groups[i],groupIsCellSpanning=group instanceof Groups.CellSpanningGroup,groupOffset=group?group.offset:0;if(forEachContainer(groupBundle.itemsContainer,function(container,j){if(realizationRange.firstIndex<=itemIndex&&realizationRange.lastIndex>=itemIndex&&(groupHasAtleastOneItemRealized=!0,!this._cachedItemRecords[itemIndex])){var itemPosition=this._getItemPositionForAnimations(itemIndex,i,j),row=itemPosition.row,column=itemPosition.column,left=itemPosition.left,top=itemPosition.top;this._cachedItemRecords[itemIndex]={oldRow:row,oldColumn:column,oldLeft:left,oldTop:top,width:itemPosition.width,height:itemPosition.height,element:container,inCellSpanningGroup:groupIsCellSpanning}}itemIndex++}.bind(this)),groupHasAtleastOneItemRealized){var groupIndex=i;if(!this._cachedHeaderRecords[groupIndex]){var headerPosition=this._getHeaderPositionForAnimations(groupIndex);this._cachedHeaderRecords[groupIndex]={oldLeft:headerPosition.left,oldTop:headerPosition.top,width:headerPosition.width,height:headerPosition.height,element:groupBundle.header}}this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)]||(this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)]={oldLeft:horizontal?groupOffset:0,left:horizontal?groupOffset:0,oldTop:horizontal?0:groupOffset,top:horizontal?0:groupOffset,element:groupBundle.itemsContainer.element})}}this._site._writeProfilerMark("Animation:setupAnimations,StopTM")}},_layoutAnimations:function(modifiedItems,modifiedGroups){if(Object.keys(this._cachedItemRecords).length||Object.keys(this._cachedGroupRecords).length||Object.keys(this._cachedHeaderRecords).length){this._site._writeProfilerMark("Animation:layoutAnimation,StartTM"),this._updateAnimationCache(modifiedItems,modifiedGroups);for(var realizationRange=this._getRealizationRange(),tree=this._site.tree,itemIndex=0,horizontal="horizontal"===this.orientation,i=0,treeLength=tree.length;i<treeLength;i++){var groupBundle=tree[i],group=this._groups[i],groupIsCellSpanning=group instanceof Groups.CellSpanningGroup,groupOffset=group?group.offset:0,groupMovementX=0,groupMovementY=0,cachedGroupRecord=this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)];cachedGroupRecord&&(horizontal?groupMovementX=cachedGroupRecord.oldLeft-groupOffset:groupMovementY=cachedGroupRecord.oldTop-groupOffset),forEachContainer(groupBundle.itemsContainer,function(container,j){if(realizationRange.firstIndex<=itemIndex&&realizationRange.lastIndex>=itemIndex){var cachedItemRecord=this._cachedItemRecords[itemIndex];if(cachedItemRecord){var itemPosition=this._getItemPositionForAnimations(itemIndex,i,j),row=itemPosition.row,column=itemPosition.column,left=itemPosition.left,top=itemPosition.top;if(cachedItemRecord.inCellSpanningGroup=cachedItemRecord.inCellSpanningGroup||groupIsCellSpanning,cachedItemRecord.oldRow!==row||cachedItemRecord.oldColumn!==column||cachedItemRecord.oldTop!==top||cachedItemRecord.oldLeft!==left){cachedItemRecord.row=row,cachedItemRecord.column=column,cachedItemRecord.left=left,cachedItemRecord.top=top;var xOffset=cachedItemRecord.oldLeft-cachedItemRecord.left-groupMovementX,yOffset=cachedItemRecord.oldTop-cachedItemRecord.top-groupMovementY;if(xOffset=(this._site.rtl?-1:1)*xOffset,cachedItemRecord.xOffset=xOffset,cachedItemRecord.yOffset=yOffset,0!==xOffset||0!==yOffset){var element=cachedItemRecord.element;cachedItemRecord.needsToResetTransform=!0,element.style[transitionScriptName]="",element.style[transformNames.scriptName]="translate("+xOffset+"px,"+yOffset+"px)"}var itemsBlock=container.parentNode;_ElementUtilities.hasClass(itemsBlock,_Constants._itemsBlockClass)&&(this._animatingItemsBlocks[uniqueID(itemsBlock)]=itemsBlock)}}else this._cachedInsertedItemRecords[itemIndex]=container,container.style[transitionScriptName]="",container.style.opacity=0}itemIndex++}.bind(this));var groupIndex=i,cachedHeader=this._cachedHeaderRecords[groupIndex];if(cachedHeader){var headerPosition=this._getHeaderPositionForAnimations(groupIndex);if(cachedHeader.height=headerPosition.height,cachedHeader.width=headerPosition.width,cachedHeader.oldLeft!==headerPosition.left||cachedHeader.oldTop!==headerPosition.top){cachedHeader.left=headerPosition.left,cachedHeader.top=headerPosition.top;var xOffset=cachedHeader.oldLeft-cachedHeader.left,yOffset=cachedHeader.oldTop-cachedHeader.top;if(xOffset=(this._site.rtl?-1:1)*xOffset,0!==xOffset||0!==yOffset){cachedHeader.needsToResetTransform=!0;var headerContainer=cachedHeader.element;headerContainer.style[transitionScriptName]="",headerContainer.style[transformNames.scriptName]="translate("+xOffset+"px,"+yOffset+"px)"}}}if(cachedGroupRecord&&(horizontal&&cachedGroupRecord.left!==groupOffset||!horizontal&&cachedGroupRecord.top!==groupOffset)){var element=cachedGroupRecord.element;if(0===groupMovementX&&0===groupMovementY)cachedGroupRecord.needsToResetTransform&&(cachedGroupRecord.needsToResetTransform=!1,element.style[transformNames.scriptName]="");else{var groupOffsetX=(this._site.rtl?-1:1)*groupMovementX,groupOffsetY=groupMovementY;cachedGroupRecord.needsToResetTransform=!0,element.style[transitionScriptName]="",element.style[transformNames.scriptName]="translate("+groupOffsetX+"px, "+groupOffsetY+"px)"}}}if(this._inListMode||1===this._itemsPerBar)for(var itemsBlockKeys=Object.keys(this._animatingItemsBlocks),b=0,blockKeys=itemsBlockKeys.length;b<blockKeys;b++)this._animatingItemsBlocks[itemsBlockKeys[b]].style.overflow="visible";this._site._writeProfilerMark("Animation:layoutAnimation,StopTM")}},executeAnimations:function(){function startAnimations(){if(removePhase(),hasMultisizeMove)cellSpanningFadeOutMove();else{if(that._itemsPerBar>1)for(var maxDistance=that._itemsPerBar*that._sizes.containerCrossSize+that._getHeaderSizeContentAdjustment()+that._sizes.containerMargins[horizontal?"top":site.rtl?"right":"left"]+(horizontal?that._sizes.layoutOriginY:that._sizes.layoutOriginX),i=0,len=itemMoveRecords.length;i<len;i++){var cachedItemRecord=itemMoveRecords[i];cachedItemRecord[oldReflowLayoutProperty]>cachedItemRecord[reflowLayoutProperty]?(upOutDist=Math.max(upOutDist,cachedItemRecord[oldReflowLayoutPosition]+cachedItemRecord[horizontal?"height":"width"]),upInDist=Math.max(upInDist,maxDistance-cachedItemRecord[reflowLayoutPosition]),hasReflow=!0,reflowItemRecords.push(cachedItemRecord)):cachedItemRecord[oldReflowLayoutProperty]<cachedItemRecord[reflowLayoutProperty]&&(downOutDist=Math.max(downOutDist,maxDistance-cachedItemRecord[oldReflowLayoutPosition]),downInDist=Math.max(downInDist,cachedItemRecord[reflowLayoutPosition]+cachedItemRecord[horizontal?"height":"width"]),reflowItemRecords.push(cachedItemRecord),hasReflow=!0)}site.rtl&&!horizontal&&(upOutDist*=-1,upInDist*=-1,downOutDist*=-1,downInDist*=-1),hasReflow?reflowPhase(that._itemsPerBar):directMovePhase()}}function waitForNextPhase(nextPhaseCallback){currentAnimationPromise=Promise.join(pendingTransitionPromises),currentAnimationPromise.done(function(){pendingTransitionPromises=[],animationSignal&&(exports.Layout._debugAnimations?_BaseUtils._requestAnimationFrame(function(){nextPhaseCallback()}):nextPhaseCallback())})}function removePhase(){if(removedElements.length){site._writeProfilerMark("Animation:setupRemoveAnimation,StartTM"),moveDelay+=60,addDelay+=60;var removeDuration=120;slowAnimations&&(removeDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(removedElements,[{property:"opacity",delay:removeDelay,duration:removeDuration,timing:"linear",to:0,skipStylesReset:!0}])),site._writeProfilerMark("Animation:setupRemoveAnimation,StopTM")}}function cellSpanningFadeOutMove(){site._writeProfilerMark("Animation:cellSpanningFadeOutMove,StartTM");for(var moveElements=[],i=0,len=itemMoveRecords.length;i<len;i++){var cachedItemRecord=itemMoveRecords[i],container=cachedItemRecord.element;moveElements.push(container)}for(var i=0,len=moveRecords.length;i<len;i++){var cachedItemRecord=moveRecords[i],container=cachedItemRecord.element;moveElements.push(container)}var fadeOutDuration=120;slowAnimations&&(fadeOutDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(moveElements,{property:"opacity",delay:removeDelay,duration:fadeOutDuration,timing:"linear",to:0})),waitForNextPhase(cellSpanningFadeInMove),site._writeProfilerMark("Animation:cellSpanningFadeOutMove,StopTM")}function cellSpanningFadeInMove(){site._writeProfilerMark("Animation:cellSpanningFadeInMove,StartTM"),addDelay=0;for(var moveElements=[],i=0,len=itemMoveRecords.length;i<len;i++){var cachedItemRecord=itemMoveRecords[i],container=cachedItemRecord.element;container.style[transformNames.scriptName]="",moveElements.push(container)}for(var i=0,len=moveRecords.length;i<len;i++){var cachedItemRecord=moveRecords[i],container=cachedItemRecord.element;container.style[transformNames.scriptName]="",moveElements.push(container)}var fadeInDuration=120;slowAnimations&&(fadeInDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(moveElements,{property:"opacity",delay:addDelay,duration:fadeInDuration,timing:"linear",to:1})),site._writeProfilerMark("Animation:cellSpanningFadeInMove,StopTM"),addPhase()}function reflowPhase(itemsPerBar){site._writeProfilerMark("Animation:setupReflowAnimation,StartTM");for(var itemContainersLastBarIndices={},i=0,len=reflowItemRecords.length;i<len;i++){var reflowItemRecord=reflowItemRecords[i],xOffset=reflowItemRecord.xOffset,yOffset=reflowItemRecord.yOffset;reflowItemRecord[oldReflowLayoutProperty]>reflowItemRecord[reflowLayoutProperty]?horizontal?yOffset-=upOutDist:xOffset-=upOutDist:reflowItemRecord[oldReflowLayoutProperty]<reflowItemRecord[reflowLayoutProperty]&&(horizontal?yOffset+=downOutDist:xOffset+=downOutDist);var container=reflowItemRecord.element;minOffset=Math.min(minOffset,horizontal?xOffset:yOffset),maxOffset=Math.max(maxOffset,horizontal?xOffset:yOffset);var itemsContainer=container.parentNode;_ElementUtilities.hasClass(itemsContainer,"win-itemscontainer")||(itemsContainer=itemsContainer.parentNode);var lastBarIndex=itemContainersLastBarIndices[uniqueID(itemsContainer)];if(!lastBarIndex){var count=getItemsContainerLength(getItemsContainerTree(itemsContainer,site.tree));itemContainersLastBarIndices[uniqueID(itemsContainer)]=lastBarIndex=Math.ceil(count/itemsPerBar)-1}reflowItemRecords[i][horizontal?"column":"row"]===lastBarIndex&&(itemContainersToExpand[uniqueID(itemsContainer)]=itemsContainer);var reflowDuration=80;slowAnimations&&(reflowDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(container,{property:transformNames.cssName,delay:moveDelay,duration:reflowDuration,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:"translate("+xOffset+"px,"+yOffset+"px)"}))}for(var itemContainerKeys=Object.keys(itemContainersToExpand),i=0,len=itemContainerKeys.length;i<len;i++){var itemContainer=itemContainersToExpand[itemContainerKeys[i]];site.rtl&&horizontal?(itemContainer.style.paddingLeft=-1*minOffset+"px",itemContainer.style.marginLeft=minOffset+"px"):(itemContainer.style[horizontal?"paddingRight":"paddingBottom"]=maxOffset+"px",itemContainer.style[horizontal?"marginRight":"marginBottom"]="-"+maxOffset+"px")}for(var itemsBlockKeys=Object.keys(animatingItemsBlocks),i=0,len=itemsBlockKeys.length;i<len;i++)animatingItemsBlocks[itemsBlockKeys[i]].classList.add(_Constants._clipClass);waitForNextPhase(afterReflowPhase),site._writeProfilerMark("Animation:setupReflowAnimation,StopTM")}function cleanupItemsContainers(){for(var itemContainerKeys=Object.keys(itemContainersToExpand),i=0,len=itemContainerKeys.length;i<len;i++){var itemContainer=itemContainersToExpand[itemContainerKeys[i]];site.rtl&&horizontal?(itemContainer.style.paddingLeft="",itemContainer.style.marginLeft=""):(itemContainer.style[horizontal?"paddingRight":"paddingBottom"]="",itemContainer.style[horizontal?"marginRight":"marginBottom"]="")}itemContainersToExpand={};for(var itemsBlockKeys=Object.keys(animatingItemsBlocks),i=0,len=itemsBlockKeys.length;i<len;i++){var itemsBlock=animatingItemsBlocks[itemsBlockKeys[i]];itemsBlock.style.overflow="",itemsBlock.classList.remove(_Constants._clipClass)}}function afterReflowPhase(){site._writeProfilerMark("Animation:prepareReflowedItems,StartTM");for(var i=0,len=reflowItemRecords.length;i<len;i++){var reflowItemRecord=reflowItemRecords[i],xOffset=0,yOffset=0;reflowItemRecord[oldReflowLayoutProperty]>reflowItemRecord[reflowLayoutProperty]?horizontal?yOffset=upInDist:xOffset=upInDist:reflowItemRecord[oldReflowLayoutProperty]<reflowItemRecord[reflowLayoutProperty]&&(horizontal?yOffset=-1*downInDist:xOffset=-1*downInDist),reflowItemRecord.element.style[transitionScriptName]="",
reflowItemRecord.element.style[transformNames.scriptName]="translate("+xOffset+"px,"+yOffset+"px)"}site._writeProfilerMark("Animation:prepareReflowedItems,StopTM"),exports.Layout._debugAnimations?_BaseUtils._requestAnimationFrame(function(){directMovePhase(!0)}):directMovePhase(!0)}function directMovePhase(fastMode){var duration=200;if(fastMode&&(duration=150,moveDelay=0,addDelay=0),slowAnimations&&(duration*=10),itemMoveRecords.length>0||moveRecords.length>0){site._writeProfilerMark("Animation:setupMoveAnimation,StartTM");for(var moveElements=[],i=0,len=moveRecords.length;i<len;i++){var container=moveRecords[i].element;moveElements.push(container)}for(var i=0,len=itemMoveRecords.length;i<len;i++){var container=itemMoveRecords[i].element;moveElements.push(container)}pendingTransitionPromises.push(_TransitionAnimation.executeTransition(moveElements,{property:transformNames.cssName,delay:moveDelay,duration:duration,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",to:""})),addDelay+=80,site._writeProfilerMark("Animation:setupMoveAnimation,StopTM")}addPhase()}function addPhase(){if(insertedElements.length>0){site._writeProfilerMark("Animation:setupInsertAnimation,StartTM");var addDuration=120;slowAnimations&&(addDuration*=10),pendingTransitionPromises.push(_TransitionAnimation.executeTransition(insertedElements,[{property:"opacity",delay:addDelay,duration:addDuration,timing:"linear",to:1}])),site._writeProfilerMark("Animation:setupInsertAnimation,StopTM")}waitForNextPhase(completePhase)}function completePhase(){site._writeProfilerMark("Animation:cleanupAnimations,StartTM"),cleanupItemsContainers();for(var i=0,len=removedElements.length;i<len;i++){var container=removedElements[i];container.parentNode&&(_Dispose._disposeElement(container),container.parentNode.removeChild(container))}site._writeProfilerMark("Animation:cleanupAnimations,StopTM"),that._animationsRunning=null,animationSignal.complete()}var animationSignal=new _Signal;if(this._filterInsertedElements(),this._filterMovedElements(),this._filterRemovedElements(),0===this._insertedElements.length&&0===this._removedElements.length&&0===this._itemMoveRecords.length&&0===this._moveRecords.length)return this._resetAnimationCaches(!0),animationSignal.complete(),animationSignal.promise;this._animationsRunning=animationSignal.promise;for(var slowAnimations=exports.Layout._debugAnimations||exports.Layout._slowAnimations,site=this._site,insertedElements=this._insertedElements,removedElements=this._removedElements,itemMoveRecords=this._itemMoveRecords,moveRecords=this._moveRecords,removeDelay=0,moveDelay=0,addDelay=0,currentAnimationPromise=null,pendingTransitionPromises=[],hasMultisizeMove=!1,hasReflow=!1,minOffset=0,maxOffset=0,itemContainersToExpand={},upOutDist=0,downOutDist=0,upInDist=0,downInDist=0,reflowItemRecords=[],horizontal="horizontal"===this.orientation,oldReflowLayoutProperty=horizontal?"oldColumn":"oldRow",reflowLayoutProperty=horizontal?"column":"row",oldReflowLayoutPosition=horizontal?"oldTop":"oldLeft",reflowLayoutPosition=horizontal?"top":"left",animatingItemsBlocks=this._animatingItemsBlocks,i=0,len=itemMoveRecords.length;i<len;i++){var cachedItemRecord=itemMoveRecords[i];if(cachedItemRecord.inCellSpanningGroup){hasMultisizeMove=!0;break}}var that=this;return exports.Layout._debugAnimations?_BaseUtils._requestAnimationFrame(function(){startAnimations()}):startAnimations(),this._resetAnimationCaches(!0),animationSignal.promise.then(null,function(){cleanupItemsContainers();for(var i=0,len=moveRecords.length;i<len;i++){var container=moveRecords[i].element;container.style[transformNames.scriptName]="",container.style.opacity=1}for(var i=0,len=itemMoveRecords.length;i<len;i++){var container=itemMoveRecords[i].element;container.style[transformNames.scriptName]="",container.style.opacity=1}for(var i=0,len=insertedElements.length;i<len;i++)insertedElements[i].style.opacity=1;for(var i=0,len=removedElements.length;i<len;i++){var container=removedElements[i];container.parentNode&&(_Dispose._disposeElement(container),container.parentNode.removeChild(container))}this._animationsRunning=null,animationSignal=null,currentAnimationPromise&&currentAnimationPromise.cancel()}.bind(this)),animationSignal.promise},dragOver:function(x,y,dragInfo){var indicesAffected=this.hitTest(x,y),groupAffected=this._groups?this._site.groupIndexFromItemIndex(indicesAffected.index):0,itemsContainer=this._site.tree[groupAffected].itemsContainer,itemsCount=getItemsContainerLength(itemsContainer),indexOffset=this._groups?this._groups[groupAffected].startIndex:0,visibleRange=this._getVisibleRange();indicesAffected.index-=indexOffset,indicesAffected.insertAfterIndex-=indexOffset,visibleRange.firstIndex=Math.max(visibleRange.firstIndex-indexOffset-1,0),visibleRange.lastIndex=Math.min(visibleRange.lastIndex-indexOffset+1,itemsCount);var indexAfter=Math.max(Math.min(itemsCount-1,indicesAffected.insertAfterIndex),-1),indexBefore=Math.min(indexAfter+1,itemsCount);if(dragInfo){for(var i=indexAfter;i>=visibleRange.firstIndex;i--){if(!dragInfo._isIncluded(i+indexOffset)){indexAfter=i;break}i===visibleRange.firstIndex&&(indexAfter=-1)}for(var i=indexBefore;i<visibleRange.lastIndex;i++){if(!dragInfo._isIncluded(i+indexOffset)){indexBefore=i;break}i===visibleRange.lastIndex-1&&(indexBefore=itemsCount)}}var elementBefore=containerFromIndex(itemsContainer,indexBefore),elementAfter=containerFromIndex(itemsContainer,indexAfter);if(this._animatedDragItems)for(var i=0,len=this._animatedDragItems.length;i<len;i++){var item=this._animatedDragItems[i];item&&(item.style[transitionScriptName]=this._site.animationsDisabled?"":dragBetweenTransition,item.style[transformNames.scriptName]="")}this._animatedDragItems=[];var horizontal="horizontal"===this.orientation,inListMode=this._inListMode||1===this._itemsPerBar;this._groups&&this._groups[groupAffected]instanceof Groups.CellSpanningGroup&&(inListMode=1===this._groups[groupAffected]._slotsPerColumn);var horizontalTransform=0,verticalTransform=0;!horizontal&&!inListMode||horizontal&&inListMode?horizontalTransform=this._site.rtl?-dragBetweenDistance:dragBetweenDistance:verticalTransform=dragBetweenDistance,elementBefore&&(elementBefore.style[transitionScriptName]=this._site.animationsDisabled?"":dragBetweenTransition,elementBefore.style[transformNames.scriptName]="translate("+horizontalTransform+"px, "+verticalTransform+"px)",this._animatedDragItems.push(elementBefore)),elementAfter&&(elementAfter.style[transitionScriptName]=this._site.animationsDisabled?"":dragBetweenTransition,elementAfter.style[transformNames.scriptName]="translate("+-horizontalTransform+"px, -"+verticalTransform+"px)",this._animatedDragItems.push(elementAfter))},dragLeave:function(){if(this._animatedDragItems)for(var i=0,len=this._animatedDragItems.length;i<len;i++)this._animatedDragItems[i].style[transitionScriptName]=this._site.animationsDisabled?"":dragBetweenTransition,this._animatedDragItems[i].style[transformNames.scriptName]="";this._animatedDragItems=[]},_setMaxRowsOrColumns:function(value){value===this._maxRowsOrColumns||this._inListMode||(this._sizes&&this._sizes.containerSizeLoaded&&(this._itemsPerBar=Math.floor(this._sizes.maxItemsContainerContentSize/this._sizes.containerCrossSize),value&&(this._itemsPerBar=Math.min(this._itemsPerBar,value)),this._itemsPerBar=Math.max(1,this._itemsPerBar)),this._maxRowsOrColumns=value,this._invalidateLayout())},_getItemPosition:function(itemIndex){if(this._groupsEnabled){var groupIndex=Math.min(this._groups.length-1,this._site.groupIndexFromItemIndex(itemIndex)),group=this._groups[groupIndex],itemOfGroupIndex=itemIndex-group.startIndex;return this._getItemPositionForAnimations(itemIndex,groupIndex,itemOfGroupIndex)}return this._getItemPositionForAnimations(itemIndex,0,itemIndex)},_getRealizationRange:function(){var realizedRange=this._site.realizedRange;return{firstIndex:this._firstItemFromRange(realizedRange.firstPixel),lastIndex:this._lastItemFromRange(realizedRange.lastPixel)}},_getVisibleRange:function(){var visibleRange=this._site.visibleRange;return{firstIndex:this._firstItemFromRange(visibleRange.firstPixel),lastIndex:this._lastItemFromRange(visibleRange.lastPixel)}},_resetAnimationCaches:function(skipReset){if(!skipReset){this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords),this._resetStylesForRemovedRecords(this._cachedRemovedItems),this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);for(var itemsBlockKeys=Object.keys(this._animatingItemsBlocks),i=0,len=itemsBlockKeys.length;i<len;i++){var itemsBlock=this._animatingItemsBlocks[itemsBlockKeys[i]];itemsBlock.style.overflow="",itemsBlock.classList.remove(_Constants._clipClass)}}this._cachedGroupRecords={},this._cachedItemRecords={},this._cachedHeaderRecords={},this._cachedInsertedItemRecords={},this._cachedInsertedHeaderRecords={},this._cachedRemovedItems=[],this._cachedRemovedHeaders=[],this._animatingItemsBlocks={}},_cacheRemovedElements:function(modifiedElements,cachedRecords,cachedInsertedRecords,removedElements,areHeaders){var leftStr="left";this._site.rtl&&(leftStr="right");var outerX,outerY;areHeaders?(outerX=this._sizes.headerContainerOuterX,outerY=this._sizes.headerContainerOuterY):(outerX=this._sizes.containerMargins[leftStr],outerY=this._sizes.containerMargins.top);for(var i=0,len=modifiedElements.length;i<len;i++){var modifiedElementLookup=modifiedElements[i];if(modifiedElementLookup.newIndex===-1){var container=modifiedElementLookup.element,cachedItemRecord=cachedRecords[modifiedElementLookup.oldIndex];cachedItemRecord&&(cachedItemRecord.element=container,delete cachedRecords[modifiedElementLookup.oldIndex],container.style.position="absolute",container.style[transitionScriptName]="",container.style.top=cachedItemRecord.oldTop-outerY+"px",container.style[leftStr]=cachedItemRecord.oldLeft-outerX+"px",container.style.width=cachedItemRecord.width+"px",container.style.height=cachedItemRecord.height+"px",container.style[transformNames.scriptName]="",this._site.surface.appendChild(container),removedElements.push(cachedItemRecord)),cachedInsertedRecords[modifiedElementLookup.oldIndex]&&delete cachedInsertedRecords[modifiedElementLookup.oldIndex]}}},_cacheInsertedElements:function(modifiedElements,cachedInsertedRecords,cachedRecords){for(var newCachedInsertedRecords={},i=0,len=modifiedElements.length;i<len;i++){var modifiedElementLookup=modifiedElements[i],wasInserted=cachedInsertedRecords[modifiedElementLookup.oldIndex];if(wasInserted&&delete cachedInsertedRecords[modifiedElementLookup.oldIndex],wasInserted||modifiedElementLookup.oldIndex===-1||modifiedElementLookup.moved){var cachedRecord=cachedRecords[modifiedElementLookup.newIndex];cachedRecord&&delete cachedRecords[modifiedElementLookup.newIndex];var modifiedElement=modifiedElementLookup.element;newCachedInsertedRecords[modifiedElementLookup.newIndex]=modifiedElement,modifiedElement.style[transitionScriptName]="",modifiedElement.style[transformNames.scriptName]="",modifiedElement.style.opacity=0}}for(var keys=Object.keys(cachedInsertedRecords),i=0,len=keys.length;i<len;i++)newCachedInsertedRecords[keys[i]]=cachedInsertedRecords[keys[i]];return newCachedInsertedRecords},_resetStylesForRecords:function(recordsHash){for(var recordKeys=Object.keys(recordsHash),i=0,len=recordKeys.length;i<len;i++){var record=recordsHash[recordKeys[i]];record.needsToResetTransform&&(record.element.style[transformNames.scriptName]="",record.needsToResetTransform=!1)}},_resetStylesForInsertedRecords:function(insertedRecords){for(var insertedRecordKeys=Object.keys(insertedRecords),i=0,len=insertedRecordKeys.length;i<len;i++){var insertedElement=insertedRecords[insertedRecordKeys[i]];insertedElement.style.opacity=1}},_resetStylesForRemovedRecords:function(removedElements){for(var i=0,len=removedElements.length;i<len;i++){var container=removedElements[i].element;container.parentNode&&(_Dispose._disposeElement(container),container.parentNode.removeChild(container))}},_updateAnimationCache:function(modifiedItems,modifiedGroups){function updateIndicies(modifiedElements,cachedRecords){for(var updatedCachedRecords={},i=0,len=modifiedElements.length;i<len;i++){var modifiedElementLookup=modifiedElements[i],cachedRecord=cachedRecords[modifiedElementLookup.oldIndex];cachedRecord&&(updatedCachedRecords[modifiedElementLookup.newIndex]=cachedRecord,cachedRecord.element=modifiedElementLookup.element,delete cachedRecords[modifiedElementLookup.oldIndex])}for(var cachedRecordKeys=Object.keys(cachedRecords),i=0,len=cachedRecordKeys.length;i<len;i++){var key=cachedRecordKeys[i],record=cachedRecords[key];record.element&&!existingContainers[uniqueID(record.element)]||(updatedCachedRecords[key]=record)}return updatedCachedRecords}this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords),this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);for(var existingContainers={},realizationRange=this._getRealizationRange(),tree=this._site.tree,i=0,itemIndex=0,treeLength=tree.length;i<treeLength;i++)forEachContainer(tree[i].itemsContainer,function(container){realizationRange.firstIndex<=itemIndex&&realizationRange.lastIndex>=itemIndex&&(existingContainers[uniqueID(container)]=!0),itemIndex++});this._cachedItemRecords=updateIndicies(modifiedItems,this._cachedItemRecords),this._cachedHeaderRecords=updateIndicies(modifiedGroups,this._cachedHeaderRecords),this._cachedInsertedItemRecords=this._cacheInsertedElements(modifiedItems,this._cachedInsertedItemRecords,this._cachedItemRecords),this._cachedInsertedHeaderRecords=this._cacheInsertedElements(modifiedGroups,this._cachedInsertedHeaderRecords,this._cachedHeaderRecords)},_filterRemovedElements:function(){function filterRemovedElements(removedRecordArray,removedElementsArray){for(var i=0,len=removedRecordArray.length;i<len;i++){var removedItem=removedRecordArray[i],container=removedItem.element;removedItem[oldLeftStr]+removedItem[widthStr]-1<visibleFirstPixel||removedItem[oldLeftStr]>visibleLastPixel||!that._site.viewport.contains(container)?container.parentNode&&(_Dispose._disposeElement(container),container.parentNode.removeChild(container)):removedElementsArray.push(container)}}if(this._removedElements=[],this._site.animationsDisabled)return this._resetStylesForRemovedRecords(this._cachedRemovedItems),void this._resetStylesForRemovedRecords(this._cachedRemovedHeaders);var that=this,oldLeftStr="horizontal"===this.orientation?"oldLeft":"oldTop",widthStr="horizontal"===this.orientation?"width":"height",visibleFirstPixel=this._site.scrollbarPos,visibleLastPixel=visibleFirstPixel+this._site.viewportSize[widthStr]-1;filterRemovedElements(this._cachedRemovedItems,this._removedElements),filterRemovedElements(this._cachedRemovedHeaders,this._removedElements)},_filterInsertedElements:function(){function filterInsertedElements(cachedInsertedRecords,insertedElementsArray){for(var recordKeys=Object.keys(cachedInsertedRecords),i=0,len=recordKeys.length;i<len;i++){var itemIndex=recordKeys[i],insertedRecord=cachedInsertedRecords[itemIndex];itemIndex<visibleRange.firstIndex||itemIndex>visibleRange.lastIndex||that._site.viewport.contains(insertedRecord.element)?insertedRecord.style.opacity=1:insertedElementsArray.push(insertedRecord)}}if(this._insertedElements=[],this._site.animationsDisabled)return this._resetStylesForInsertedRecords(this._cachedInsertedItemRecords),void this._resetStylesForInsertedRecords(this._cachedInsertedHeaderRecords);var that=this,visibleRange=this._getVisibleRange();filterInsertedElements(this._cachedInsertedItemRecords,this._insertedElements),filterInsertedElements(this._cachedInsertedHeaderRecords,this._insertedElements)},_filterMovedElements:function(){var that=this,oldLeftStr="horizontal"===this.orientation?"oldLeft":"oldTop",leftStr="horizontal"===this.orientation?"left":"top",widthStr="horizontal"===this.orientation?"width":"height",realizationRange=this._getRealizationRange(),visibleFirstPixel=this._site.scrollbarPos,visibleLastPixel=visibleFirstPixel+this._site.viewportSize[widthStr]-1;if(this._itemMoveRecords=[],this._moveRecords=[],!this._site.animationsDisabled)for(var tree=this._site.tree,itemIndex=0,i=0,treeLength=tree.length;i<treeLength;i++){var groupBundle=tree[i],groupHasItemToAnimate=!1;forEachContainer(groupBundle.itemsContainer,function(){if(realizationRange.firstIndex<=itemIndex&&realizationRange.lastIndex>=itemIndex){var cachedItemRecord=this._cachedItemRecords[itemIndex];if(cachedItemRecord){var shouldAnimate=(cachedItemRecord[oldLeftStr]+cachedItemRecord[widthStr]-1>=visibleFirstPixel&&cachedItemRecord[oldLeftStr]<=visibleLastPixel||cachedItemRecord[leftStr]+cachedItemRecord[widthStr]-1>=visibleFirstPixel&&cachedItemRecord[leftStr]<=visibleLastPixel)&&that._site.viewport.contains(cachedItemRecord.element);shouldAnimate&&(groupHasItemToAnimate=!0,cachedItemRecord.needsToResetTransform&&(this._itemMoveRecords.push(cachedItemRecord),delete this._cachedItemRecords[itemIndex]))}}itemIndex++}.bind(this));var groupIndex=i,cachedHeaderRecord=this._cachedHeaderRecords[groupIndex];cachedHeaderRecord&&groupHasItemToAnimate&&cachedHeaderRecord.needsToResetTransform&&(this._moveRecords.push(cachedHeaderRecord),delete this._cachedHeaderRecords[groupIndex]);var cachedGroupRecord=this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)];cachedGroupRecord&&groupHasItemToAnimate&&cachedGroupRecord.needsToResetTransform&&(this._moveRecords.push(cachedGroupRecord),delete this._cachedGroupRecords[uniqueID(groupBundle.itemsContainer.element)])}this._resetStylesForRecords(this._cachedGroupRecords),this._resetStylesForRecords(this._cachedItemRecords),this._resetStylesForRecords(this._cachedHeaderRecords)},_getItemPositionForAnimations:function(itemIndex,groupIndex,itemOfGroupIndex){var group=this._groups[groupIndex],itemPosition=group.getItemPositionForAnimations(itemOfGroupIndex),groupOffset=this._groups[groupIndex]?this._groups[groupIndex].offset:0,headerWidth=this._groupsEnabled&&this._groupHeaderPosition===HeaderPosition.left?this._sizes.headerContainerWidth:0,headerHeight=this._groupsEnabled&&this._groupHeaderPosition===HeaderPosition.top?this._sizes.headerContainerHeight:0;return itemPosition.left+=this._sizes.layoutOriginX+headerWidth+this._sizes.itemsContainerOuterX,itemPosition.top+=this._sizes.layoutOriginY+headerHeight+this._sizes.itemsContainerOuterY,itemPosition[this._horizontal?"left":"top"]+=groupOffset,itemPosition},_getHeaderPositionForAnimations:function(groupIndex){var headerPosition;if(this._groupsEnabled){var width=this._sizes.headerContainerWidth-this._sizes.headerContainerOuterWidth,height=this._sizes.headerContainerHeight-this._sizes.headerContainerOuterHeight;this._groupHeaderPosition!==HeaderPosition.left||this._horizontal?this._groupHeaderPosition===HeaderPosition.top&&this._horizontal&&(width=this._groups[groupIndex].getItemsContainerSize()-this._sizes.headerContainerOuterWidth):height=this._groups[groupIndex].getItemsContainerSize()-this._sizes.headerContainerOuterHeight;var offsetX=this._horizontal?this._groups[groupIndex].offset:0,offsetY=this._horizontal?0:this._groups[groupIndex].offset;headerPosition={top:this._sizes.layoutOriginY+offsetY+this._sizes.headerContainerOuterY,left:this._sizes.layoutOriginX+offsetX+this._sizes.headerContainerOuterX,height:height,width:width}}else headerPosition={top:0,left:0,height:0,width:0};return headerPosition},_rangeContainsItems:function(firstPixel,lastPixel){if(0===this._groups.length)return!1;var lastGroup=this._groups[this._groups.length-1],lastPixelOfLayout=this._sizes.layoutOrigin+lastGroup.offset+this._getGroupSize(lastGroup)-1;return lastPixel>=0&&firstPixel<=lastPixelOfLayout},_itemFromOffset:function(offset,options){function assignItemMargins(offset){if(!options.wholeItem){var marginPropLast=that._horizontal?that._site.rtl?"right":"left":"top",marginPropFirst=that._horizontal?that._site.rtl?"left":"right":"bottom";return options.last?offset-that._sizes.containerMargins[marginPropLast]:offset+that._sizes.containerMargins[marginPropFirst]}return offset}function assignGroupMarginsAndHeaders(offset){return options.last?offset-that._getHeaderSizeGroupAdjustment()-that._sizes.itemsContainerOuterStart:offset}var that=this;if(0===this._groups.length)return 0;options=options||{},offset-=this._sizes.layoutOrigin,offset=assignItemMargins(offset);var groupIndex=this._groupFromOffset(assignGroupMarginsAndHeaders(offset)),group=this._groups[groupIndex];return offset-=group.offset,offset-=this._getHeaderSizeGroupAdjustment(),group.startIndex+group.itemFromOffset(offset,options)},_firstItemFromRange:function(firstPixel,options){return options=options||{},options.last=0,this._itemFromOffset(firstPixel,options)},_lastItemFromRange:function(lastPixel,options){return options=options||{},options.last=1,this._itemFromOffset(lastPixel,options)},_adjustedKeyForRTL:function(key){return this._site.rtl&&(key===Key.leftArrow?key=Key.rightArrow:key===Key.rightArrow&&(key=Key.leftArrow)),key},_adjustedKeyForOrientationAndBars:function(key,cellSpanningGroup){var newKey=key;if(cellSpanningGroup)return key;if(!this._horizontal)switch(newKey){case Key.leftArrow:newKey=Key.upArrow;break;case Key.rightArrow:newKey=Key.downArrow;break;case Key.upArrow:newKey=Key.leftArrow;break;case Key.downArrow:newKey=Key.rightArrow}return 1===this._itemsPerBar&&(newKey===Key.upArrow?newKey=Key.leftArrow:newKey===Key.downArrow&&(newKey=Key.rightArrow)),newKey},_getAdjacentForPageKeys:function(currentItem,pressedKey){var newFocus,containerMargins=this._sizes.containerMargins,marginSum="horizontal"===this.orientation?containerMargins.left+containerMargins.right:containerMargins.top+containerMargins.bottom,viewportLength=this._site.viewportSize["horizontal"===this.orientation?"width":"height"],firstPixel=this._site.scrollbarPos,lastPixel=firstPixel+viewportLength-1-containerMargins["horizontal"===this.orientation?"right":"bottom"],firstIndex=this._firstItemFromRange(firstPixel,{wholeItem:!0}),lastIndex=this._lastItemFromRange(lastPixel,{wholeItem:!1}),currentItemPosition=this._getItemPosition(currentItem.index),offscreen=!1;if((currentItem.index<firstIndex||currentItem.index>lastIndex)&&(offscreen=!0,firstPixel="horizontal"===this.orientation?currentItemPosition.left-marginSum:currentItemPosition.top-marginSum,lastPixel=firstPixel+viewportLength-1,firstIndex=this._firstItemFromRange(firstPixel,{wholeItem:!0}),lastIndex=this._lastItemFromRange(lastPixel,{wholeItem:!1})),pressedKey===Key.pageUp){if(!offscreen&&firstIndex!==currentItem.index)return{type:_UI.ObjectType.item,index:firstIndex};var end;end="horizontal"===this.orientation?currentItemPosition.left+currentItemPosition.width+marginSum+containerMargins.left:currentItemPosition.top+currentItemPosition.height+marginSum+containerMargins.bottom;var firstIndexOnPrevPage=this._firstItemFromRange(end-viewportLength,{wholeItem:!0});newFocus=currentItem.index===firstIndexOnPrevPage?Math.max(0,currentItem.index-this._itemsPerBar):firstIndexOnPrevPage}else{if(!offscreen&&lastIndex!==currentItem.index)return{type:_UI.ObjectType.item,index:lastIndex};var start;start="horizontal"===this.orientation?currentItemPosition.left-marginSum-containerMargins.right:currentItemPosition.top-marginSum-containerMargins.bottom;var lastIndexOnNextPage=Math.max(0,this._lastItemFromRange(start+viewportLength-1,{wholeItem:!0}));newFocus=currentItem.index===lastIndexOnNextPage?currentItem.index+this._itemsPerBar:lastIndexOnNextPage}return{type:_UI.ObjectType.item,index:newFocus}},_isCellSpanning:function(groupIndex){var group=this._site.groupFromIndex(groupIndex),groupInfo=this._groupInfo;return!!groupInfo&&!!("function"==typeof groupInfo?groupInfo(group):groupInfo).enableCellSpanning},_getGroupInfo:function(groupIndex){var group=this._site.groupFromIndex(groupIndex),groupInfo=this._groupInfo,margins=this._sizes.containerMargins,adjustedInfo={enableCellSpanning:!1};if(groupInfo="function"==typeof groupInfo?groupInfo(group):groupInfo){if(groupInfo.enableCellSpanning&&(+groupInfo.cellWidth!==groupInfo.cellWidth||+groupInfo.cellHeight!==groupInfo.cellHeight))throw new _ErrorFromName("WinJS.UI.GridLayout.GroupInfoResultIsInvalid",strings.groupInfoResultIsInvalid);adjustedInfo={enableCellSpanning:!!groupInfo.enableCellSpanning,cellWidth:groupInfo.cellWidth+margins.left+margins.right,cellHeight:groupInfo.cellHeight+margins.top+margins.bottom}}return adjustedInfo},_getItemInfo:function(itemIndex){var result;if(this._itemInfo&&"function"==typeof this._itemInfo)result=this._itemInfo(itemIndex);else{if(!this._useDefaultItemInfo)throw new _ErrorFromName("WinJS.UI.GridLayout.ItemInfoIsInvalid",strings.itemInfoIsInvalid);result=this._defaultItemInfo(itemIndex)}return Promise.as(result).then(function(size){if(!size||+size.width!==size.width||+size.height!==size.height)throw new _ErrorFromName("WinJS.UI.GridLayout.ItemInfoIsInvalid",strings.itemInfoIsInvalid);return size})},_defaultItemInfo:function(itemIndex){var that=this;return this._site.renderItem(this._site.itemFromIndex(itemIndex)).then(function(element){return that._elementsToMeasure[itemIndex]={element:element},that._measureElements()}).then(function(){var entry=that._elementsToMeasure[itemIndex],size={width:entry.width,height:entry.height};return delete that._elementsToMeasure[itemIndex],size},function(error){return delete that._elementsToMeasure[itemIndex],Promise.wrapError(error)})},_getGroupSize:function(group){var headerContainerMinSize=0;return this._groupsEnabled&&(this._horizontal&&this._groupHeaderPosition===HeaderPosition.top?headerContainerMinSize=this._sizes.headerContainerMinWidth:this._horizontal||this._groupHeaderPosition!==HeaderPosition.left||(headerContainerMinSize=this._sizes.headerContainerMinHeight)),Math.max(headerContainerMinSize,group.getItemsContainerSize()+this._getHeaderSizeGroupAdjustment())},_groupFromOffset:function(offset){return offset<this._groups[0].offset?0:this._groupFrom(function(group){return offset<group.offset})},_groupFromImpl:function(fromGroup,toGroup,comp){if(toGroup<fromGroup)return null;var center=fromGroup+Math.floor((toGroup-fromGroup)/2),centerGroup=this._groups[center];return comp(centerGroup,center)?this._groupFromImpl(fromGroup,center-1,comp):center<toGroup&&!comp(this._groups[center+1],center+1)?this._groupFromImpl(center+1,toGroup,comp):center},_groupFrom:function(comp){if(this._groups.length>0){var lastGroupIndex=this._groups.length-1,lastGroup=this._groups[lastGroupIndex];return comp(lastGroup,lastGroupIndex)?this._groupFromImpl(0,this._groups.length-1,comp):lastGroupIndex}return null},_invalidateLayout:function(){this._site&&this._site.invalidateLayout()},_resetMeasurements:function(){this._measuringPromise&&(this._measuringPromise.cancel(),this._measuringPromise=null),this._containerSizeClassName&&(_ElementUtilities.removeClass(this._site.surface,this._containerSizeClassName),deleteDynamicCssRule(this._containerSizeClassName),this._containerSizeClassName=null),this._sizes=null,this._resetAnimationCaches()},_measureElements:function(){if(!this._measuringElements){var that=this;that._measuringElements=Scheduler.schedulePromiseHigh(null,"WinJS.UI.GridLayout._measuringElements").then(function(){that._site._writeProfilerMark("_measureElements,StartTM");var surface=that._createMeasuringSurface(),itemsContainer=_Global.document.createElement("div"),site=that._site,measuringElements=that._measuringElements,elementsToMeasure=that._elementsToMeasure,stopMeasuring=!1;itemsContainer.className=_Constants._itemsContainerClass+" "+_Constants._laidOutClass,itemsContainer.style.cssText+=";display: -ms-grid;-ms-grid-column: 1;-ms-grid-row: 1";var len,i,keys=Object.keys(elementsToMeasure);for(i=0,len=keys.length;i<len;i++){var element=elementsToMeasure[keys[i]].element;element.style["-ms-grid-column"]=i+1,element.style["-ms-grid-row"]=i+1,itemsContainer.appendChild(element)}for(surface.appendChild(itemsContainer),site.viewport.insertBefore(surface,site.viewport.firstChild),measuringElements.then(null,function(){stopMeasuring=!0}),i=0,len=keys.length;i<len&&!stopMeasuring;i++){var entry=elementsToMeasure[keys[i]],item=entry.element.querySelector("."+_Constants._itemClass);entry.width=_ElementUtilities.getTotalWidth(item),entry.height=_ElementUtilities.getTotalHeight(item)}surface.parentNode&&surface.parentNode.removeChild(surface),measuringElements===that._measuringElements&&(that._measuringElements=null),site._writeProfilerMark("_measureElements,StopTM")},function(error){return that._measuringElements=null,Promise.wrapError(error)})}return this._measuringElements},_ensureEnvInfo:function(){return this._envInfo||(this._envInfo=getEnvironmentSupportInformation(this._site),this._envInfo&&!this._envInfo.supportsCSSGrid&&_ElementUtilities.addClass(this._site.surface,_Constants._noCSSGrid)),!!this._envInfo},_createMeasuringSurface:function(){var surface=_Global.document.createElement("div");return surface.style.cssText="visibility: hidden;-ms-grid-columns: auto;-ms-grid-rows: auto;-ms-flex-align: start;-webkit-align-items: flex-start;align-items: flex-start",surface.className=_Constants._scrollableClass+" "+(this._inListMode?_Constants._listLayoutClass:_Constants._gridLayoutClass),this._envInfo.supportsCSSGrid||_ElementUtilities.addClass(surface,_Constants._noCSSGrid),this._groupsEnabled&&(this._groupHeaderPosition===HeaderPosition.top?_ElementUtilities.addClass(surface,_Constants._headerPositionTopClass):_ElementUtilities.addClass(surface,_Constants._headerPositionLeftClass)),surface},_measureItem:function(index){function measureItemImpl(index,itemPromise){var itemPromise,secondTry=!!itemPromise,elementPromises={},left=site.rtl?"right":"left";return site.itemCount.then(function(count){return!count||that._groupsEnabled&&!site.groupCount?Promise.cancel:(itemPromise=itemPromise||site.itemFromIndex(index),elementPromises.container=site.renderItem(itemPromise),that._groupsEnabled&&(elementPromises.headerContainer=site.renderHeader(that._site.groupFromIndex(site.groupIndexFromItemIndex(index)))),Promise.join(elementPromises))}).then(function(elements){function readMeasurementsFromDOM(){var horizontal=that._horizontal,groupsEnabled=that._groupsEnabled,stopMeasuring=!1;measuringPromise.then(null,function(){stopMeasuring=!0});var firstElementOnSurfaceMargins=getMargins(firstElementOnSurface),firstElementOnSurfaceOffsetX=site.rtl?site.viewport.offsetWidth-(firstElementOnSurface.offsetLeft+firstElementOnSurface.offsetWidth):firstElementOnSurface.offsetLeft,firstElementOnSurfaceOffsetY=firstElementOnSurface.offsetTop,sizes={viewportContentSize:0,surfaceContentSize:0,maxItemsContainerContentSize:0,surfaceOuterHeight:getOuterHeight(surface),surfaceOuterWidth:getOuterWidth(surface),layoutOriginX:firstElementOnSurfaceOffsetX-firstElementOnSurfaceMargins[left],layoutOriginY:firstElementOnSurfaceOffsetY-firstElementOnSurfaceMargins.top,itemsContainerOuterHeight:getOuterHeight(itemsContainer),itemsContainerOuterWidth:getOuterWidth(itemsContainer),itemsContainerOuterX:getOuter(site.rtl?"Right":"Left",itemsContainer),itemsContainerOuterY:getOuter("Top",itemsContainer),itemsContainerMargins:getMargins(itemsContainer),itemBoxOuterHeight:getOuterHeight(itemBox),itemBoxOuterWidth:getOuterWidth(itemBox),containerOuterHeight:getOuterHeight(elements.container),containerOuterWidth:getOuterWidth(elements.container),emptyContainerContentHeight:_ElementUtilities.getContentHeight(emptyContainer),emptyContainerContentWidth:_ElementUtilities.getContentWidth(emptyContainer),containerMargins:getMargins(elements.container),containerWidth:0,containerHeight:0,containerSizeLoaded:!1};site.header&&(sizes[horizontal?"layoutOriginX":"layoutOriginY"]+=_ElementUtilities[horizontal?"getTotalWidth":"getTotalHeight"](site.header)),
groupsEnabled&&(sizes.headerContainerOuterX=getOuter(site.rtl?"Right":"Left",elements.headerContainer),sizes.headerContainerOuterY=getOuter("Top",elements.headerContainer),sizes.headerContainerOuterWidth=getOuterWidth(elements.headerContainer),sizes.headerContainerOuterHeight=getOuterHeight(elements.headerContainer),sizes.headerContainerWidth=_ElementUtilities.getTotalWidth(elements.headerContainer),sizes.headerContainerHeight=_ElementUtilities.getTotalHeight(elements.headerContainer),sizes.headerContainerMinWidth=getDimension(elements.headerContainer,"minWidth")+sizes.headerContainerOuterWidth,sizes.headerContainerMinHeight=getDimension(elements.headerContainer,"minHeight")+sizes.headerContainerOuterHeight);var measurements={sizes:sizes,viewportContentWidth:_ElementUtilities.getContentWidth(site.viewport),viewportContentHeight:_ElementUtilities.getContentHeight(site.viewport),containerContentWidth:_ElementUtilities.getContentWidth(elements.container),containerContentHeight:_ElementUtilities.getContentHeight(elements.container),containerWidth:_ElementUtilities.getTotalWidth(elements.container),containerHeight:_ElementUtilities.getTotalHeight(elements.container)};return measurements.viewportCrossSize=measurements[horizontal?"viewportContentHeight":"viewportContentWidth"],site.readyToMeasure(),stopMeasuring?null:measurements}function cleanUp(){surface.parentNode&&surface.parentNode.removeChild(surface)}var surface=that._createMeasuringSurface(),itemsContainer=_Global.document.createElement("div"),emptyContainer=_Global.document.createElement("div"),itemBox=elements.container.querySelector("."+_Constants._itemBoxClass),groupIndex=site.groupIndexFromItemIndex(index);emptyContainer.className=_Constants._containerClass,itemsContainer.className=_Constants._itemsContainerClass+" "+_Constants._laidOutClass;var itemsContainerRow=1,itemsContainerColumn=1,headerContainerRow=2,headerContainerColumn=2,firstElementOnSurface=itemsContainer,addHeaderFirst=!1;that._inListMode&&that._groupsEnabled&&(that._horizontal&&that._groupHeaderPosition===HeaderPosition.top?(itemsContainerRow=2,headerContainerColumn=1,headerContainerRow=1,firstElementOnSurface=elements.headerContainer,addHeaderFirst=!0):that._horizontal||that._groupHeaderPosition!==HeaderPosition.left||(itemsContainerColumn=2,headerContainerColumn=1,headerContainerRow=1,firstElementOnSurface=elements.headerContainer,addHeaderFirst=!0)),itemsContainer.style.cssText+=";display: "+(that._inListMode?(that._horizontal?"flex":"block")+"; overflow: hidden":"inline-block")+";vertical-align:top;-ms-grid-column: "+itemsContainerColumn+";-ms-grid-row: "+itemsContainerRow,that._inListMode||(elements.container.style.display="inline-block"),that._groupsEnabled&&(elements.headerContainer.style.cssText+=";display: inline-block;-ms-grid-column: "+headerContainerColumn+";-ms-grid-row: "+headerContainerRow,_ElementUtilities.addClass(elements.headerContainer,_Constants._laidOutClass+" "+_Constants._groupLeaderClass),(that._groupHeaderPosition===HeaderPosition.top&&that._horizontal||that._groupHeaderPosition===HeaderPosition.left&&!that._horizontal)&&_ElementUtilities.addClass(itemsContainer,_Constants._groupLeaderClass)),addHeaderFirst&&surface.appendChild(elements.headerContainer),itemsContainer.appendChild(elements.container),itemsContainer.appendChild(emptyContainer),surface.appendChild(itemsContainer),!addHeaderFirst&&that._groupsEnabled&&surface.appendChild(elements.headerContainer),site.viewport.insertBefore(surface,site.viewport.firstChild);var measurements=readMeasurementsFromDOM();if(!measurements)return cleanUp(),Promise.cancel;if(that._horizontal&&0===measurements.viewportContentHeight||!that._horizontal&&0===measurements.viewportContentWidth)return cleanUp(),Promise.cancel;if(!(secondTry||that._isCellSpanning(groupIndex)||0!==measurements.containerContentWidth&&0!==measurements.containerContentHeight))return cleanUp(),itemPromise.then(function(){return measureItemImpl(index,itemPromise)});var sizes=that._sizes=measurements.sizes;if(Object.defineProperties(sizes,{surfaceOuterCrossSize:{get:function(){return that._horizontal?sizes.surfaceOuterHeight:sizes.surfaceOuterWidth},enumerable:!0},layoutOrigin:{get:function(){return that._horizontal?sizes.layoutOriginX:sizes.layoutOriginY},enumerable:!0},itemsContainerOuterSize:{get:function(){return that._horizontal?sizes.itemsContainerOuterWidth:sizes.itemsContainerOuterHeight},enumerable:!0},itemsContainerOuterCrossSize:{get:function(){return that._horizontal?sizes.itemsContainerOuterHeight:sizes.itemsContainerOuterWidth},enumerable:!0},itemsContainerOuterStart:{get:function(){return that._horizontal?sizes.itemsContainerOuterX:sizes.itemsContainerOuterY},enumerable:!0},itemsContainerOuterCrossStart:{get:function(){return that._horizontal?sizes.itemsContainerOuterY:sizes.itemsContainerOuterX},enumerable:!0},containerCrossSize:{get:function(){return that._horizontal?sizes.containerHeight:sizes.containerWidth},enumerable:!0},containerSize:{get:function(){return that._horizontal?sizes.containerWidth:sizes.containerHeight},enumerable:!0}}),!that._isCellSpanning(groupIndex)){if(that._inListMode){var itemsContainerContentSize=measurements.viewportCrossSize-sizes.surfaceOuterCrossSize-that._getHeaderSizeContentAdjustment()-sizes.itemsContainerOuterCrossSize;that._horizontal?(sizes.containerHeight=itemsContainerContentSize,sizes.containerWidth=measurements.containerWidth):(sizes.containerHeight=measurements.containerHeight,sizes.containerWidth=itemsContainerContentSize)}else sizes.containerWidth=measurements.containerWidth,sizes.containerHeight=measurements.containerHeight;sizes.containerSizeLoaded=!0}that._createContainerStyleRule(),that._viewportSizeChanged(measurements.viewportCrossSize),cleanUp()})}var that=this,perfId="Layout:measureItem",site=that._site,measuringPromise=that._measuringPromise;if(!measuringPromise){site._writeProfilerMark(perfId+",StartTM");var promiseStoredSignal=new _Signal;that._measuringPromise=measuringPromise=promiseStoredSignal.promise.then(function(){return that._ensureEnvInfo()?measureItemImpl(index):Promise.cancel}).then(function(){site._writeProfilerMark(perfId+":complete,info"),site._writeProfilerMark(perfId+",StopTM")},function(error){return that._measuringPromise=null,site._writeProfilerMark(perfId+":canceled,info"),site._writeProfilerMark(perfId+",StopTM"),Promise.wrapError(error)}),promiseStoredSignal.complete()}return measuringPromise},_getHeaderSizeGroupAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===HeaderPosition.left)return this._sizes.headerContainerWidth;if(!this._horizontal&&this._groupHeaderPosition===HeaderPosition.top)return this._sizes.headerContainerHeight}return 0},_getHeaderSizeContentAdjustment:function(){if(this._groupsEnabled){if(this._horizontal&&this._groupHeaderPosition===HeaderPosition.top)return this._sizes.headerContainerHeight;if(!this._horizontal&&this._groupHeaderPosition===HeaderPosition.left)return this._sizes.headerContainerWidth}return 0},_getViewportCrossSize:function(){return this._site.viewportSize[this._horizontal?"height":"width"]},_viewportSizeChanged:function(viewportContentSize){var sizes=this._sizes;sizes.viewportContentSize=viewportContentSize,sizes.surfaceContentSize=viewportContentSize-sizes.surfaceOuterCrossSize,sizes.maxItemsContainerContentSize=sizes.surfaceContentSize-sizes.itemsContainerOuterCrossSize-this._getHeaderSizeContentAdjustment(),sizes.containerSizeLoaded&&!this._inListMode?(this._itemsPerBar=Math.floor(sizes.maxItemsContainerContentSize/sizes.containerCrossSize),this.maximumRowsOrColumns&&(this._itemsPerBar=Math.min(this._itemsPerBar,this.maximumRowsOrColumns)),this._itemsPerBar=Math.max(1,this._itemsPerBar)):(this._inListMode&&(sizes[this._horizontal?"containerHeight":"containerWidth"]=sizes.maxItemsContainerContentSize),this._itemsPerBar=1),this._resetAnimationCaches()},_createContainerStyleRule:function(){var sizes=this._sizes;if(!this._containerSizeClassName&&sizes.containerSizeLoaded&&(0===sizes.emptyContainerContentHeight||0===sizes.emptyContainerContentWidth)){var width=sizes.containerWidth-sizes.containerOuterWidth+"px",height=sizes.containerHeight-sizes.containerOuterHeight+"px";this._inListMode&&(this._horizontal?height="calc(100% - "+(sizes.containerMargins.top+sizes.containerMargins.bottom)+"px)":width="auto"),this._containerSizeClassName||(this._containerSizeClassName=uniqueCssClassName("containersize"),_ElementUtilities.addClass(this._site.surface,this._containerSizeClassName));var ruleSelector="."+_Constants._containerClass,ruleBody="width:"+width+";height:"+height+";";addDynamicCssRule(this._containerSizeClassName,this._site,ruleSelector,ruleBody)}},_ensureContainerSize:function(group){var sizes=this._sizes;if(sizes.containerSizeLoaded||this._ensuringContainerSize)return this._ensuringContainerSize?this._ensuringContainerSize:Promise.wrap();var promise;if(this._itemInfo&&"function"==typeof this._itemInfo||!this._useDefaultItemInfo)promise=this._getItemInfo();else{var margins=sizes.containerMargins;promise=Promise.wrap({width:group.groupInfo.cellWidth-margins.left-margins.right,height:group.groupInfo.cellHeight-margins.top-margins.bottom})}var that=this;return this._ensuringContainerSize=promise.then(function(itemSize){sizes.containerSizeLoaded=!0,sizes.containerWidth=itemSize.width+sizes.itemBoxOuterWidth+sizes.containerOuterWidth,sizes.containerHeight=itemSize.height+sizes.itemBoxOuterHeight+sizes.containerOuterHeight,that._inListMode?that._itemsPerBar=1:(that._itemsPerBar=Math.floor(sizes.maxItemsContainerContentSize/sizes.containerCrossSize),that.maximumRowsOrColumns&&(that._itemsPerBar=Math.min(that._itemsPerBar,that.maximumRowsOrColumns)),that._itemsPerBar=Math.max(1,that._itemsPerBar)),that._createContainerStyleRule()}),promise.done(function(){that._ensuringContainerSize=null},function(){that._ensuringContainerSize=null}),promise},_indexToCoordinate:function(index,itemsPerBar){itemsPerBar=itemsPerBar||this._itemsPerBar;var bar=Math.floor(index/itemsPerBar);return this._horizontal?{column:bar,row:index-bar*itemsPerBar}:{row:bar,column:index-bar*itemsPerBar}},_rangeForGroup:function(group,range){var first=group.startIndex,last=first+group.count-1;return!range||range.firstIndex>last||range.lastIndex<first?null:{firstIndex:Math.max(0,range.firstIndex-first),lastIndex:Math.min(group.count-1,range.lastIndex-first)}},_syncDomWithGroupHeaderPosition:function(tree){if(this._groupsEnabled&&this._oldGroupHeaderPosition!==this._groupHeaderPosition){var i,len=tree.length;if(this._oldGroupHeaderPosition===HeaderPosition.top)if(_ElementUtilities.removeClass(this._site.surface,_Constants._headerPositionTopClass),this._horizontal)for(i=0;i<len;i++)tree[i].header.style.maxWidth="",_ElementUtilities.removeClass(tree[i].itemsContainer.element,_Constants._groupLeaderClass);else this._site.surface.style.msGridRows="";else if(this._oldGroupHeaderPosition===HeaderPosition.left){if(_ElementUtilities.removeClass(this._site.surface,_Constants._headerPositionLeftClass),!this._horizontal)for(i=0;i<len;i++)tree[i].header.style.maxHeight="",_ElementUtilities.removeClass(tree[i].itemsContainer.element,_Constants._groupLeaderClass);this._site.surface.style.msGridColumns=""}if(this._groupHeaderPosition===HeaderPosition.top){if(_ElementUtilities.addClass(this._site.surface,_Constants._headerPositionTopClass),this._horizontal)for(i=0;i<len;i++)_ElementUtilities.addClass(tree[i].itemsContainer.element,_Constants._groupLeaderClass)}else if(_ElementUtilities.addClass(this._site.surface,_Constants._headerPositionLeftClass),!this._horizontal)for(i=0;i<len;i++)_ElementUtilities.addClass(tree[i].itemsContainer.element,_Constants._groupLeaderClass);this._oldGroupHeaderPosition=this._groupHeaderPosition}},_layoutGroup:function(index){var group=this._groups[index],groupBundle=this._site.tree[index],headerContainer=groupBundle.header,itemsContainer=groupBundle.itemsContainer.element,sizes=this._sizes,groupCrossSize=group.getItemsContainerCrossSize();if(this._groupsEnabled){if(this._horizontal)if(this._groupHeaderPosition===HeaderPosition.top){var headerContainerMinContentWidth=sizes.headerContainerMinWidth-sizes.headerContainerOuterWidth,itemsContainerContentWidth=group.getItemsContainerSize()-sizes.headerContainerOuterWidth;headerContainer.style.maxWidth=Math.max(headerContainerMinContentWidth,itemsContainerContentWidth)+"px",this._envInfo.supportsCSSGrid?(headerContainer.style.msGridColumn=index+1,itemsContainer.style.msGridColumn=index+1):(headerContainer.style.height=sizes.headerContainerHeight-sizes.headerContainerOuterHeight+"px",itemsContainer.style.height=groupCrossSize-sizes.itemsContainerOuterHeight+"px",itemsContainer.style.marginBottom=sizes.itemsContainerMargins.bottom+(sizes.maxItemsContainerContentSize-groupCrossSize+sizes.itemsContainerOuterHeight)+"px"),_ElementUtilities.addClass(itemsContainer,_Constants._groupLeaderClass)}else this._envInfo.supportsCSSGrid?(headerContainer.style.msGridColumn=2*index+1,itemsContainer.style.msGridColumn=2*index+2):(headerContainer.style.width=sizes.headerContainerWidth-sizes.headerContainerOuterWidth+"px",headerContainer.style.height=groupCrossSize-sizes.headerContainerOuterHeight+"px",itemsContainer.style.height=groupCrossSize-sizes.itemsContainerOuterHeight+"px");else if(this._groupHeaderPosition===HeaderPosition.left){var headerContainerMinContentHeight=sizes.headerContainerMinHeight-sizes.headerContainerOuterHeight,itemsContainerContentHeight=group.getItemsContainerSize()-sizes.headerContainerOuterHeight;headerContainer.style.maxHeight=Math.max(headerContainerMinContentHeight,itemsContainerContentHeight)+"px",this._envInfo.supportsCSSGrid?(headerContainer.style.msGridRow=index+1,itemsContainer.style.msGridRow=index+1):(headerContainer.style.width=sizes.headerContainerWidth-sizes.headerContainerOuterWidth+"px",itemsContainer.style.width=groupCrossSize-sizes.itemsContainerOuterWidth+"px",itemsContainer.style["margin"+(this._site.rtl?"Left":"Right")]=sizes.itemsContainerMargins[this._site.rtl?"left":"right"]+(sizes.maxItemsContainerContentSize-groupCrossSize+sizes.itemsContainerOuterWidth)+"px"),_ElementUtilities.addClass(itemsContainer,_Constants._groupLeaderClass)}else headerContainer.style.msGridRow=2*index+1,this._inListMode?headerContainer.style.height=sizes.headerContainerHeight-sizes.headerContainerOuterHeight+"px":this._envInfo.supportsCSSGrid?itemsContainer.style.msGridRow=2*index+2:(headerContainer.style.height=sizes.headerContainerHeight-sizes.headerContainerOuterHeight+"px",headerContainer.style.width=groupCrossSize-sizes.headerContainerOuterWidth+"px",itemsContainer.style.width=groupCrossSize-sizes.itemsContainerOuterWidth+"px");_ElementUtilities.addClass(headerContainer,_Constants._laidOutClass+" "+_Constants._groupLeaderClass)}_ElementUtilities.addClass(itemsContainer,_Constants._laidOutClass)}},{_barsPerItemsBlock:4})}),_LegacyLayout:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._LayoutCommon,null,{disableBackdrop:{get:function(){return this._backdropDisabled||!1},set:function(value){if(_ElementUtilities._deprecated(_ErrorMessages.disableBackdropIsDeprecated),value=!!value,this._backdropDisabled!==value&&(this._backdropDisabled=value,this._disableBackdropClassName&&(deleteDynamicCssRule(this._disableBackdropClassName),this._site&&_ElementUtilities.removeClass(this._site.surface,this._disableBackdropClassName),this._disableBackdropClassName=null),this._disableBackdropClassName=uniqueCssClassName("disablebackdrop"),this._site&&_ElementUtilities.addClass(this._site.surface,this._disableBackdropClassName),value)){var ruleSelector=".win-container.win-backdrop",ruleBody="background-color:transparent;";addDynamicCssRule(this._disableBackdropClassName,this._site,ruleSelector,ruleBody)}}},backdropColor:{get:function(){return this._backdropColor||"rgba(155,155,155,0.23)"},set:function(value){if(_ElementUtilities._deprecated(_ErrorMessages.backdropColorIsDeprecated),value&&this._backdropColor!==value){this._backdropColor=value,this._backdropColorClassName&&(deleteDynamicCssRule(this._backdropColorClassName),this._site&&_ElementUtilities.removeClass(this._site.surface,this._backdropColorClassName),this._backdropColorClassName=null),this._backdropColorClassName=uniqueCssClassName("backdropcolor"),this._site&&_ElementUtilities.addClass(this._site.surface,this._backdropColorClassName);var ruleSelector=".win-container.win-backdrop",ruleBody="background-color:"+value+";";addDynamicCssRule(this._backdropColorClassName,this._site,ruleSelector,ruleBody)}}}})}),GridLayout:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._LegacyLayout,function(options){options=options||{},this.itemInfo=options.itemInfo,this.groupInfo=options.groupInfo,this._maxRowsOrColumns=0,this._useDefaultItemInfo=!0,this._elementsToMeasure={},this._groupHeaderPosition=options.groupHeaderPosition||HeaderPosition.top,this.orientation=options.orientation||"horizontal",options.maxRows&&(this.maxRows=+options.maxRows),options.maximumRowsOrColumns&&(this.maximumRowsOrColumns=+options.maximumRowsOrColumns)},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(value){this._setMaxRowsOrColumns(value)}},maxRows:{get:function(){return this.maximumRowsOrColumns},set:function(maxRows){_ElementUtilities._deprecated(_ErrorMessages.maxRowsIsDeprecated),this.maximumRowsOrColumns=maxRows}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(itemInfo){itemInfo&&_ElementUtilities._deprecated(_ErrorMessages.itemInfoIsDeprecated),this._itemInfo=itemInfo,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(groupInfo){groupInfo&&_ElementUtilities._deprecated(_ErrorMessages.groupInfoIsDeprecated),this._groupInfo=groupInfo,this._invalidateLayout()}}})})});var Groups=_Base.Namespace.defineWithParent(null,null,{UniformGroupBase:_Base.Namespace._lazy(function(){return _Base.Class.define(null,{cleanUp:function(){},itemFromOffset:function(offset,options){options=options||{};var sizes=this._layout._sizes;offset-=sizes.itemsContainerOuterStart,options.wholeItem&&(offset+=(options.last?-1:1)*(sizes.containerSize-1));var lastIndexOfGroup=this.count-1,lastBar=Math.floor(lastIndexOfGroup/this._layout._itemsPerBar),bar=clampToRange(0,lastBar,Math.floor(offset/sizes.containerSize)),index=(bar+options.last)*this._layout._itemsPerBar-options.last;return clampToRange(0,this.count-1,index)},hitTest:function(x,y){var horizontal=this._layout._horizontal,itemsPerBar=this._layout._itemsPerBar,useListSemantics=this._layout._inListMode||1===itemsPerBar,directionalLocation=horizontal?x:y,crossLocation=horizontal?y:x,sizes=this._layout._sizes;directionalLocation-=sizes.itemsContainerOuterStart,crossLocation-=sizes.itemsContainerOuterCrossStart;var insertAfterSlot,bar=Math.floor(directionalLocation/sizes.containerSize),slotInBar=clampToRange(0,itemsPerBar-1,Math.floor(crossLocation/sizes.containerCrossSize)),index=Math.max(-1,bar*itemsPerBar+slotInBar);if(insertAfterSlot=!horizontal&&useListSemantics||horizontal&&!useListSemantics?(y-sizes.containerHeight/2)/sizes.containerHeight:(x-sizes.containerWidth/2)/sizes.containerWidth,useListSemantics)return insertAfterSlot=Math.floor(insertAfterSlot),{index:index,insertAfterIndex:insertAfterSlot>=0&&index>=0?insertAfterSlot:-1};insertAfterSlot=clampToRange(-1,itemsPerBar-1,insertAfterSlot);var insertAfterIndex;return insertAfterIndex=insertAfterSlot<0?bar*itemsPerBar-1:bar*itemsPerBar+Math.floor(insertAfterSlot),{index:clampToRange(-1,this.count-1,index),insertAfterIndex:clampToRange(-1,this.count-1,insertAfterIndex)}},getAdjacent:function(currentItem,pressedKey){var newFocus,index=currentItem.index,currentBar=Math.floor(index/this._layout._itemsPerBar),currentSlot=index%this._layout._itemsPerBar;switch(pressedKey){case Key.upArrow:newFocus=0===currentSlot?"boundary":index-1;break;case Key.downArrow:var isLastIndexOfGroup=index===this.count-1,inLastSlot=this._layout._itemsPerBar>1&&currentSlot===this._layout._itemsPerBar-1;newFocus=isLastIndexOfGroup||inLastSlot?"boundary":index+1;break;case Key.leftArrow:newFocus=0===currentBar&&this._layout._itemsPerBar>1?"boundary":index-this._layout._itemsPerBar;break;case Key.rightArrow:var lastIndexOfGroup=this.count-1,lastBar=Math.floor(lastIndexOfGroup/this._layout._itemsPerBar);newFocus=currentBar===lastBar?"boundary":Math.min(index+this._layout._itemsPerBar,this.count-1)}return"boundary"===newFocus?newFocus:{type:_UI.ObjectType.item,index:newFocus}},getItemsContainerSize:function(){var sizes=this._layout._sizes,barCount=Math.ceil(this.count/this._layout._itemsPerBar);return barCount*sizes.containerSize+sizes.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var sizes=this._layout._sizes;return this._layout._itemsPerBar*sizes.containerCrossSize+sizes.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(itemIndex){var sizes=this._layout._sizes,leftStr=this._layout._site.rtl?"right":"left",containerMargins=this._layout._sizes.containerMargins,coordinates=this._layout._indexToCoordinate(itemIndex),itemPosition={row:coordinates.row,column:coordinates.column,top:containerMargins.top+coordinates.row*sizes.containerHeight,left:containerMargins[leftStr]+coordinates.column*sizes.containerWidth,height:sizes.containerHeight-sizes.containerMargins.top-sizes.containerMargins.bottom,width:sizes.containerWidth-sizes.containerMargins.left-sizes.containerMargins.right};return itemPosition}})}),UniformGroup:_Base.Namespace._lazy(function(){return _Base.Class.derive(Groups.UniformGroupBase,function(layout,itemsContainer){this._layout=layout,this._itemsContainer=itemsContainer,_ElementUtilities.addClass(this._itemsContainer,layout._inListMode?_Constants._uniformListLayoutClass:_Constants._uniformGridLayoutClass)},{cleanUp:function(skipDomCleanUp){skipDomCleanUp||(_ElementUtilities.removeClass(this._itemsContainer,_Constants._uniformGridLayoutClass),_ElementUtilities.removeClass(this._itemsContainer,_Constants._uniformListLayoutClass),this._itemsContainer.style.height=this._itemsContainer.style.width=""),this._itemsContainer=null,this._layout=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayout:function(itemsCount,oldChangedRealizedRange,oldState,updatedProperties){return this.groupInfo=updatedProperties.groupInfo,this.startIndex=updatedProperties.startIndex,this.count=itemsCount,this._layout._ensureContainerSize(this)},layoutRealizedRange:function(){var sizes=this._layout._sizes;this._itemsContainer.style[this._layout._horizontal?"width":"height"]=this.getItemsContainerSize()-sizes.itemsContainerOuterSize+"px",this._itemsContainer.style[this._layout._horizontal?"height":"width"]=this._layout._inListMode?sizes.maxItemsContainerContentSize+"px":this._layout._itemsPerBar*sizes.containerCrossSize+"px"},layoutUnrealizedRange:function(){return Promise.wrap()}})}),UniformFlowGroup:_Base.Namespace._lazy(function(){return _Base.Class.derive(Groups.UniformGroupBase,function(layout,tree){this._layout=layout,this._itemsContainer=tree.element,_ElementUtilities.addClass(this._itemsContainer,layout._inListMode?_Constants._uniformListLayoutClass:_Constants._uniformGridLayoutClass)},{cleanUp:function(skipDomCleanUp){skipDomCleanUp||(_ElementUtilities.removeClass(this._itemsContainer,_Constants._uniformListLayoutClass),_ElementUtilities.removeClass(this._itemsContainer,_Constants._uniformGridLayoutClass),this._itemsContainer.style.height="")},layout:function(){this._layout._site._writeProfilerMark("Layout:_UniformFlowGroup:setItemsContainerHeight,info"),this._itemsContainer.style.height=this.count*this._layout._sizes.containerHeight+"px"}})}),CellSpanningGroup:_Base.Namespace._lazy(function(){return _Base.Class.define(function(layout,itemsContainer){this._layout=layout,this._itemsContainer=itemsContainer,_ElementUtilities.addClass(this._itemsContainer,_Constants._cellSpanningGridLayoutClass),this.resetMap()},{cleanUp:function(skipDomCleanUp){skipDomCleanUp||(this._cleanContainers(),_ElementUtilities.removeClass(this._itemsContainer,_Constants._cellSpanningGridLayoutClass),this._itemsContainer.style.cssText=""),this._itemsContainer=null,this._layoutPromise&&(this._layoutPromise.cancel(),this._layoutPromise=null),this.resetMap(),this._slotsPerColumn=null,this._offScreenSlotsPerColumn=null,this._items=null,this._layout=null,this._containersToHide=null,this.groupInfo=null,this.startIndex=null,this.offset=null,this.count=null},prepareLayoutWithCopyOfTree:function(tree,oldChangedRealizedRange,oldState,updatedProperties){var i,that=this;if(this._containersToHide={},oldChangedRealizedRange)for(i=oldChangedRealizedRange.firstIndex;i<=oldChangedRealizedRange.lastIndex;i++)this._containersToHide[uniqueID(oldState._items[i])]=oldState._items[i];this.groupInfo=updatedProperties.groupInfo,this.startIndex=updatedProperties.startIndex,this.count=tree.items.length,this._items=tree.items,this._slotsPerColumn=Math.floor(this._layout._sizes.maxItemsContainerContentSize/this.groupInfo.cellHeight),this._layout.maximumRowsOrColumns&&(this._slotsPerColumn=Math.min(this._slotsPerColumn,this._layout.maximumRowsOrColumns)),this._slotsPerColumn=Math.max(this._slotsPerColumn,1),this.resetMap();var itemInfoPromises=new Array(this.count);for(i=0;i<this.count;i++)itemInfoPromises[i]=this._layout._getItemInfo(this.startIndex+i);return Promise.join(itemInfoPromises).then(function(itemInfos){itemInfos.forEach(function(itemInfo,index){that.addItemToMap(index,itemInfo)})})},layoutRealizedRange:function(firstChangedIndex,realizedRange){if(realizedRange){var i,firstChangedRealizedIndex=Math.max(firstChangedIndex,realizedRange.firstIndex);for(i=firstChangedRealizedIndex;i<=realizedRange.lastIndex;i++)this._layoutItem(i),delete this._containersToHide[uniqueID(this._items[i])]}Object.keys(this._containersToHide).forEach(function(id){_ElementUtilities.removeClass(this._containersToHide[id],_Constants._laidOutClass)}.bind(this)),this._containersToHide={},this._itemsContainer.style.cssText+=";width:"+(this.getItemsContainerSize()-this._layout._sizes.itemsContainerOuterSize)+"px;height:"+this._layout._sizes.maxItemsContainerContentSize+"px;-ms-grid-columns: ("+this.groupInfo.cellWidth+"px)["+this.getColumnCount()+"];-ms-grid-rows: ("+this.groupInfo.cellHeight+"px)["+(this._slotsPerColumn+this._offScreenSlotsPerColumn)+"]"},layoutUnrealizedRange:function(firstChangedIndex,realizedRange,beforeRealizedRange){var layoutJob,that=this;return that._layoutPromise=new Promise(function(complete){function completeLayout(){layoutJob=null,complete()}function schedule(fn){return Scheduler.schedule(fn,Scheduler.Priority.normal,null,"WinJS.UI.GridLayout.CellSpanningGroup.LayoutUnrealizedRange")}if(realizedRange){var stop=!1,before=realizedRange.firstIndex-1,after=Math.max(firstChangedIndex,realizedRange.lastIndex+1);after=Math.max(before+1,after),layoutJob=schedule(function unrealizedRangeWork(info){for(;!stop;){if(info.shouldYield)return void info.setWork(unrealizedRangeWork);stop=!0,before>=firstChangedIndex&&(that._layoutItem(before),before--,stop=!1),after<that.count&&(that._layoutItem(after),after++,stop=!1)}completeLayout()})}else if(beforeRealizedRange){var i=that.count-1;layoutJob=schedule(function beforeRealizedRangeWork(info){for(;i>=firstChangedIndex;i--){if(info.shouldYield)return void info.setWork(beforeRealizedRangeWork);that._layoutItem(i)}completeLayout()})}else{var i=firstChangedIndex;layoutJob=schedule(function afterRealizedRangeWork(info){for(;i<that.count;i++){if(info.shouldYield)return void info.setWork(afterRealizedRangeWork);that._layoutItem(i)}completeLayout()})}},function(){layoutJob&&layoutJob.cancel(),layoutJob=null}),that._layoutPromise},itemFromOffset:function(offset,options){options=options||{};var sizes=this._layout._sizes,margins=sizes.containerMargins;offset-=sizes.itemsContainerOuterX,offset-=(options.last?1:-1)*margins[options.last?"left":"right"];var value=this.indexFromOffset(offset,options.wholeItem,options.last).item;return clampToRange(0,this.count-1,value)},getAdjacent:function(currentItem,pressedKey){var index,originalIndex;index=originalIndex=currentItem.index;var newIndex,inMap,inMapIndex;inMapIndex=this.lastAdjacent===index?this.lastInMapIndex:this.findItem(index);do{var column=Math.floor(inMapIndex/this._slotsPerColumn),row=inMapIndex-column*this._slotsPerColumn,lastColumn=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);switch(pressedKey){case Key.upArrow:if(!(row>0))return{type:_UI.ObjectType.item,index:originalIndex};inMapIndex--;break;case Key.downArrow:if(!(row+1<this._slotsPerColumn))return{type:_UI.ObjectType.item,index:originalIndex};inMapIndex++;break;case Key.leftArrow:inMapIndex=column>0?inMapIndex-this._slotsPerColumn:-1;break;case Key.rightArrow:inMapIndex=column<lastColumn?inMapIndex+this._slotsPerColumn:this.occupancyMap.length}inMap=inMapIndex>=0&&inMapIndex<this.occupancyMap.length,inMap&&(newIndex=this.occupancyMap[inMapIndex]?this.occupancyMap[inMapIndex].index:void 0)}while(inMap&&(index===newIndex||void 0===newIndex));return this.lastAdjacent=newIndex,this.lastInMapIndex=inMapIndex,inMap?{type:_UI.ObjectType.item,index:newIndex}:"boundary"},hitTest:function(x,y){var sizes=this._layout._sizes,itemIndex=0;if(x-=sizes.itemsContainerOuterX,y-=sizes.itemsContainerOuterY,this.occupancyMap.length>0){for(var result=this.indexFromOffset(x,!1,0),counter=Math.min(this._slotsPerColumn-1,Math.floor(y/this.groupInfo.cellHeight)),curr=result.index,lastValidIndex=curr;counter-- >0;)curr++,this.occupancyMap[curr]&&(lastValidIndex=curr);this.occupancyMap[lastValidIndex]||lastValidIndex--,itemIndex=this.occupancyMap[lastValidIndex].index}var itemSize=this.getItemSize(itemIndex),itemLeft=itemSize.column*this.groupInfo.cellWidth,itemTop=itemSize.row*this.groupInfo.cellHeight,useListSemantics=1===this._slotsPerColumn,insertAfterIndex=itemIndex;return(useListSemantics&&x<itemLeft+itemSize.contentWidth/2||!useListSemantics&&y<itemTop+itemSize.contentHeight/2)&&insertAfterIndex--,{type:_UI.ObjectType.item,index:clampToRange(0,this.count-1,itemIndex),insertAfterIndex:clampToRange(-1,this.count-1,insertAfterIndex)}},getItemsContainerSize:function(){var sizes=this._layout._sizes;return this.getColumnCount()*this.groupInfo.cellWidth+sizes.itemsContainerOuterSize},getItemsContainerCrossSize:function(){var sizes=this._layout._sizes;return sizes.maxItemsContainerContentSize+sizes.itemsContainerOuterCrossSize},getItemPositionForAnimations:function(itemIndex){var leftStr=this._layout._site.rtl?"right":"left",containerMargins=this._layout._sizes.containerMargins,coordinates=this.getItemSize(itemIndex),groupInfo=this.groupInfo,itemPosition={row:coordinates.row,column:coordinates.column,top:containerMargins.top+coordinates.row*groupInfo.cellHeight,left:containerMargins[leftStr]+coordinates.column*groupInfo.cellWidth,height:coordinates.contentHeight,width:coordinates.contentWidth};return itemPosition},_layoutItem:function(index){var entry=this.getItemSize(index);return this._items[index].style.cssText+=";-ms-grid-row:"+(entry.row+1)+";-ms-grid-column:"+(entry.column+1)+";-ms-grid-row-span:"+entry.rows+";-ms-grid-column-span:"+entry.columns+";height:"+entry.contentHeight+"px;width:"+entry.contentWidth+"px",_ElementUtilities.addClass(this._items[index],_Constants._laidOutClass),this._items[index]},_cleanContainers:function(){var i,items=this._items,len=items.length;for(i=0;i<len;i++)items[i].style.cssText="",_ElementUtilities.removeClass(items[i],_Constants._laidOutClass)},getColumnCount:function(){return Math.ceil(this.occupancyMap.length/this._slotsPerColumn)},getOccupancyMapItemCount:function(){var index=-1;return this.occupancyMap.forEach(function(item){item.index>index&&(index=item.index)}),index+1},coordinateToIndex:function(c,r){return c*this._slotsPerColumn+r},markSlotAsFull:function(index,itemEntry){
for(var coordinates=this._layout._indexToCoordinate(index,this._slotsPerColumn),toRow=coordinates.row+itemEntry.rows,r=coordinates.row;r<toRow&&r<this._slotsPerColumn;r++)for(var c=coordinates.column,toColumn=coordinates.column+itemEntry.columns;c<toColumn;c++)this.occupancyMap[this.coordinateToIndex(c,r)]=itemEntry;this._offScreenSlotsPerColumn=Math.max(this._offScreenSlotsPerColumn,toRow-this._slotsPerColumn)},isSlotEmpty:function(itemSize,row,column){for(var r=row,toRow=row+itemSize.rows;r<toRow;r++)for(var c=column,toColumn=column+itemSize.columns;c<toColumn;c++)if(r>=this._slotsPerColumn||void 0!==this.occupancyMap[this.coordinateToIndex(c,r)])return!1;return!0},findEmptySlot:function(startIndex,itemSize,newColumn){var coordinates=this._layout._indexToCoordinate(startIndex,this._slotsPerColumn),startRow=coordinates.row,lastColumn=Math.floor((this.occupancyMap.length-1)/this._slotsPerColumn);if(newColumn){for(var c=coordinates.column+1;c<=lastColumn;c++)if(this.isSlotEmpty(itemSize,0,c))return this.coordinateToIndex(c,0)}else for(var c=coordinates.column;c<=lastColumn;c++){for(var r=startRow;r<this._slotsPerColumn;r++)if(this.isSlotEmpty(itemSize,r,c))return this.coordinateToIndex(c,r);startRow=0}return(lastColumn+1)*this._slotsPerColumn},findItem:function(index){for(var inMapIndex=index,len=this.occupancyMap.length;inMapIndex<len;inMapIndex++){var entry=this.occupancyMap[inMapIndex];if(entry&&entry.index===index)return inMapIndex}return inMapIndex},getItemSize:function(index){var inMapIndex=this.findItem(index),entry=this.occupancyMap[inMapIndex],coords=this._layout._indexToCoordinate(inMapIndex,this._slotsPerColumn);return index===entry.index?{row:coords.row,column:coords.column,contentWidth:entry.contentWidth,contentHeight:entry.contentHeight,columns:entry.columns,rows:entry.rows}:null},resetMap:function(){this.occupancyMap=[],this.lastAdded=0,this._offScreenSlotsPerColumn=0},addItemToMap:function(index,itemInfo){function add(mapEntry,newColumn){var inMapIndex=that.findEmptySlot(that.lastAdded,mapEntry,newColumn);that.lastAdded=inMapIndex,that.markSlotAsFull(inMapIndex,mapEntry)}var that=this,groupInfo=that.groupInfo,margins=that._layout._sizes.containerMargins,mapEntry={index:index,contentWidth:itemInfo.width,contentHeight:itemInfo.height,columns:Math.max(1,Math.ceil((itemInfo.width+margins.left+margins.right)/groupInfo.cellWidth)),rows:Math.max(1,Math.ceil((itemInfo.height+margins.top+margins.bottom)/groupInfo.cellHeight))};add(mapEntry,itemInfo.newColumn)},indexFromOffset:function(adjustedOffset,wholeItem,last){var measuredWidth=0,lastItem=0,groupInfo=this.groupInfo,index=0;if(this.occupancyMap.length>0){if(lastItem=this.getOccupancyMapItemCount()-1,measuredWidth=Math.ceil((this.occupancyMap.length-1)/this._slotsPerColumn)*groupInfo.cellWidth,adjustedOffset<measuredWidth){for(var counter=this._slotsPerColumn,index=(Math.max(0,Math.floor(adjustedOffset/groupInfo.cellWidth))+last)*this._slotsPerColumn-last;!this.occupancyMap[index]&&counter-- >0;)index+=last>0?-1:1;return{index:index,item:this.occupancyMap[index].index}}index=this.occupancyMap.length-1}return{index:index,item:lastItem+(Math.max(0,Math.floor((adjustedOffset-measuredWidth)/groupInfo.cellWidth))+last)*this._slotsPerColumn-last}}})})});_Base.Namespace._moduleDefine(exports,"WinJS.UI",{ListLayout:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._LegacyLayout,function(options){options=options||{},this._itemInfo={},this._groupInfo={},this._groupHeaderPosition=options.groupHeaderPosition||HeaderPosition.top,this._inListMode=!0,this.orientation=options.orientation||"vertical"},{initialize:function(site,groupsEnabled){_ElementUtilities.addClass(site.surface,_Constants._listLayoutClass),exports._LegacyLayout.prototype.initialize.call(this,site,groupsEnabled)},uninitialize:function(){this._site&&_ElementUtilities.removeClass(this._site.surface,_Constants._listLayoutClass),exports._LegacyLayout.prototype.uninitialize.call(this)},layout:function(tree,changedRange,modifiedItems,modifiedGroups){return this._groupsEnabled||this._horizontal?exports._LegacyLayout.prototype.layout.call(this,tree,changedRange,modifiedItems,modifiedGroups):this._layoutNonGroupedVerticalList(tree,changedRange,modifiedItems,modifiedGroups)},_layoutNonGroupedVerticalList:function(tree,changedRange,modifiedItems,modifiedGroups){var that=this,perfId="Layout:_layoutNonGroupedVerticalList";return that._site._writeProfilerMark(perfId+",StartTM"),this._layoutPromise=that._measureItem(0).then(function(){_ElementUtilities[that._usingStructuralNodes?"addClass":"removeClass"](that._site.surface,_Constants._structuralNodesClass),_ElementUtilities[that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall?"addClass":"removeClass"](that._site.surface,_Constants._singleItemsBlockClass),that._sizes.viewportContentSize!==that._getViewportCrossSize()&&that._viewportSizeChanged(that._getViewportCrossSize()),that._cacheRemovedElements(modifiedItems,that._cachedItemRecords,that._cachedInsertedItemRecords,that._cachedRemovedItems,!1),that._cacheRemovedElements(modifiedGroups,that._cachedHeaderRecords,that._cachedInsertedHeaderRecords,that._cachedRemovedHeaders,!0);var itemsContainer=tree[0].itemsContainer,group=new Groups.UniformFlowGroup(that,itemsContainer);that._groups=[group],group.groupInfo={enableCellSpanning:!1},group.startIndex=0,group.count=getItemsContainerLength(itemsContainer),group.offset=0,group.layout(),that._site._writeProfilerMark(perfId+":setSurfaceWidth,info"),that._site.surface.style.width=that._sizes.surfaceContentSize+"px",that._layoutAnimations(modifiedItems,modifiedGroups),that._site._writeProfilerMark(perfId+":complete,info"),that._site._writeProfilerMark(perfId+",StopTM")},function(error){return that._site._writeProfilerMark(perfId+":canceled,info"),that._site._writeProfilerMark(perfId+",StopTM"),Promise.wrapError(error)}),{realizedRangeComplete:this._layoutPromise,layoutComplete:this._layoutPromise}},numberOfItemsPerItemsBlock:{get:function(){var that=this;return this._measureItem(0).then(function(){return that._envInfo.nestedFlexTooLarge||that._envInfo.nestedFlexTooSmall?(that._usingStructuralNodes=!0,Number.MAX_VALUE):(that._usingStructuralNodes=exports.ListLayout._numberOfItemsPerItemsBlock>0,exports.ListLayout._numberOfItemsPerItemsBlock)})}}},{_numberOfItemsPerItemsBlock:10})}),CellSpanningLayout:_Base.Namespace._lazy(function(){return _Base.Class.derive(exports._LayoutCommon,function(options){options=options||{},this._itemInfo=options.itemInfo,this._groupInfo=options.groupInfo,this._groupHeaderPosition=options.groupHeaderPosition||HeaderPosition.top,this._horizontal=!0,this._cellSpanning=!0},{maximumRowsOrColumns:{get:function(){return this._maxRowsOrColumns},set:function(value){this._setMaxRowsOrColumns(value)}},itemInfo:{enumerable:!0,get:function(){return this._itemInfo},set:function(itemInfo){this._itemInfo=itemInfo,this._invalidateLayout()}},groupInfo:{enumerable:!0,get:function(){return this._groupInfo},set:function(groupInfo){this._groupInfo=groupInfo,this._invalidateLayout()}},orientation:{enumerable:!0,get:function(){return"horizontal"}}})}),_LayoutWrapper:_Base.Namespace._lazy(function(){return _Base.Class.define(function(layout){this.defaultAnimations=!0,this.initialize=function(site,groupsEnabled){layout.initialize(site,groupsEnabled)},this.hitTest=function(x,y){return layout.hitTest(x,y)},layout.uninitialize&&(this.uninitialize=function(){layout.uninitialize()}),"numberOfItemsPerItemsBlock"in layout&&Object.defineProperty(this,"numberOfItemsPerItemsBlock",{get:function(){return layout.numberOfItemsPerItemsBlock}}),layout._getItemPosition&&(this._getItemPosition=function(index){return layout._getItemPosition(index)}),layout.itemsFromRange&&(this.itemsFromRange=function(start,end){return layout.itemsFromRange(start,end)}),layout.getAdjacent&&(this.getAdjacent=function(currentItem,pressedKey){return layout.getAdjacent(currentItem,pressedKey)}),layout.dragOver&&(this.dragOver=function(x,y,dragInfo){return layout.dragOver(x,y,dragInfo)}),layout.dragLeave&&(this.dragLeave=function(){return layout.dragLeave()});var propertyDefinition={enumerable:!0,get:function(){return"vertical"}};if(void 0!==layout.orientation&&(propertyDefinition.get=function(){return layout.orientation},propertyDefinition.set=function(value){layout.orientation=value}),Object.defineProperty(this,"orientation",propertyDefinition),(layout.setupAnimations||layout.executeAnimations)&&(this.defaultAnimations=!1,this.setupAnimations=function(){return layout.setupAnimations()},this.executeAnimations=function(){return layout.executeAnimations()}),layout.layout)if(this.defaultAnimations){var that=this;this.layout=function(tree,changedRange,modifiedItems,modifiedGroups){var synchronous,promises=normalizeLayoutPromises(layout.layout(tree,changedRange,[],[]));return promises.realizedRangeComplete.then(function(){synchronous=!0}),synchronous&&that._layoutAnimations(modifiedItems,modifiedGroups),promises}}else this.layout=function(tree,changedRange,modifiedItems,modifiedGroups){return normalizeLayoutPromises(layout.layout(tree,changedRange,modifiedItems,modifiedGroups))}},{uninitialize:function(){},numberOfItemsPerItemsBlock:{get:function(){}},layout:function(tree,changedRange,modifiedItems,modifiedGroups){return this.defaultAnimations&&this._layoutAnimations(modifiedItems,modifiedGroups),normalizeLayoutPromises()},itemsFromRange:function(){return{firstIndex:0,lastIndex:Number.MAX_VALUE}},getAdjacent:function(currentItem,pressedKey){switch(pressedKey){case Key.pageUp:case Key.upArrow:case Key.leftArrow:return{type:currentItem.type,index:currentItem.index-1};case Key.downArrow:case Key.rightArrow:case Key.pageDown:return{type:currentItem.type,index:currentItem.index+1}}},dragOver:function(){},dragLeave:function(){},setupAnimations:function(){},executeAnimations:function(){},_getItemPosition:function(){},_layoutAnimations:function(){}})})});var HeaderPosition={left:"left",top:"top"};_Base.Namespace._moduleDefine(exports,"WinJS.UI",{HeaderPosition:HeaderPosition,_getMargins:getMargins})}),define("WinJS/Controls/ListView/_VirtualizeContentsView",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_SafeHtml","../../Utilities/_UI","../ItemContainer/_Constants","../ItemContainer/_ItemEventsHandler","./_Helpers","./_ItemsContainer"],function(exports,_Global,_Base,_BaseUtils,Promise,_Signal,Scheduler,_Dispose,_ElementUtilities,_SafeHtml,_UI,_Constants,_ItemEventsHandler,_Helpers,_ItemsContainer){"use strict";function setFlow(from,to){_ElementUtilities._setAttribute(from,"aria-flowto",to.id),_ElementUtilities._setAttribute(to,"x-ms-aria-flowfrom",from.id)}_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_VirtualizeContentsView:_Base.Namespace._lazy(function(){function cooperativeQueueWorker(info){for(var work,workItems=info.job._workItems;workItems.length&&!info.shouldYield;)(work=workItems.shift())();info.setWork(cooperativeQueueWorker),workItems.length||info.job.pause()}function scheduleQueueJob(priority,name){var job=Scheduler.schedule(cooperativeQueueWorker,priority,null,name);return job._workItems=[],job.addWork=function(work,head){head?this._workItems.unshift(work):this._workItems.push(work),this.resume()},job.clearWork=function(){this._workItems.length=0},job.dispose=function(){this.cancel(),this._workItems.length=0},job}function shouldWaitForSeZo(listView){return listView._zooming||listView._pinching}function waitForSeZo(listView,timeout){return listView._isZombie()?Promise.wrap():shouldWaitForSeZo(listView)?(+timeout!==timeout&&(timeout=_VirtualizeContentsView._waitForSeZoTimeoutDuration),Promise.timeout(_VirtualizeContentsView._waitForSeZoIntervalDuration).then(function(){return timeout-=_VirtualizeContentsView._waitForSeZoIntervalDuration,timeout<=0||waitForSeZo(listView,timeout)})):Promise.wrap()}function makeFunctor(scrollToFunctor){if("number"==typeof scrollToFunctor){var pos=scrollToFunctor;scrollToFunctor=function(){return{position:pos,direction:"right"}}}return scrollToFunctor}function nop(){}var _VirtualizeContentsView=_Base.Class.define(function(listView){this._listView=listView,this._forceRelayout=!1,this.maxLeadingPages=_BaseUtils._isiOS?_VirtualizeContentsView._iOSMaxLeadingPages:_VirtualizeContentsView._defaultPagesToPrefetch,this.maxTrailingPages=_BaseUtils._isiOS?_VirtualizeContentsView._iOSMaxTrailingPages:_VirtualizeContentsView._defaultPagesToPrefetch,this.items=new _ItemsContainer._ItemsContainer(listView),this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this.begin=0,this.end=0,this._realizePass=1,this._firstLayoutPass=!0,this._runningAnimations=null,this._renderCompletePromise=Promise.wrap(),this._state=new CreatedState(this),this._createLayoutSignal(),this._createTreeBuildingSignal(),this._layoutWork=null,this._onscreenJob=scheduleQueueJob(Scheduler.Priority.aboveNormal,"on-screen items"),this._frontOffscreenJob=scheduleQueueJob(Scheduler.Priority.normal,"front off-screen items"),this._backOffscreenJob=scheduleQueueJob(Scheduler.Priority.belowNormal,"back off-screen items"),this._scrollbarPos=0,this._direction="right",this._scrollToFunctor=makeFunctor(0)},{_dispose:function(){this.cleanUp(),this.items=null,this._renderCompletePromise&&this._renderCompletePromise.cancel(),this._renderCompletePromise=null,this._onscreenJob.dispose(),this._frontOffscreenJob.dispose(),this._backOffscreenJob.dispose()},_createItem:function(itemIndex,itemPromise,available,unavailable){this._listView._writeProfilerMark("createItem("+itemIndex+") "+this._getBoundingRectString(itemIndex)+",info");var that=this;that._listView._itemsManager._itemFromItemPromiseThrottled(itemPromise).done(function(element){element?available(itemIndex,element,that._listView._itemsManager._recordFromElement(element)):unavailable(itemIndex)},function(err){return unavailable(itemIndex),Promise.wrapError(err)})},_addItem:function(fragment,itemIndex,element,currentPass){if(this._realizePass===currentPass){var record=this._listView._itemsManager._recordFromElement(element);delete this._pendingItemPromises[record.itemPromise.handle],this.items.setItemAt(itemIndex,{itemBox:null,container:null,element:element,detached:!0,itemsManagerRecord:record})}},lastItemIndex:function(){return this.containers?this.containers.length-1:-1},_setSkipRealizationForChange:function(skip){skip?this._realizationLevel!==_VirtualizeContentsView._realizationLevel.realize&&(this._realizationLevel=_VirtualizeContentsView._realizationLevel.skip):this._realizationLevel=_VirtualizeContentsView._realizationLevel.realize},_realizeItems:function(fragment,begin,end,count,currentPass,scrollbarPos,direction,firstInView,lastInView,ignoreGaps){function itemIsReady(itemIndex,itemsManagerRecord){renderCompletePromises.push(Promise._cancelBlocker(itemsManagerRecord.renderComplete)),delivered(itemIndex)}function appendItemsToDom(startIndex,endIndex){function updateDraggable(itemData,element){itemData.updatedDraggableAttribute||!that._listView.itemsDraggable&&!that._listView.itemsReorderable||itemData.itemsManagerRecord.renderComplete.done(function(){that._realizePass===currentPass&&(_ElementUtilities.hasClass(element,_Constants._nonDraggableClass)||(itemData.itemBox.draggable=!0),itemData.updatedDraggableAttribute=!0)})}if(that._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StartTM"),!that._listView._isZombie()){var itemIndex,appendItemsCount=0,firstIndex=-1,lastIndex=-1;for(itemIndex=startIndex;itemIndex<=endIndex;itemIndex++){var itemData=that.items.itemDataAt(itemIndex);if(itemData){var element=itemData.element,itemBox=itemData.itemBox;itemBox||(itemBox=that._listView._itemBoxTemplate.cloneNode(!0),itemData.itemBox=itemBox,itemBox.appendChild(element),_ElementUtilities.addClass(element,_Constants._itemClass),that._listView._setupAriaSelectionObserver(element),that._listView._isSelected(itemIndex)&&_ItemEventsHandler._ItemEventsHandler.renderSelection(itemBox,element,!0,!0),that._listView._currentMode().renderDragSourceOnRealizedItem(itemIndex,itemBox)),updateDraggable(itemData,element);var container=that.getContainer(itemIndex);itemBox.parentNode!==container&&(itemData.container=container,that._appendAndRestoreFocus(container,itemBox),appendItemsCount++,firstIndex<0&&(firstIndex=itemIndex),lastIndex=itemIndex,that._listView._isSelected(itemIndex)&&_ElementUtilities.addClass(container,_Constants._selectedClass),_ElementUtilities.removeClass(container,_Constants._backdropClass),that.items.elementAvailable(itemIndex))}}that._listView._writeProfilerMark("_realizeItems_appendedItemsToDom,StopTM"),appendItemsCount>0&&(that._listView._writeProfilerMark("_realizeItems_appendedItemsToDom:"+appendItemsCount+" ("+firstIndex+"-"+lastIndex+"),info"),that._reportElementsLevel(direction))}}function removeGaps(first,last,begin,end){function testGap(itemIndex,foundMissing){var itemData=that.items.itemDataAt(itemIndex);if(itemData){var itemBox=itemData.itemBox;return!itemBox||!itemBox.parentNode||!!foundMissing&&(_ElementUtilities.addClass(itemBox.parentNode,_Constants._backdropClass),itemBox.parentNode.removeChild(itemBox),!0)}return!0}if(!ignoreGaps){for(var foundMissing=!1;first>=begin;)foundMissing=testGap(first,foundMissing),first--;for(foundMissing=!1;last<=end;)foundMissing=testGap(last,foundMissing),last++}}function scheduleReadySignal(first,last,job,dir,head){function schedule(itemIndex){var itemData=that.items.itemDataAt(itemIndex);if(itemData){var record=itemData.itemsManagerRecord;record.readyComplete||that._realizePass!==currentPass||job.addWork(function(){that._listView._isZombie()||record.pendingReady&&that._realizePass===currentPass&&(that._listView._writeProfilerMark("pendingReady("+itemIndex+"),info"),record.pendingReady())},head)}}for(var promises=[],i=first;i<=last;i++){var itemData=that.items.itemDataAt(i);itemData&&promises.push(itemData.itemsManagerRecord.itemPromise)}Promise.join(promises).then(function(){if("right"===dir)for(var i=first;i<=last;i++)schedule(i);else for(var i=last;i>=first;i--)schedule(i)})}function delivered(index){if(that._realizePass===currentPass){if(index>=firstInView&&index<=lastInView){if(0===--inViewCounter){if(appendItemsToDom(firstInView,lastInView),removeGaps(firstInView,lastInView,begin,end),that._firstLayoutPass){scheduleReadySignal(firstInView,lastInView,that._frontOffscreenJob,"right"===direction?"left":"right",!0);var entranceAnimation=Scheduler.schedulePromiseHigh(null,"WinJS.UI.ListView.entranceAnimation").then(function(){if(!that._listView._isZombie()){that._listView._writeProfilerMark("entranceAnimation,StartTM");var promise=that._listView._animateListEntrance(!that._firstEntranceAnimated);return that._firstEntranceAnimated=!0,promise}});that._runningAnimations=Promise.join([that._runningAnimations,entranceAnimation]),that._runningAnimations.done(function(){that._listView._writeProfilerMark("entranceAnimation,StopTM"),that._realizePass===currentPass&&(that._runningAnimations=null,entranceAnimationSignal.complete())}),that._firstLayoutPass=!1,that._listView._isCurrentZoomView&&Scheduler.requestDrain(that._onscreenJob.priority)}else scheduleReadySignal(firstInView,lastInView,that._frontOffscreenJob,direction),entranceAnimationSignal.complete();that._updateHeaders(that._listView._canvas,firstInView,lastInView+1).done(function(){viewportItemsRealized.complete()})}}else index<firstInView?(--leftOffscreenCount,leftOffscreenCount%inView===0&&appendItemsToDom(begin,firstInView-1),leftOffscreenCount||(that._updateHeaders(that._listView._canvas,begin,firstInView).done(function(){"right"!==direction&&frontItemsRealized.complete()}),scheduleReadySignal(begin,firstInView-1,"right"!==direction?that._frontOffscreenJob:that._backOffscreenJob,"left"))):index>lastInView&&(--rightOffscreenCount,rightOffscreenCount%inView===0&&appendItemsToDom(lastInView+1,end-1),rightOffscreenCount||(that._updateHeaders(that._listView._canvas,lastInView+1,end).then(function(){"right"===direction&&frontItemsRealized.complete()}),scheduleReadySignal(lastInView+1,end-1,"right"===direction?that._frontOffscreenJob:that._backOffscreenJob,"right")));counter--,0===counter&&(that._renderCompletePromise=Promise.join(renderCompletePromises).then(null,function(e){var error=Array.isArray(e)&&e.some(function(item){return item&&!(item instanceof Error&&"Canceled"===item.name)});if(error)return Promise.wrapError(e)}),(that._headerRenderPromises||Promise.wrap()).done(function(){Scheduler.schedule(function(){that._listView._isZombie()?workCompleteSignal.cancel():workCompleteSignal.complete()},Math.min(that._onscreenJob.priority,that._backOffscreenJob.priority),null,"WinJS.UI.ListView._allItemsRealized")}))}}function newItemIsReady(itemIndex,element,itemsManagerRecord){if(that._realizePass===currentPass){var element=itemsManagerRecord.element;that._addItem(fragment,itemIndex,element,currentPass),itemIsReady(itemIndex,itemsManagerRecord)}}var perfId="_realizeItems("+begin+"-"+(end-1)+") visible("+firstInView+"-"+lastInView+")";this._listView._writeProfilerMark(perfId+",StartTM"),direction=direction||"right";var counter=end-begin,inView=lastInView-firstInView+1,inViewCounter=inView,rightOffscreenCount=end-lastInView-1,leftOffscreenCount=firstInView-begin,renderCompletePromises=[],entranceAnimationSignal=new _Signal,viewportItemsRealized=new _Signal,frontItemsRealized=new _Signal,that=this;if(counter>0){var createCount=0,updateCount=0,cleanCount=0;that.firstIndexDisplayed=firstInView,that.lastIndexDisplayed=lastInView;var isCurrentZoomView=that._listView._isCurrentZoomView;that._highPriorityRealize&&(that._firstLayoutPass||that._hasAnimationInViewportPending)?(that._highPriorityRealize=!1,that._onscreenJob.priority=Scheduler.Priority.high,that._frontOffscreenJob.priority=Scheduler.Priority.normal,that._backOffscreenJob.priority=Scheduler.Priority.belowNormal):that._highPriorityRealize?(that._highPriorityRealize=!1,that._onscreenJob.priority=Scheduler.Priority.high,that._frontOffscreenJob.priority=Scheduler.Priority.high-1,that._backOffscreenJob.priority=Scheduler.Priority.high-1):isCurrentZoomView?(that._onscreenJob.priority=Scheduler.Priority.aboveNormal,that._frontOffscreenJob.priority=Scheduler.Priority.normal,that._backOffscreenJob.priority=Scheduler.Priority.belowNormal):(that._onscreenJob.priority=Scheduler.Priority.belowNormal,that._frontOffscreenJob.priority=Scheduler.Priority.idle,that._backOffscreenJob.priority=Scheduler.Priority.idle);var workCompleteSignal=new _Signal,cancelToken=that._listView._versionManager.cancelOnNotification(workCompleteSignal.promise),queueStage1AfterStage0=function(job,record){record.startStage1&&record.stage0.then(function(){that._realizePass===currentPass&&record.startStage1&&job.addWork(record.startStage1)})},queueWork=function(job,itemIndex){var itemData=that.items.itemDataAt(itemIndex);if(!itemData){var itemPromise=that._listView._itemsManager._itemPromiseAtIndex(itemIndex);that._pendingItemPromises[itemPromise.handle]=itemPromise,delete that._previousRealizationPendingItemPromises[itemPromise.handle],job.addWork(function(){if(!that._listView._isZombie()&&(createCount++,that._createItem(itemIndex,itemPromise,newItemIsReady,delivered),!that._listView._isZombie()&&that._realizePass===currentPass&&itemPromise.handle)){var record=that._listView._itemsManager._recordFromHandle(itemPromise.handle);queueStage1AfterStage0(job,record)}})}},queueRight=function(job,first,last){for(var itemIndex=first;itemIndex<=last;itemIndex++)queueWork(job,itemIndex)},queueLeft=function(job,first,last){for(var itemIndex=last;itemIndex>=first;itemIndex--)queueWork(job,itemIndex)},handleExistingRange=function(job,first,last){for(var itemIndex=first;itemIndex<=last;itemIndex++){var itemData=that.items.itemDataAt(itemIndex);if(itemData){var record=itemData.itemsManagerRecord;itemIsReady(itemIndex,record),updateCount++,queueStage1AfterStage0(job,record)}}};this._previousRealizationPendingItemPromises=this._pendingItemPromises||{},this._pendingItemPromises={};var emptyFront;"left"===direction?(queueLeft(that._onscreenJob,firstInView,lastInView),queueLeft(that._frontOffscreenJob,begin,firstInView-1),emptyFront=begin>firstInView-1):(queueRight(that._onscreenJob,firstInView,lastInView),queueRight(that._frontOffscreenJob,lastInView+1,end-1),emptyFront=lastInView+1>end-1);for(var i=0,handles=Object.keys(this._previousRealizationPendingItemPromises),len=handles.length;i<len;i++){var handle=handles[i];that._listView._itemsManager.releaseItemPromise(this._previousRealizationPendingItemPromises[handle])}this._previousRealizationPendingItemPromises={},handleExistingRange(that._onscreenJob,firstInView,lastInView),"left"===direction?handleExistingRange(that._frontOffscreenJob,begin,firstInView-1):handleExistingRange(that._frontOffscreenJob,lastInView+1,end-1);var showProgress=inViewCounter===lastInView-firstInView+1;return that._firstLayoutPass?that._listView._canvas.style.opacity=0:showProgress?that._listView._showProgressBar(that._listView._element,"50%","50%"):that._listView._hideProgressBar(),that._frontOffscreenJob.pause(),that._backOffscreenJob.pause(),viewportItemsRealized.promise.done(function(){that._frontOffscreenJob.resume(),emptyFront&&frontItemsRealized.complete()},function(){workCompleteSignal.cancel()}),frontItemsRealized.promise.done(function(){that._listView._writeProfilerMark("frontItemsRealized,info"),"left"===direction?(queueRight(that._backOffscreenJob,lastInView+1,end-1),handleExistingRange(that._backOffscreenJob,lastInView+1,end-1)):(queueLeft(that._backOffscreenJob,begin,firstInView-1),handleExistingRange(that._backOffscreenJob,begin,firstInView-1)),that._backOffscreenJob.resume()}),workCompleteSignal.promise.done(function(){that._listView._versionManager.clearCancelOnNotification(cancelToken),that._listView._writeProfilerMark(perfId+" complete(created:"+createCount+" updated:"+updateCount+"),info")},function(err){return that._listView._versionManager.clearCancelOnNotification(cancelToken),that._onscreenJob.clearWork(),that._frontOffscreenJob.clearWork(),that._backOffscreenJob.clearWork(),entranceAnimationSignal.cancel(),viewportItemsRealized.cancel(),that._listView._writeProfilerMark(perfId+" canceled(created:"+createCount+" updated:"+updateCount+" clean:"+cleanCount+"),info"),Promise.wrapError(err)}),that._listView._writeProfilerMark(perfId+",StopTM"),{viewportItemsRealized:viewportItemsRealized.promise,allItemsRealized:workCompleteSignal.promise,loadingCompleted:Promise.join([workCompleteSignal.promise,entranceAnimationSignal.promise]).then(function(){for(var promises=[],i=begin;i<end;i++){var itemData=that.items.itemDataAt(i);itemData&&promises.push(itemData.itemsManagerRecord.itemReadyPromise)}return Promise._cancelBlocker(Promise.join(promises))})}}return that._listView._writeProfilerMark(perfId+",StopTM"),{viewportItemsRealized:Promise.wrap(),allItemsRealized:Promise.wrap(),loadingCompleted:Promise.wrap()}},_setAnimationInViewportState:function(modifiedElements){if(this._hasAnimationInViewportPending=!1,modifiedElements&&modifiedElements.length>0)for(var viewportLength=this._listView._getViewportLength(),range=this._listView._layout.itemsFromRange(this._scrollbarPos,this._scrollbarPos+viewportLength-1),i=0,len=modifiedElements.length;i<len;i++){var modifiedElement=modifiedElements[i];if(modifiedElement.newIndex>=range.firstIndex&&modifiedElement.newIndex<=range.lastIndex&&modifiedElement.newIndex!==modifiedElement.oldIndex){this._hasAnimationInViewportPending=!0;break}}},_addHeader:function(fragment,groupIndex){var that=this;return this._listView._groups.renderGroup(groupIndex).then(function(header){if(header){header.element.tabIndex=0;var placeholder=that._getHeaderContainer(groupIndex);header.element.parentNode!==placeholder&&(placeholder.appendChild(header.element),_ElementUtilities.addClass(header.element,_Constants._headerClass)),that._listView._groups.setDomElement(groupIndex,header.element)}})},_updateHeaders:function(fragment,begin,end){function updateGroup(index){var group=that._listView._groups.group(index);if(group&&!group.header){var headerPromise=group.headerPromise;return headerPromise||(headerPromise=group.headerPromise=that._addHeader(fragment,index),headerPromise.done(function(){group.headerPromise=null},function(){group.headerPromise=null})),headerPromise}return Promise.wrap()}function done(){that._headerRenderPromises=null}var that=this;this._listView._groups.removeElements();var groupStart=this._listView._groups.groupFromItem(begin),groupIndex=groupStart,groupEnd=this._listView._groups.groupFromItem(end-1),realizationPromises=[];if(null!==groupIndex)for(;groupIndex<=groupEnd;groupIndex++)realizationPromises.push(updateGroup(groupIndex));return this._headerRenderPromises=Promise.join(realizationPromises,this._headerRenderPromises).then(done,done),this._headerRenderPromises||Promise.wrap()},_unrealizeItem:function(itemIndex){var focusedItemPurged,listView=this._listView;this._listView._writeProfilerMark("_unrealizeItem("+itemIndex+"),info");var focused=listView._selection._getFocused();focused.type===_UI.ObjectType.item&&focused.index===itemIndex&&(listView._unsetFocusOnItem(),focusedItemPurged=!0);var itemData=this.items.itemDataAt(itemIndex),item=itemData.element,itemBox=itemData.itemBox;itemBox&&itemBox.parentNode&&(_ElementUtilities.removeClass(itemBox.parentNode,_Constants._selectedClass),_ElementUtilities.removeClass(itemBox.parentNode,_Constants._footprintClass),_ElementUtilities.addClass(itemBox.parentNode,_Constants._backdropClass),itemBox.parentNode.removeChild(itemBox)),itemData.container=null,listView._currentMode().itemUnrealized&&listView._currentMode().itemUnrealized(itemIndex,itemBox),this.items.removeItem(itemIndex),itemData.removed||listView._itemsManager.releaseItem(item),_Dispose._disposeElement(item),focusedItemPurged&&listView._setFocusOnItem(listView._selection._getFocused())},_unrealizeGroup:function(group){var focusedItemPurged,headerElement=group.header,focused=this._listView._selection._getFocused();focused.type===_UI.ObjectType.groupHeader&&this._listView._groups.group(focused.index)===group&&(this._listView._unsetFocusOnItem(),focusedItemPurged=!0),headerElement.parentNode&&headerElement.parentNode.removeChild(headerElement),_Dispose._disposeElement(headerElement),group.header=null,group.left=-1,group.top=-1,focusedItemPurged&&this._listView._setFocusOnItem(this._listView._selection._getFocused())},_unrealizeItems:function(remove){var that=this,removedCount=0;this.items.eachIndex(function(index){if(index<that.begin||index>=that.end)return that._unrealizeItem(index),remove&&++removedCount>=remove});var groups=this._listView._groups,beginGroup=groups.groupFromItem(this.begin);if(null!==beginGroup)for(var endGroup=groups.groupFromItem(this.end-1),i=0,len=groups.length();i<len;i++){var group=groups.group(i);(i<beginGroup||i>endGroup)&&group.header&&this._unrealizeGroup(group)}},_unrealizeExcessiveItems:function(){var realized=this.items.count(),needed=this.end-this.begin,approved=needed+this._listView._maxDeferredItemCleanup;this._listView._writeProfilerMark("_unrealizeExcessiveItems realized("+realized+") approved("+approved+"),info"),realized>approved&&this._unrealizeItems(realized-approved)},_lazilyUnrealizeItems:function(){this._listView._writeProfilerMark("_lazilyUnrealizeItems,StartTM");var that=this;return waitForSeZo(this._listView).then(function(){function done(){that._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM")}if(that._listView._isZombie())return void done();var itemsToUnrealize=[];that.items.eachIndex(function(index){(index<that.begin||index>=that.end)&&itemsToUnrealize.push(index)}),that._listView._writeProfilerMark("_lazilyUnrealizeItems itemsToUnrealize("+itemsToUnrealize.length+"),info");var groupsToUnrealize=[],groups=that._listView._groups,beginGroup=groups.groupFromItem(that.begin);
if(null!==beginGroup)for(var endGroup=groups.groupFromItem(that.end-1),i=0,len=groups.length();i<len;i++){var group=groups.group(i);(i<beginGroup||i>endGroup)&&group.header&&groupsToUnrealize.push(group)}if(itemsToUnrealize.length||groupsToUnrealize.length){var job,promise=new Promise(function(complete){function unrealizeWorker(info){if(!that._listView._isZombie()){for(var firstIndex=-1,lastIndex=-1,removeCount=0,zooming=shouldWaitForSeZo(that._listView);itemsToUnrealize.length&&!zooming&&!info.shouldYield;){var itemIndex=itemsToUnrealize.shift();that._unrealizeItem(itemIndex),removeCount++,firstIndex<0&&(firstIndex=itemIndex),lastIndex=itemIndex}for(that._listView._writeProfilerMark("unrealizeWorker removeItems:"+removeCount+" ("+firstIndex+"-"+lastIndex+"),info");groupsToUnrealize.length&&!zooming&&!info.shouldYield;)that._unrealizeGroup(groupsToUnrealize.shift());itemsToUnrealize.length||groupsToUnrealize.length?zooming?info.setPromise(waitForSeZo(that._listView).then(function(){return unrealizeWorker})):info.setWork(unrealizeWorker):complete()}}job=Scheduler.schedule(unrealizeWorker,Scheduler.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyUnrealizeItems")});return promise.then(done,function(error){return job.cancel(),that._listView._writeProfilerMark("_lazilyUnrealizeItems canceled,info"),that._listView._writeProfilerMark("_lazilyUnrealizeItems,StopTM"),Promise.wrapError(error)})}return done(),Promise.wrap()})},_getBoundingRectString:function(itemIndex){var result;if(itemIndex>=0&&itemIndex<this.containers.length){var itemPos=this._listView._layout._getItemPosition(itemIndex);itemPos&&(result="["+itemPos.left+"; "+itemPos.top+"; "+itemPos.width+"; "+itemPos.height+" ]")}return result||""},_clearDeferTimeout:function(){this.deferTimeout&&(this.deferTimeout.cancel(),this.deferTimeout=null),this.deferredActionCancelToken!==-1&&(this._listView._versionManager.clearCancelOnNotification(this.deferredActionCancelToken),this.deferredActionCancelToken=-1)},_setupAria:function(timedOut){function done(){that._listView._writeProfilerMark("aria work,StopTM")}function calcLastRealizedIndexInGroup(groupIndex){var groups=that._listView._groups,nextGroup=groups.group(groupIndex+1);return nextGroup?Math.min(nextGroup.startIndex-1,that.end-1):that.end-1}if(!this._listView._isZombie()){var that=this;return this._listView._createAriaMarkers(),this._listView._itemsCount().then(function(count){if(!(count>0&&that.firstIndexDisplayed!==-1&&that.lastIndexDisplayed!==-1))return Promise.wrap();that._listView._writeProfilerMark("aria work,StartTM");var job,groups,startGroup,currentGroup,group,lastRealizedIndexInGroup,startMarker=that._listView._ariaStartMarker,endMarker=that._listView._ariaEndMarker,index=that.begin,item=that.items.itemAt(that.begin);return item?(_ElementUtilities._ensureId(item),that._listView._groupsEnabled()?(groups=that._listView._groups,startGroup=currentGroup=groups.groupFromItem(that.begin),group=groups.group(currentGroup),lastRealizedIndexInGroup=calcLastRealizedIndexInGroup(currentGroup),_ElementUtilities._ensureId(group.header),_ElementUtilities._setAttribute(group.header,"role",that._listView._headerRole),_ElementUtilities._setAttribute(group.header,"x-ms-aria-flowfrom",startMarker.id),setFlow(group.header,item),_ElementUtilities._setAttribute(group.header,"tabindex",that._listView._tabIndex)):_ElementUtilities._setAttribute(item,"x-ms-aria-flowfrom",startMarker.id),new Promise(function(completeJobPromise){var skipWait=timedOut;job=Scheduler.schedule(function ariaWorker(jobInfo){if(that._listView._isZombie())return void done();for(;index<that.end;index++){if(!skipWait&&shouldWaitForSeZo(that._listView))return void jobInfo.setPromise(waitForSeZo(that._listView).then(function(timedOut){return skipWait=timedOut,ariaWorker}));if(jobInfo.shouldYield)return void jobInfo.setWork(ariaWorker);item=that.items.itemAt(index);var nextItem=that.items.itemAt(index+1);if(nextItem&&_ElementUtilities._ensureId(nextItem),_ElementUtilities._setAttribute(item,"role",that._listView._itemRole),_ElementUtilities._setAttribute(item,"aria-setsize",count),_ElementUtilities._setAttribute(item,"aria-posinset",index+1),_ElementUtilities._setAttribute(item,"tabindex",that._listView._tabIndex),that._listView._groupsEnabled())if(index!==lastRealizedIndexInGroup&&nextItem)setFlow(item,nextItem);else{var nextGroup=groups.group(currentGroup+1);nextGroup&&nextGroup.header&&nextItem?(_ElementUtilities._setAttribute(nextGroup.header,"tabindex",that._listView._tabIndex),_ElementUtilities._setAttribute(nextGroup.header,"role",that._listView._headerRole),_ElementUtilities._ensureId(nextGroup.header),setFlow(item,nextGroup.header),setFlow(nextGroup.header,nextItem)):_ElementUtilities._setAttribute(item,"aria-flowto",endMarker.id),currentGroup++,group=nextGroup,lastRealizedIndexInGroup=calcLastRealizedIndexInGroup(currentGroup)}else nextItem?setFlow(item,nextItem):_ElementUtilities._setAttribute(item,"aria-flowto",endMarker.id);if(!nextItem)break}that._listView._fireAccessibilityAnnotationCompleteEvent(that.begin,index,startGroup,currentGroup-1),done(),completeJobPromise()},Scheduler.Priority.belowNormal,null,"WinJS.UI.ListView._setupAria")},function(){job.cancel(),done()})):void done()})}},_setupDeferredActions:function(){function cleanUp(){that._listView._isZombie()||(that.deferTimeout=null,that._listView._versionManager.clearCancelOnNotification(that.deferredActionCancelToken),that.deferredActionCancelToken=-1)}this._listView._writeProfilerMark("_setupDeferredActions,StartTM");var that=this;this._clearDeferTimeout(),this.deferTimeout=this._lazilyRemoveRedundantItemsBlocks().then(function(){return Promise.timeout(_Constants._DEFERRED_ACTION)}).then(function(){return waitForSeZo(that._listView)}).then(function(timedOut){return that._setupAria(timedOut)}).then(cleanUp,function(error){return cleanUp(),Promise.wrapError(error)}),this.deferredActionCancelToken=this._listView._versionManager.cancelOnNotification(this.deferTimeout),this._listView._writeProfilerMark("_setupDeferredActions,StopTM")},_updateAriaMarkers:function(listViewIsEmpty,firstIndexDisplayed,lastIndexDisplayed){function getFirstVisibleItem(){return that.items.itemAt(firstIndexDisplayed)}function getLastVisibleItem(){for(var i=lastIndexDisplayed;i>=firstIndexDisplayed;i--)if(that.items.itemAt(i))return that.items.itemAt(i);return null}var that=this;if(!this._listView._isZombie()){this._listView._createAriaMarkers();var firstVisibleItem,lastVisibleItem,startMarker=this._listView._ariaStartMarker,endMarker=this._listView._ariaEndMarker;if(firstIndexDisplayed!==-1&&lastIndexDisplayed!==-1&&firstIndexDisplayed<=lastIndexDisplayed&&(firstVisibleItem=getFirstVisibleItem(),lastVisibleItem=getLastVisibleItem()),!listViewIsEmpty&&firstVisibleItem&&lastVisibleItem){if(_ElementUtilities._ensureId(firstVisibleItem),_ElementUtilities._ensureId(lastVisibleItem),this._listView._groupsEnabled()){var groups=this._listView._groups,firstVisibleGroup=groups.group(groups.groupFromItem(firstIndexDisplayed));firstVisibleGroup.header&&(_ElementUtilities._ensureId(firstVisibleGroup.header),firstIndexDisplayed===firstVisibleGroup.startIndex?_ElementUtilities._setAttribute(startMarker,"aria-flowto",firstVisibleGroup.header.id):_ElementUtilities._setAttribute(startMarker,"aria-flowto",firstVisibleItem.id))}else _ElementUtilities._setAttribute(startMarker,"aria-flowto",firstVisibleItem.id);_ElementUtilities._setAttribute(endMarker,"x-ms-aria-flowfrom",lastVisibleItem.id)}else setFlow(startMarker,endMarker),this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1)}},updateAriaForAnnouncement:function(item,count){if(item!==this._listView.header&&item!==this._listView.footer){var index=-1,type=_UI.ObjectType.item;_ElementUtilities.hasClass(item,_Constants._headerClass)?(index=this._listView._groups.index(item),type=_UI.ObjectType.groupHeader,_ElementUtilities._setAttribute(item,"role",this._listView._headerRole),_ElementUtilities._setAttribute(item,"tabindex",this._listView._tabIndex)):(index=this.items.index(item),_ElementUtilities._setAttribute(item,"aria-setsize",count),_ElementUtilities._setAttribute(item,"aria-posinset",index+1),_ElementUtilities._setAttribute(item,"role",this._listView._itemRole),_ElementUtilities._setAttribute(item,"tabindex",this._listView._tabIndex)),type===_UI.ObjectType.groupHeader?this._listView._fireAccessibilityAnnotationCompleteEvent(-1,-1,index,index):this._listView._fireAccessibilityAnnotationCompleteEvent(index,index,-1,-1)}},_reportElementsLevel:function(direction){function elementsCount(first,last){for(var count=0,itemIndex=first;itemIndex<=last;itemIndex++){var itemData=items.itemDataAt(itemIndex);itemData&&itemData.container&&count++}return count}var level,items=this.items;level="right"===direction?Math.floor(100*elementsCount(this.firstIndexDisplayed,this.end-1)/(this.end-this.firstIndexDisplayed)):Math.floor(100*elementsCount(this.begin,this.lastIndexDisplayed)/(this.lastIndexDisplayed-this.begin+1)),this._listView._writeProfilerMark("elementsLevel level("+level+"),info")},_createHeaderContainer:function(insertAfter){return this._createSurfaceChild(_Constants._headerContainerClass,insertAfter)},_createItemsContainer:function(insertAfter){var itemsContainer=this._createSurfaceChild(_Constants._itemsContainerClass,insertAfter),padder=_Global.document.createElement("div");return padder.className=_Constants._padderClass,itemsContainer.appendChild(padder),itemsContainer},_ensureContainerInDOM:function(index){var container=this.containers[index];return!(!container||this._listView._canvas.contains(container))&&(this._forceItemsBlocksInDOM(index,index+1),!0)},_ensureItemsBlocksInDOM:function(begin,end){if(this._expandedRange){var oldBegin=this._expandedRange.first.index,oldEnd=this._expandedRange.last.index+1;begin<=oldBegin&&end>oldBegin?end=Math.max(end,oldEnd):begin<oldEnd&&end>=oldEnd&&(begin=Math.min(begin,oldBegin))}this._forceItemsBlocksInDOM(begin,end)},_removeRedundantItemsBlocks:function(){this.begin!==-1&&this.end!==-1&&this._forceItemsBlocksInDOM(this.begin,this.end)},_lazilyRemoveRedundantItemsBlocks:function(){this._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StartTM");var that=this;return waitForSeZo(this._listView).then(function(){function done(){that._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM")}if(that._listView._isZombie())return void done();if(that._expandedRange&&that.begin!==-1&&that.end!==-1&&(that._expandedRange.first.index<that.begin||that._expandedRange.last.index+1>that.end)){var job,promise=new Promise(function(complete){function blocksCleanupWorker(info){if(!that._listView._isZombie()){for(var zooming=shouldWaitForSeZo(that._listView);that._expandedRange.first.index<that.begin&&!zooming&&!info.shouldYield;){var begin=Math.min(that.begin,that._expandedRange.first.index+that._blockSize*_VirtualizeContentsView._blocksToRelease);that._forceItemsBlocksInDOM(begin,that.end)}for(;that._expandedRange.last.index+1>that.end&&!zooming&&!info.shouldYield;){var end=Math.max(that.end,that._expandedRange.last.index-that._blockSize*_VirtualizeContentsView._blocksToRelease);that._forceItemsBlocksInDOM(that.begin,end)}that._expandedRange.first.index<that.begin||that._expandedRange.last.index+1>that.end?zooming?info.setPromise(waitForSeZo(that._listView).then(function(){return blocksCleanupWorker})):info.setWork(blocksCleanupWorker):complete()}}job=Scheduler.schedule(blocksCleanupWorker,Scheduler.Priority.belowNormal,null,"WinJS.UI.ListView._lazilyRemoveRedundantItemsBlocks")});return promise.then(done,function(error){return job.cancel(),that._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks canceled,info"),that._listView._writeProfilerMark("_lazilyRemoveRedundantItemsBlocks,StopTM"),Promise.wrapError(error)})}return done(),Promise.wrap()})},_forceItemsBlocksInDOM:function(begin,end){function setPadder(itemsContainer,padding){var padder=itemsContainer.element.firstElementChild;padder.style[paddingProperty]=padding}function forEachBlock(callback){for(var g=0;g<that.tree.length;g++)for(var itemsContainer=that.tree[g].itemsContainer,b=0,len=itemsContainer.itemsBlocks.length;b<len;b++)if(callback(itemsContainer,itemsContainer.itemsBlocks[b]))return}function measureItemsBlock(itemsBlock){that._listView._writeProfilerMark("_itemsBlockExtent,StartTM"),that._listView._itemsBlockExtent=_ElementUtilities[that._listView._horizontal()?"getTotalWidth":"getTotalHeight"](itemsBlock.element),that._listView._writeProfilerMark("_itemsBlockExtent("+that._listView._itemsBlockExtent+"),info"),that._listView._writeProfilerMark("_itemsBlockExtent,StopTM")}function getItemsBlockExtent(){return that._listView._itemsBlockExtent===-1&&forEachBlock(function(itemsContainer,itemsBlock){return itemsBlock.items.length===that._blockSize&&itemsBlock.element.parentNode===itemsContainer.element&&(measureItemsBlock(itemsBlock),!0)}),that._listView._itemsBlockExtent===-1&&forEachBlock(function(itemsContainer,itemsBlock){return itemsBlock.items.length===that._blockSize&&(itemsContainer.element.appendChild(itemsBlock.element),measureItemsBlock(itemsBlock),itemsContainer.element.removeChild(itemsBlock.element),!0)}),that._listView._itemsBlockExtent}function removeBlocks(itemsContainer,begin,end){function remove(blockIndex){var block=itemsContainer.itemsBlocks[blockIndex];block&&block.element.parentNode===itemsContainer.element&&(itemsContainer.element.removeChild(block.element),removed++)}if(Array.isArray(begin))begin.forEach(remove);else for(var i=begin;i<end;i++)remove(i)}function addBlocks(itemsContainer,begin,end){for(var padder=itemsContainer.element.firstElementChild,previous=padder,i=begin;i<end;i++){var block=itemsContainer.itemsBlocks[i];block&&(block.element.parentNode!==itemsContainer.element&&(itemsContainer.element.insertBefore(block.element,previous.nextElementSibling),added++),previous=block.element)}}function collapseGroup(groupIndex){if(groupIndex<that.tree.length){that._listView._writeProfilerMark("collapseGroup("+groupIndex+"),info");var itemsContainer=that.tree[groupIndex].itemsContainer;removeBlocks(itemsContainer,0,itemsContainer.itemsBlocks.length),setPadder(itemsContainer,"")}}function expandGroup(groupIndex){if(groupIndex<that.tree.length){that._listView._writeProfilerMark("expandGroup("+groupIndex+"),info");var itemsContainer=that.tree[groupIndex].itemsContainer;addBlocks(itemsContainer,0,itemsContainer.itemsBlocks.length),setPadder(itemsContainer,"")}}function removedFromRange(oldRange,newRange){function expand(first,last){for(var array=[],i=first;i<=last;i++)array.push(i);return array}var newL=newRange[0],newR=newRange[1],oldL=oldRange[0],oldR=oldRange[1];return newR<oldL||newL>oldR?expand(oldL,oldR):newL>oldL&&newR<oldR?expand(oldL,newL-1).concat(expand(newR+1,oldR)):oldL<newL?expand(oldL,newL-1):oldR>newR?expand(newR+1,oldR):null}if(this._blockSize){var perfId="_forceItemsBlocksInDOM begin("+begin+") end("+end+"),";this._listView._writeProfilerMark(perfId+"StartTM");var that=this,added=0,removed=0,paddingProperty="padding"+(this._listView._horizontal()?"Left":"Top"),firstGroupIndex=this._listView._groups.groupFromItem(begin),lastGroupIndex=this._listView._groups.groupFromItem(end-1),firstGroup=this._listView._groups.group(firstGroupIndex),firstItemsContainer=that.tree[firstGroupIndex].itemsContainer,firstBlock=Math.floor((begin-firstGroup.startIndex)/this._blockSize),lastGroup=this._listView._groups.group(lastGroupIndex),lastItemsContainer=that.tree[lastGroupIndex].itemsContainer,lastBlock=Math.floor((end-1-lastGroup.startIndex)/this._blockSize);firstBlock&&that._listView._itemsBlockExtent===-1&&forEachBlock(function(itemsContainer,itemsBlock){return itemsBlock.items.length===that._blockSize&&itemsBlock.element.parentNode===itemsContainer.element&&(measureItemsBlock(itemsBlock),!0)});var groupsToCollapse=this._expandedRange?removedFromRange([this._expandedRange.first.groupIndex,this._expandedRange.last.groupIndex],[firstGroupIndex,lastGroupIndex]):null;if(groupsToCollapse&&groupsToCollapse.forEach(collapseGroup),this._expandedRange&&this._expandedRange.first.groupKey===firstGroup.key){var blocksToRemove=removedFromRange([this._expandedRange.first.block,Number.MAX_VALUE],[firstBlock,Number.MAX_VALUE]);blocksToRemove&&removeBlocks(firstItemsContainer,blocksToRemove)}else this._expandedRange&&firstGroupIndex>=this._expandedRange.first.groupIndex&&firstGroupIndex<=this._expandedRange.last.groupIndex&&removeBlocks(firstItemsContainer,0,firstBlock);if(firstGroupIndex!==lastGroupIndex?(addBlocks(firstItemsContainer,firstBlock,firstItemsContainer.itemsBlocks.length),addBlocks(lastItemsContainer,0,lastBlock+1)):addBlocks(firstItemsContainer,firstBlock,lastBlock+1),this._expandedRange&&this._expandedRange.last.groupKey===lastGroup.key){var blocksToRemove=removedFromRange([0,this._expandedRange.last.block],[0,lastBlock]);blocksToRemove&&removeBlocks(lastItemsContainer,blocksToRemove)}else this._expandedRange&&lastGroupIndex>=this._expandedRange.first.groupIndex&&lastGroupIndex<=this._expandedRange.last.groupIndex&&removeBlocks(lastItemsContainer,lastBlock+1,lastItemsContainer.itemsBlocks.length);setPadder(firstItemsContainer,firstBlock?firstBlock*getItemsBlockExtent()+"px":""),firstGroupIndex!==lastGroupIndex&&setPadder(lastItemsContainer,"");for(var i=firstGroupIndex+1;i<lastGroupIndex;i++)expandGroup(i);this._expandedRange={first:{index:begin,groupIndex:firstGroupIndex,groupKey:firstGroup.key,block:firstBlock},last:{index:end-1,groupIndex:lastGroupIndex,groupKey:lastGroup.key,block:lastBlock}},this._listView._writeProfilerMark("_forceItemsBlocksInDOM groups("+firstGroupIndex+"-"+lastGroupIndex+") blocks("+firstBlock+"-"+lastBlock+") added("+added+") removed("+removed+"),info"),this._listView._writeProfilerMark(perfId+"StopTM")}},_realizePageImpl:function(){var that=this,perfId="realizePage(scrollPosition:"+this._scrollbarPos+" forceLayout:"+this._forceRelayout+")";return this._listView._writeProfilerMark(perfId+",StartTM"),this._listView._versionManager.locked?(this._listView._versionManager.unlocked.done(function(){that._listView._isZombie()||that._listView._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.low,that._listView.scrollPosition)}),this._listView._writeProfilerMark(perfId+",StopTM"),Promise.cancel):new Promise(function(c){function complete(){c(),renderingCompleteSignal.complete()}function viewPortPageRealized(){that._listView._hideProgressBar(),that._state.setLoadingState(that._listView._LoadingState.viewPortLoaded),that._executeAnimations&&that._setState(RealizingAnimatingState,renderingCompleteSignal.promise)}function pageRealized(count){that._updateAriaMarkers(0===count,that.firstIndexDisplayed,that.lastIndexDisplayed),that._state.setLoadingState&&that._state.setLoadingState(that._listView._LoadingState.itemsLoaded)}function finish(count){that._listView._clearInsertedItems(),that._listView._groups.removeElements(),viewPortPageRealized(),pageRealized(count),complete()}var renderingCompleteSignal=new _Signal;that._state.setLoadingState(that._listView._LoadingState.itemsLoading),that._firstLayoutPass&&that._listView._showProgressBar(that._listView._element,"50%","50%");var count=that.containers.length;if(count){var pagesBefore,pagesAfter,pagesToPrefetch=that.maxLeadingPages,pagesToRetain=that.maxTrailingPages,viewportLength=that._listView._getViewportLength();if(that._listView._zooming)pagesBefore=pagesAfter=0;else if(_VirtualizeContentsView._disableCustomPagesPrefetch)pagesBefore=pagesAfter=_VirtualizeContentsView._defaultPagesToPrefetch;else{pagesBefore="left"===that._direction?pagesToPrefetch:pagesToRetain;var pagesShortBehind=Math.max(0,pagesBefore-that._scrollbarPos/viewportLength);pagesAfter=Math.min(pagesToPrefetch,pagesShortBehind+("right"===that._direction?pagesToPrefetch:pagesToRetain))}var beginningOffset=Math.max(0,that._scrollbarPos-pagesBefore*viewportLength),endingOffset=that._scrollbarPos+(1+pagesAfter)*viewportLength,range=that._listView._layout.itemsFromRange(beginningOffset,endingOffset-1);if((range.firstIndex<0||range.firstIndex>=count)&&(range.lastIndex<0||range.lastIndex>=count))that.begin=-1,that.end=-1,that.firstIndexDisplayed=-1,that.lastIndexDisplayed=-1,finish(count);else{var begin=_ElementUtilities._clamp(range.firstIndex,0,count-1),end=_ElementUtilities._clamp(range.lastIndex+1,0,count),inView=that._listView._layout.itemsFromRange(that._scrollbarPos,that._scrollbarPos+viewportLength-1),firstInView=_ElementUtilities._clamp(inView.firstIndex,0,count-1),lastInView=_ElementUtilities._clamp(inView.lastIndex,0,count-1);if(that._realizationLevel!==_VirtualizeContentsView._realizationLevel.skip||that.lastRealizePass||firstInView!==that.firstIndexDisplayed||lastInView!==that.lastIndexDisplayed)if((that._forceRelayout||begin!==that.begin||end!==that.end||firstInView!==that.firstIndexDisplayed||lastInView!==that.lastIndexDisplayed)&&begin<end&&beginningOffset<endingOffset){that._listView._writeProfilerMark("realizePage currentInView("+firstInView+"-"+lastInView+") previousInView("+that.firstIndexDisplayed+"-"+that.lastIndexDisplayed+") change("+(firstInView-that.firstIndexDisplayed)+"),info"),that._cancelRealize();var currentPass=that._realizePass;that.begin=begin,that.end=end,that.firstIndexDisplayed=firstInView,that.lastIndexDisplayed=lastInView,that.deletesWithoutRealize=0,that._ensureItemsBlocksInDOM(that.begin,that.end);var realizeWork=that._realizeItems(that._listView._itemCanvas,that.begin,that.end,count,currentPass,that._scrollbarPos,that._direction,firstInView,lastInView,that._forceRelayout);that._forceRelayout=!1;var realizePassWork=realizeWork.viewportItemsRealized.then(function(){return viewPortPageRealized(),realizeWork.allItemsRealized}).then(function(){if(that._realizePass===currentPass)return that._updateHeaders(that._listView._canvas,that.begin,that.end).then(function(){pageRealized(count)})}).then(function(){return realizeWork.loadingCompleted}).then(function(){that._unrealizeExcessiveItems(),that.lastRealizePass=null,complete()},function(e){return that._realizePass===currentPass&&(that.lastRealizePass=null,that.begin=-1,that.end=-1),Promise.wrapError(e)});that.lastRealizePass=Promise.join([realizeWork.viewportItemsRealized,realizeWork.allItemsRealized,realizeWork.loadingCompleted,realizePassWork]),that._unrealizeExcessiveItems()}else that.lastRealizePass?that.lastRealizePass.then(complete):finish(count);else that.begin=begin,that.end=begin+Object.keys(that.items._itemData).length,that._updateHeaders(that._listView._canvas,that.begin,that.end).done(function(){that.lastRealizePass=null,finish(count)})}}else that.begin=-1,that.end=-1,that.firstIndexDisplayed=-1,that.lastIndexDisplayed=-1,finish(count);that._reportElementsLevel(that._direction),that._listView._writeProfilerMark(perfId+",StopTM")})},realizePage:function(scrollToFunctor,forceRelayout,scrollEndPromise,StateType){this._scrollToFunctor=makeFunctor(scrollToFunctor),this._forceRelayout=this._forceRelayout||forceRelayout,this._scrollEndPromise=scrollEndPromise,this._listView._writeProfilerMark(this._state.name+"_realizePage,info"),this._state.realizePage(StateType||RealizingState)},onScroll:function(scrollToFunctor,scrollEndPromise){this.realizePage(scrollToFunctor,!1,scrollEndPromise,ScrollingState)},reload:function(scrollToFunctor,highPriority){this._listView._isZombie()||(this._scrollToFunctor=makeFunctor(scrollToFunctor),this._forceRelayout=!0,this._highPriorityRealize=!!highPriority,this.stopWork(!0),this._listView._writeProfilerMark(this._state.name+"_rebuildTree,info"),this._state.rebuildTree())},refresh:function(scrollToFunctor){this._listView._isZombie()||(this._scrollToFunctor=makeFunctor(scrollToFunctor),this._forceRelayout=!0,this._highPriorityRealize=!0,this.stopWork(),this._listView._writeProfilerMark(this._state.name+"_relayout,info"),this._state.relayout())},waitForValidScrollPosition:function(newPosition){var that=this,currentMaxScroll=this._listView._viewport[this._listView._scrollLength]-this._listView._getViewportLength();return newPosition>currentMaxScroll?that._listView._itemsCount().then(function(count){return that.containers.length<count?Promise._cancelBlocker(that._creatingContainersWork&&that._creatingContainersWork.promise).then(function(){return that._getLayoutCompleted()}).then(function(){return newPosition}):newPosition}):Promise.wrap(newPosition)},waitForEntityPosition:function(entity){var that=this;return entity.type===_UI.ObjectType.header||entity.type===_UI.ObjectType.footer?Promise.wrap():(this._listView._writeProfilerMark(this._state.name+"_waitForEntityPosition("+entity.type+": "+entity.index+"),info"),Promise._cancelBlocker(this._state.waitForEntityPosition(entity).then(function(){if(entity.type!==_UI.ObjectType.groupHeader&&entity.index>=that.containers.length||entity.type===_UI.ObjectType.groupHeader&&that._listView._groups.group(entity.index).startIndex>=that.containers.length)return that._creatingContainersWork&&that._creatingContainersWork.promise}).then(function(){return that._getLayoutCompleted()})))},stopWork:function(stopTreeCreation){this._listView._writeProfilerMark(this._state.name+"_stop,info"),this._state.stop(stopTreeCreation),this._layoutWork&&this._layoutWork.cancel(),stopTreeCreation&&this._creatingContainersWork&&this._creatingContainersWork.cancel(),stopTreeCreation&&(this._state=new CreatedState(this))},_cancelRealize:function(){this._listView._writeProfilerMark("_cancelRealize,StartTM"),(this.lastRealizePass||this.deferTimeout)&&(this._forceRelayout=!0),this._clearDeferTimeout(),this._realizePass++,this._headerRenderPromises&&(this._headerRenderPromises.cancel(),this._headerRenderPromises=null);var last=this.lastRealizePass;last&&(this.lastRealizePass=null,this.begin=-1,this.end=-1,last.cancel()),this._listView._writeProfilerMark("_cancelRealize,StopTM")},resetItems:function(unparent){if(!this._listView._isZombie()){this.firstIndexDisplayed=-1,this.lastIndexDisplayed=-1,this._runningAnimations=null,this._executeAnimations=!1;var listView=this._listView;this._firstLayoutPass=!0,listView._unsetFocusOnItem(),listView._currentMode().onDataChanged&&listView._currentMode().onDataChanged(),this.items.each(function(index,item){unparent&&item.parentNode&&item.parentNode.parentNode&&item.parentNode.parentNode.removeChild(item.parentNode),listView._itemsManager.releaseItem(item),_Dispose._disposeElement(item)}),this.items.removeItems(),this._deferredReparenting=[],unparent&&listView._groups.removeElements(),listView._clearInsertedItems()}},reset:function(){if(this.stopWork(!0),this._state=new CreatedState(this),this.resetItems(),!this._listView._isZombie()){var listView=this._listView;listView._groups.resetGroups(),listView._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null}},cleanUp:function(){this.stopWork(!0),this._runningAnimations&&this._runningAnimations.cancel();var itemsManager=this._listView._itemsManager;this.items.each(function(index,item){itemsManager.releaseItem(item),_Dispose._disposeElement(item)}),this._listView._unsetFocusOnItem(),this.items.removeItems(),this._deferredReparenting=[],this._listView._groups.resetGroups(),this._listView._resetCanvas(),this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null,this.destroyed=!0},getContainer:function(itemIndex){return this.containers[itemIndex]},_getHeaderContainer:function(groupIndex){return this.tree[groupIndex].header},_getGroups:function(count){if(this._listView._groupDataSource){var groupsContainer=this._listView._groups.groups,groups=[];if(count)for(var i=0,len=groupsContainer.length;i<len;i++){var group=groupsContainer[i],nextStartIndex=i+1<len?groupsContainer[i+1].startIndex:count;groups.push({key:group.key,size:nextStartIndex-group.startIndex})}return groups}return[{key:"-1",size:count}]},_createChunk:function(groups,count,chunkSize){function addToGroup(itemsContainer,groupSize){var children=itemsContainer.element.children,oldSize=children.length,toAdd=Math.min(groupSize-itemsContainer.items.length,chunkSize);_SafeHtml.insertAdjacentHTMLUnsafe(itemsContainer.element,"beforeend",_Helpers._repeat("<div class='win-container win-backdrop'></div>",toAdd));for(var i=0;i<toAdd;i++){var container=children[oldSize+i];itemsContainer.items.push(container),that.containers.push(container)}}function newGroup(group){var node={header:that._listView._groupDataSource?that._createHeaderContainer():null,itemsContainer:{element:that._createItemsContainer(),items:[]}};that.tree.push(node),that.keyToGroupIndex[group.key]=that.tree.length-1,addToGroup(node.itemsContainer,group.size)}var that=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=groups.length){var last=this.tree[this.tree.length-1],finalSize=groups[this.tree.length-1].size;if(last.itemsContainer.items.length<finalSize)return addToGroup(last.itemsContainer,finalSize),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<groups.length&&newGroup(groups[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_createChunkWithBlocks:function(groups,count,blockSize,chunkSize){function addToGroup(itemsContainer,toAdd){var indexOfNextGroupItem,lastExistingBlock=itemsContainer.itemsBlocks.length?itemsContainer.itemsBlocks[itemsContainer.itemsBlocks.length-1]:null;if(toAdd=Math.min(toAdd,chunkSize),lastExistingBlock&&lastExistingBlock.items.length<blockSize){var emptySpotsToFill=Math.min(toAdd,blockSize-lastExistingBlock.items.length),sizeOfOldLastBlock=lastExistingBlock.items.length,indexOfNextGroupItem=(itemsContainer.itemsBlocks.length-1)*blockSize+sizeOfOldLastBlock,containersMarkup=_Helpers._stripedContainers(emptySpotsToFill,indexOfNextGroupItem);_SafeHtml.insertAdjacentHTMLUnsafe(lastExistingBlock.element,"beforeend",containersMarkup),children=lastExistingBlock.element.children;for(var j=0;j<emptySpotsToFill;j++){var child=children[sizeOfOldLastBlock+j];lastExistingBlock.items.push(child),that.containers.push(child)}toAdd-=emptySpotsToFill}indexOfNextGroupItem=itemsContainer.itemsBlocks.length*blockSize;var newBlocksCount=Math.floor(toAdd/blockSize),markup="",firstBlockFirstItemIndex=indexOfNextGroupItem,secondBlockFirstItemIndex=indexOfNextGroupItem+blockSize;if(newBlocksCount>0){var pairOfItemBlocks=["<div class='win-itemsblock'>"+_Helpers._stripedContainers(blockSize,firstBlockFirstItemIndex)+"</div>","<div class='win-itemsblock'>"+_Helpers._stripedContainers(blockSize,secondBlockFirstItemIndex)+"</div>"];markup=_Helpers._repeat(pairOfItemBlocks,newBlocksCount),indexOfNextGroupItem+=newBlocksCount*blockSize}var sizeOfNewLastBlock=toAdd%blockSize;sizeOfNewLastBlock>0&&(markup+="<div class='win-itemsblock'>"+_Helpers._stripedContainers(sizeOfNewLastBlock,indexOfNextGroupItem)+"</div>",indexOfNextGroupItem+=sizeOfNewLastBlock,newBlocksCount++);var blocksTemp=_Global.document.createElement("div");_SafeHtml.setInnerHTMLUnsafe(blocksTemp,markup);for(var children=blocksTemp.children,i=0;i<newBlocksCount;i++){var block=children[i],blockNode={element:block,items:_Helpers._nodeListToArray(block.children)};itemsContainer.itemsBlocks.push(blockNode);for(var n=0;n<blockNode.items.length;n++)that.containers.push(blockNode.items[n])}}function newGroup(group){var node={header:that._listView._groupDataSource?that._createHeaderContainer():null,itemsContainer:{element:that._createItemsContainer(),itemsBlocks:[]}};that.tree.push(node),that.keyToGroupIndex[group.key]=that.tree.length-1,addToGroup(node.itemsContainer,group.size)}var that=this;if(this._listView._writeProfilerMark("createChunk,StartTM"),this.tree.length&&this.tree.length<=groups.length){var lastContainer=this.tree[this.tree.length-1].itemsContainer,finalSize=groups[this.tree.length-1].size,currentSize=0;if(lastContainer.itemsBlocks.length&&(currentSize=(lastContainer.itemsBlocks.length-1)*blockSize+lastContainer.itemsBlocks[lastContainer.itemsBlocks.length-1].items.length),
currentSize<finalSize)return addToGroup(lastContainer,finalSize-currentSize),void this._listView._writeProfilerMark("createChunk,StopTM")}this.tree.length<groups.length&&newGroup(groups[this.tree.length]),this._listView._writeProfilerMark("createChunk,StopTM")},_generateCreateContainersWorker:function(){var that=this,counter=0,skipWait=!1;return function work(info){that._listView._versionManager.locked?info.setPromise(that._listView._versionManager.unlocked.then(function(){return work})):that._listView._itemsCount().then(function(count){var zooming=!skipWait&&shouldWaitForSeZo(that._listView);if(zooming)info.setPromise(waitForSeZo(that._listView).then(function(timedOut){return skipWait=timedOut,work}));else{if(that._listView._isZombie())return;skipWait=!1;var end=_BaseUtils._now()+_VirtualizeContentsView._createContainersJobTimeslice,groups=that._getGroups(count),startLength=that.containers.length,realizedToEnd=that.end===that.containers.length,chunkSize=_VirtualizeContentsView._chunkSize;do that._blockSize?that._createChunkWithBlocks(groups,count,that._blockSize,chunkSize):that._createChunk(groups,count,chunkSize),counter++;while(that.containers.length<count&&_BaseUtils._now()<end);that._listView._writeProfilerMark("createContainers yields containers("+that.containers.length+"),info"),that._listView._affectedRange.add({start:startLength,end:that.containers.length},count),realizedToEnd?(that.stopWork(),that._listView._writeProfilerMark(that._state.name+"_relayout,info"),that._state.relayout()):(that._listView._writeProfilerMark(that._state.name+"_layoutNewContainers,info"),that._state.layoutNewContainers()),that.containers.length<count?info.setWork(work):(that._listView._writeProfilerMark("createContainers completed steps("+counter+"),info"),that._creatingContainersWork.complete())}})}},_scheduleLazyTreeCreation:function(){return Scheduler.schedule(this._generateCreateContainersWorker(),Scheduler.Priority.idle,this,"WinJS.UI.ListView.LazyTreeCreation")},_createContainers:function(){this.tree=null,this.keyToGroupIndex=null,this.containers=null,this._expandedRange=null;var count,that=this;return this._listView._itemsCount().then(function(c){if(0===c&&that._listView._hideProgressBar(),count=c,that._listView._writeProfilerMark("createContainers("+count+"),StartTM"),that._listView._groupDataSource)return that._listView._groups.initialize()}).then(function(){return that._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StartTM"),count&&that._listView._groups.length()?that._listView._layout.numberOfItemsPerItemsBlock:null}).then(function(blockSize){that._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+blockSize+"),info"),that._listView._writeProfilerMark("numberOfItemsPerItemsBlock,StopTM"),that._listView._resetCanvas(),that.tree=[],that.keyToGroupIndex={},that.containers=[],that._blockSize=blockSize;var stop,groups=that._getGroups(count),end=_BaseUtils._now()+_VirtualizeContentsView._maxTimePerCreateContainers,chunkSize=Math.min(_VirtualizeContentsView._startupChunkSize,_VirtualizeContentsView._chunkSize);do stop=blockSize?that._createChunkWithBlocks(groups,count,blockSize,chunkSize):that._createChunk(groups,count,chunkSize);while(_BaseUtils._now()<end&&that.containers.length<count&&!stop);if(that._listView._writeProfilerMark("createContainers created("+that.containers.length+"),info"),that._listView._affectedRange.add({start:0,end:that.containers.length},count),that.containers.length<count){var jobNode=that._scheduleLazyTreeCreation();that._creatingContainersWork.promise.done(null,function(){jobNode.cancel()})}else that._listView._writeProfilerMark("createContainers completed synchronously,info"),that._creatingContainersWork.complete();that._listView._writeProfilerMark("createContainers("+count+"),StopTM")})},_updateItemsBlocks:function(blockSize){function createNewBlock(){var element=_Global.document.createElement("div");return element.className=_Constants._itemsBlockClass,element}function updateGroup(itemsContainer,startIndex){function rebuildItemsContainer(){itemsContainer.itemsBlocks=null,itemsContainer.items=[];for(var i=0;i<itemsCount;i++){var container=that.containers[startIndex+i];itemsContainer.element.appendChild(container),itemsContainer.items.push(container)}}function rebuildItemsContainerWithBlocks(){itemsContainer.itemsBlocks=[{element:blockElements.length?blockElements.shift():createNewBlock(),items:[]}];for(var currentBlock=itemsContainer.itemsBlocks[0],i=0;i<itemsCount;i++){if(currentBlock.items.length===blockSize){var nextBlock=blockElements.length?blockElements.shift():createNewBlock();itemsContainer.itemsBlocks.push({element:nextBlock,items:[]}),currentBlock=itemsContainer.itemsBlocks[itemsContainer.itemsBlocks.length-1]}var container=that.containers[startIndex+i];currentBlock.element.appendChild(container),currentBlock.items.push(container)}itemsContainer.items=null}var b,blockElements=[],itemsCount=0,blocks=itemsContainer.itemsBlocks;if(blocks)for(b=0;b<blocks.length;b++)itemsCount+=blocks[b].items.length,blockElements.push(blocks[b].element);else itemsCount=itemsContainer.items.length;for(usingStructuralNodes?rebuildItemsContainerWithBlocks():rebuildItemsContainer(),b=0;b<blockElements.length;b++){var block=blockElements[b];block.parentNode===itemsContainer.element&&itemsContainer.element.removeChild(block)}return itemsCount}for(var that=this,usingStructuralNodes=!!blockSize,g=0,startIndex=0;g<this.tree.length;g++)startIndex+=updateGroup(this.tree[g].itemsContainer,startIndex);that._blockSize=blockSize},_layoutItems:function(){var that=this;return this._listView._itemsCount().then(function(){return Promise.as(that._listView._layout.numberOfItemsPerItemsBlock).then(function(blockSize){that._listView._writeProfilerMark("numberOfItemsPerItemsBlock("+blockSize+"),info"),blockSize!==that._blockSize&&(that._updateItemsBlocks(blockSize),that._listView._itemsBlockExtent=-1);var changedRange,affectedRange=that._listView._affectedRange.get();return affectedRange&&(changedRange={firstIndex:Math.max(affectedRange.start-1,0),lastIndex:Math.min(that.containers.length-1,affectedRange.end)},changedRange.firstIndex<that.containers.length||0===that.containers.length)?that._listView._layout.layout(that.tree,changedRange,that._modifiedElements||[],that._modifiedGroups||[]):(that._listView._affectedRange.clear(),{realizedRangeComplete:Promise.wrap(),layoutComplete:Promise.wrap()})})})},updateTree:function(count,delta,modifiedElements){return this._listView._writeProfilerMark(this._state.name+"_updateTree,info"),this._state.updateTree(count,delta,modifiedElements)},_updateTreeImpl:function(count,delta,modifiedElements,skipUnrealizeItems){function removeElements(array){for(var i=0,len=array.length;i<len;i++){var itemBox=array[i];itemBox.parentNode.removeChild(itemBox)}}if(this._executeAnimations=!0,this._modifiedElements=modifiedElements,!modifiedElements.handled){modifiedElements.handled=!0,this._listView._writeProfilerMark("_updateTreeImpl,StartTM");var i,that=this;skipUnrealizeItems||this._unrealizeItems();for(var i=0,len=modifiedElements.length;i<len;i++)modifiedElements[i]._itemBox&&modifiedElements[i]._itemBox.parentNode&&_ElementUtilities.removeClass(modifiedElements[i]._itemBox.parentNode,_Constants._selectedClass);this.items.each(function(index,item,itemData){itemData.container&&_ElementUtilities.removeClass(itemData.container,_Constants._selectedClass),itemData.container&&_ElementUtilities.addClass(itemData.container,_Constants._backdropClass)});var removedGroups=this._listView._updateContainers(this._getGroups(count),count,delta,modifiedElements);removeElements(removedGroups.removedHeaders),removeElements(removedGroups.removedItemsContainers);for(var i=0,len=modifiedElements.length;i<len;i++){var modifiedElement=modifiedElements[i];if(modifiedElement.newIndex!==-1){if(modifiedElement.element=this.getContainer(modifiedElement.newIndex),!modifiedElement.element)throw"Container missing after updateContainers."}else _ElementUtilities.removeClass(modifiedElement.element,_Constants._backdropClass)}var activeElement=_Global.document.activeElement;this._listView._canvas.contains(activeElement)&&(this._requireFocusRestore=activeElement),this._deferredReparenting=[],this.items.each(function(index,item,itemData){var container=that.getContainer(index),itemBox=itemData.itemBox;itemBox&&container&&(itemData.container=container,itemBox.parentNode!==container&&(index>=that.firstIndexDisplayed&&index<=that.lastIndexDisplayed?that._appendAndRestoreFocus(container,itemBox):that._deferredReparenting.push({itemBox:itemBox,container:container})),_ElementUtilities.removeClass(container,_Constants._backdropClass),_ElementUtilities[that._listView.selection._isIncluded(index)?"addClass":"removeClass"](container,_Constants._selectedClass),!that._listView.selection._isIncluded(index)&&_ElementUtilities.hasClass(itemBox,_Constants._selectedClass)&&_ItemEventsHandler._ItemEventsHandler.renderSelection(itemBox,itemData.element,!1,!0))}),this._listView._writeProfilerMark("_updateTreeImpl,StopTM")}},_completeUpdateTree:function(){if(this._deferredReparenting){var deferredCount=this._deferredReparenting.length;if(deferredCount>0){var perfId="_completeReparenting("+deferredCount+")";this._listView._writeProfilerMark(perfId+",StartTM");for(var deferredItem,i=0;i<deferredCount;i++)deferredItem=this._deferredReparenting[i],this._appendAndRestoreFocus(deferredItem.container,deferredItem.itemBox);this._deferredReparenting=[],this._listView._writeProfilerMark(perfId+",StopTM")}}this._requireFocusRestore=null},_appendAndRestoreFocus:function(container,itemBox){if(itemBox.parentNode!==container){var activeElement;if(this._requireFocusRestore&&(activeElement=_Global.document.activeElement),this._requireFocusRestore&&this._requireFocusRestore===activeElement&&(container.contains(activeElement)||itemBox.contains(activeElement))&&(this._listView._unsetFocusOnItem(),activeElement=_Global.document.activeElement),_ElementUtilities.empty(container),container.appendChild(itemBox),this._requireFocusRestore&&activeElement===this._listView._keyboardEventsHelper){var focused=this._listView._selection._getFocused();focused.type===_UI.ObjectType.item&&this.items.itemBoxAt(focused.index)===itemBox&&(_ElementUtilities._setActive(this._requireFocusRestore),this._requireFocusRestore=null)}}},_startAnimations:function(){this._listView._writeProfilerMark("startAnimations,StartTM");var that=this;this._hasAnimationInViewportPending=!1;var animationPromise=Promise.as(this._listView._layout.executeAnimations()).then(function(){that._listView._writeProfilerMark("startAnimations,StopTM")});return animationPromise},_setState:function(NewStateType,arg){if(!this._listView._isZombie()){var prevStateName=this._state.name;this._state=new NewStateType(this,arg),this._listView._writeProfilerMark(this._state.name+"_enter from("+prevStateName+"),info"),this._state.enter()}},getAdjacent:function(currentFocus,direction){var that=this;return this.waitForEntityPosition(currentFocus).then(function(){return that._listView._layout.getAdjacent(currentFocus,direction)})},hitTest:function(x,y){if(this._realizedRangeLaidOut)return{index:-1,insertAfterIndex:-1};var retVal=this._listView._layout.hitTest(x,y);return retVal.index=_ElementUtilities._clamp(retVal.index,-1,this._listView._cachedCount-1,0),retVal.insertAfterIndex=_ElementUtilities._clamp(retVal.insertAfterIndex,-1,this._listView._cachedCount-1,0),retVal},_createTreeBuildingSignal:function(){if(!this._creatingContainersWork){this._creatingContainersWork=new _Signal;var that=this;this._creatingContainersWork.promise.done(function(){that._creatingContainersWork=null},function(){that._creatingContainersWork=null})}},_createLayoutSignal:function(){var that=this;this._layoutCompleted||(this._layoutCompleted=new _Signal,this._layoutCompleted.promise.done(function(){that._layoutCompleted=null},function(){that._layoutCompleted=null})),this._realizedRangeLaidOut||(this._realizedRangeLaidOut=new _Signal,this._realizedRangeLaidOut.promise.done(function(){that._realizedRangeLaidOut=null},function(){that._realizedRangeLaidOut=null}))},_getLayoutCompleted:function(){return this._layoutCompleted?Promise._cancelBlocker(this._layoutCompleted.promise):Promise.wrap()},_createSurfaceChild:function(className,insertAfter){var element=_Global.document.createElement("div");return element.className=className,this._listView._canvas.insertBefore(element,insertAfter?insertAfter.nextElementSibling:null),element},_executeScrollToFunctor:function(){var that=this;return Promise.as(this._scrollToFunctor?this._scrollToFunctor():null).then(function(scroll){that._scrollToFunctor=null,scroll=scroll||{},+scroll.position===scroll.position&&(that._scrollbarPos=scroll.position),that._direction=scroll.direction||"right"})}},{_defaultPagesToPrefetch:2,_iOSMaxLeadingPages:6,_iOSMaxTrailingPages:2,_disableCustomPagesPrefetch:!1,_waitForSeZoIntervalDuration:100,_waitForSeZoTimeoutDuration:500,_chunkSize:500,_startupChunkSize:100,_maxTimePerCreateContainers:5,_createContainersJobTimeslice:15,_blocksToRelease:10,_realizationLevel:{skip:"skip",realize:"realize",normal:"normal"}}),CreatedState=_Base.Class.define(function(view){this.view=view,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},{name:"CreatedState",enter:function(){this.view._createTreeBuildingSignal(),this.view._createLayoutSignal()},stop:nop,realizePage:nop,rebuildTree:function(){this.view._setState(BuildingState)},relayout:function(){this.view._setState(BuildingState)},layoutNewContainers:nop,waitForEntityPosition:function(){return this.view._setState(BuildingState),this.view._getLayoutCompleted()},updateTree:nop}),BuildingState=_Base.Class.define(function(view){this.view=view},{name:"BuildingState",enter:function(){this.canceling=!1,this.view._createTreeBuildingSignal(),this.view._createLayoutSignal();var that=this,promiseStoredSignal=new _Signal;this.promise=promiseStoredSignal.promise.then(function(){return that.view._createContainers()}).then(function(){that.view._setState(LayingoutState)},function(error){return that.canceling||(that.view._setState(CreatedState),that.view._listView._raiseViewComplete()),Promise.wrapError(error)}),promiseStoredSignal.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._setState(CreatedState)},realizePage:nop,rebuildTree:function(){this.canceling=!0,this.promise.cancel(),this.enter()},relayout:nop,layoutNewContainers:nop,waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:nop}),LayingoutState=_Base.Class.define(function(view,NextStateType){this.view=view,this.nextStateType=NextStateType||RealizingState},{name:"LayingoutState",enter:function(){var that=this;this.canceling=!1,this.view._createLayoutSignal(),this.view._listView._writeProfilerMark(this.name+"_enter_layoutItems,StartTM");var promiseStoredSignal=new _Signal;this.promise=promiseStoredSignal.promise.then(function(){return that.view._layoutItems()}).then(function(layoutPromises){return that.view._layoutWork=layoutPromises.layoutComplete,layoutPromises.realizedRangeComplete}).then(function(){that.view._listView._writeProfilerMark(that.name+"_enter_layoutItems,StopTM"),that.view._listView._clearInsertedItems(),that.view._setAnimationInViewportState(that.view._modifiedElements),that.view._modifiedElements=[],that.view._modifiedGroups=[],that.view._realizedRangeLaidOut.complete(),that.view._layoutWork.then(function(){that.view._listView._writeProfilerMark(that.name+"_enter_layoutCompleted,info"),that.view._listView._affectedRange.clear(),that.view._layoutCompleted.complete()}),that.canceling||that.view._setState(that.nextStateType)},function(error){return that.view._listView._writeProfilerMark(that.name+"_enter_layoutCanceled,info"),that.canceling||(that.view.firstIndexDisplayed=that.view.lastIndexDisplayed=-1,that.view._updateAriaMarkers(!0,that.view.firstIndexDisplayed,that.view.lastIndexDisplayed),that.view._setState(CompletedState)),Promise.wrapError(error)}),promiseStoredSignal.complete(),this.canceling&&this.promise.cancel()},cancelLayout:function(switchState){this.view._listView._writeProfilerMark(this.name+"_cancelLayout,info"),this.canceling=!0,this.promise&&this.promise.cancel(),switchState&&this.view._setState(LayoutCanceledState)},stop:function(){this.cancelLayout(!0)},realizePage:nop,rebuildTree:function(){this.cancelLayout(!1),this.view._setState(BuildingState)},relayout:function(){this.cancelLayout(!1),this.enter()},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)}}),LayoutCanceledState=_Base.Class.define(function(view){this.view=view},{name:"LayoutCanceledState",enter:nop,stop:nop,realizePage:function(){this.relayout()},rebuildTree:function(){this.view._setState(BuildingState)},relayout:function(){this.view._setState(LayingoutState)},layoutNewContainers:function(){this.relayout()},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)}}),RealizingState=_Base.Class.define(function(view){this.view=view,this.nextState=UnrealizingState,this.relayoutNewContainers=!0},{name:"RealizingState",enter:function(){var that=this,promiseStoredSignal=new _Signal;this.promise=promiseStoredSignal.promise.then(function(){return that.view._executeScrollToFunctor()}).then(function(){return that.relayoutNewContainers=!1,Promise._cancelBlocker(that.view._realizePageImpl())}).then(function(){that.view._state===that&&(that.view._completeUpdateTree(),that.view._listView._writeProfilerMark("RealizingState_to_UnrealizingState"),that.view._setState(that.nextState))},function(error){return that.view._state!==that||that.canceling||(that.view._listView._writeProfilerMark("RealizingState_to_CanceledState"),that.view._setState(CanceledState)),Promise.wrapError(error)}),promiseStoredSignal.complete()},stop:function(){this.canceling=!0,this.promise.cancel(),this.view._cancelRealize(),this.view._setState(CanceledState)},realizePage:function(){this.canceling=!0,this.promise.cancel(),this.enter()},rebuildTree:function(){this.stop(),this.view._setState(BuildingState)},relayout:function(){this.stop(),this.view._setState(LayingoutState)},layoutNewContainers:function(){this.relayoutNewContainers?this.relayout():(this.view._createLayoutSignal(),this.view._relayoutInComplete=!0)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)},setLoadingState:function(state){this.view._listView._setViewState(state)}}),CanceledState=_Base.Class.define(function(view){this.view=view},{name:"CanceledState",enter:nop,stop:function(){this.view._cancelRealize()},realizePage:function(NewStateType){this.stop(),this.view._setState(NewStateType)},rebuildTree:function(){this.stop(),this.view._setState(BuildingState)},relayout:function(NextStateType){this.stop(),this.view._setState(LayingoutState,NextStateType)},layoutNewContainers:function(){this.relayout(CanceledState)},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)}}),ScrollingState=_Base.Class.derive(RealizingState,function(view){this.view=view,this.nextState=ScrollingPausedState,this.relayoutNewContainers=!0},{name:"ScrollingState",setLoadingState:function(){}}),ScrollingPausedState=_Base.Class.derive(CanceledState,function(view){this.view=view},{name:"ScrollingPausedState",enter:function(){var that=this;this.promise=Promise._cancelBlocker(this.view._scrollEndPromise).then(function(){that.view._setState(UnrealizingState)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()}}),UnrealizingState=_Base.Class.define(function(view){this.view=view},{name:"UnrealizingState",enter:function(){var that=this;this.promise=this.view._lazilyUnrealizeItems().then(function(){return that.view._listView._writeProfilerMark("_renderCompletePromise wait starts,info"),that.view._renderCompletePromise}).then(function(){that.view._setState(CompletedState)})},stop:function(){this.view._cancelRealize(),this.promise.cancel(),this.view._setState(CanceledState)},realizePage:function(NewStateType){this.promise.cancel(),this.view._setState(NewStateType)},rebuildTree:function(){this.view._setState(BuildingState)},relayout:function(){this.view._setState(LayingoutState)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements)}}),RealizingAnimatingState=_Base.Class.define(function(view,realizePromise){this.view=view,this.realizePromise=realizePromise,this.realizeId=1},{name:"RealizingAnimatingState",enter:function(){var that=this;this.animating=!0,this.animatePromise=this.view._startAnimations(),this.animateSignal=new _Signal,this.view._executeAnimations=!1,this.animatePromise.done(function(){that.animating=!1,that.modifiedElements?(that.view._updateTreeImpl(that.count,that.delta,that.modifiedElements),that.modifiedElements=null,that.view._setState(CanceledState)):that.animateSignal.complete()},function(error){return that.animating=!1,Promise.wrapError(error)}),this._waitForRealize()},_waitForRealize:function(){var that=this;this.realizing=!0,this.realizePromise.done(function(){that.realizing=!1});var currentRealizeId=++this.realizeId;Promise.join([this.realizePromise,this.animateSignal.promise]).done(function(){currentRealizeId===that.realizeId&&(that.view._completeUpdateTree(),that.view._listView._writeProfilerMark("RealizingAnimatingState_to_UnrealizingState"),that.view._setState(UnrealizingState))})},stop:function(stopTreeCreation){this.realizePromise.cancel(),this.view._cancelRealize(),stopTreeCreation&&(this.animatePromise.cancel(),this.view._setState(CanceledState))},realizePage:function(){if(!this.modifiedElements){var that=this;this.realizePromise=this.view._executeScrollToFunctor().then(function(){return Promise._cancelBlocker(that.view._realizePageImpl())}),this._waitForRealize()}},rebuildTree:function(){this.stop(!0),this.view._setState(BuildingState)},relayout:function(){this.stop(!0),this.modifiedElements&&(this.view._updateTreeImpl(this.count,this.delta,this.modifiedElements),this.modifiedElements=null),this.view._setState(LayingoutState)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._relayoutInComplete=!0},waitForEntityPosition:function(){return this.view._getLayoutCompleted()},updateTree:function(count,delta,modifiedElements){if(this.animating){var previousModifiedElements=this.modifiedElements;return this.count=count,this.delta=delta,this.modifiedElements=modifiedElements,previousModifiedElements?Promise.cancel:this.animatePromise}return this.view._updateTreeImpl(count,delta,modifiedElements)},setLoadingState:function(state){this.view._listView._setViewState(state)}}),CompletedState=_Base.Class.derive(CanceledState,function(view){this.view=view},{name:"CompletedState",enter:function(){this._stopped=!1,this.view._setupDeferredActions(),this.view._realizationLevel=_VirtualizeContentsView._realizationLevel.normal,this.view._listView._raiseViewComplete(),this.view._state===this&&this.view._relayoutInComplete&&!this._stopped&&this.view._setState(LayingoutNewContainersState)},stop:function(){this._stopped=!0,CanceledState.prototype.stop.call(this)},layoutNewContainers:function(){this.view._createLayoutSignal(),this.view._setState(LayingoutNewContainersState)},updateTree:function(count,delta,modifiedElements){return this.view._updateTreeImpl(count,delta,modifiedElements,!0)}}),LayingoutNewContainersState=_Base.Class.derive(CanceledState,function(view){this.view=view},{name:"LayingoutNewContainersState",enter:function(){var that=this;this.promise=Promise.join([this.view.deferTimeout,this.view._layoutWork]),this.promise.then(function(){that.view._relayoutInComplete=!1,that.relayout(CanceledState)})},stop:function(){this.promise.cancel(),this.view._cancelRealize()},realizePage:function(NewStateType){this.stop(),this.view._setState(LayingoutState,NewStateType)},layoutNewContainers:function(){this.view._createLayoutSignal()}});return _VirtualizeContentsView})})}),define("require-style!less/styles-listview",[],function(){}),define("require-style!less/colors-listview",[],function(){}),define("WinJS/Controls/ListView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../_Accents","../Animations","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../_Signal","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_SafeHtml","../Utilities/_TabContainer","../Utilities/_UI","../Utilities/_VersionManager","./ElementResizeInstrument","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler","./ListView/_BrowseMode","./ListView/_ErrorMessages","./ListView/_GroupFocusCache","./ListView/_GroupsContainer","./ListView/_Helpers","./ListView/_ItemsContainer","./ListView/_Layouts","./ListView/_SelectionManager","./ListView/_VirtualizeContentsView","require-style!less/styles-listview","require-style!less/colors-listview"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,_Accents,Animations,_TransitionAnimation,BindingList,Promise,Scheduler,_Signal,_Control,_Dispose,_ElementUtilities,_Hoverable,_ItemsManager,_SafeHtml,_TabContainer,_UI,_VersionManager,_ElementResizeInstrument,_Constants,_ItemEventsHandler,_BrowseMode,_ErrorMessages,_GroupFocusCache,_GroupsContainer,_Helpers,_ItemsContainer,_Layouts,_SelectionManager,_VirtualizeContentsView){"use strict";function disposeControls(){var temp=controlsToDispose;controlsToDispose=[],temp=temp.filter(function(c){return!c._isZombie()||(c._dispose(),!1)}),controlsToDispose=controlsToDispose.concat(temp)}function scheduleForDispose(lv){controlsToDispose.push(lv),disposeControlTimeout&&disposeControlTimeout.cancel(),disposeControlTimeout=Promise.timeout(DISPOSE_TIMEOUT).then(disposeControls)}function getOffsetRight(element){return element.offsetParent?element.offsetParent.offsetWidth-element.offsetLeft-element.offsetWidth:0}_Accents.createAccentRule(".win-listview:not(.win-selectionstylefilled) .win-selectioncheckmarkbackground,         .win-itemcontainer:not(.win-selectionstylefilled) .win-selectioncheckmarkbackground",[{name:"border-color",value:_Accents.ColorTypes.accent},{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-listview:not(.win-selectionstylefilled) .win-container.win-selected .win-selectionborder,         .win-itemcontainer:not(.win-selectionstylefilled).win-container.win-selected .win-selectionborder",[{name:"border-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-listview.win-selectionstylefilled .win-selected .win-selectionbackground,         .win-itemcontainer.win-selectionstylefilled.win-selected .win-selectionbackground",[{name:"background-color",value:_Accents.ColorTypes.accent}]);var disposeControlTimeout,transformNames=_BaseUtils._browserStyleEquivalents.transform,DISPOSE_TIMEOUT=1e3,controlsToDispose=[],uniqueID=_ElementUtilities._uniqueID,strings={get notCompatibleWithSemanticZoom(){return"ListView can only be used with SemanticZoom if randomAccess loading behavior is specified."},get listViewInvalidItem(){return"Item must provide index, key or description of corresponding item."},get listViewViewportAriaLabel(){return _Resources._getWinJSString("ui/listViewViewportAriaLabel").value}},requireSupportedForProcessing=_BaseUtils.requireSupportedForProcessing,ListViewAnimationType={entrance:"entrance",contentTransition:"contentTransition"};_Base.Namespace.define("WinJS.UI",{ListViewAnimationType:ListViewAnimationType,ListView:_Base.Namespace._lazy(function(){var AffectedRange=_Base.Class.define(function(){this.clear()},{add:function(range,itemsCount){if(range._lastKnownSizeOfData=itemsCount,this._range){this._range.start=Math.min(this._range.start,range.start);var previousUnmodifiedItemsFromEnd=this._range._lastKnownSizeOfData-this._range.end,newUnmodifiedItemsFromEnd=range._lastKnownSizeOfData-range.end,finalUnmodifiedItemsFromEnd=Math.min(previousUnmodifiedItemsFromEnd,newUnmodifiedItemsFromEnd);this._range._lastKnownSizeOfData=range._lastKnownSizeOfData,this._range.end=this._range._lastKnownSizeOfData-finalUnmodifiedItemsFromEnd}else this._range=range},addAll:function(){this.add({start:0,end:Number.MAX_VALUE},Number.MAX_VALUE)},clear:function(){this._range=null},get:function(){return this._range}}),ZoomableView=_Base.Class.define(function(listView){this._listView=listView},{getPanAxis:function(){return this._listView._getPanAxis()},configureForZoom:function(isZoomedOut,isCurrentView,triggerZoom,prefetchedPages){this._listView._configureForZoom(isZoomedOut,isCurrentView,triggerZoom,prefetchedPages)},setCurrentItem:function(x,y){this._listView._setCurrentItem(x,y)},getCurrentItem:function(){return this._listView._getCurrentItem()},beginZoom:function(){return this._listView._beginZoom()},positionItem:function(item,position){return this._listView._positionItem(item,position)},endZoom:function(isCurrentView){this._listView._endZoom(isCurrentView)},pinching:{get:function(){return this._listView._pinching},set:function(value){this._listView._pinching=value}}}),ListView=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("div"),this._id=element.id||"",this._writeProfilerMark("constructor,StartTM"),options=options||{},element.winControl=this,_ElementUtilities.addClass(element,"win-disposable"),this._affectedRange=new AffectedRange,this._mutationObserver=new _ElementUtilities._MutationObserver(this._itemPropertyChange.bind(this)),this._versionManager=null,this._insertedItems={},this._element=element,this._startProperty=null,this._scrollProperty=null,this._scrollLength=null,this._scrolling=!1,this._zooming=!1,this._pinching=!1,this._itemsManager=null,this._canvas=null,this._cachedCount=_Constants._UNINITIALIZED,this._loadingState=this._LoadingState.complete,this._firstTimeDisplayed=!0,this._currentScrollPosition=0,this._lastScrollPosition=0,this._notificationHandlers=[],this._itemsBlockExtent=-1,this._lastFocusedElementInGroupTrack={type:_UI.ObjectType.item,index:-1},this._headerFooterVisibilityStatus={headerVisible:!1,footerVisible:!1},this._viewportWidth=_Constants._UNINITIALIZED,this._viewportHeight=_Constants._UNINITIALIZED,this._manipulationState=_ElementUtilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED,this._maxDeferredItemCleanup=Number.MAX_VALUE,this._groupsToRemove={},this._setupInternalTree(),this._isCurrentZoomView=!0,this._dragSource=!1,this._reorderable=!1,this._groupFocusCache=new _GroupFocusCache._UnsupportedGroupFocusCache,this._viewChange=_Constants._ViewChange.rebuild,this._scrollToFunctor=null,this._setScrollbarPosition=!1,this._view=new _VirtualizeContentsView._VirtualizeContentsView(this),this._selection=new _SelectionManager._SelectionManager(this),this._createTemplates(),this._groupHeaderRenderer=_ItemsManager._trivialHtmlRenderer,this._itemRenderer=_ItemsManager._trivialHtmlRenderer,this._groupHeaderRelease=null,this._itemRelease=null,options.itemDataSource)this._dataSource=options.itemDataSource;else{var list=new BindingList.List;this._dataSource=list.dataSource}this._selectionMode=_UI.SelectionMode.multi,this._tap=_UI.TapBehavior.invokeOnly,
this._groupHeaderTap=_UI.GroupHeaderTapBehavior.invoke,this._mode=new _BrowseMode._SelectionMode(this),this._groups=new _GroupsContainer._NoGroups(this),this._updateItemsAriaRoles(),this._updateGroupHeadersAriaRoles(),this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._element.tabIndex=-1,this._tabManager.tabIndex=this._tabIndex,"absolute"!==this._element.style.position&&"relative"!==this._element.style.position&&(this._element.style.position="relative"),this._updateItemsManager(),options.layout||this._updateLayout(new _Layouts.GridLayout),this._attachEvents(),this._runningInit=!0,_Control.setOptions(this,options),this._runningInit=!1,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},layout:{get:function(){return this._layoutImpl},set:function(layoutObject){this._updateLayout(layoutObject),this._runningInit||(this._view.reset(),this._updateItemsManager(),this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},maxLeadingPages:{get:function(){return this._view.maxLeadingPages},set:function(value){this._view.maxLeadingPages=Math.max(0,Math.floor(value))}},maxTrailingPages:{get:function(){return this._view.maxTrailingPages},set:function(value){this._view.maxTrailingPages=Math.max(0,Math.floor(value))}},pagesToLoad:{get:function(){return 2*_VirtualizeContentsView._VirtualizeContentsView._defaultPagesToPrefetch+1},set:function(){_ElementUtilities._deprecated(_ErrorMessages.pagesToLoadIsDeprecated)}},pagesToLoadThreshold:{get:function(){return 0},set:function(){_ElementUtilities._deprecated(_ErrorMessages.pagesToLoadThresholdIsDeprecated)}},groupDataSource:{get:function(){return this._groupDataSource},set:function(newValue){function groupStatusChanged(eventObject){eventObject.detail===_UI.DataSourceStatus.failure&&(that.itemDataSource=null,that.groupDataSource=null)}this._writeProfilerMark("set_groupDataSource,info");var that=this;this._groupDataSource&&this._groupDataSource.removeEventListener&&this._groupDataSource.removeEventListener("statuschanged",groupStatusChanged,!1),this._groupDataSource=newValue,this._groupFocusCache=newValue&&this._supportsGroupHeaderKeyboarding?new _GroupFocusCache._GroupFocusCache(this):new _GroupFocusCache._UnsupportedGroupFocusCache,this._groupDataSource&&this._groupDataSource.addEventListener&&this._groupDataSource.addEventListener("statuschanged",groupStatusChanged,!1),this._createGroupsContainer(),this._runningInit?(this._updateGroupWork(),this._resetLayout()):(this._view.reset(),this._pendingLayoutReset=!0,this._pendingGroupWork=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},_updateGroupWork:function(){this._pendingGroupWork=!1,this._groupDataSource?_ElementUtilities.addClass(this._element,_Constants._groupsClass):_ElementUtilities.removeClass(this._element,_Constants._groupsClass),this._resetLayout()},automaticallyLoadPages:{get:function(){return!1},set:function(){_ElementUtilities._deprecated(_ErrorMessages.automaticallyLoadPagesIsDeprecated)}},loadingBehavior:{get:function(){return"randomAccess"},set:function(){_ElementUtilities._deprecated(_ErrorMessages.loadingBehaviorIsDeprecated)}},selectionMode:{get:function(){return this._selectionMode},set:function(newMode){if("string"==typeof newMode&&newMode.match(/^(none|single|multi)$/)){if(_BaseUtils.isPhone&&newMode===_UI.SelectionMode.single)return;return this._selectionMode=newMode,this._element.setAttribute("aria-multiselectable",this._multiSelection()),this._updateItemsAriaRoles(),void this._configureSelectionMode()}throw new _ErrorFromName("WinJS.UI.ListView.ModeIsInvalid",_ErrorMessages.modeIsInvalid)}},tapBehavior:{get:function(){return this._tap},set:function(tap){_BaseUtils.isPhone&&tap===_UI.TapBehavior.directSelect||(this._tap=tap,this._updateItemsAriaRoles(),this._configureSelectionMode())}},groupHeaderTapBehavior:{get:function(){return this._groupHeaderTap},set:function(tap){this._groupHeaderTap=tap,this._updateGroupHeadersAriaRoles()}},swipeBehavior:{get:function(){return"none"},set:function(value){_ElementUtilities._deprecated(_ErrorMessages.swipeBehaviorDeprecated)}},itemDataSource:{get:function(){return this._itemsManager.dataSource},set:function(newData){this._writeProfilerMark("set_itemDataSource,info"),this._dataSource=newData||(new BindingList.List).dataSource,this._groupFocusCache.clear(),this._runningInit||(this._selection._reset(),this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},itemTemplate:{get:function(){return this._itemRenderer},set:function(newRenderer){this._setRenderer(newRenderer,!1),this._runningInit||(this._cancelAsyncViewWork(!0),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},resetItem:{get:function(){return this._itemRelease},set:function(release){_ElementUtilities._deprecated(_ErrorMessages.resetItemIsDeprecated),this._itemRelease=release}},groupHeaderTemplate:{get:function(){return this._groupHeaderRenderer},set:function(newRenderer){this._setRenderer(newRenderer,!0),this._runningInit||(this._cancelAsyncViewWork(!0),this._pendingLayoutReset=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.medium,0,!0))}},resetGroupHeader:{get:function(){return this._groupHeaderRelease},set:function(release){_ElementUtilities._deprecated(_ErrorMessages.resetGroupHeaderIsDeprecated),this._groupHeaderRelease=release}},header:{get:function(){return this._header},set:function(newHeader){_ElementUtilities.empty(this._headerContainer),this._header=newHeader,newHeader&&(this._header.tabIndex=this._tabIndex,this._headerContainer.appendChild(newHeader));var currentFocus=this._selection._getFocused();if(currentFocus.type===_UI.ObjectType.header){var targetEntity=currentFocus;newHeader||(targetEntity={type:_UI.ObjectType.item,index:0}),this._hasKeyboardFocus?this._changeFocus(targetEntity,!0,!1,!0):this._changeFocusPassively(targetEntity)}this.recalculateItemPosition(),this._raiseHeaderFooterVisibilityEvent()}},footer:{get:function(){return this._footer},set:function(newFooter){_ElementUtilities.empty(this._footerContainer),this._footer=newFooter,newFooter&&(this._footer.tabIndex=this._tabIndex,this._footerContainer.appendChild(newFooter));var currentFocus=this._selection._getFocused();if(currentFocus.type===_UI.ObjectType.footer){var targetEntity=currentFocus;newFooter||(targetEntity={type:_UI.ObjectType.item,index:0}),this._hasKeyboardFocus?this._changeFocus(targetEntity,!0,!1,!0):this._changeFocusPassively(targetEntity)}this.recalculateItemPosition(),this._raiseHeaderFooterVisibilityEvent()}},loadingState:{get:function(){return this._loadingState}},selection:{get:function(){return this._selection}},indexOfFirstVisible:{get:function(){return this._view.firstIndexDisplayed},set:function(itemIndex){if(!(itemIndex<0)){this._writeProfilerMark("set_indexOfFirstVisible("+itemIndex+"),info"),this._raiseViewLoading(!0);var that=this;this._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.high,function(){var range;return that._entityInRange({type:_UI.ObjectType.item,index:itemIndex}).then(function(validated){return validated.inRange?that._getItemOffset({type:_UI.ObjectType.item,index:validated.index}).then(function(r){return range=r,that._ensureFirstColumnRange(_UI.ObjectType.item)}).then(function(){return range=that._correctRangeInFirstColumn(range,_UI.ObjectType.item),range=that._convertFromCanvasCoordinates(range),that._view.waitForValidScrollPosition(range.begin)}).then(function(begin){var direction=begin<that._lastScrollPosition?"left":"right",max=that._viewport[that._scrollLength]-that._getViewportLength();return begin=_ElementUtilities._clamp(begin,0,max),{position:begin,direction:direction}}):{position:0,direction:"left"}})},!0)}}},indexOfLastVisible:{get:function(){return this._view.lastIndexDisplayed}},currentItem:{get:function(){var focused=this._selection._getFocused(),retVal={index:focused.index,type:focused.type,key:null,hasFocus:!!this._hasKeyboardFocus,showFocus:!1};if(focused.type===_UI.ObjectType.groupHeader){var group=this._groups.group(focused.index);group&&(retVal.key=group.key,retVal.showFocus=!(!group.header||!_ElementUtilities.hasClass(group.header,_Constants._itemFocusClass)))}else if(focused.type===_UI.ObjectType.item){var item=this._view.items.itemAt(focused.index);if(item){var record=this._itemsManager._recordFromElement(item);retVal.key=record.item&&record.item.key,retVal.showFocus=!!item.parentNode.querySelector("."+_Constants._itemFocusOutlineClass)}}return retVal},set:function(data){function setItemFocused(item,isInTree,entity){var drawKeyboardFocus=!!data.showFocus&&that._hasKeyboardFocus;that._unsetFocusOnItem(isInTree),that._selection._setFocused(entity,drawKeyboardFocus),that._hasKeyboardFocus?(that._keyboardFocusInbound=drawKeyboardFocus,that._setFocusOnItem(entity)):that._tabManager.childFocus=isInTree?item:null,entity.type!==_UI.ObjectType.groupHeader&&(that._updateFocusCache(entity.index),that._updater&&(that._updater.newSelectionPivot=entity.index,that._updater.oldSelectionPivot=-1),that._selection._pivot=entity.index)}this._hasKeyboardFocus=data.hasFocus||this._hasKeyboardFocus,data.type||(data.type=_UI.ObjectType.item);var that=this;if(data.key&&(data.type===_UI.ObjectType.item&&this._dataSource.itemFromKey||data.type===_UI.ObjectType.groupHeader&&this._groupDataSource&&this._groupDataSource.itemFromKey)){this.oldCurrentItemKeyFetch&&this.oldCurrentItemKeyFetch.cancel();var dataSource=data.type===_UI.ObjectType.groupHeader?this._groupDataSource:this._dataSource;this.oldCurrentItemKeyFetch=dataSource.itemFromKey(data.key).then(function(item){if(that.oldCurrentItemKeyFetch=null,item){var element=data.type===_UI.ObjectType.groupHeader?that._groups.group(item.index).header:that._view.items.itemAt(item.index);setItemFocused(element,!!element,{type:data.type,index:item.index})}})}else{var element;if(data.type===_UI.ObjectType.header||data.type===_UI.ObjectType.footer)element=data.type===_UI.ObjectType.header?this._header:this._footer,setItemFocused(element,!!element,{type:data.type,index:data.index});else if(void 0!==data.index){if(data.type===_UI.ObjectType.groupHeader){var group=that._groups.group(data.index);element=group&&group.header}else element=that._view.items.itemAt(data.index);setItemFocused(element,!!element,{type:data.type,index:data.index})}}}},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new ZoomableView(this)),this._zoomableView}},itemsDraggable:{get:function(){return this._dragSource},set:function(value){_BaseUtils.isPhone||this._dragSource!==value&&(this._dragSource=value,this._setDraggable())}},itemsReorderable:{get:function(){return this._reorderable},set:function(value){_BaseUtils.isPhone||this._reorderable!==value&&(this._reorderable=value,this._setDraggable())}},maxDeferredItemCleanup:{get:function(){return this._maxDeferredItemCleanup},set:function(value){this._maxDeferredItemCleanup=Math.max(0,+value||0)}},dispose:function(){this._dispose()},elementFromIndex:function(itemIndex){return this._view.items.itemAt(itemIndex)},indexOfElement:function(element){return this._view.items.index(element)},ensureVisible:function(value){var type=_UI.ObjectType.item,itemIndex=value;if(+value!==value&&(type=value.type,itemIndex=value.index),this._writeProfilerMark("ensureVisible("+type+": "+itemIndex+"),info"),!(itemIndex<0)){this._raiseViewLoading(!0);var that=this;this._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.high,function(){var range;return that._entityInRange({type:type,index:itemIndex}).then(function(validated){return validated.inRange?that._getItemOffset({type:type,index:validated.index}).then(function(r){return range=r,that._ensureFirstColumnRange(type)}).then(function(){range=that._correctRangeInFirstColumn(range,type);var viewportLength=that._getViewportLength(),left=that._viewportScrollPosition,right=left+viewportLength,newPosition=that._viewportScrollPosition,entityWidth=range.end-range.begin;range=that._convertFromCanvasCoordinates(range);var handled=!1;if(type===_UI.ObjectType.groupHeader&&left<=range.begin){var header=that._groups.group(validated.index).header;if(header){var headerEnd,margins=_Layouts._getMargins(header);if(that._horizontalLayout){var rtl=that._rtl(),headerStart=rtl?getOffsetRight(header)-margins.right:header.offsetLeft-margins.left;headerEnd=headerStart+header.offsetWidth+(rtl?margins.left:margins.right)}else headerEnd=header.offsetTop+header.offsetHeight+margins.top;handled=headerEnd<=right}}handled||(entityWidth>=right-left?newPosition=range.begin:range.begin<left?newPosition=range.begin:range.end>right&&(newPosition=range.end-viewportLength));var direction=newPosition<that._lastScrollPosition?"left":"right",max=that._viewport[that._scrollLength]-viewportLength;return newPosition=_ElementUtilities._clamp(newPosition,0,max),{position:newPosition,direction:direction}}):{position:0,direction:"left"}})},!0)}},loadMorePages:function(){_ElementUtilities._deprecated(_ErrorMessages.loadMorePagesIsDeprecated)},recalculateItemPosition:function(){this._writeProfilerMark("recalculateItemPosition,info"),this._forceLayoutImpl(_Constants._ViewChange.relayout)},forceLayout:function(){this._writeProfilerMark("forceLayout,info"),this._forceLayoutImpl(_Constants._ViewChange.remeasure)},_entityInRange:function(entity){if(entity.type===_UI.ObjectType.item)return this._itemsCount().then(function(itemsCount){var index=_ElementUtilities._clamp(entity.index,0,itemsCount-1);return{inRange:index>=0&&index<itemsCount,index:index}});if(entity.type===_UI.ObjectType.groupHeader){var index=_ElementUtilities._clamp(entity.index,0,this._groups.length()-1);return Promise.wrap({inRange:index>=0&&index<this._groups.length(),index:index})}return Promise.wrap({inRange:!0,index:0})},_forceLayoutImpl:function(viewChange){var that=this;this._versionManager.unlocked.then(function(){that._writeProfilerMark("_forceLayoutImpl viewChange("+viewChange+"),info"),that._cancelAsyncViewWork(),that._pendingLayoutReset=!0,that._resizeViewport(),that._batchViewUpdates(viewChange,_Constants._ScrollToPriority.low,function(){return{position:that._lastScrollPosition,direction:"right"}},!0,!0)})},_configureSelectionMode:function(){var selectionModeClass=_Constants._selectionModeClass,hidingSelectionModeClass=_Constants._hidingSelectionMode;if(this._isInSelectionMode())_ElementUtilities.addClass(this._canvas,selectionModeClass),_ElementUtilities.removeClass(this._canvas,hidingSelectionModeClass);else{if(_ElementUtilities.hasClass(this._canvas,selectionModeClass)){var that=this;_Global.setTimeout(function(){_Global.setTimeout(function(){_ElementUtilities.removeClass(that._canvas,hidingSelectionModeClass)},_Constants._hidingSelectionModeAnimationTimeout)},50),_ElementUtilities.addClass(this._canvas,hidingSelectionModeClass)}_ElementUtilities.removeClass(this._canvas,selectionModeClass)}},_lastScrollPosition:{get:function(){return this._lastScrollPositionValue},set:function(position){if(0===position)this._lastDirection="right",this._direction="right",this._lastScrollPositionValue=0;else{var currentDirection=position<this._lastScrollPositionValue?"left":"right";this._direction=this._scrollDirection(position),this._lastDirection=currentDirection,this._lastScrollPositionValue=position}}},_hasHeaderOrFooter:{get:function(){return!(!this._header&&!this._footer)}},_getHeaderOrFooterFromElement:function(element){return this._header&&this._header.contains(element)?this._header:this._footer&&this._footer.contains(element)?this._footer:null},_supportsGroupHeaderKeyboarding:{get:function(){return this._groupDataSource}},_viewportScrollPosition:{get:function(){return this._currentScrollPosition=_ElementUtilities.getScrollPosition(this._viewport)[this._scrollProperty],this._currentScrollPosition},set:function(value){var newScrollPos={};newScrollPos[this._scrollProperty]=value,_ElementUtilities.setScrollPosition(this._viewport,newScrollPos),this._currentScrollPosition=value}},_canvasStart:{get:function(){return this._canvasStartValue||0},set:function(value){var transformX=this._horizontal()?this._rtl()?-value:value:0,transformY=this._horizontal()?0:value;0!==value?this._canvas.style[transformNames.scriptName]="translate( "+transformX+"px, "+transformY+"px)":this._canvas.style[transformNames.scriptName]="",this._canvasStartValue=value}},scrollPosition:{get:function(){return this._viewportScrollPosition},set:function(newPosition){var that=this;this._batchViewUpdates(_Constants._ViewChange.realize,_Constants._ScrollToPriority.high,function(){return that._view.waitForValidScrollPosition(newPosition).then(function(){var max=that._viewport[that._scrollLength]-that._getViewportLength();newPosition=_ElementUtilities._clamp(newPosition,0,max);var direction=newPosition<that._lastScrollPosition?"left":"right";return{position:newPosition,direction:direction}})},!0)}},_setRenderer:function(newRenderer,isGroupHeaderRenderer){var renderer;if(newRenderer){if("function"==typeof newRenderer)renderer=newRenderer;else if("object"==typeof newRenderer){if(_BaseUtils.validation&&!newRenderer.renderItem)throw new _ErrorFromName("WinJS.UI.ListView.invalidTemplate",_ErrorMessages.invalidTemplate);renderer=newRenderer.renderItem}}else{if(_BaseUtils.validation)throw new _ErrorFromName("WinJS.UI.ListView.invalidTemplate",_ErrorMessages.invalidTemplate);renderer=_ItemsManager.trivialHtmlRenderer}renderer&&(isGroupHeaderRenderer?this._groupHeaderRenderer=renderer:this._itemRenderer=renderer)},_renderWithoutReuse:function(itemPromise,oldElement){oldElement&&_Dispose._disposeElement(oldElement);var templateResult=this._itemRenderer(itemPromise);if(templateResult.then)return templateResult.then(function(element){return element.tabIndex=0,element});var element=templateResult.element||templateResult;return element.tabIndex=0,templateResult},_isInsertedItem:function(itemPromise){return!!this._insertedItems[itemPromise.handle]},_clearInsertedItems:function(){for(var keys=Object.keys(this._insertedItems),i=0,len=keys.length;i<len;i++)this._insertedItems[keys[i]].release();this._insertedItems={},this._modifiedElements=[],this._countDifference=0},_cancelAsyncViewWork:function(stopTreeCreation){this._view.stopWork(stopTreeCreation)},_updateView:function(){function resetCache(){that._itemsBlockExtent=-1,that._firstItemRange=null,that._firstHeaderRange=null,that._itemMargins=null,that._headerMargins=null,that._canvasMargins=null,that._cachedRTL=null,that._rtl()}function functorWrapper(){that._scrollToPriority=_Constants._ScrollToPriority.uninitialized;var setScrollbarPosition=that._setScrollbarPosition;that._setScrollbarPosition=!1;var position="number"==typeof that._scrollToFunctor?{position:that._scrollToFunctor}:that._scrollToFunctor();return Promise.as(position).then(function(scroll){return scroll=scroll||{},setScrollbarPosition&&+scroll.position===scroll.position&&(that._lastScrollPosition=scroll.position,that._viewportScrollPosition=scroll.position),scroll},function(error){return that._setScrollbarPosition|=setScrollbarPosition,Promise.wrapError(error)})}if(!this._isZombie()){var that=this,viewChange=this._viewChange;this._viewChange=_Constants._ViewChange.realize,viewChange===_Constants._ViewChange.rebuild?(this._pendingGroupWork&&this._updateGroupWork(),this._pendingLayoutReset&&this._resetLayout(),resetCache(),this._firstTimeDisplayed||this._view.reset(),this._view.reload(functorWrapper,!0),this._setFocusOnItem(this._selection._getFocused()),this._headerFooterVisibilityStatus={headerVisible:!1,footerVisible:!1}):viewChange===_Constants._ViewChange.remeasure?(this._view.resetItems(!0),this._resetLayout(),resetCache(),this._view.refresh(functorWrapper),this._setFocusOnItem(this._selection._getFocused()),this._headerFooterVisibilityStatus={headerVisible:!1,footerVisible:!1}):viewChange===_Constants._ViewChange.relayout?(this._pendingLayoutReset&&(this._resetLayout(),resetCache()),this._view.refresh(functorWrapper)):(this._view.onScroll(functorWrapper),this._raiseHeaderFooterVisibilityEvent())}},_batchViewUpdates:function(viewChange,scrollToPriority,positionFunctor,setScrollbarPosition,skipFadeout){if(this._viewChange=Math.min(this._viewChange,viewChange),(null===this._scrollToFunctor||scrollToPriority>=this._scrollToPriority)&&(this._scrollToPriority=scrollToPriority,this._scrollToFunctor=positionFunctor),this._setScrollbarPosition|=!!setScrollbarPosition,!this._batchingViewUpdates){this._raiseViewLoading();var that=this;this._batchingViewUpdatesSignal=new _Signal,this._batchingViewUpdates=Promise.any([this._batchingViewUpdatesSignal.promise,Scheduler.schedulePromiseHigh(null,"WinJS.UI.ListView._updateView")]).then(function(){if(!that._isZombie())return that._viewChange!==_Constants._ViewChange.rebuild||that._firstTimeDisplayed||0===Object.keys(that._view.items._itemData).length||skipFadeout?void 0:that._fadeOutViewport()}).then(function(){that._batchingViewUpdates=null,that._batchingViewUpdatesSignal=null,that._updateView(),that._firstTimeDisplayed=!1},function(){that._batchingViewUpdates=null,that._batchingViewUpdatesSignal=null})}return this._batchingViewUpdatesSignal},_resetCanvas:function(){if(!this._disposed){var newCanvas=_Global.document.createElement("div");newCanvas.className=this._canvas.className,this._viewport.replaceChild(newCanvas,this._canvas),this._canvas=newCanvas,this._groupsToRemove={},this._canvas.appendChild(this._canvasProxy)}},_setupInternalTree:function(){_ElementUtilities.addClass(this._element,_Constants._listViewClass),_ElementUtilities[this._rtl()?"addClass":"removeClass"](this._element,_Constants._rtlListViewClass),this._element.innerHTML='<div tabIndex="-1" role="group" class="'+_Constants._viewportClass+" "+_Constants._horizontalClass+'"><div></div><div class="'+_Constants._scrollableClass+'"><div class="'+_Constants._proxyClass+'"></div></div><div></div><div></div></div><div aria-hidden="true" style="position:absolute;left:50%;top:50%;width:0px;height:0px;" tabindex="-1"></div>',this._viewport=this._element.firstElementChild,this._headerContainer=this._viewport.firstElementChild,_ElementUtilities.addClass(this._headerContainer,_Constants._listHeaderContainerClass),this._canvas=this._headerContainer.nextElementSibling,this._footerContainer=this._canvas.nextElementSibling,_ElementUtilities.addClass(this._footerContainer,_Constants._listFooterContainerClass),this._canvasProxy=this._canvas.firstElementChild,this._deleteWrapper=this._canvas.nextElementSibling,this._keyboardEventsHelper=this._viewport.nextElementSibling,this._tabIndex=_ElementUtilities.getTabIndex(this._element),this._tabIndex<0&&(this._tabIndex=0),this._tabManager=new _TabContainer.TabContainer(this._viewport),this._tabManager.tabIndex=this._tabIndex,this._progressBar=_Global.document.createElement("progress"),_ElementUtilities.addClass(this._progressBar,_Constants._progressClass),_ElementUtilities.addClass(this._progressBar,"win-progress-ring"),this._progressBar.style.position="absolute",this._progressBar.max=100},_unsetFocusOnItem:function(newFocusExists){this._tabManager.childFocus&&this._clearFocusRectangle(this._tabManager.childFocus),this._isZombie()||(newFocusExists||(this._tabManager.childFocus&&(this._tabManager.childFocus=null),this._keyboardEventsHelper._shouldHaveFocus=!1,_Global.document.activeElement!==this._viewport&&this._hasKeyboardFocus&&(this._keyboardEventsHelper._shouldHaveFocus=!0,_ElementUtilities._setActive(this._keyboardEventsHelper))),this._itemFocused=!1)},_setFocusOnItem:function(entity){if(this._writeProfilerMark("_setFocusOnItem,info"),this._focusRequest&&this._focusRequest.cancel(),!this._isZombie()){var that=this,setFocusOnItemImpl=function(item){that._isZombie()||(that._tabManager.childFocus!==item&&(that._tabManager.childFocus=item),that._focusRequest=null,that._hasKeyboardFocus&&!that._itemFocused&&(that._selection._keyboardFocused()&&that._drawFocusRectangle(item),entity.type!==_UI.ObjectType.groupHeader&&entity.type!==_UI.ObjectType.item||that._view.updateAriaForAnnouncement(item,entity.type===_UI.ObjectType.groupHeader?that._groups.length():that._cachedCount),that._itemFocused=!0,_ElementUtilities._setActive(item)))};entity.type===_UI.ObjectType.item?this._focusRequest=this._view.items.requestItem(entity.index):entity.type===_UI.ObjectType.groupHeader?this._focusRequest=this._groups.requestHeader(entity.index):this._focusRequest=Promise.wrap(entity.type===_UI.ObjectType.header?this._header:this._footer),this._focusRequest.then(setFocusOnItemImpl)}},_attachEvents:function(){function listViewHandler(eventName,caseSensitive,capture){return{name:caseSensitive?eventName:eventName.toLowerCase(),handler:function(eventObject){that["_on"+eventName](eventObject)},capture:capture}}function modeHandler(eventName,caseSensitive,capture){return{capture:capture,name:caseSensitive?eventName:eventName.toLowerCase(),handler:function(eventObject){var currentMode=that._mode,name="on"+eventName;!that._disposed&&currentMode[name]&&currentMode[name](eventObject)}}}function observerHandler(handlerName,attributesFilter){return{handler:function(listOfChanges){that["_on"+handlerName](listOfChanges)},filter:attributesFilter}}var that=this,elementObservers=[observerHandler("PropertyChange",["dir","style","tabindex"])];this._cachedStyleDir=this._element.style.direction,elementObservers.forEach(function(elementObserver){new _ElementUtilities._MutationObserver(elementObserver.handler).observe(that._element,{attributes:!0,attributeFilter:elementObserver.filter})});var events=[modeHandler("PointerDown"),modeHandler("click",!1),modeHandler("PointerUp"),modeHandler("LostPointerCapture"),modeHandler("MSHoldVisual",!0),modeHandler("PointerCancel",!0),modeHandler("DragStart"),modeHandler("DragOver"),modeHandler("DragEnter"),modeHandler("DragLeave"),modeHandler("Drop"),modeHandler("ContextMenu")];events.forEach(function(eventHandler){_ElementUtilities._addEventListener(that._viewport,eventHandler.name,eventHandler.handler,!!eventHandler.capture)});var elementEvents=[listViewHandler("FocusIn",!1,!1),listViewHandler("FocusOut",!1,!1),modeHandler("KeyDown"),modeHandler("KeyUp")];elementEvents.forEach(function(eventHandler){_ElementUtilities._addEventListener(that._element,eventHandler.name,eventHandler.handler,!!eventHandler.capture)}),this._onElementResizeBound=this._onElementResize.bind(this),_ElementUtilities._resizeNotifier.subscribe(this._element,this._onElementResizeBound),this._elementResizeInstrument=new _ElementResizeInstrument._ElementResizeInstrument,this._element.appendChild(this._elementResizeInstrument.element),this._elementResizeInstrument.addEventListener("resize",this._onElementResizeBound),_ElementUtilities._inDom(this.element).then(function(){that._disposed||that._elementResizeInstrument.addedToDom()});var viewportEvents=[listViewHandler("MSManipulationStateChanged",!0),listViewHandler("Scroll")];viewportEvents.forEach(function(viewportEvent){that._viewport.addEventListener(viewportEvent.name,viewportEvent.handler,!1)}),this._viewport.addEventListener("onTabEnter",this._onTabEnter.bind(this)),this._viewport.addEventListener("onTabExit",this._onTabExit.bind(this)),this._viewport.addEventListener("onTabEntered",function(e){that._mode.onTabEntered(e)}),this._viewport.addEventListener("onTabExiting",function(e){that._mode.onTabExiting(e)})},_updateItemsManager:function(){function statusChanged(eventObject){eventObject.detail===_UI.DataSourceStatus.failure&&(that.itemDataSource=null,that.groupDataSource=null)}var that=this,notificationHandler={beginNotifications:function(){},changed:function(newItem,oldItem){if(!that._ifZombieDispose()){that._createUpdater();var elementInfo=that._updater.elements[uniqueID(oldItem)];if(elementInfo){var selected=that.selection._isIncluded(elementInfo.index);if(selected&&(that._updater.updateDrag=!0),oldItem!==newItem){if(that._tabManager.childFocus!==oldItem&&that._updater.newFocusedItem!==oldItem||(that._updater.newFocusedItem=newItem,that._tabManager.childFocus=null),elementInfo.itemBox){_ElementUtilities.addClass(newItem,_Constants._itemClass),that._setupAriaSelectionObserver(newItem);var next=oldItem.nextElementSibling;elementInfo.itemBox.removeChild(oldItem),elementInfo.itemBox.insertBefore(newItem,next)}that._setAriaSelected(newItem,selected),that._view.items.setItemAt(elementInfo.newIndex,{element:newItem,itemBox:elementInfo.itemBox,container:elementInfo.container,itemsManagerRecord:elementInfo.itemsManagerRecord}),delete that._updater.elements[uniqueID(oldItem)],_Dispose._disposeElement(oldItem),that._updater.elements[uniqueID(newItem)]={item:newItem,container:elementInfo.container,itemBox:elementInfo.itemBox,index:elementInfo.index,newIndex:elementInfo.newIndex,itemsManagerRecord:elementInfo.itemsManagerRecord}}else elementInfo.itemBox&&elementInfo.container&&(_ItemEventsHandler._ItemEventsHandler.renderSelection(elementInfo.itemBox,newItem,selected,!0),_ElementUtilities[selected?"addClass":"removeClass"](elementInfo.container,_Constants._selectedClass));that._updater.changed=!0}for(var i=0,len=that._notificationHandlers.length;i<len;i++)that._notificationHandlers[i].changed(newItem,oldItem);that._writeProfilerMark("changed,info")}},removed:function(item,mirage,handle){function removeFromSelection(index){that._updater.updateDrag=!0,that._currentMode()._dragging&&that._currentMode()._draggingUnselectedItem&&that._currentMode()._dragInfo._isIncluded(index)&&(that._updater.newDragInfo=new _SelectionManager._Selection(that,[]));var firstRange=that._updater.selectionFirst[index],lastRange=that._updater.selectionLast[index],range=firstRange||lastRange;range&&(delete that._updater.selectionFirst[range.oldFirstIndex],delete that._updater.selectionLast[range.oldLastIndex],that._updater.selectionChanged=!0)}if(!that._ifZombieDispose()){that._createUpdater();var insertedItem=that._insertedItems[handle];insertedItem&&delete that._insertedItems[handle];var index;if(item){var elementInfo=that._updater.elements[uniqueID(item)],itemObject=that._itemsManager.itemObject(item);if(itemObject&&that._groupFocusCache.deleteItem(itemObject.key),elementInfo){if(index=elementInfo.index,elementInfo.itemBox){var itemBox=elementInfo.itemBox,oddStripe=_Constants._containerOddClass,evenStripe=_Constants._containerEvenClass,containerStripe=_ElementUtilities.hasClass(itemBox.parentElement,evenStripe)?evenStripe:oddStripe;that._updater.removed.push({index:index,itemBox:itemBox,containerStripe:containerStripe})}that._updater.deletesCount++;var itemData=that._view.items.itemDataAt(index);itemData.removed=!0,delete that._updater.elements[uniqueID(item)]}else index=itemObject&&itemObject.index;that._updater.oldFocus.type!==_UI.ObjectType.groupHeader&&that._updater.oldFocus.index===index&&(that._updater.newFocus.index=index,that._updater.focusedItemRemoved=!0),removeFromSelection(index)}else index=that._updater.selectionHandles[handle],index===+index&&removeFromSelection(index);that._writeProfilerMark("removed("+index+"),info"),that._updater.changed=!0}},updateAffectedRange:function(newerRange){that._itemsCount().then(function(count){var containerCount=that._view.containers?that._view.containers.length:0;newerRange.start=Math.min(newerRange.start,containerCount),that._affectedRange.add(newerRange,count)}),that._createUpdater(),that._updater.changed=!0},indexChanged:function(item,newIndex,oldIndex){if(!that._ifZombieDispose()){if(that._createUpdater(),item){var itemObject=that._itemsManager.itemObject(item);itemObject&&that._groupFocusCache.updateItemIndex(itemObject.key,newIndex);var elementInfo=that._updater.elements[uniqueID(item)];
elementInfo&&(elementInfo.newIndex=newIndex,that._updater.changed=!0),that._updater.itemsMoved=!0}that._currentMode()._dragging&&that._currentMode()._draggingUnselectedItem&&that._currentMode()._dragInfo._isIncluded(oldIndex)&&(that._updater.newDragInfo=new _SelectionManager._Selection(that,[{firstIndex:newIndex,lastIndex:newIndex}]),that._updater.updateDrag=!0),that._updater.oldFocus.type!==_UI.ObjectType.groupHeader&&that._updater.oldFocus.index===oldIndex&&(that._updater.newFocus.index=newIndex,that._updater.changed=!0),that._updater.oldSelectionPivot===oldIndex&&(that._updater.newSelectionPivot=newIndex,that._updater.changed=!0);var range=that._updater.selectionFirst[oldIndex];range&&(range.newFirstIndex=newIndex,that._updater.changed=!0,that._updater.selectionChanged=!0,that._updater.updateDrag=!0),range=that._updater.selectionLast[oldIndex],range&&(range.newLastIndex=newIndex,that._updater.changed=!0,that._updater.selectionChanged=!0,that._updater.updateDrag=!0)}},endNotifications:function(){that._update()},inserted:function(itemPromise){that._ifZombieDispose()||(that._writeProfilerMark("inserted,info"),that._createUpdater(),that._updater.changed=!0,itemPromise.retain(),that._updater.insertsCount++,that._insertedItems[itemPromise.handle]=itemPromise)},moved:function(item,previous,next,itemPromise){if(!that._ifZombieDispose()){if(that._createUpdater(),that._updater.movesCount++,item){that._updater.itemsMoved=!0;var elementInfo=that._updater.elements[uniqueID(item)];elementInfo&&(elementInfo.moved=!0)}var index=that._updater.selectionHandles[itemPromise.handle];if(index===+index){that._updater.updateDrag=!0,that._updater.selectionChanged=!0,that._updater.changed=!0;var firstRange=that._updater.selectionFirst[index],lastRange=that._updater.selectionLast[index],range=firstRange||lastRange;range&&range.oldFirstIndex!==range.oldLastIndex&&(delete that._updater.selectionFirst[range.oldFirstIndex],delete that._updater.selectionLast[range.oldLastIndex])}that._writeProfilerMark("moved("+index+"),info")}},countChanged:function(newCount,oldCount){that._ifZombieDispose()||(that._writeProfilerMark("countChanged("+newCount+"),info"),that._cachedCount=newCount,that._createUpdater(),that._view.lastIndexDisplayed+1===oldCount&&(that._updater.changed=!0),that._updater.countDifference+=newCount-oldCount)},reload:function(){that._ifZombieDispose()||(that._writeProfilerMark("reload,info"),that._processReload())}};this._versionManager&&this._versionManager._dispose(),this._versionManager=new _VersionManager._VersionManager,this._updater=null;var ranges=this._selection.getRanges();this._selection._selected.clear(),this._itemsManager&&(this._itemsManager.dataSource&&this._itemsManager.dataSource.removeEventListener&&this._itemsManager.dataSource.removeEventListener("statuschanged",statusChanged,!1),this._clearInsertedItems(),this._itemsManager.release()),this._itemsCountPromise&&(this._itemsCountPromise.cancel(),this._itemsCountPromise=null),this._cachedCount=_Constants._UNINITIALIZED,this._itemsManager=_ItemsManager._createItemsManager(this._dataSource,this._renderWithoutReuse.bind(this),notificationHandler,{ownerElement:this._element,versionManager:this._versionManager,indexInView:function(index){return index>=that.indexOfFirstVisible&&index<=that.indexOfLastVisible},viewCallsReady:!0,profilerId:this._id}),this._dataSource.addEventListener&&this._dataSource.addEventListener("statuschanged",statusChanged,!1),this._selection._selected.set(ranges)},_processReload:function(){this._affectedRange.addAll(),this._cancelAsyncViewWork(!0),this._currentMode()._dragging&&this._currentMode()._clearDragProperties(),this._groupFocusCache.clear(),this._selection._reset(),this._updateItemsManager(),this._pendingLayoutReset=!0,this._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.low,this.scrollPosition)},_createUpdater:function(){if(!this._updater){this.itemDataSource._isVirtualizedDataSource&&this._affectedRange.addAll(),this._versionManager.beginUpdating(),this._cancelAsyncViewWork();var updater={changed:!1,elements:{},selectionFirst:{},selectionLast:{},selectionHandles:{},oldSelectionPivot:{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},newSelectionPivot:{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},removed:[],selectionChanged:!1,oldFocus:{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},newFocus:{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},hadKeyboardFocus:this._hasKeyboardFocus,itemsMoved:!1,lastVisible:this.indexOfLastVisible,updateDrag:!1,movesCount:0,insertsCount:0,deletesCount:0,countDifference:0};this._view.items.each(function(index,item,itemData){updater.elements[uniqueID(item)]={item:item,container:itemData.container,itemBox:itemData.itemBox,index:index,newIndex:index,itemsManagerRecord:itemData.itemsManagerRecord,detached:itemData.detached}});for(var selection=this._selection._selected._ranges,i=0,len=selection.length;i<len;i++){var range=selection[i],newRange={newFirstIndex:selection[i].firstIndex,oldFirstIndex:selection[i].firstIndex,newLastIndex:selection[i].lastIndex,oldLastIndex:selection[i].lastIndex};updater.selectionFirst[newRange.oldFirstIndex]=newRange,updater.selectionLast[newRange.oldLastIndex]=newRange,updater.selectionHandles[range.firstPromise.handle]=newRange.oldFirstIndex,updater.selectionHandles[range.lastPromise.handle]=newRange.oldLastIndex}updater.oldSelectionPivot=this._selection._pivot,updater.newSelectionPivot=updater.oldSelectionPivot,updater.oldFocus=this._selection._getFocused(),updater.newFocus=this._selection._getFocused(),this._updater=updater}},_synchronize:function(){var updater=this._updater;if(this._updater=null,this._groupsChanged=!1,this._countDifference=this._countDifference||0,updater&&updater.changed){updater.itemsMoved&&this._layout.itemsMoved&&this._layout.itemsMoved(),updater.removed.length&&this._layout.itemsRemoved&&this._layout.itemsRemoved(updater.removed.map(function(node){return node.itemBox})),(updater.itemsMoved||updater.removed.length||Object.keys(this._insertedItems).length)&&this._layout.setupAnimations&&this._layout.setupAnimations(),this._currentMode().onDataChanged&&this._currentMode().onDataChanged();var newSelection=[];for(var i in updater.selectionFirst)if(updater.selectionFirst.hasOwnProperty(i)){var range=updater.selectionFirst[i];updater.selectionChanged=updater.selectionChanged||range.newLastIndex-range.newFirstIndex!==range.oldLastIndex-range.oldFirstIndex,range.newFirstIndex<=range.newLastIndex&&newSelection.push({firstIndex:range.newFirstIndex,lastIndex:range.newLastIndex})}if(updater.selectionChanged){var newSelectionItems=new _SelectionManager._Selection(this,newSelection);this._selection._fireSelectionChanging(newSelectionItems),this._selection._selected.set(newSelection),this._selection._fireSelectionChanged(),newSelectionItems.clear()}else this._selection._selected.set(newSelection);this._selection._updateCount(this._cachedCount),updater.newSelectionPivot=Math.min(this._cachedCount-1,updater.newSelectionPivot),this._selection._pivot=updater.newSelectionPivot>=0?updater.newSelectionPivot:_Constants._INVALID_INDEX,updater.newFocus.type!==_UI.ObjectType.groupHeader&&(updater.newFocus.index=Math.max(0,Math.min(this._cachedCount-1,updater.newFocus.index))),this._selection._setFocused(updater.newFocus,this._selection._keyboardFocused());var previousModifiedElements=this._modifiedElements||[],previousModifiedElementsHash={};for(this._modifiedElements=[],this._countDifference+=updater.countDifference,i=0;i<previousModifiedElements.length;i++){var modifiedElement=previousModifiedElements[i];modifiedElement.newIndex===-1?this._modifiedElements.push(modifiedElement):previousModifiedElementsHash[modifiedElement.newIndex]=modifiedElement}for(i=0;i<updater.removed.length;i++){var removed=updater.removed[i],modifiedElement=previousModifiedElementsHash[removed.index];modifiedElement?delete previousModifiedElementsHash[removed.index]:modifiedElement={oldIndex:removed.index},modifiedElement.newIndex=-1,modifiedElement._removalHandled||(modifiedElement._itemBox=removed.itemBox,modifiedElement._containerStripe=removed.containerStripe),this._modifiedElements.push(modifiedElement)}var insertedKeys=Object.keys(this._insertedItems);for(i=0;i<insertedKeys.length;i++)this._modifiedElements.push({oldIndex:-1,newIndex:this._insertedItems[insertedKeys[i]].index});this._writeProfilerMark("_synchronize:update_modifiedElements,StartTM");var newItems={};for(i in updater.elements)if(updater.elements.hasOwnProperty(i)){var elementInfo=updater.elements[i];newItems[elementInfo.newIndex]={element:elementInfo.item,container:elementInfo.container,itemBox:elementInfo.itemBox,itemsManagerRecord:elementInfo.itemsManagerRecord,detached:elementInfo.detached};var modifiedElement=previousModifiedElementsHash[elementInfo.index];modifiedElement?(delete previousModifiedElementsHash[elementInfo.index],modifiedElement.newIndex=elementInfo.newIndex):modifiedElement={oldIndex:elementInfo.index,newIndex:elementInfo.newIndex},modifiedElement.moved=elementInfo.moved,this._modifiedElements.push(modifiedElement)}this._writeProfilerMark("_synchronize:update_modifiedElements,StopTM");var previousIndices=Object.keys(previousModifiedElementsHash);for(i=0;i<previousIndices.length;i++){var key=previousIndices[i],modifiedElement=previousModifiedElementsHash[key];modifiedElement.oldIndex!==-1&&this._modifiedElements.push(modifiedElement)}this._view.items._itemData=newItems,updater.updateDrag&&this._currentMode()._dragging&&(this._currentMode()._draggingUnselectedItem?updater.newDragInfo&&(this._currentMode()._dragInfo=updater.newDragInfo):this._currentMode()._dragInfo=this._selection,this._currentMode().fireDragUpdateEvent()),updater.focusedItemRemoved||this._focusRequest&&updater.oldFocus.index!==updater.newFocus.index||updater.oldFocus.type!==updater.newFocus.type?(this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused())):updater.newFocusedItem&&(this._hasKeyboardFocus=updater.hadKeyboardFocus,this._itemFocused=!1,this._setFocusOnItem(this._selection._getFocused()));var that=this;return this._groups.synchronizeGroups().then(function(){return updater.newFocus.type===_UI.ObjectType.groupHeader&&(updater.newFocus.index=Math.min(that._groups.length()-1,updater.newFocus.index),updater.newFocus.index<0&&(updater.newFocus={type:_UI.ObjectType.item,index:0}),that._selection._setFocused(updater.newFocus,that._selection._keyboardFocused())),that._versionManager.endUpdating(),updater.deletesCount>0&&that._updateDeleteWrapperSize(),that._view.updateTree(that._cachedCount,that._countDifference,that._modifiedElements)}).then(function(){return that._lastScrollPosition})}this._countDifference+=updater?updater.countDifference:0;var that=this;return this._groups.synchronizeGroups().then(function(){return updater&&that._versionManager.endUpdating(),that._view.updateTree(that._cachedCount,that._countDifference,that._modifiedElements)}).then(function(){return that.scrollPosition})},_updateDeleteWrapperSize:function(clear){var sizeProperty=this._horizontal()?"width":"height";this._deleteWrapper.style["min-"+sizeProperty]=(clear?0:this.scrollPosition+this._getViewportSize()[sizeProperty])+"px"},_verifyRealizationNeededForChange:function(){var skipRealization=!1,totalInViewport=(this._view.lastIndexDisplayed||0)-(this._view.firstIndexDisplayed||0),deletesOnly=this._updater&&0===this._updater.movesCount&&0===this._updater.insertsCount&&this._updater.deletesCount>0&&this._updater.deletesCount===Math.abs(this._updater.countDifference);if(deletesOnly&&this._updater.elements)for(var elementsKeys=Object.keys(this._updater.elements),i=0,len=elementsKeys.length;i<len;i++){var element=this._updater.elements[elementsKeys[i]],delta=element.index-element.newIndex;if(delta<0||delta>this._updater.deletesCount){deletesOnly=!1;break}}this._view.deletesWithoutRealize=this._view.deletesWithoutRealize||0,deletesOnly&&this._view.lastIndexDisplayed<this._view.end-totalInViewport&&this._updater.deletesCount+this._view.deletesWithoutRealize<totalInViewport?(skipRealization=!0,this._view.deletesWithoutRealize+=Math.abs(this._updater.countDifference),this._writeProfilerMark("skipping realization on delete,info")):this._view.deletesWithoutRealize=0,this._view._setSkipRealizationForChange(skipRealization)},_update:function(){if(this._writeProfilerMark("update,StartTM"),!this._ifZombieDispose()){this._updateJob=null;var that=this;this._versionManager.noOutstandingNotifications&&(this._updater||this._groupsChanged?(this._cancelAsyncViewWork(),this._verifyRealizationNeededForChange(),this._synchronize().then(function(scrollbarPos){that._writeProfilerMark("update,StopTM"),that._batchViewUpdates(_Constants._ViewChange.relayout,_Constants._ScrollToPriority.low,scrollbarPos).complete()})):this._batchViewUpdates(_Constants._ViewChange.relayout,_Constants._ScrollToPriority.low,this._lastScrollPosition).complete())}},_scheduleUpdate:function(){if(!this._updateJob){var that=this;this._updateJob=Scheduler.schedulePromiseHigh(null,"WinJS.UI.ListView._update").then(function(){that._updateJob&&that._update()}),this._raiseViewLoading()}},_createGroupsContainer:function(){this._groups&&this._groups.cleanUp(),this._groupDataSource?this._groups=new _GroupsContainer._UnvirtualizedGroupsContainer(this,this._groupDataSource):this._groups=new _GroupsContainer._NoGroups(this)},_createLayoutSite:function(){var that=this;return Object.create({invalidateLayout:function(){that._pendingLayoutReset=!0;var orientationChanged="horizontal"===that._layout.orientation!==that._horizontalLayout;that._affectedRange.addAll(),that._batchViewUpdates(_Constants._ViewChange.rebuild,_Constants._ScrollToPriority.low,orientationChanged?0:that.scrollPosition,!1,!0)},itemFromIndex:function(itemIndex){return that._itemsManager._itemPromiseAtIndex(itemIndex)},groupFromIndex:function(groupIndex){return that._groupsEnabled()?groupIndex<that._groups.length()?that._groups.group(groupIndex).userData:null:{key:"-1"}},groupIndexFromItemIndex:function(itemIndex){return itemIndex=Math.max(0,itemIndex),that._groups.groupFromItem(itemIndex)},renderItem:function(itemPromise){return Promise._cancelBlocker(that._itemsManager._itemFromItemPromise(itemPromise)).then(function(element){if(element){var record=that._itemsManager._recordFromElement(element);record.pendingReady&&record.pendingReady(),element=element.cloneNode(!0),_ElementUtilities.addClass(element,_Constants._itemClass);var itemBox=_Global.document.createElement("div");_ElementUtilities.addClass(itemBox,_Constants._itemBoxClass),itemBox.appendChild(element);var container=_Global.document.createElement("div");return _ElementUtilities.addClass(container,_Constants._containerClass),container.appendChild(itemBox),container}return Promise.cancel})},renderHeader:function(group){var rendered=_ItemsManager._normalizeRendererReturn(that.groupHeaderTemplate(Promise.wrap(group)));return rendered.then(function(headerRecord){_ElementUtilities.addClass(headerRecord.element,_Constants._headerClass);var container=_Global.document.createElement("div");return _ElementUtilities.addClass(container,_Constants._headerContainerClass),container.appendChild(headerRecord.element),container})},readyToMeasure:function(){that._getViewportLength(),that._getCanvasMargins()},_isZombie:function(){return that._isZombie()},_writeProfilerMark:function(text){that._writeProfilerMark(text)}},{_itemsManager:{enumerable:!0,get:function(){return that._itemsManager}},rtl:{enumerable:!0,get:function(){return that._rtl()}},surface:{enumerable:!0,get:function(){return that._canvas}},viewport:{enumerable:!0,get:function(){return that._viewport}},scrollbarPos:{enumerable:!0,get:function(){return that.scrollPosition}},viewportSize:{enumerable:!0,get:function(){return that._getViewportSize()}},loadingBehavior:{enumerable:!0,get:function(){return that.loadingBehavior}},animationsDisabled:{enumerable:!0,get:function(){return that._animationsDisabled()}},tree:{enumerable:!0,get:function(){return that._view.tree}},realizedRange:{enumerable:!0,get:function(){return{firstPixel:Math.max(0,that.scrollPosition-2*that._getViewportLength()),lastPixel:that.scrollPosition+3*that._getViewportLength()-1}}},visibleRange:{enumerable:!0,get:function(){return{firstPixel:that.scrollPosition,lastPixel:that.scrollPosition+that._getViewportLength()-1}}},itemCount:{enumerable:!0,get:function(){return that._itemsCount()}},groupCount:{enumerable:!0,get:function(){return that._groups.length()}},header:{enumerable:!0,get:function(){return that.header}},footer:{enumerable:!0,get:function(){return that.footer}}})},_initializeLayout:function(){this._affectedRange.addAll();var layoutSite=this._createLayoutSite();return this._layout.initialize(layoutSite,this._groupsEnabled()),"horizontal"===this._layout.orientation},_resetLayoutOrientation:function(resetScrollPosition){this._horizontalLayout?(this._startProperty="left",this._scrollProperty="scrollLeft",this._scrollLength="scrollWidth",this._deleteWrapper.style.minHeight="",_ElementUtilities.addClass(this._viewport,_Constants._horizontalClass),_ElementUtilities.removeClass(this._viewport,_Constants._verticalClass),resetScrollPosition&&(this._viewport.scrollTop=0)):(this._startProperty="top",this._scrollProperty="scrollTop",this._scrollLength="scrollHeight",this._deleteWrapper.style.minWidth="",_ElementUtilities.addClass(this._viewport,_Constants._verticalClass),_ElementUtilities.removeClass(this._viewport,_Constants._horizontalClass),resetScrollPosition&&_ElementUtilities.setScrollPosition(this._viewport,{scrollLeft:0}))},_resetLayout:function(){this._pendingLayoutReset=!1,this._affectedRange.addAll(),this._layout&&(this._layout.uninitialize(),this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation())},_updateLayout:function(layoutObject){var hadPreviousLayout=!1;this._layout&&(this._cancelAsyncViewWork(!0),this._layout.uninitialize(),hadPreviousLayout=!0);var layoutImpl;if(layoutObject&&"function"==typeof layoutObject.type){var LayoutCtor=requireSupportedForProcessing(layoutObject.type);layoutImpl=new LayoutCtor(layoutObject)}else layoutImpl=layoutObject&&layoutObject.initialize?layoutObject:new _Layouts.GridLayout(layoutObject);hadPreviousLayout&&this._resetCanvas(),this._layoutImpl=layoutImpl,this._layout=new _Layouts._LayoutWrapper(layoutImpl),hadPreviousLayout&&this._unsetFocusOnItem(),this._setFocusOnItem({type:_UI.ObjectType.item,index:0}),this._selection._setFocused({type:_UI.ObjectType.item,index:0}),this._lastFocusedElementInGroupTrack={type:_UI.ObjectType.item,index:-1},this._headerContainer.style.opacity=0,this._footerContainer.style.opacity=0,this._horizontalLayout=this._initializeLayout(),this._resetLayoutOrientation(hadPreviousLayout),hadPreviousLayout&&(this._canvas.style.width=this._canvas.style.height="")},_currentMode:function(){return this._mode},_setDraggable:function(){var dragEnabled=this.itemsDraggable||this.itemsReorderable;this._view.items.each(function(index,item,itemData){itemData.itemBox&&(itemData.itemBox.draggable=dragEnabled&&!_ElementUtilities.hasClass(item,_Constants._nonDraggableClass))})},_resizeViewport:function(){this._viewportWidth=_Constants._UNINITIALIZED,this._viewportHeight=_Constants._UNINITIALIZED},_onElementResize:function(){this._writeProfilerMark("_onElementResize,info"),Scheduler.schedule(function(){if(!this._isZombie()&&this._viewportWidth!==_Constants._UNINITIALIZED&&this._viewportHeight!==_Constants._UNINITIALIZED){var newWidth=this._element.offsetWidth,newHeight=this._element.offsetHeight;if(this._previousWidth!==newWidth||this._previousHeight!==newHeight){this._writeProfilerMark("resize ("+this._previousWidth+"x"+this._previousHeight+") => ("+newWidth+"x"+newHeight+"),info"),this._previousWidth=newWidth,this._previousHeight=newHeight,this._resizeViewport();var that=this;this._affectedRange.addAll(),this._batchViewUpdates(_Constants._ViewChange.relayout,_Constants._ScrollToPriority.low,function(){return{position:that.scrollPosition,direction:"right"}})}}},Scheduler.Priority.max,this,"WinJS.UI.ListView._onElementResize")},_onFocusIn:function(event){function moveFocusToItem(keyboardFocused){that._changeFocus(that._selection._getFocused(),!0,!1,!1,keyboardFocused)}this._hasKeyboardFocus=!0;var that=this;if(event.target===this._keyboardEventsHelper)!this._keyboardEventsHelper._shouldHaveFocus&&this._keyboardFocusInbound?moveFocusToItem(!0):this._keyboardEventsHelper._shouldHaveFocus=!1;else if(event.target===this._element)moveFocusToItem();else{if(this._mode.inboundFocusHandled)return void(this._mode.inboundFocusHandled=!1);var items=this._view.items,entity={},element=this._getHeaderOrFooterFromElement(event.target),winItem=null;if(element?(entity.index=0,entity.type=element===this._header?_UI.ObjectType.header:_UI.ObjectType.footer,this._lastFocusedElementInGroupTrack=entity):(element=this._groups.headerFrom(event.target),element?(entity.type=_UI.ObjectType.groupHeader,entity.index=this._groups.index(element),this._lastFocusedElementInGroupTrack=entity):(entity.index=items.index(event.target),entity.type=_UI.ObjectType.item,element=items.itemBoxAt(entity.index),winItem=items.itemAt(entity.index))),entity.index!==_Constants._INVALID_INDEX&&((this._keyboardFocusInbound||this._selection._keyboardFocused())&&(entity.type===_UI.ObjectType.groupHeader&&event.target===element||entity.type===_UI.ObjectType.item&&event.target.parentNode===element)&&this._drawFocusRectangle(element),this._tabManager.childFocus!==element&&this._tabManager.childFocus!==winItem&&(this._selection._setFocused(entity,this._keyboardFocusInbound||this._selection._keyboardFocused()),this._keyboardFocusInbound=!1,entity.type===_UI.ObjectType.item&&(element=items.itemAt(entity.index)),this._tabManager.childFocus=element,that._updater))){var elementInfo=that._updater.elements[uniqueID(element)],focusIndex=entity.index;elementInfo&&elementInfo.newIndex&&(focusIndex=elementInfo.newIndex),that._updater.oldFocus={type:entity.type,index:focusIndex},that._updater.newFocus={type:entity.type,index:focusIndex}}}},_onFocusOut:function(event){if(!this._disposed){this._hasKeyboardFocus=!1,this._itemFocused=!1;var element=this._view.items.itemBoxFrom(event.target)||this._groups.headerFrom(event.target);element&&this._clearFocusRectangle(element)}},_onMSManipulationStateChanged:function(ev){function done(){that._manipulationEndSignal=null}var that=this;this._manipulationState=ev.currentState,that._writeProfilerMark("_onMSManipulationStateChanged state("+ev.currentState+"),info"),this._manipulationState===_ElementUtilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED||this._manipulationEndSignal||(this._manipulationEndSignal=new _Signal,this._manipulationEndSignal.promise.done(done,done)),this._manipulationState===_ElementUtilities._MSManipulationEvent.MS_MANIPULATION_STATE_STOPPED&&this._manipulationEndSignal.complete()},_pendingScroll:!1,_onScroll:function(){this._zooming||this._pendingScroll||this._checkScroller()},_checkScroller:function(){if(!this._isZombie()){var currentScrollPosition=this._viewportScrollPosition;if(currentScrollPosition!==this._lastScrollPosition){this._pendingScroll=_BaseUtils._requestAnimationFrame(this._checkScroller.bind(this)),currentScrollPosition=Math.max(0,currentScrollPosition);var direction=this._scrollDirection(currentScrollPosition);this._lastScrollPosition=currentScrollPosition,this._raiseViewLoading(!0),this._raiseHeaderFooterVisibilityEvent();var that=this;this._view.onScroll(function(){return{position:that._lastScrollPosition,direction:direction}},this._manipulationEndSignal?this._manipulationEndSignal.promise:Promise.timeout(_Constants._DEFERRED_SCROLL_END))}else this._pendingScroll=null}},_scrollDirection:function(currentScrollPosition){var currentDirection=currentScrollPosition<this._lastScrollPosition?"left":"right";return currentDirection===this._lastDirection?currentDirection:this._direction},_onTabEnter:function(){this._keyboardFocusInbound=!0},_onTabExit:function(){this._keyboardFocusInbound=!1},_onPropertyChange:function(list){var that=this;list.forEach(function(record){var dirChanged=!1;if("dir"===record.attributeName?dirChanged=!0:"style"===record.attributeName&&(dirChanged=that._cachedStyleDir!==record.target.style.direction),dirChanged&&(that._cachedStyleDir=record.target.style.direction,that._cachedRTL=null,_ElementUtilities[that._rtl()?"addClass":"removeClass"](that._element,_Constants._rtlListViewClass),that._lastScrollPosition=0,that._viewportScrollPosition=0,that.forceLayout()),"tabIndex"===record.attributeName){var newTabIndex=that._element.tabIndex;newTabIndex>=0&&(that._view.items.each(function(index,item){item.tabIndex=newTabIndex}),that._header&&(that._header.tabIndex=newTabIndex),that._footer&&(that._footer.tabIndex=newTabIndex),that._tabIndex=newTabIndex,that._tabManager.tabIndex=newTabIndex,that._element.tabIndex=-1)}})},_getCanvasMargins:function(){return this._canvasMargins||(this._canvasMargins=_Layouts._getMargins(this._canvas)),this._canvasMargins},_convertCoordinatesByCanvasMargins:function(coordinates,conversionCallback){function fix(field,offset){void 0!==coordinates[field]&&(coordinates[field]=conversionCallback(coordinates[field],offset))}var offset;return this._horizontal()?(offset=this._getCanvasMargins()[this._rtl()?"right":"left"],fix("left",offset)):(offset=this._getCanvasMargins().top,fix("top",offset)),fix("begin",offset),fix("end",offset),coordinates},_convertFromCanvasCoordinates:function(coordinates){return this._convertCoordinatesByCanvasMargins(coordinates,function(coordinate,canvasMargin){return coordinate+canvasMargin})},_convertToCanvasCoordinates:function(coordinates){return this._convertCoordinatesByCanvasMargins(coordinates,function(coordinate,canvasMargin){return coordinate-canvasMargin})},_getViewportSize:function(){return this._viewportWidth!==_Constants._UNINITIALIZED&&this._viewportHeight!==_Constants._UNINITIALIZED||(this._viewportWidth=Math.max(0,_ElementUtilities.getContentWidth(this._element)),this._viewportHeight=Math.max(0,_ElementUtilities.getContentHeight(this._element)),this._writeProfilerMark("viewportSizeDetected width:"+this._viewportWidth+" height:"+this._viewportHeight),this._previousWidth=this._element.offsetWidth,this._previousHeight=this._element.offsetHeight),{width:this._viewportWidth,height:this._viewportHeight}},_itemsCount:function(){function cleanUp(){that._itemsCountPromise=null}var that=this;if(this._cachedCount!==_Constants._UNINITIALIZED)return Promise.wrap(this._cachedCount);var retVal;return this._itemsCountPromise?retVal=this._itemsCountPromise:(retVal=this._itemsCountPromise=this._itemsManager.dataSource.getCount().then(function(count){return count===_UI.CountResult.unknown&&(count=0),that._cachedCount=count,that._selection._updateCount(that._cachedCount),count},function(){return Promise.cancel}),this._itemsCountPromise.then(cleanUp,cleanUp)),retVal},_isSelected:function(index){return this._selection._isIncluded(index)},_LoadingState:{itemsLoading:"itemsLoading",viewPortLoaded:"viewPortLoaded",itemsLoaded:"itemsLoaded",complete:"complete"},_raiseViewLoading:function(scrolling){this._loadingState!==this._LoadingState.itemsLoading&&(this._scrolling=!!scrolling),this._setViewState(this._LoadingState.itemsLoading)},_raiseViewComplete:function(){this._disposed||this._view.animating||this._setViewState(this._LoadingState.complete)},_raiseHeaderFooterVisibilityEvent:function(){var that=this,elementInViewport=function(element){if(!element)return!1;var scrollPosition=that._lastScrollPosition,elementPosition=element[that._horizontal()?"offsetLeft":"offsetTop"],elementLength=element[that._horizontal()?"offsetWidth":"offsetHeight"];return elementPosition+elementLength>scrollPosition&&elementPosition<scrollPosition+that._getViewportLength()},raiseVisibilityEvent=function(eventName,visible){var visibilityEvent=_Global.document.createEvent("CustomEvent");visibilityEvent.initCustomEvent(eventName,!0,!0,{visible:visible}),that._element.dispatchEvent(visibilityEvent)},headerInView=!!this._header&&elementInViewport(this._headerContainer),footerInView=!!this._footer&&elementInViewport(this._footerContainer);this._headerFooterVisibilityStatus.headerVisible!==headerInView&&(this._headerFooterVisibilityStatus.headerVisible=headerInView,raiseVisibilityEvent("headervisibilitychanged",headerInView)),this._headerFooterVisibilityStatus.footerVisible!==footerInView&&(this._headerFooterVisibilityStatus.footerVisible=footerInView,raiseVisibilityEvent("footervisibilitychanged",footerInView))},_setViewState:function(state){if(state!==this._loadingState){var detail={scrolling:!1};switch(state){case this._LoadingState.viewPortLoaded:this._scheduledForDispose||(scheduleForDispose(this),this._scheduledForDispose=!0),this._setViewState(this._LoadingState.itemsLoading);break;case this._LoadingState.itemsLoaded:detail={scrolling:this._scrolling},this._setViewState(this._LoadingState.viewPortLoaded);break;case this._LoadingState.complete:this._setViewState(this._LoadingState.itemsLoaded),this._updateDeleteWrapperSize(!0)}this._writeProfilerMark("loadingStateChanged:"+state+",info"),this._loadingState=state;var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent("loadingstatechanged",!0,!1,detail),this._element.dispatchEvent(eventObject)}},_createTemplates:function(){function createNodeWithClass(className,skipAriaHidden){var element=_Global.document.createElement("div");return element.className=className,skipAriaHidden||element.setAttribute("aria-hidden",!0),element}this._itemBoxTemplate=createNodeWithClass(_Constants._itemBoxClass,!0)},_updateSelection:function(){var indices=this._selection.getIndices(),selectAll=this._selection.isEverything(),selectionMap={};if(!selectAll)for(var i=0,len=indices.length;i<len;i++){var index=indices[i];selectionMap[index]=!0}this._view.items.each(function(index,element,itemData){if(itemData.itemBox){var selected=selectAll||!!selectionMap[index];_ItemEventsHandler._ItemEventsHandler.renderSelection(itemData.itemBox,element,selected,!0),itemData.container&&_ElementUtilities[selected?"addClass":"removeClass"](itemData.container,_Constants._selectedClass)}})},_getViewportLength:function(){return this._getViewportSize()[this._horizontal()?"width":"height"]},_horizontal:function(){return this._horizontalLayout},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction),this._cachedRTL},_showProgressBar:function(parent,x,y){var progressBar=this._progressBar,progressStyle=progressBar.style;if(!progressBar.parentNode){this._fadingProgressBar=!1,this._progressIndicatorDelayTimer&&this._progressIndicatorDelayTimer.cancel();var that=this;this._progressIndicatorDelayTimer=Promise.timeout(_Constants._LISTVIEW_PROGRESS_DELAY).then(function(){that._isZombie()||(parent.appendChild(progressBar),Animations.fadeIn(progressBar),that._progressIndicatorDelayTimer=null)})}progressStyle[this._rtl()?"right":"left"]=x,progressStyle.top=y},_hideProgressBar:function(){this._progressIndicatorDelayTimer&&(this._progressIndicatorDelayTimer.cancel(),this._progressIndicatorDelayTimer=null);var progressBar=this._progressBar;if(progressBar.parentNode&&!this._fadingProgressBar){this._fadingProgressBar=!0;var that=this;Animations.fadeOut(progressBar).then(function(){progressBar.parentNode&&progressBar.parentNode.removeChild(progressBar),that._fadingProgressBar=!1})}},_getPanAxis:function(){return this._horizontal()?"horizontal":"vertical"},_configureForZoom:function(isZoomedOut,isCurrentView,triggerZoom){if(_BaseUtils.validation&&(!this._view.realizePage||"number"!=typeof this._view.begin))throw new _ErrorFromName("WinJS.UI.ListView.NotCompatibleWithSemanticZoom",strings.notCompatibleWithSemanticZoom);this._isZoomedOut=isZoomedOut,this._disableEntranceAnimation=!isCurrentView,
this._isCurrentZoomView=isCurrentView,this._triggerZoom=triggerZoom},_setCurrentItem:function(x,y){this._rtl()&&(x=this._viewportWidth-x),this._horizontal()?x+=this.scrollPosition:y+=this.scrollPosition;var result=this._view.hitTest(x,y),entity={type:result.type?result.type:_UI.ObjectType.item,index:result.index};entity.index>=0&&(this._hasKeyboardFocus?this._changeFocus(entity,!0,!1,!0):this._changeFocusPassively(entity))},_getCurrentItem:function(){var focused=this._selection._getFocused();focused.type===_UI.ObjectType.groupHeader?focused={type:_UI.ObjectType.item,index:this._groups.group(focused.index).startIndex}:focused.type!==_UI.ObjectType.item&&(focused={type:_UI.ObjectType.item,index:focused.type===_UI.ObjectType.header?0:this._cachedCount}),"number"!=typeof focused.index&&(this._setCurrentItem(.5*this._viewportWidth,.5*this._viewportHeight),focused=this._selection._getFocused());var that=this,promisePosition=this._getItemOffsetPosition(focused.index).then(function(posCanvas){var scrollOffset=that._canvasStart;return posCanvas[that._startProperty]+=scrollOffset,posCanvas});return Promise.join({item:this._dataSource.itemFromIndex(focused.index),position:promisePosition})},_animateItemsForPhoneZoom:function(){function rowStaggerDelay(minRow,rows,delayBetweenRows){return function(index){return(rows[index]-minRow)*delayBetweenRows}}function clearTransform(){for(var i=0,len=containersOnScreen.length;i<len;i++)containersOnScreen[i].style[transformNames.scriptName]=""}for(var containersOnScreen=[],itemRows=[],promises=[],minRow=Number.MAX_VALUE,that=this,i=this._view.firstIndexDisplayed,len=Math.min(this._cachedCount,this._view.lastIndexDisplayed+1);i<len;i++)promises.push(this._view.waitForEntityPosition({type:_UI.ObjectType.item,index:i}).then(function(){containersOnScreen.push(that._view.items.containerAt(i));var itemRow=0;if(that.layout._getItemPosition){var itemPosition=that.layout._getItemPosition(i);itemPosition.row&&(itemRow=itemPosition.row)}itemRows.push(itemRow),minRow=Math.min(itemRow,minRow)}));return Promise.join(promises).then(function(){return(0===containersOnScreen.length?Promise.wrap():_TransitionAnimation.executeTransition(containersOnScreen,{property:transformNames.cssName,delay:rowStaggerDelay(minRow,itemRows,30),duration:100,timing:"ease-in-out",from:that._isCurrentZoomView?"rotateX(0deg)":"rotateX(-90deg)",to:that._isCurrentZoomView?"rotateX(90deg)":"rotateX(0deg)"})).then(clearTransform,clearTransform)}).then(clearTransform,clearTransform)},_beginZoom:function(){this._zooming=!0;var zoomPromise=null;if(_BaseUtils.isPhone){if(this._isZoomedOut)if(this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),this._isCurrentZoomView){var that=this,animationComplete=function(){that._zoomAnimationPromise=null};this._zoomAnimationPromise=zoomPromise=this._animateItemsForPhoneZoom().then(animationComplete,animationComplete)}else this._zoomAnimationPromise=new _Signal,zoomPromise=this._zoomAnimationPromise.promise}else{var horizontal=this._horizontal(),scrollOffset=-this.scrollPosition;_ElementUtilities.addClass(this._viewport,horizontal?_Constants._zoomingXClass:_Constants._zoomingYClass),this._canvasStart=scrollOffset,_ElementUtilities.addClass(this._viewport,horizontal?_Constants._zoomingYClass:_Constants._zoomingXClass)}return zoomPromise},_positionItem:function(item,position){function positionItemAtIndex(index){return that._getItemOffsetPosition(index).then(function(posCanvas){var scrollPosition,horizontal=that._horizontal(),canvasSize=that._viewport[horizontal?"scrollWidth":"scrollHeight"],viewportSize=horizontal?that._viewportWidth:that._viewportHeight,headerSizeProp=horizontal?"headerContainerWidth":"headerContainerHeight",layoutSizes=that.layout._sizes,headerSize=0;layoutSizes&&layoutSizes[headerSizeProp]&&(headerSize=layoutSizes[headerSizeProp]);var start=_BaseUtils.isPhone?headerSize:position[that._startProperty],startMax=viewportSize-(horizontal?posCanvas.width:posCanvas.height);start=Math.max(0,Math.min(startMax,start)),scrollPosition=posCanvas[that._startProperty]-start;var adjustedScrollPosition=Math.max(0,Math.min(canvasSize-viewportSize,scrollPosition)),scrollAdjustment=adjustedScrollPosition-scrollPosition;scrollPosition=adjustedScrollPosition;var entity={type:_UI.ObjectType.item,index:index};if(that._hasKeyboardFocus?that._changeFocus(entity,!0):that._changeFocusPassively(entity),that._raiseViewLoading(!0),_BaseUtils.isPhone)that._viewportScrollPosition=scrollPosition;else{var scrollOffset=-scrollPosition;that._canvasStart=scrollOffset}if(that._view.realizePage(scrollPosition,!0),_BaseUtils.isPhone&&that._isZoomedOut){var animationComplete=function(){that._zoomAnimationPromise&&that._zoomAnimationPromise.complete&&that._zoomAnimationPromise.complete(),that._zoomAnimationPromise=null};that._animateItemsForPhoneZoom().then(animationComplete,animationComplete)}return horizontal?{x:scrollAdjustment,y:0}:{x:0,y:scrollAdjustment}})}var that=this,itemIndex=0;if(item&&(itemIndex=this._isZoomedOut?item.groupIndexHint:item.firstItemIndexHint),"number"==typeof itemIndex)return positionItemAtIndex(itemIndex);var itemPromise,key=this._isZoomedOut?item.groupKey:item.firstItemKey;if("string"==typeof key&&this._dataSource.itemFromKey)itemPromise=this._dataSource.itemFromKey(key,this._isZoomedOut?{groupMemberKey:item.key,groupMemberIndex:item.index}:null);else{var description=this._isZoomedOut?item.groupDescription:item.firstItemDescription;if(_BaseUtils.validation&&void 0===description)throw new _ErrorFromName("WinJS.UI.ListView.InvalidItem",strings.listViewInvalidItem);itemPromise=this._dataSource.itemFromDescription(description)}return itemPromise.then(function(item){return positionItemAtIndex(item.index)})},_endZoom:function(isCurrentView){if(!this._isZombie()){if(!_BaseUtils.isPhone){var scrollOffset=this._canvasStart;_ElementUtilities.removeClass(this._viewport,_Constants._zoomingYClass),_ElementUtilities.removeClass(this._viewport,_Constants._zoomingXClass),this._canvasStart=0,this._viewportScrollPosition=-scrollOffset}this._disableEntranceAnimation=!isCurrentView,this._isCurrentZoomView=isCurrentView,this._zooming=!1,this._view.realizePage(this.scrollPosition,!1)}},_getItemOffsetPosition:function(index){var that=this;return this._getItemOffset({type:_UI.ObjectType.item,index:index}).then(function(position){return that._ensureFirstColumnRange(_UI.ObjectType.item).then(function(){return position=that._correctRangeInFirstColumn(position,_UI.ObjectType.item),position=that._convertFromCanvasCoordinates(position),that._horizontal()?(position.left=position.begin,position.width=position.end-position.begin,position.height=position.totalHeight):(position.top=position.begin,position.height=position.end-position.begin,position.width=position.totalWidth),position})})},_groupRemoved:function(key){this._groupFocusCache.deleteGroup(key)},_updateFocusCache:function(itemIndex){this._updateFocusCacheItemRequest&&this._updateFocusCacheItemRequest.cancel();var that=this;this._updateFocusCacheItemRequest=this._view.items.requestItem(itemIndex).then(function(){that._updateFocusCacheItemRequest=null;var itemData=that._view.items.itemDataAt(itemIndex),groupIndex=that._groups.groupFromItem(itemIndex),groupKey=that._groups.group(groupIndex).key;itemData.itemsManagerRecord.item&&that._groupFocusCache.updateCache(groupKey,itemData.itemsManagerRecord.item.key,itemIndex)})},_changeFocus:function(newFocus,skipSelection,ctrlKeyDown,skipEnsureVisible,keyboardFocused){if(!this._isZombie()){var targetItem;if(newFocus.type===_UI.ObjectType.item)targetItem=this._view.items.itemAt(newFocus.index),!skipSelection&&targetItem&&_ElementUtilities.hasClass(targetItem,_Constants._nonSelectableClass)&&(skipSelection=!0),this._updateFocusCache(newFocus.index);else if(newFocus.type===_UI.ObjectType.groupHeader){this._lastFocusedElementInGroupTrack=newFocus;var group=this._groups.group(newFocus.index);targetItem=group&&group.header}else this._lastFocusedElementInGroupTrack=newFocus,targetItem=newFocus.type===_UI.ObjectType.footer?this._footer:this._header;this._unsetFocusOnItem(!!targetItem),this._hasKeyboardFocus=!0,this._selection._setFocused(newFocus,keyboardFocused),skipEnsureVisible||this.ensureVisible(newFocus),!skipSelection&&this._selectFocused(ctrlKeyDown)&&this._selection.set(newFocus.index),this._setFocusOnItem(newFocus)}},_changeFocusPassively:function(newFocus){var targetItem;switch(newFocus.type){case _UI.ObjectType.item:targetItem=this._view.items.itemAt(newFocus.index),this._updateFocusCache(newFocus.index);break;case _UI.ObjectType.groupHeader:this._lastFocusedElementInGroupTrack=newFocus;var group=this._groups.group(newFocus.index);targetItem=group&&group.header;break;case _UI.ObjectType.header:this._lastFocusedElementInGroupTrack=newFocus,targetItem=this._header;break;case _UI.ObjectType.footer:this._lastFocusedElementInGroupTrack=newFocus,targetItem=this._footer}this._unsetFocusOnItem(!!targetItem),this._selection._setFocused(newFocus),this._setFocusOnItem(newFocus)},_drawFocusRectangle:function(item){if(item!==this._header&&item!==this._footer)if(_ElementUtilities.hasClass(item,_Constants._headerClass))_ElementUtilities.addClass(item,_Constants._itemFocusClass);else{var itemBox=this._view.items.itemBoxFrom(item);if(itemBox.querySelector("."+_Constants._itemFocusOutlineClass))return;_ElementUtilities.addClass(itemBox,_Constants._itemFocusClass);var outline=_Global.document.createElement("div");outline.className=_Constants._itemFocusOutlineClass,itemBox.appendChild(outline)}},_clearFocusRectangle:function(item){if(item&&!this._isZombie()&&item!==this._header&&item!==this._footer){var itemBox=this._view.items.itemBoxFrom(item);if(itemBox){_ElementUtilities.removeClass(itemBox,_Constants._itemFocusClass);var outline=itemBox.querySelector("."+_Constants._itemFocusOutlineClass);outline&&outline.parentNode.removeChild(outline)}else{var header=this._groups.headerFrom(item);header&&_ElementUtilities.removeClass(header,_Constants._itemFocusClass)}}},_defaultInvoke:function(entity){(this._isZoomedOut||_BaseUtils.isPhone&&this._triggerZoom&&entity.type===_UI.ObjectType.groupHeader)&&(this._changeFocusPassively(entity),this._triggerZoom())},_selectionAllowed:function(itemIndex){var item=void 0!==itemIndex?this.elementFromIndex(itemIndex):null,itemSelectable=!(item&&_ElementUtilities.hasClass(item,_Constants._nonSelectableClass));return itemSelectable&&this._selectionMode!==_UI.SelectionMode.none},_multiSelection:function(){return this._selectionMode===_UI.SelectionMode.multi},_isInSelectionMode:function(){return this.tapBehavior===_UI.TapBehavior.toggleSelect&&this.selectionMode===_UI.SelectionMode.multi},_selectOnTap:function(){return this._tap===_UI.TapBehavior.toggleSelect||this._tap===_UI.TapBehavior.directSelect},_selectFocused:function(ctrlKeyDown){return this._tap===_UI.TapBehavior.directSelect&&this._selectionMode===_UI.SelectionMode.multi&&!ctrlKeyDown},_dispose:function(){if(!this._disposed){this._disposed=!0;var clear=function(e){e&&(e.textContent="")};_ElementUtilities._resizeNotifier.unsubscribe(this._element,this._onElementResizeBound),this._elementResizeInstrument.dispose(),this._batchingViewUpdates&&this._batchingViewUpdates.cancel(),this._view&&this._view._dispose&&this._view._dispose(),this._mode&&this._mode._dispose&&this._mode._dispose(),this._groups&&this._groups._dispose&&this._groups._dispose(),this._selection&&this._selection._dispose&&this._selection._dispose(),this._layout&&this._layout.uninitialize&&this._layout.uninitialize(),this._itemsCountPromise&&this._itemsCountPromise.cancel(),this._versionManager&&this._versionManager._dispose(),this._clearInsertedItems(),this._itemsManager&&this._itemsManager.release(),this._zoomAnimationPromise&&this._zoomAnimationPromise.cancel(),clear(this._viewport),clear(this._canvas),clear(this._canvasProxy),this._versionManager=null,this._view=null,this._mode=null,this._element=null,this._viewport=null,this._itemsManager=null,this._canvas=null,this._canvasProxy=null,this._itemsCountPromise=null,this._scrollToFunctor=null;var index=controlsToDispose.indexOf(this);index>=0&&controlsToDispose.splice(index,1)}},_isZombie:function(){return this._disposed||!(this.element.firstElementChild&&_Global.document.body.contains(this.element))},_ifZombieDispose:function(){var zombie=this._isZombie();return zombie&&!this._disposed&&scheduleForDispose(this),zombie},_animationsDisabled:function(){return 0===this._viewportWidth||0===this._viewportHeight||!_TransitionAnimation.isAnimationEnabled()},_fadeOutViewport:function(){var that=this;return new Promise(function(complete){if(that._animationsDisabled())return void complete();if(!that._fadingViewportOut){that._waitingEntranceAnimationPromise&&(that._waitingEntranceAnimationPromise.cancel(),that._waitingEntranceAnimationPromise=null);var eventDetails=that._fireAnimationEvent(ListViewAnimationType.contentTransition);that._firedAnimationEvent=!0,eventDetails.prevented?(that._disableEntranceAnimation=!0,that._viewport.style.opacity=1,complete()):(that._fadingViewportOut=!0,that._viewport.style.overflow="hidden",Animations.fadeOut(that._viewport).then(function(){that._isZombie()||(that._fadingViewportOut=!1,that._viewport.style.opacity=1,complete())}))}})},_animateListEntrance:function(firstTime){function resetViewOpacity(){that._canvas.style.opacity=1,that._headerContainer.style.opacity=1,that._footerContainer.style.opacity=1,that._viewport.style.overflow="",that._raiseHeaderFooterVisibilityEvent()}var eventDetails={prevented:!1,animationPromise:Promise.wrap()},that=this;return this._raiseHeaderFooterVisibilityEvent(),this._disableEntranceAnimation||this._animationsDisabled()?(resetViewOpacity(),this._waitingEntranceAnimationPromise&&(this._waitingEntranceAnimationPromise.cancel(),this._waitingEntranceAnimationPromise=null),Promise.wrap()):(this._firedAnimationEvent?this._firedAnimationEvent=!1:eventDetails=this._fireAnimationEvent(ListViewAnimationType.entrance),eventDetails.prevented||_BaseUtils.isPhone?(resetViewOpacity(),Promise.wrap()):(this._waitingEntranceAnimationPromise&&this._waitingEntranceAnimationPromise.cancel(),this._canvas.style.opacity=0,this._viewport.style.overflow="hidden",this._headerContainer.style.opacity=1,this._footerContainer.style.opacity=1,this._waitingEntranceAnimationPromise=eventDetails.animationPromise.then(function(){if(!that._isZombie())return that._canvas.style.opacity=1,Animations.enterContent(that._viewport).then(function(){that._isZombie()||(that._waitingEntranceAnimationPromise=null,that._viewport.style.overflow="")})}),this._waitingEntranceAnimationPromise))},_fireAnimationEvent:function(type){var animationEvent=_Global.document.createEvent("CustomEvent"),animationPromise=Promise.wrap();animationEvent.initCustomEvent("contentanimating",!0,!0,{type:type}),type===ListViewAnimationType.entrance&&(animationEvent.detail.setPromise=function(delayPromise){animationPromise=delayPromise});var prevented=!this._element.dispatchEvent(animationEvent);return{prevented:prevented,animationPromise:animationPromise}},_createAriaMarkers:function(){this._viewport.getAttribute("aria-label")||this._viewport.setAttribute("aria-label",strings.listViewViewportAriaLabel),this._ariaStartMarker||(this._ariaStartMarker=_Global.document.createElement("div"),this._ariaStartMarker.id=uniqueID(this._ariaStartMarker),this._viewport.insertBefore(this._ariaStartMarker,this._viewport.firstElementChild)),this._ariaEndMarker||(this._ariaEndMarker=_Global.document.createElement("div"),this._ariaEndMarker.id=uniqueID(this._ariaEndMarker),this._viewport.appendChild(this._ariaEndMarker))},_updateItemsAriaRoles:function(){var expectedListRole,expectedItemRole,that=this,listRole=this._element.getAttribute("role");this._currentMode().staticMode()?(expectedListRole="list",expectedItemRole="listitem"):(expectedListRole="listbox",expectedItemRole="option"),listRole===expectedListRole&&this._itemRole===expectedItemRole||(this._element.setAttribute("role",expectedListRole),this._itemRole=expectedItemRole,this._view.items.each(function(index,itemElement){itemElement.setAttribute("role",that._itemRole)}))},_updateGroupHeadersAriaRoles:function(){var headerRole=this.groupHeaderTapBehavior===_UI.GroupHeaderTapBehavior.none?"separator":"link";if(this._headerRole!==headerRole){this._headerRole=headerRole;for(var i=0,len=this._groups.length();i<len;i++){var header=this._groups.group(i).header;header&&header.setAttribute("role",this._headerRole)}}},_setAriaSelected:function(itemElement,isSelected){var ariaSelected="true"===itemElement.getAttribute("aria-selected");isSelected!==ariaSelected&&itemElement.setAttribute("aria-selected",isSelected)},_setupAriaSelectionObserver:function(item){item._mutationObserver||(this._mutationObserver.observe(item,{attributes:!0,attributeFilter:["aria-selected"]}),item._mutationObserver=!0)},_itemPropertyChange:function(list){function revertAriaSelected(items){items.forEach(function(entry){entry.item.setAttribute("aria-selected",!entry.selected)})}if(!this._isZombie()){for(var that=this,singleSelection=that._selectionMode===_UI.SelectionMode.single,changedItems=[],unselectableItems=[],i=0,len=list.length;i<len;i++){var item=list[i].target,itemBox=that._view.items.itemBoxFrom(item),selected="true"===item.getAttribute("aria-selected");if(itemBox&&selected!==_ElementUtilities._isSelectionRendered(itemBox)){var index=that._view.items.index(itemBox),entry={index:index,item:item,selected:selected};(that._selectionAllowed(index)?changedItems:unselectableItems).push(entry)}}if(changedItems.length>0){var signal=new _Signal;that.selection._synchronize(signal).then(function(){var newSelection=that.selection._cloneSelection();return changedItems.forEach(function(entry){entry.selected?newSelection[singleSelection?"set":"add"](entry.index):newSelection.remove(entry.index)}),that.selection._set(newSelection)}).then(function(approved){that._isZombie()||approved||revertAriaSelected(changedItems),signal.complete()})}revertAriaSelected(unselectableItems)}},_groupsEnabled:function(){return!!this._groups.groupDataSource},_getItemPosition:function(entity,preserveItemsBlocks){var that=this;return this._view.waitForEntityPosition(entity).then(function(){var container,alreadyCorrectedForCanvasMargins=that._zooming&&0!==that._canvasStart;switch(entity.type){case _UI.ObjectType.item:container=that._view.getContainer(entity.index);break;case _UI.ObjectType.groupHeader:container=that._view._getHeaderContainer(entity.index);break;case _UI.ObjectType.header:alreadyCorrectedForCanvasMargins=!0,container=that._headerContainer;break;case _UI.ObjectType.footer:alreadyCorrectedForCanvasMargins=!0,container=that._footerContainer}if(container){that._writeProfilerMark("WinJS.UI.ListView:getItemPosition,info");var itemsBlockFrom,itemsBlockTo;that._view._expandedRange?(itemsBlockFrom=that._view._expandedRange.first.index,itemsBlockTo=that._view._expandedRange.last.index):preserveItemsBlocks=!1,entity.type===_UI.ObjectType.item?(preserveItemsBlocks=!!preserveItemsBlocks,preserveItemsBlocks&=that._view._ensureContainerInDOM(entity.index)):preserveItemsBlocks=!1;var margins=that._getItemMargins(entity.type),position={left:that._rtl()?getOffsetRight(container)-margins.right:container.offsetLeft-margins.left,top:container.offsetTop-margins.top,totalWidth:_ElementUtilities.getTotalWidth(container),totalHeight:_ElementUtilities.getTotalHeight(container),contentWidth:_ElementUtilities.getContentWidth(container),contentHeight:_ElementUtilities.getContentHeight(container)};return preserveItemsBlocks&&that._view._forceItemsBlocksInDOM(itemsBlockFrom,itemsBlockTo+1),alreadyCorrectedForCanvasMargins?position:that._convertToCanvasCoordinates(position)}return Promise.cancel})},_getItemOffset:function(entity,preserveItemsBlocks){var that=this;return this._getItemPosition(entity,preserveItemsBlocks).then(function(pos){var margins=that._getItemMargins(entity.type);if(that._horizontal()){var rtl=that._rtl();pos.begin=pos.left-margins[rtl?"left":"right"],pos.end=pos.left+pos.totalWidth+margins[rtl?"right":"left"]}else pos.begin=pos.top-margins.bottom,pos.end=pos.top+pos.totalHeight+margins.top;return pos})},_getItemMargins:function(type){type=type||_UI.ObjectType.item;var that=this,calculateMargins=function(className){var cleanup,item=that._canvas.querySelector("."+className);item||(item=_Global.document.createElement("div"),_ElementUtilities.addClass(item,className),that._viewport.appendChild(item),cleanup=!0);var margins=_Layouts._getMargins(item);return cleanup&&that._viewport.removeChild(item),margins};return type===_UI.ObjectType.item?this._itemMargins?this._itemMargins:this._itemMargins=calculateMargins(_Constants._containerClass):type===_UI.ObjectType.groupHeader?this._headerMargins?this._headerMargins:this._headerMargins=calculateMargins(_Constants._headerContainerClass):(this._headerFooterMargins||(this._headerFooterMargins={headerMargins:calculateMargins(_Constants._listHeaderContainerClass),footerMargins:calculateMargins(_Constants._listFooterContainerClass)}),this._headerFooterMargins[type===_UI.ObjectType.header?"headerMargins":"footerMargins"])},_fireAccessibilityAnnotationCompleteEvent:function(firstIndex,lastIndex,firstHeaderIndex,lastHeaderIndex){var detail={firstIndex:firstIndex,lastIndex:lastIndex,firstHeaderIndex:+firstHeaderIndex||-1,lastHeaderIndex:+lastHeaderIndex||-1},eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent("accessibilityannotationcomplete",!0,!1,detail),this._element.dispatchEvent(eventObject)},_ensureFirstColumnRange:function(type){if(type===_UI.ObjectType.header||type===_UI.ObjectType.footer)return Promise.wrap();var propName=type===_UI.ObjectType.item?"_firstItemRange":"_firstHeaderRange";if(this[propName])return Promise.wrap();var that=this;return this._getItemOffset({type:type,index:0},!0).then(function(firstRange){that[propName]=firstRange})},_correctRangeInFirstColumn:function(range,type){if(type===_UI.ObjectType.header||type===_UI.ObjectType.footer)return range;var firstRange=type===_UI.ObjectType.groupHeader?this._firstHeaderRange:this._firstItemRange;return firstRange.begin===range.begin&&(this._horizontal()?range.begin=-this._getCanvasMargins()[this._rtl()?"right":"left"]:range.begin=-this._getCanvasMargins().top),range},_updateContainers:function(groups,count,containersDelta,modifiedElements){function createContainer(){var element=_Global.document.createElement("div");return element.className=_Constants._containerClass,element}function updateExistingGroupWithBlocks(groupNode,firstItem,newSize){firstItem+newSize>maxContainers&&(newSize=maxContainers-firstItem);var children,itemsContainer=groupNode.itemsContainer,blocks=itemsContainer.itemsBlocks,blockSize=that._view._blockSize,lastBlock=blocks.length?blocks[blocks.length-1]:null,indexOfNextGroupItem=blocks.length?(blocks.length-1)*blockSize+lastBlock.items.length:0,delta=newSize-indexOfNextGroupItem;if(delta>0){var sizeOfOldLastBlock,toAdd=delta;if(lastBlock&&lastBlock.items.length<blockSize){var emptySpotsToFill=Math.min(toAdd,blockSize-lastBlock.items.length);sizeOfOldLastBlock=lastBlock.items.length;var containersMarkup=_Helpers._stripedContainers(emptySpotsToFill,indexOfNextGroupItem);_SafeHtml.insertAdjacentHTMLUnsafe(lastBlock.element,"beforeend",containersMarkup),children=lastBlock.element.children;for(var j=0;j<emptySpotsToFill;j++)lastBlock.items.push(children[sizeOfOldLastBlock+j]);toAdd-=emptySpotsToFill}indexOfNextGroupItem=blocks.length*blockSize;var newBlocksCount=Math.floor(toAdd/blockSize),markup="",firstBlockFirstItemIndex=indexOfNextGroupItem,secondBlockFirstItemIndex=indexOfNextGroupItem+blockSize;if(newBlocksCount>0){var pairOfItemBlocks=["<div class='win-itemsblock'>"+_Helpers._stripedContainers(blockSize,firstBlockFirstItemIndex)+"</div>","<div class='win-itemsblock'>"+_Helpers._stripedContainers(blockSize,secondBlockFirstItemIndex)+"</div>"];markup=_Helpers._repeat(pairOfItemBlocks,newBlocksCount),indexOfNextGroupItem+=newBlocksCount*blockSize}var sizeOfNewLastBlock=toAdd%blockSize;sizeOfNewLastBlock>0&&(markup+="<div class='win-itemsblock'>"+_Helpers._stripedContainers(sizeOfNewLastBlock,indexOfNextGroupItem)+"</div>",indexOfNextGroupItem+=sizeOfNewLastBlock,newBlocksCount++);var blocksTemp=_Global.document.createElement("div");_SafeHtml.setInnerHTMLUnsafe(blocksTemp,markup);for(var children=blocksTemp.children,j=0;j<newBlocksCount;j++){var block=children[j],blockNode={element:block,items:_Helpers._nodeListToArray(block.children)};blocks.push(blockNode)}}else if(delta<0)for(var n=delta;n<0;n++){var container=lastBlock.items.pop();!that._view._requireFocusRestore&&container.contains(_Global.document.activeElement)&&(that._view._requireFocusRestore=_Global.document.activeElement,that._unsetFocusOnItem()),lastBlock.element.removeChild(container),removedContainers.push(container),lastBlock.items.length||(itemsContainer.element===lastBlock.element.parentNode&&itemsContainer.element.removeChild(lastBlock.element),blocks.pop(),lastBlock=blocks[blocks.length-1])}for(var j=0,len=blocks.length;j<len;j++)for(var block=blocks[j],n=0;n<block.items.length;n++)newContainers.push(block.items[n])}function addInserted(groupNode,firstItemIndex,newSize){for(var added=modifiedElements.filter(function(entry){return entry.oldIndex===-1&&entry.newIndex>=firstItemIndex&&entry.newIndex<firstItemIndex+newSize}).sort(function(left,right){return left.newIndex-right.newIndex}),itemsContainer=groupNode.itemsContainer,i=0,len=added.length;i<len;i++){var entry=added[i],offset=entry.newIndex-firstItemIndex,container=createContainer(),next=offset<itemsContainer.items.length?itemsContainer.items[offset]:null;itemsContainer.items.splice(offset,0,container),itemsContainer.element.insertBefore(container,next)}}function updateExistingGroup(groupNode,firstItem,newSize){firstItem+newSize>maxContainers&&(newSize=maxContainers-firstItem);var itemsContainer=groupNode.itemsContainer,delta=newSize-itemsContainer.items.length;if(delta>0){var children=itemsContainer.element.children,oldSize=children.length;_SafeHtml.insertAdjacentHTMLUnsafe(itemsContainer.element,"beforeend",_Helpers._repeat("<div class='win-container win-backdrop'></div>",delta));for(var n=0;n<delta;n++){var container=children[oldSize+n];itemsContainer.items.push(container)}}for(var n=delta;n<0;n++){var container=itemsContainer.items.pop();itemsContainer.element.removeChild(container),removedContainers.push(container)}for(var n=0,len=itemsContainer.items.length;n<len;n++)newContainers.push(itemsContainer.items[n])}function addNewGroup(groupInfo,firstItem){var header=that._view._createHeaderContainer(prevElement),groupNode={header:header,itemsContainer:{element:that._view._createItemsContainer(header)}};return groupNode.itemsContainer[that._view._blockSize?"itemsBlocks":"items"]=[],that._view._blockSize?updateExistingGroupWithBlocks(groupNode,firstItem,groupInfo.size):updateExistingGroup(groupNode,firstItem,groupInfo.size),groupNode}function shift(groupNode,oldFirstItemIndex,currentFirstItemIndex,newSize){for(var firstShifted,delta,currentLast=currentFirstItemIndex+newSize-1,i=0,len=modifiedElements.length;i<len;i++){var entry=modifiedElements[i];entry.newIndex>=currentFirstItemIndex&&entry.newIndex<=currentLast&&entry.oldIndex!==-1&&(firstShifted!==+firstShifted||entry.newIndex<firstShifted)&&(firstShifted=entry.newIndex,delta=entry.newIndex-entry.oldIndex)}if(firstShifted===+firstShifted){var addedBeforeShift=0;for(i=0,len=modifiedElements.length;i<len;i++){var entry=modifiedElements[i];entry.newIndex>=currentFirstItemIndex&&entry.newIndex<firstShifted&&entry.oldIndex===-1&&addedBeforeShift++}var removedBeforeShift=0,oldFirstShifted=firstShifted-delta;for(i=0,len=modifiedElements.length;i<len;i++){var entry=modifiedElements[i];entry.oldIndex>=oldFirstItemIndex&&entry.oldIndex<oldFirstShifted&&entry.newIndex===-1&&removedBeforeShift++}delta+=removedBeforeShift,delta-=addedBeforeShift,delta-=currentFirstItemIndex-oldFirstItemIndex;var itemsContainer=groupNode.itemsContainer;if(delta>0){var children=itemsContainer.element.children;_SafeHtml.insertAdjacentHTMLUnsafe(itemsContainer.element,"afterBegin",_Helpers._repeat("<div class='win-container win-backdrop'></div>",delta));for(var n=0;n<delta;n++){var container=children[n];itemsContainer.items.splice(n,0,container)}}for(var n=delta;n<0;n++){var container=itemsContainer.items.shift();itemsContainer.element.removeChild(container)}delta&&that._affectedRange.add({start:currentFirstItemIndex,end:currentFirstItemIndex+newSize},count)}}function flatIndexToGroupIndex(index){for(var firstItem=0,i=0,len=that._view.tree.length;i<len;i++){var group=that._view.tree[i],size=group.itemsContainer.items.length,lastItem=firstItem+size-1;if(index>=firstItem&&index<=lastItem)return{group:i,item:index-firstItem};firstItem+=size}}var maxContainers,that=this,containerCountAfterEdits=this._view.containers.length+containersDelta,asyncContainerCreationInProgress=containerCountAfterEdits<count;if(asyncContainerCreationInProgress){for(var countInsertedInRealizedRange=0,i=0;i<modifiedElements.length;i++)modifiedElements[i].oldIndex===-1&&countInsertedInRealizedRange++;maxContainers=this._view.containers.length+countInsertedInRealizedRange}else maxContainers=count;var newTree=[],newKeyToGroupIndex={},newContainers=[],removedContainers=[],oldFirstItem=[],firstItem=0;if(!that._view._blockSize)for(var i=0,len=this._view.tree.length;i<len;i++)oldFirstItem.push(firstItem),firstItem+=this._view.tree[i].itemsContainer.items.length;if(!that._view._blockSize)for(var removed=modifiedElements.filter(function(entry){return entry.newIndex===-1&&!entry._removalHandled}).sort(function(left,right){return right.oldIndex-left.oldIndex}),i=0,len=removed.length;i<len;i++){var entry=removed[i];entry._removalHandled=!0;var itemBox=entry._itemBox;entry._itemBox=null;var groupIndex=flatIndexToGroupIndex(entry.oldIndex),group=this._view.tree[groupIndex.group],container=group.itemsContainer.items[groupIndex.item];container.parentNode.removeChild(container),_ElementUtilities.hasClass(itemBox,_Constants._selectedClass)&&_ElementUtilities.addClass(container,_Constants._selectedClass),group.itemsContainer.items.splice(groupIndex.item,1),entry.element=container}this._view._modifiedGroups=[];var prevElement=this._canvasProxy;firstItem=0;for(var i=0,len=groups.length;i<len&&(!this._groupsEnabled()||firstItem<maxContainers);i++){var groupInfo=groups[i],existingGroupIndex=this._view.keyToGroupIndex[groupInfo.key],existingGroup=this._view.tree[existingGroupIndex];if(existingGroup)that._view._blockSize?updateExistingGroupWithBlocks(existingGroup,firstItem,groupInfo.size):(shift(existingGroup,oldFirstItem[existingGroupIndex],firstItem,groupInfo.size),addInserted(existingGroup,firstItem,groupInfo.size),updateExistingGroup(existingGroup,firstItem,groupInfo.size)),newTree.push(existingGroup),newKeyToGroupIndex[groupInfo.key]=newTree.length-1,delete this._view.keyToGroupIndex[groupInfo.key],prevElement=existingGroup.itemsContainer.element,this._view._modifiedGroups.push({oldIndex:existingGroupIndex,newIndex:newTree.length-1,element:existingGroup.header});else{var newGroup=addNewGroup(groupInfo,firstItem);newTree.push(newGroup),newKeyToGroupIndex[groupInfo.key]=newTree.length-1,this._view._modifiedGroups.push({oldIndex:-1,newIndex:newTree.length-1,element:newGroup.header}),prevElement=newGroup.itemsContainer.element}firstItem+=groupInfo.size}for(var removedItemsContainers=[],removedHeaders=[],removedGroups=this._view.keyToGroupIndex?Object.keys(this._view.keyToGroupIndex):[],i=0,len=removedGroups.length;i<len;i++){var groupIndex=this._view.keyToGroupIndex[removedGroups[i]],groupNode=this._view.tree[groupIndex];if(removedHeaders.push(groupNode.header),removedItemsContainers.push(groupNode.itemsContainer.element),this._view._blockSize)for(var b=0;b<groupNode.itemsContainer.itemsBlocks.length;b++)for(var block=groupNode.itemsContainer.itemsBlocks[b],n=0;n<block.items.length;n++)removedContainers.push(block.items[n]);else for(var n=0;n<groupNode.itemsContainer.items.length;n++)removedContainers.push(groupNode.itemsContainer.items[n]);
this._view._modifiedGroups.push({oldIndex:groupIndex,newIndex:-1,element:groupNode.header})}for(var i=0,len=modifiedElements.length;i<len;i++)if(modifiedElements[i].newIndex===-1&&!modifiedElements[i]._removalHandled){modifiedElements[i]._removalHandled=!0;var itemBox=modifiedElements[i]._itemBox;modifiedElements[i]._itemBox=null;var container;removedContainers.length?(container=removedContainers.pop(),_ElementUtilities.empty(container)):container=createContainer(),_ElementUtilities.hasClass(itemBox,_Constants._selectedClass)&&_ElementUtilities.addClass(container,_Constants._selectedClass),modifiedElements._containerStripe===_Constants._containerEvenClass?(_ElementUtilities.addClass(container,_Constants._containerEvenClass),_ElementUtilities.removeClass(container,_Constants._containerOddClass)):(_ElementUtilities.addClass(container,_Constants._containerOddClass),_ElementUtilities.removeClass(container,_Constants._containerEvenClass)),container.appendChild(itemBox),modifiedElements[i].element=container}return this._view.tree=newTree,this._view.keyToGroupIndex=newKeyToGroupIndex,this._view.containers=newContainers,{removedHeaders:removedHeaders,removedItemsContainers:removedItemsContainers}},_writeProfilerMark:function(text){var message="WinJS.UI.ListView:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"listviewprofiler")}},{triggerDispose:function(){disposeControls()}});return _Base.Class.mix(ListView,_Events.createEventProperties("iteminvoked","groupheaderinvoked","selectionchanging","selectionchanged","loadingstatechanged","keyboardnavigating","contentanimating","itemdragstart","itemdragenter","itemdragend","itemdragbetween","itemdragleave","itemdragchanged","itemdragdrop","headervisibilitychanged","footervisibilitychanged","accessibilityannotationcomplete")),_Base.Class.mix(ListView,_Control.DOMEventMixin),ListView})})}),define("WinJS/Controls/FlipView/_Constants",[],function(){"use strict";var members={};return members.datasourceCountChangedEvent="datasourcecountchanged",members.pageVisibilityChangedEvent="pagevisibilitychanged",members.pageSelectedEvent="pageselected",members.pageCompletedEvent="pagecompleted",members}),define("WinJS/Controls/FlipView/_PageManager",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Promise","../../_Signal","../../Scheduler","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_TabContainer","./_Constants"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Log,_Resources,_WriteProfilerMark,Animations,Promise,_Signal,Scheduler,_Dispose,_ElementUtilities,_TabContainer,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_FlipPageManager:_Base.Namespace._lazy(function(){function isFlipper(element){var control=element.winControl;return!(!control||!control._isFlipView)}function flipperPropertyChanged(list){list.forEach(function(record){var element=record.target;element.winControl&&element.tabIndex>=0&&(element.winControl._pageManager._updateTabIndex(element.tabIndex),element.tabIndex=-1);var that=element.winControl;if(that&&that._isFlipView){var dirChanged=!1;"dir"===record.attributeName?dirChanged=!0:"style"===record.attributeName&&(dirChanged=that._cachedStyleDir!==element.style.direction),dirChanged&&(that._cachedStyleDir=element.style.direction,that._pageManager._rtl="rtl"===_ElementUtilities._getComputedStyle(that._pageManager._flipperDiv,null).direction,that._pageManager.resized())}})}var uniqueID=_ElementUtilities._uniqueID,styleEquivalents=_BaseUtils._browserStyleEquivalents,leftBufferAmount=50,itemSelectedEventDelay=250,strings={get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"}},_FlipPageManager=_Base.Class.define(function(flipperDiv,panningDiv,panningDivContainer,itemsManager,itemSpacing,environmentSupportsTouch,buttonVisibilityHandler){this._visibleElements=[],this._flipperDiv=flipperDiv,this._panningDiv=panningDiv,this._panningDivContainer=panningDivContainer,this._buttonVisibilityHandler=buttonVisibilityHandler,this._currentPage=null,this._rtl="rtl"===_ElementUtilities._getComputedStyle(this._flipperDiv,null).direction,this._itemsManager=itemsManager,this._itemSpacing=itemSpacing,this._tabIndex=_ElementUtilities.getTabIndex(flipperDiv),this._tabIndex<0&&(this._tabIndex=0),panningDiv.tabIndex=-1,flipperDiv.tabIndex=-1,this._tabManager=new _TabContainer.TabContainer(this._panningDivContainer),this._tabManager.tabIndex=this._tabIndex,this._lastSelectedPage=null,this._lastSelectedElement=null,this._bufferSize=_FlipPageManager.flipPageBufferCount,this._cachedSize=-1,this._environmentSupportsTouch=environmentSupportsTouch;var that=this;this._panningDiv.addEventListener("keydown",function(event){that._blockTabs&&event.keyCode===_ElementUtilities.Key.tab&&(event.stopImmediatePropagation(),event.preventDefault())},!0),_ElementUtilities._addEventListener(this._flipperDiv,"focusin",function(event){event.target===that._flipperDiv&&that._currentPage.element&&_ElementUtilities._setActive(that._currentPage.element)},!1),new _ElementUtilities._MutationObserver(flipperPropertyChanged).observe(this._flipperDiv,{attributes:!0,attributeFilter:["dir","style","tabindex"]}),this._cachedStyleDir=this._flipperDiv.style.direction,this._handleManipulationStateChangedBound=this._handleManipulationStateChanged.bind(this),this._environmentSupportsTouch&&this._panningDivContainer.addEventListener(_BaseUtils._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0)},{initialize:function(initialIndex,isHorizontal){var currPage=null;if(this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight,this._isHorizontal=isHorizontal,!this._currentPage){this._bufferAriaStartMarker=_Global.document.createElement("div"),this._bufferAriaStartMarker.id=uniqueID(this._bufferAriaStartMarker),this._panningDiv.appendChild(this._bufferAriaStartMarker),this._currentPage=this._createFlipPage(null,this),currPage=this._currentPage,this._panningDiv.appendChild(currPage.pageRoot);for(var pagesToInit=2*this._bufferSize,i=0;i<pagesToInit;i++)currPage=this._createFlipPage(currPage,this),this._panningDiv.appendChild(currPage.pageRoot);this._bufferAriaEndMarker=_Global.document.createElement("div"),this._bufferAriaEndMarker.id=uniqueID(this._bufferAriaEndMarker),this._panningDiv.appendChild(this._bufferAriaEndMarker)}this._prevMarker=this._currentPage.prev.prev,this._itemsManager&&this.setNewItemsManager(this._itemsManager,initialIndex)},dispose:function(){var curPage=this._currentPage,tmpPage=curPage;do _Dispose._disposeElement(tmpPage.element),tmpPage=tmpPage.next;while(tmpPage!==curPage)},setOrientation:function(isHorizontal){if(this._notificationsEndedSignal){var that=this;return void this._notificationsEndedSignal.promise.done(function(){that._notificationsEndedSignal=null,that.setOrientation(isHorizontal)})}if(isHorizontal!==this._isHorizontal){this._isOrientationChanging=!0,this._isHorizontal?_ElementUtilities.setScrollPosition(this._panningDivContainer,{scrollLeft:this._getItemStart(this._currentPage),scrollTop:0}):_ElementUtilities.setScrollPosition(this._panningDivContainer,{scrollLeft:0,scrollTop:this._getItemStart(this._currentPage)}),this._isHorizontal=isHorizontal;var containerStyle=this._panningDivContainer.style;containerStyle.overflowX="hidden",containerStyle.overflowY="hidden";var that=this;_BaseUtils._requestAnimationFrame(function(){that._isOrientationChanging=!1,that._forEachPage(function(curr){var currStyle=curr.pageRoot.style;currStyle.left="0px",currStyle.top="0px"}),containerStyle.overflowX=that._isHorizontal&&that._environmentSupportsTouch?"scroll":"hidden",containerStyle.overflowY=that._isHorizontal||!that._environmentSupportsTouch?"hidden":"scroll",that._ensureCentered()})}},resetState:function(initialIndex){if(this._writeProfilerMark("WinJS.UI.FlipView:resetState,info"),0!==initialIndex){var indexValid=this.jumpToIndex(initialIndex,!0);if(!indexValid&&_BaseUtils.validation)throw new _ErrorFromName("WinJS.UI.FlipView.BadCurrentPage",strings.badCurrentPage);return indexValid}_Dispose.disposeSubTree(this._flipperDiv),this._resetBuffer(null,!0);var that=this,work=Promise.wrap(!0);return this._itemsManager&&(work=that._itemsManager._firstItem().then(function(e){return that._currentPage.setElement(e),that._fetchPreviousItems(!0).then(function(){return that._fetchNextItems()}).then(function(){that._setButtonStates()})})),work.then(function(){that._tabManager.childFocus=that._currentPage.element,that._ensureCentered(),that._itemSettledOn()})},setNewItemsManager:function(manager,initialIndex){this._itemsManager=manager;var that=this;return this.resetState(initialIndex).then(function(){0!==initialIndex&&(that._tabManager.childFocus=that._currentPage.element,that._ensureCentered(),that._itemSettledOn())})},currentIndex:function(){if(!this._itemsManager)return 0;var index=0,element=this._navigationAnimationRecord?this._navigationAnimationRecord.newCurrentElement:this._currentPage.element;return element&&(index=this._getElementIndex(element)),index},resetScrollPos:function(){this._ensureCentered()},scrollPosChanged:function(){if(this._hasFocus&&(this._hadFocus=!0),this._itemsManager&&this._currentPage.element&&!this._isOrientationChanging){var newPos=this._getViewportStart(),bufferEnd=this._lastScrollPos>newPos?this._getTailOfBuffer():this._getHeadOfBuffer();if(newPos!==this._lastScrollPos){for(;this._currentPage.element&&this._getItemStart(this._currentPage)>newPos&&this._currentPage.prev.element;)this._currentPage=this._currentPage.prev,this._fetchOnePrevious(bufferEnd.prev),bufferEnd=bufferEnd.prev;for(;this._currentPage.element&&this._itemEnd(this._currentPage)<=newPos&&this._currentPage.next.element;)this._currentPage=this._currentPage.next,this._fetchOneNext(bufferEnd.next),bufferEnd=bufferEnd.next;this._setButtonStates(),this._checkElementVisibility(!1),this._blockTabs=!0,this._lastScrollPos=newPos,this._currentPage.element&&(this._tabManager.childFocus=this._currentPage.element),this._setListEnds(),!this._manipulationState&&this._viewportOnItemStart()&&(this._currentPage.element.setAttribute("aria-setsize",this._cachedSize),this._currentPage.element.setAttribute("aria-posinset",this.currentIndex()+1),this._timeoutPageSelection())}}},itemRetrieved:function(real,placeholder){var that=this;if(this._forEachPage(function(curr){if(curr.element===placeholder)return curr===that._currentPage||curr===that._currentPage.next?that._changeFlipPage(curr,placeholder,real):curr.setElement(real,!0),!0}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers)for(var animatingElements=this._navigationAnimationRecord.elementContainers,i=0,len=animatingElements.length;i<len;i++)animatingElements[i].element===placeholder&&(that._changeFlipPage(animatingElements[i],placeholder,real),animatingElements[i].element=real);this._checkElementVisibility(!1)},resized:function(){this._panningDivContainerOffsetWidth=this._panningDivContainer.offsetWidth,this._panningDivContainerOffsetHeight=this._panningDivContainer.offsetHeight;var that=this;this._forEachPage(function(curr){curr.pageRoot.style.width=that._panningDivContainerOffsetWidth+"px",curr.pageRoot.style.height=that._panningDivContainerOffsetHeight+"px"}),this._ensureCentered(),this._writeProfilerMark("WinJS.UI.FlipView:resize,StopTM")},jumpToIndex:function(index,forceJump){if(!forceJump){if(!this._itemsManager||!this._currentPage.element||index<0)return Promise.wrap(!1);var currIndex=this._getElementIndex(this._currentPage.element),distance=Math.abs(index-currIndex);if(0===distance)return Promise.wrap(!1)}var tail=Promise.wrap(!0),that=this;return tail=tail.then(function(){var itemPromise=that._itemsManager._itemPromiseAtIndex(index);return Promise.join({element:that._itemsManager._itemFromItemPromise(itemPromise),item:itemPromise}).then(function(v){var elementAtIndex=v.element;return that._resetBuffer(elementAtIndex,forceJump),!!elementAtIndex&&(that._currentPage.setElement(elementAtIndex),that._fetchNextItems().then(function(){return that._fetchPreviousItems(!0)}).then(function(){return!0}))})}),tail=tail.then(function(v){return that._setButtonStates(),v})},startAnimatedNavigation:function(goForward,cancelAnimationCallback,completionCallback){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedNavigation,info"),this._currentPage.element){var outgoingPage=this._currentPage,incomingPage=goForward?this._currentPage.next:this._currentPage.prev;if(incomingPage.element){this._hasFocus&&_ElementUtilities._setActive(this._panningDiv),this._navigationAnimationRecord={},this._navigationAnimationRecord.goForward=goForward,this._navigationAnimationRecord.cancelAnimationCallback=cancelAnimationCallback,this._navigationAnimationRecord.completionCallback=completionCallback,this._navigationAnimationRecord.oldCurrentPage=outgoingPage,this._navigationAnimationRecord.newCurrentPage=incomingPage;var outgoingElement=outgoingPage.element,incomingElement=incomingPage.element;this._navigationAnimationRecord.newCurrentElement=incomingElement,outgoingPage.setElement(null,!0),outgoingPage.elementUniqueID=uniqueID(outgoingElement),incomingPage.setElement(null,!0),incomingPage.elementUniqueID=uniqueID(incomingElement);var outgoingFlipPage=this._createDiscardablePage(outgoingElement),incomingFlipPage=this._createDiscardablePage(incomingElement);return outgoingFlipPage.pageRoot.itemIndex=this._getElementIndex(outgoingElement),incomingFlipPage.pageRoot.itemIndex=outgoingFlipPage.pageRoot.itemIndex+(goForward?1:-1),outgoingFlipPage.pageRoot.style.position="absolute",incomingFlipPage.pageRoot.style.position="absolute",outgoingFlipPage.pageRoot.style.zIndex=1,incomingFlipPage.pageRoot.style.zIndex=2,this._setItemStart(outgoingFlipPage,0),this._setItemStart(incomingFlipPage,0),this._blockTabs=!0,this._visibleElements.push(incomingElement),this._announceElementVisible(incomingElement),this._navigationAnimationRecord.elementContainers=[outgoingFlipPage,incomingFlipPage],{outgoing:outgoingFlipPage,incoming:incomingFlipPage}}}return null},endAnimatedNavigation:function(goForward,outgoing,incoming){if(this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedNavigation,info"),this._navigationAnimationRecord&&this._navigationAnimationRecord.oldCurrentPage&&this._navigationAnimationRecord.newCurrentPage){var outgoingRemoved=this._restoreAnimatedElement(this._navigationAnimationRecord.oldCurrentPage,outgoing);this._restoreAnimatedElement(this._navigationAnimationRecord.newCurrentPage,incoming),outgoingRemoved||this._setViewportStart(this._getItemStart(goForward?this._currentPage.next:this._currentPage.prev)),this._navigationAnimationRecord=null,this._itemSettledOn()}},startAnimatedJump:function(index,cancelAnimationCallback,completionCallback){if(this._writeProfilerMark("WinJS.UI.FlipView:startAnimatedJump,info"),this._hasFocus&&(this._hadFocus=!0),this._currentPage.element){var oldElement=this._currentPage.element,oldIndex=this._getElementIndex(oldElement),that=this;return that.jumpToIndex(index).then(function(v){if(!v)return null;if(that._navigationAnimationRecord={},that._navigationAnimationRecord.cancelAnimationCallback=cancelAnimationCallback,that._navigationAnimationRecord.completionCallback=completionCallback,that._navigationAnimationRecord.oldCurrentPage=null,that._forEachPage(function(curr){if(curr.element===oldElement)return that._navigationAnimationRecord.oldCurrentPage=curr,!0}),that._navigationAnimationRecord.newCurrentPage=that._currentPage,that._navigationAnimationRecord.newCurrentPage===that._navigationAnimationRecord.oldCurrentPage)return null;var newElement=that._currentPage.element;that._navigationAnimationRecord.newCurrentElement=newElement,that._currentPage.setElement(null,!0),that._currentPage.elementUniqueID=uniqueID(newElement),that._navigationAnimationRecord.oldCurrentPage&&that._navigationAnimationRecord.oldCurrentPage.setElement(null,!0);var oldFlipPage=that._createDiscardablePage(oldElement),newFlipPage=that._createDiscardablePage(newElement);return oldFlipPage.pageRoot.itemIndex=oldIndex,newFlipPage.pageRoot.itemIndex=index,oldFlipPage.pageRoot.style.position="absolute",newFlipPage.pageRoot.style.position="absolute",oldFlipPage.pageRoot.style.zIndex=1,newFlipPage.pageRoot.style.zIndex=2,that._setItemStart(oldFlipPage,0),that._setItemStart(newFlipPage,that._itemSize(that._currentPage)),that._visibleElements.push(newElement),that._announceElementVisible(newElement),that._navigationAnimationRecord.elementContainers=[oldFlipPage,newFlipPage],that._blockTabs=!0,{oldPage:oldFlipPage,newPage:newFlipPage}})}return Promise.wrap(null)},simulateMouseWheelScroll:function(ev){if(!this._environmentSupportsTouch&&!this._waitingForMouseScroll){var wheelingForward;wheelingForward="number"==typeof ev.deltaY?(ev.deltaX||ev.deltaY)>0:ev.wheelDelta<0;var targetPage=wheelingForward?this._currentPage.next:this._currentPage.prev;if(targetPage.element){var zoomToContent={contentX:0,contentY:0,viewportX:0,viewportY:0};zoomToContent[this._isHorizontal?"contentX":"contentY"]=this._getItemStart(targetPage),_ElementUtilities._zoomTo(this._panningDivContainer,zoomToContent),this._waitingForMouseScroll=!0,_Global.setTimeout(function(){this._waitingForMouseScroll=!1}.bind(this),_ElementUtilities._zoomToDuration+100)}}},endAnimatedJump:function(oldCurr,newCurr){this._writeProfilerMark("WinJS.UI.FlipView:endAnimatedJump,info"),this._navigationAnimationRecord.oldCurrentPage?this._navigationAnimationRecord.oldCurrentPage.setElement(oldCurr.element,!0):oldCurr.element.parentNode&&oldCurr.element.parentNode.removeChild(oldCurr.element),this._navigationAnimationRecord.newCurrentPage.setElement(newCurr.element,!0),this._navigationAnimationRecord=null,this._ensureCentered(),this._itemSettledOn()},inserted:function(element,prev,next,animateInsertion){this._writeProfilerMark("WinJS.UI.FlipView:inserted,info");var curr=this._prevMarker,passedCurrent=!1,elementSuccessfullyPlaced=!1;if(animateInsertion&&(this._createAnimationRecord(uniqueID(element),null),this._getAnimationRecord(element).inserted=!0),prev){do{if(curr===this._currentPage&&(passedCurrent=!0),curr.elementUniqueID===uniqueID(prev)){elementSuccessfullyPlaced=!0;var temp,pageShifted=curr,lastElementMoved=element,lastElementMovedUniqueID=uniqueID(element);if(passedCurrent)for(;pageShifted.next!==this._prevMarker;)temp=pageShifted.next.element,lastElementMovedUniqueID=pageShifted.next.elementUniqueID,pageShifted.next.setElement(lastElementMoved,!0),!lastElementMoved&&lastElementMovedUniqueID&&(pageShifted.next.elementUniqueID=lastElementMovedUniqueID),lastElementMoved=temp,pageShifted=pageShifted.next;else for(curr.elementUniqueID===curr.next.elementUniqueID&&curr.elementUniqueID&&(pageShifted=curr.next);pageShifted.next!==this._prevMarker;)temp=pageShifted.element,lastElementMovedUniqueID=pageShifted.elementUniqueID,pageShifted.setElement(lastElementMoved,!0),!lastElementMoved&&lastElementMovedUniqueID&&(pageShifted.elementUniqueID=lastElementMovedUniqueID),lastElementMoved=temp,pageShifted=pageShifted.prev;if(lastElementMoved){var reused=!1;this._forEachPage(function(curr){if(uniqueID(lastElementMoved)===curr.elementUniqueID)return reused=!0,!0}),reused||this._releaseElementIfNotAnimated(lastElementMoved)}break}curr=curr.next}while(curr!==this._prevMarker)}else if(next){for(;curr.next!==this._prevMarker&&curr.elementUniqueID!==uniqueID(next);)curr===this._currentPage&&(passedCurrent=!0),curr=curr.next;curr.elementUniqueID===uniqueID(next)&&curr!==this._prevMarker?(curr.prev.setElement(element),elementSuccessfullyPlaced=!0):this._releaseElementIfNotAnimated(element)}else this._currentPage.setElement(element);this._getAnimationRecord(element).successfullyMoved=elementSuccessfullyPlaced,this._setButtonStates()},changed:function(newVal,element){this._writeProfilerMark("WinJS.UI.FlipView:changed,info");var that=this;if(this._forEachPage(function(curr){if(curr.elementUniqueID===uniqueID(element)){var record=that._animationRecords[curr.elementUniqueID];return record.changed=!0,record.oldElement=element,record.newElement=newVal,curr.element=newVal,curr.elementUniqueID=uniqueID(newVal),that._animationRecords[uniqueID(newVal)]=record,!0}}),this._navigationAnimationRecord&&this._navigationAnimationRecord.elementContainers){for(var i=0,len=this._navigationAnimationRecord.elementContainers.length;i<len;i++){var page=this._navigationAnimationRecord.elementContainers[i];page&&page.elementUniqueID===uniqueID(element)&&(page.element=newVal,page.elementUniqueID=uniqueID(newVal))}var newElement=this._navigationAnimationRecord.newCurrentElement;newElement&&uniqueID(newElement)===uniqueID(element)&&(this._navigationAnimationRecord.newCurrentElement=newVal)}},moved:function(element,prev,next){this._writeProfilerMark("WinJS.UI.FlipView:moved,info");var record=this._getAnimationRecord(element);record||(record=this._createAnimationRecord(uniqueID(element))),record.moved=!0,this.removed(element,!1,!1),prev||next?this.inserted(element,prev,next,!1):record.successfullyMoved=!1},removed:function(element,mirage,animateRemoval){this._writeProfilerMark("WinJS.UI.FlipView:removed,info");var that=this,prevMarker=this._prevMarker,work=Promise.wrap();if(mirage){var clearNext=!1;return this._forEachPage(function(curr){(curr.elementUniqueID===uniqueID(element)||clearNext)&&(curr.setElement(null,!0),clearNext=!0)}),void this._setButtonStates()}if(animateRemoval){var record=this._getAnimationRecord(element);record&&(record.removed=!0)}if(this._currentPage.elementUniqueID===uniqueID(element))this._currentPage.next.elementUniqueID?(this._shiftLeft(this._currentPage),this._ensureCentered()):this._currentPage.prev.elementUniqueID?this._shiftRight(this._currentPage):this._currentPage.setElement(null,!0);else if(prevMarker.elementUniqueID===uniqueID(element))prevMarker.next.element?work=this._itemsManager._previousItem(prevMarker.next.element).then(function(e){return e===element&&(e=that._itemsManager._previousItem(e)),e}).then(function(e){prevMarker.setElement(e,!0)}):prevMarker.setElement(null,!0);else if(prevMarker.prev.elementUniqueID===uniqueID(element))prevMarker.prev.prev&&prevMarker.prev.prev.element?work=this._itemsManager._nextItem(prevMarker.prev.prev.element).then(function(e){return e===element&&(e=that._itemsManager._nextItem(e)),e}).then(function(e){prevMarker.prev.setElement(e,!0)}):prevMarker.prev.setElement(null,!0);else{for(var curr=this._currentPage.prev,handled=!1;curr!==prevMarker&&!handled;)curr.elementUniqueID===uniqueID(element)&&(this._shiftRight(curr),handled=!0),curr=curr.prev;for(curr=this._currentPage.next;curr!==prevMarker&&!handled;)curr.elementUniqueID===uniqueID(element)&&(this._shiftLeft(curr),handled=!0),curr=curr.next}return work.then(function(){that._setButtonStates()})},reload:function(){this._writeProfilerMark("WinJS.UI.FlipView:reload,info"),this.resetState(0)},getItemSpacing:function(){return this._itemSpacing},setItemSpacing:function(space){this._itemSpacing=space,this._ensureCentered()},notificationsStarted:function(){this._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StartTM"),this._logBuffer(),this._notificationsStarted=this._notificationsStarted||0,this._notificationsStarted++,this._notificationsEndedSignal=new _Signal,this._temporaryKeys=[],this._animationRecords={};var that=this;this._forEachPage(function(curr){that._createAnimationRecord(curr.elementUniqueID,curr)}),this._animationRecords.currentPage=this._currentPage.element,this._animationRecords.nextPage=this._currentPage.next.element},notificationsEnded:function(){var that=this;this._endNotificationsWork&&this._endNotificationsWork.cancel(),this._endNotificationsWork=this._ensureBufferConsistency().then(function(){function flipPageFromElement(element){var flipPage=null;return that._forEachPage(function(curr){if(curr.element===element)return flipPage=curr,!0}),flipPage}function animateOldViewportItemRemoved(record,item){that._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemRemoved,info");var removedPage=that._createDiscardablePage(item);that._setItemStart(removedPage,record.originalLocation),animationPromises.push(that._deleteFlipPage(removedPage))}function animateOldViewportItemMoved(record,item){that._writeProfilerMark("WinJS.UI.FlipView:_animateOldViewportItemMoved,info");var movedPage,newLocation=record.originalLocation;if(record.successfullyMoved)movedPage=flipPageFromElement(item),newLocation=record.newLocation;else{movedPage=that._createDiscardablePage(item);var indexMovedTo=that._getElementIndex(item),newCurrentIndex=that._currentPage.element?that._getElementIndex(that._currentPage.element):0;newLocation+=newCurrentIndex>indexMovedTo?-100*that._bufferSize:100*that._bufferSize}movedPage&&(that._setItemStart(movedPage,record.originalLocation),animationPromises.push(that._moveFlipPage(movedPage,function(){that._setItemStart(movedPage,newLocation)})))}function joinAnimationPromises(){return 0===animationPromises.length&&animationPromises.push(Promise.wrap()),Promise.join(animationPromises)}var animationPromises=[];that._forEachPage(function(curr){var record=that._getAnimationRecord(curr.element);record&&(record.changed&&(record.oldElement.removedFromChange=!0,animationPromises.push(that._changeFlipPage(curr,record.oldElement,record.newElement))),record.newLocation=curr.location,that._setItemStart(curr,record.originalLocation),record.inserted&&(curr.elementRoot.style.opacity=0))});var oldCurrent=that._animationRecords.currentPage,oldCurrentRecord=that._getAnimationRecord(oldCurrent),oldNext=that._animationRecords.nextPage,oldNextRecord=that._getAnimationRecord(oldNext);oldCurrentRecord&&oldCurrentRecord.changed&&(oldCurrent=oldCurrentRecord.newElement),oldNextRecord&&oldNextRecord.changed&&(oldNext=oldNextRecord.newElement),oldCurrent===that._currentPage.element&&oldNext===that._currentPage.next.element||(oldCurrentRecord&&oldCurrentRecord.removed&&animateOldViewportItemRemoved(oldCurrentRecord,oldCurrent),oldNextRecord&&oldNextRecord.removed&&animateOldViewportItemRemoved(oldNextRecord,oldNext)),that._blockTabs=!0,joinAnimationPromises().then(function(){animationPromises=[],oldCurrentRecord&&oldCurrentRecord.moved&&animateOldViewportItemMoved(oldCurrentRecord,oldCurrent),oldNextRecord&&oldNextRecord.moved&&animateOldViewportItemMoved(oldNextRecord,oldNext);var newCurrRecord=that._getAnimationRecord(that._currentPage.element),newNextRecord=that._getAnimationRecord(that._currentPage.next.element);that._forEachPage(function(curr){var record=that._getAnimationRecord(curr.element);record&&(record.inserted?record!==newCurrRecord&&record!==newNextRecord&&(curr.elementRoot.style.opacity=1):record.originalLocation!==record.newLocation&&(record!==oldCurrentRecord&&record!==oldNextRecord||record===oldCurrentRecord&&!oldCurrentRecord.moved||record===oldNextRecord&&!oldNextRecord.moved)&&animationPromises.push(that._moveFlipPage(curr,function(){that._setItemStart(curr,record.newLocation)})))}),joinAnimationPromises().then(function(){animationPromises=[],newCurrRecord&&newCurrRecord.inserted&&animationPromises.push(that._insertFlipPage(that._currentPage)),newNextRecord&&newNextRecord.inserted&&animationPromises.push(that._insertFlipPage(that._currentPage.next)),joinAnimationPromises().then(function(){that._checkElementVisibility(!1),that._itemSettledOn(),that._setListEnds(),that._notificationsStarted--,0===that._notificationsStarted&&that._notificationsEndedSignal.complete(),that._writeProfilerMark("WinJS.UI.FlipView:changeNotifications,StopTM"),that._logBuffer(),that._endNotificationsWork=null})})})})},disableTouchFeatures:function(){this._environmentSupportsTouch=!1;var panningContainerStyle=this._panningDivContainer.style;this._panningDivContainer.removeEventListener(_BaseUtils._browserEventEquivalents.manipulationStateChanged,this._handleManipulationStateChangedBound,!0),panningContainerStyle.overflowX="hidden",panningContainerStyle.overflowY="hidden";var panningContainerPropertiesToClear=["scroll-snap-type","scroll-snap-points-x","scroll-snap-points-y","scroll-limit-x-min","scroll-limit-x-max","scroll-limit-y-min","scroll-limit-y-max"];panningContainerPropertiesToClear.forEach(function(propertyName){var platformPropertyName=styleEquivalents[propertyName];platformPropertyName&&(panningContainerStyle[platformPropertyName.scriptName]="")})},_hasFocus:{get:function(){return this._flipperDiv.contains(_Global.document.activeElement)}},_timeoutPageSelection:function(){var that=this;this._lastTimeoutRequest&&this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=Promise.timeout(itemSelectedEventDelay).then(function(){that._itemSettledOn()})},_updateTabIndex:function(newIndex){this._forEachPage(function(curr){curr.element&&(curr.element.tabIndex=newIndex)}),this._tabIndex=newIndex,this._tabManager.tabIndex=newIndex},_releaseElementIfNotAnimated:function(element){var animatedRecord=this._getAnimationRecord(element);animatedRecord&&(animatedRecord.changed||animatedRecord.inserted||animatedRecord.moved||animatedRecord.removed)||this._itemsManager.releaseItem(element)},_getAnimationRecord:function(element){return element?this._animationRecords[uniqueID(element)]:null},_createAnimationRecord:function(elementUniqueID,flipPage){if(elementUniqueID){var record=this._animationRecords[elementUniqueID]={removed:!1,changed:!1,inserted:!1};return flipPage&&(record.originalLocation=flipPage.location),record}},_writeProfilerMark:function(message){_WriteProfilerMark(message),this._flipperDiv.winControl.constructor._enabledDebug&&_Log.log&&_Log.log(message,null,"flipviewdebug")},_getElementIndex:function(element){var index=0;try{index=this._itemsManager.itemObject(element).index}catch(e){}return index},_resetBuffer:function(elementToSave,skipReleases){this._writeProfilerMark("WinJS.UI.FlipView:_resetBuffer,info");var head=this._currentPage,curr=head;do curr.element&&curr.element===elementToSave||skipReleases?curr.setElement(null,!0):curr.setElement(null),curr=curr.next;while(curr!==head)},_getHeadOfBuffer:function(){return this._prevMarker.prev},_getTailOfBuffer:function(){return this._prevMarker},_insertNewFlipPage:function(prevElement){this._writeProfilerMark("WinJS.UI.FlipView:_insertNewFlipPage,info");var newPage=this._createFlipPage(prevElement,this);return this._panningDiv.appendChild(newPage.pageRoot),newPage},_fetchNextItems:function(){this._writeProfilerMark("WinJS.UI.FlipView:_fetchNextItems,info");for(var tail=Promise.wrap(this._currentPage),that=this,i=0;i<this._bufferSize;i++)tail=tail.then(function(curr){return curr.next===that._prevMarker&&that._insertNewFlipPage(curr),curr.element?that._itemsManager._nextItem(curr.element).then(function(element){return curr.next.setElement(element),curr.next}):(curr.next.setElement(null),curr.next)});return tail},_fetchOneNext:function(target){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOneNext,info");var prevElement=target.prev.element;if(this._prevMarker===target&&(this._prevMarker=this._prevMarker.next),!prevElement)return void target.setElement(null);var that=this;return this._itemsManager._nextItem(prevElement).then(function(element){target.setElement(element),that._movePageAhead(target.prev,target)})},_fetchPreviousItems:function(setPrevMarker){this._writeProfilerMark("WinJS.UI.FlipView:_fetchPreviousItems,info");for(var that=this,tail=Promise.wrap(this._currentPage),i=0;i<this._bufferSize;i++)tail=tail.then(function(curr){return curr.element?that._itemsManager._previousItem(curr.element).then(function(element){return curr.prev.setElement(element),curr.prev}):(curr.prev.setElement(null),curr.prev)});return tail.then(function(curr){setPrevMarker&&(that._prevMarker=curr);
})},_fetchOnePrevious:function(target){this._writeProfilerMark("WinJS.UI.FlipView:_fetchOnePrevious,info");var nextElement=target.next.element;if(this._prevMarker===target.next&&(this._prevMarker=this._prevMarker.prev),!nextElement)return target.setElement(null),Promise.wrap();var that=this;return this._itemsManager._previousItem(nextElement).then(function(element){target.setElement(element),that._movePageBehind(target.next,target)})},_setButtonStates:function(){this._currentPage.prev.element?this._buttonVisibilityHandler.showPreviousButton():this._buttonVisibilityHandler.hidePreviousButton(),this._currentPage.next.element?this._buttonVisibilityHandler.showNextButton():this._buttonVisibilityHandler.hideNextButton()},_ensureCentered:function(delayBoundariesSet){this._writeProfilerMark("WinJS.UI.FlipView:_ensureCentered,info"),this._setItemStart(this._currentPage,leftBufferAmount*this._viewportSize());for(var curr=this._currentPage;curr!==this._prevMarker;)this._movePageBehind(curr,curr.prev),curr=curr.prev;for(curr=this._currentPage;curr.next!==this._prevMarker;)this._movePageAhead(curr,curr.next),curr=curr.next;var boundariesSet=!1;this._lastScrollPos&&!delayBoundariesSet&&(this._setListEnds(),boundariesSet=!0),this._lastScrollPos=this._getItemStart(this._currentPage),this._setViewportStart(this._lastScrollPos),this._checkElementVisibility(!0),this._setupSnapPoints(),boundariesSet||this._setListEnds()},_ensureBufferConsistency:function(){var that=this,currentElement=this._currentPage.element;if(!currentElement)return Promise.wrap();var refreshBuffer=!1,seenUniqueIDs={},seenLocations={};this._forEachPage(function(page){if(page&&page.elementUniqueID){if(seenUniqueIDs[page.elementUniqueID])return refreshBuffer=!0,!0;if(seenUniqueIDs[page.elementUniqueID]=!0,page.location>0){if(seenLocations[page.location])return refreshBuffer=!0,!0;seenLocations[page.location]=!0}}});var animationKeys=Object.keys(this._animationRecords);return animationKeys.forEach(function(key){var record=that._animationRecords[key];record&&(record.changed||record.inserted||record.moved||record.removed)&&(refreshBuffer=!0)}),refreshBuffer?(this._resetBuffer(null,!0),this._currentPage.setElement(currentElement),this._fetchNextItems().then(function(){return that._fetchPreviousItems(!0)}).then(function(){that._ensureCentered()})):Promise.wrap()},_shiftLeft:function(startingPoint){this._writeProfilerMark("WinJS.UI.FlipView:_shiftLeft,info");for(var curr=startingPoint,nextEl=null;curr!==this._prevMarker&&curr.next!==this._prevMarker;)nextEl=curr.next.element,!nextEl&&curr.next.elementUniqueID&&(curr.elementUniqueID=curr.next.elementUniqueID),curr.next.setElement(null,!0),curr.setElement(nextEl,!0),curr=curr.next;if(curr!==this._prevMarker&&curr.prev.element){var that=this;return this._itemsManager._nextItem(curr.prev.element).then(function(element){curr.setElement(element),that._createAnimationRecord(curr.elementUniqueID,curr)})}},_logBuffer:function(){if(this._flipperDiv.winControl.constructor._enabledDebug){_Log.log&&_Log.log(this._currentPage.next.next.next.elementUniqueID+"\t@:"+this._currentPage.next.next.next.location+(this._currentPage.next.next.next.element?"\t"+this._currentPage.next.next.next.element.textContent:""),null,"flipviewdebug"),_Log.log&&_Log.log(this._currentPage.next.next.next.next.elementUniqueID+"\t@:"+this._currentPage.next.next.next.next.location+(this._currentPage.next.next.next.next.element?"\t"+this._currentPage.next.next.next.next.element.textContent:""),null,"flipviewdebug"),_Log.log&&_Log.log("> "+this._currentPage.elementUniqueID+"\t@:"+this._currentPage.location+(this._currentPage.element?"\t"+this._currentPage.element.textContent:""),null,"flipviewdebug"),_Log.log&&_Log.log(this._currentPage.next.elementUniqueID+"\t@:"+this._currentPage.next.location+(this._currentPage.next.element?"\t"+this._currentPage.next.element.textContent:""),null,"flipviewdebug"),_Log.log&&_Log.log(this._currentPage.next.next.elementUniqueID+"\t@:"+this._currentPage.next.next.location+(this._currentPage.next.next.element?"\t"+this._currentPage.next.next.element.textContent:""),null,"flipviewdebug");var keys=Object.keys(this._itemsManager._elementMap),bufferKeys=[];this._forEachPage(function(page){page&&page.elementUniqueID&&bufferKeys.push(page.elementUniqueID)}),_Log.log&&_Log.log("itemsmanager  = ["+keys.join(" ")+"] flipview ["+bufferKeys.join(" ")+"]",null,"flipviewdebug")}},_shiftRight:function(startingPoint){this._writeProfilerMark("WinJS.UI.FlipView:_shiftRight,info");for(var curr=startingPoint,prevEl=null;curr!==this._prevMarker;)prevEl=curr.prev.element,!prevEl&&curr.prev.elementUniqueID&&(curr.elementUniqueID=curr.prev.elementUniqueID),curr.prev.setElement(null,!0),curr.setElement(prevEl,!0),curr=curr.prev;if(curr.next.element){var that=this;return this._itemsManager._previousItem(curr.next.element).then(function(element){curr.setElement(element),that._createAnimationRecord(curr.elementUniqueID,curr)})}},_checkElementVisibility:function(viewWasReset){var i,len;if(viewWasReset){var currentElement=this._currentPage.element;for(i=0,len=this._visibleElements.length;i<len;i++)this._visibleElements[i]!==currentElement&&this._announceElementInvisible(this._visibleElements[i]);this._visibleElements=[],currentElement&&(this._visibleElements.push(currentElement),this._announceElementVisible(currentElement))}else{for(i=0,len=this._visibleElements.length;i<len;i++)this._visibleElements[i].parentNode&&!this._visibleElements[i].removedFromChange||this._announceElementInvisible(this._visibleElements[i]);this._visibleElements=[];var that=this;this._forEachPage(function(curr){var element=curr.element;element&&(that._itemInView(curr)?(that._visibleElements.push(element),that._announceElementVisible(element)):that._announceElementInvisible(element))})}},_announceElementVisible:function(element){if(element&&!element.visible){element.visible=!0;var event=_Global.document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:true),info"),event.initCustomEvent(_Constants.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!0}),element.dispatchEvent(event)}},_announceElementInvisible:function(element){if(element&&element.visible){element.visible=!1;var addedToDomForEvent=!1;element.parentNode||(addedToDomForEvent=!0,this._panningDivContainer.appendChild(element));var event=_Global.document.createEvent("CustomEvent");this._writeProfilerMark("WinJS.UI.FlipView:pageVisibilityChangedEvent(visible:false),info"),event.initCustomEvent(_Constants.pageVisibilityChangedEvent,!0,!1,{source:this._flipperDiv,visible:!1}),element.dispatchEvent(event),addedToDomForEvent&&this._panningDivContainer.removeChild(element)}},_createDiscardablePage:function(content){var pageDivs=this._createPageContainer(),page={pageRoot:pageDivs.root,elementRoot:pageDivs.elementContainer,discardable:!0,element:content,elementUniqueID:uniqueID(content),discard:function(){page.pageRoot.parentNode&&page.pageRoot.parentNode.removeChild(page.pageRoot),page.element.parentNode&&page.element.parentNode.removeChild(page.element)}};return page.pageRoot.style.top="0px",page.elementRoot.appendChild(content),this._panningDiv.appendChild(page.pageRoot),page},_createPageContainer:function(){var width=this._panningDivContainerOffsetWidth,height=this._panningDivContainerOffsetHeight,parentDiv=_Global.document.createElement("div"),pageStyle=parentDiv.style,flexBox=_Global.document.createElement("div");return flexBox.className="win-item",pageStyle.position="absolute",pageStyle.overflow="hidden",pageStyle.width=width+"px",pageStyle.height=height+"px",parentDiv.appendChild(flexBox),{root:parentDiv,elementContainer:flexBox}},_createFlipPage:function(prev,manager){var page={};page.element=null,page.elementUniqueID=null,prev?(page.prev=prev,page.next=prev.next,page.next.prev=page,prev.next=page):(page.next=page,page.prev=page);var pageContainer=this._createPageContainer();return page.elementRoot=pageContainer.elementContainer,page.elementRoot.style.msOverflowStyle="auto",page.pageRoot=pageContainer.root,page.setElement=function(element,isReplacement){if(void 0===element&&(element=null),element===page.element)return void(element||(page.elementUniqueID=null));if(page.element&&(isReplacement||(manager._itemsManager.releaseItem(page.element),_Dispose._disposeElement(page.element))),page.element=element,page.elementUniqueID=element?uniqueID(element):null,_ElementUtilities.empty(page.elementRoot),page.element){if(page===manager._currentPage&&(manager._tabManager.childFocus=element),!isFlipper(page.element)){page.element.tabIndex=manager._tabIndex,page.element.setAttribute("role","option"),page.element.setAttribute("aria-selected",!1),page.element.id||(page.element.id=uniqueID(page.element));var setFlowAttribute=function(source,target,attributeName){source.setAttribute(attributeName,target.id)},isEnd=!page.next.element||page===manager._prevMarker.prev;isEnd&&(setFlowAttribute(page.element,manager._bufferAriaEndMarker,"aria-flowto"),setFlowAttribute(manager._bufferAriaEndMarker,page.element,"x-ms-aria-flowfrom")),page!==manager._prevMarker&&page.prev.element&&(setFlowAttribute(page.prev.element,page.element,"aria-flowto"),setFlowAttribute(page.element,page.prev.element,"x-ms-aria-flowfrom")),page.next!==manager._prevMarker&&page.next.element&&(setFlowAttribute(page.element,page.next.element,"aria-flowto"),setFlowAttribute(page.next.element,page.element,"x-ms-aria-flowfrom")),page.prev.element||setFlowAttribute(page.element,manager._bufferAriaStartMarker,"x-ms-aria-flowfrom")}page.elementRoot.appendChild(page.element)}},page},_itemInView:function(flipPage){return this._itemEnd(flipPage)>this._getViewportStart()&&this._getItemStart(flipPage)<this._viewportEnd()},_getViewportStart:function(){if(this._panningDivContainer.parentNode)return this._isHorizontal?_ElementUtilities.getScrollPosition(this._panningDivContainer).scrollLeft:_ElementUtilities.getScrollPosition(this._panningDivContainer).scrollTop},_setViewportStart:function(newValue){this._panningDivContainer.parentNode&&(this._isHorizontal?_ElementUtilities.setScrollPosition(this._panningDivContainer,{scrollLeft:newValue}):_ElementUtilities.setScrollPosition(this._panningDivContainer,{scrollTop:newValue}))},_viewportEnd:function(){var element=this._panningDivContainer;return this._isHorizontal?this._rtl?this._getViewportStart()+this._panningDivContainerOffsetWidth:_ElementUtilities.getScrollPosition(element).scrollLeft+this._panningDivContainerOffsetWidth:element.scrollTop+this._panningDivContainerOffsetHeight},_viewportSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_getItemStart:function(flipPage){return flipPage.location},_setItemStart:function(flipPage,newValue){void 0!==newValue&&(this._isHorizontal?flipPage.pageRoot.style.left=(this._rtl?-newValue:newValue)+"px":flipPage.pageRoot.style.top=newValue+"px",flipPage.location=newValue)},_itemEnd:function(flipPage){return(this._isHorizontal?flipPage.location+this._panningDivContainerOffsetWidth:flipPage.location+this._panningDivContainerOffsetHeight)+this._itemSpacing},_itemSize:function(){return this._isHorizontal?this._panningDivContainerOffsetWidth:this._panningDivContainerOffsetHeight},_movePageAhead:function(referencePage,pageToPlace){var delta=this._itemSize(referencePage)+this._itemSpacing;this._setItemStart(pageToPlace,this._getItemStart(referencePage)+delta)},_movePageBehind:function(referencePage,pageToPlace){var delta=this._itemSize(referencePage)+this._itemSpacing;this._setItemStart(pageToPlace,this._getItemStart(referencePage)-delta)},_setupSnapPoints:function(){if(this._environmentSupportsTouch){var containerStyle=this._panningDivContainer.style;containerStyle[styleEquivalents["scroll-snap-type"].scriptName]="mandatory";var viewportSize=this._viewportSize(),snapInterval=viewportSize+this._itemSpacing,propertyName="scroll-snap-points",startSnap=0,currPos=this._getItemStart(this._currentPage);startSnap=currPos%(viewportSize+this._itemSpacing),containerStyle[styleEquivalents[this._isHorizontal?propertyName+"-x":propertyName+"-y"].scriptName]="snapInterval("+startSnap+"px, "+snapInterval+"px)"}},_setListEnds:function(){if(this._environmentSupportsTouch&&this._currentPage.element){for(var containerStyle=this._panningDivContainer.style,startScroll=0,endScroll=0,startNonEmptyPage=this._getTailOfBuffer(),endNonEmptyPage=this._getHeadOfBuffer(),startBoundaryStyle=styleEquivalents["scroll-limit-"+(this._isHorizontal?"x-min":"y-min")].scriptName,endBoundaryStyle=styleEquivalents["scroll-limit-"+(this._isHorizontal?"x-max":"y-max")].scriptName;!endNonEmptyPage.element&&(endNonEmptyPage=endNonEmptyPage.prev,endNonEmptyPage!==this._prevMarker.prev););for(;!startNonEmptyPage.element&&(startNonEmptyPage=startNonEmptyPage.next,startNonEmptyPage!==this._prevMarker););endScroll=this._getItemStart(endNonEmptyPage),startScroll=this._getItemStart(startNonEmptyPage),containerStyle[startBoundaryStyle]=startScroll+"px",containerStyle[endBoundaryStyle]=endScroll+"px"}},_viewportOnItemStart:function(){return this._getItemStart(this._currentPage)===this._getViewportStart()},_restoreAnimatedElement:function(oldPage,discardablePage){var removed=!0;return oldPage.elementUniqueID!==uniqueID(discardablePage.element)||oldPage.element?this._forEachPage(function(curr){curr.elementUniqueID!==discardablePage.elementUniqueID||curr.element||(curr.setElement(discardablePage.element,!0),removed=!1)}):(oldPage.setElement(discardablePage.element,!0),removed=!1),removed},_itemSettledOn:function(){this._lastTimeoutRequest&&(this._lastTimeoutRequest.cancel(),this._lastTimeoutRequest=null);var that=this;_BaseUtils._setImmediate(function(){that._viewportOnItemStart()&&(that._blockTabs=!1,that._currentPage.element&&that._lastSelectedElement!==that._currentPage.element&&(that._lastSelectedPage&&that._lastSelectedPage.element&&!isFlipper(that._lastSelectedPage.element)&&that._lastSelectedPage.element.setAttribute("aria-selected",!1),that._lastSelectedPage=that._currentPage,that._lastSelectedElement=that._currentPage.element,isFlipper(that._currentPage.element)||that._currentPage.element.setAttribute("aria-selected",!0),Scheduler.schedule(function(){if(that._currentPage.element){(that._hasFocus||that._hadFocus)&&(that._hadFocus=!1,_ElementUtilities._setActive(that._currentPage.element),that._tabManager.childFocus=that._currentPage.element);var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(_Constants.pageSelectedEvent,!0,!1,{source:that._flipperDiv}),that._writeProfilerMark("WinJS.UI.FlipView:pageSelectedEvent,info"),that._currentPage.element.dispatchEvent(event);var originalElement=that._currentPage.element;if(originalElement){var record=that._itemsManager._recordFromElement(originalElement,!0);record&&record.renderComplete.then(function(){originalElement===that._currentPage.element&&(that._currentPage.element.setAttribute("aria-setsize",that._cachedSize),that._currentPage.element.setAttribute("aria-posinset",that.currentIndex()+1),that._bufferAriaStartMarker.setAttribute("aria-flowto",that._currentPage.element.id),event=_Global.document.createEvent("CustomEvent"),event.initCustomEvent(_Constants.pageCompletedEvent,!0,!1,{source:that._flipperDiv}),that._writeProfilerMark("WinJS.UI.FlipView:pageCompletedEvent,info"),that._currentPage.element.dispatchEvent(event))})}}},Scheduler.Priority.normal,null,"WinJS.UI.FlipView._dispatchPageSelectedEvent")))})},_forEachPage:function(callback){var curr=this._prevMarker;do{if(callback(curr))break;curr=curr.next}while(curr!==this._prevMarker)},_changeFlipPage:function(page,oldElement,newElement){this._writeProfilerMark("WinJS.UI.FlipView:_changeFlipPage,info"),page.element=null,page.setElement?page.setElement(newElement,!0):(oldElement.parentNode.removeChild(oldElement),page.elementRoot.appendChild(newElement));var style=oldElement.style;return style.position="absolute",style.left="0px",style.top="0px",style.opacity=1,page.pageRoot.appendChild(oldElement),oldElement.style.left=Math.max(0,(page.pageRoot.offsetWidth-oldElement.offsetWidth)/2)+"px",oldElement.style.top=Math.max(0,(page.pageRoot.offsetHeight-oldElement.offsetHeight)/2)+"px",Animations.fadeOut(oldElement).then(function(){oldElement.parentNode&&oldElement.parentNode.removeChild(oldElement)})},_deleteFlipPage:function(page){_WriteProfilerMark("WinJS.UI.FlipView:_deleteFlipPage,info"),page.elementRoot.style.opacity=0;var animation=Animations.createDeleteFromListAnimation([page.elementRoot]),that=this;return animation.execute().then(function(){page.discardable&&(page.discard(),that._itemsManager.releaseItem(page.element))})},_insertFlipPage:function(page){_WriteProfilerMark("WinJS.UI.FlipView:_insertFlipPage,info"),page.elementRoot.style.opacity=1;var animation=Animations.createAddToListAnimation([page.elementRoot]);return animation.execute().then(function(){page.discardable&&page.discard()})},_moveFlipPage:function(page,move){_WriteProfilerMark("WinJS.UI.FlipView:_moveFlipPage,info");var animation=Animations.createRepositionAnimation(page.pageRoot);move();var that=this;return animation.execute().then(function(){if(page.discardable){page.discard();var animationRecord=that._getAnimationRecord(page.element);animationRecord&&!animationRecord.successfullyMoved&&that._itemsManager.releaseItem(page.element)}})},_handleManipulationStateChanged:function(event){this._manipulationState=event.currentState,0===event.currentState&&event.target===this._panningDivContainer&&(this._itemSettledOn(),this._ensureCentered())}},{supportedForProcessing:!1});return _FlipPageManager.flipPageBufferCount=2,_FlipPageManager})})}),define("require-style!less/styles-flipview",[],function(){}),define("require-style!less/colors-flipview",[],function(){}),define("WinJS/Controls/FlipView",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../BindingList","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_ItemsManager","../Utilities/_UI","./ElementResizeInstrument","./FlipView/_Constants","./FlipView/_PageManager","require-style!less/styles-flipview","require-style!less/colors-flipview"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,Animations,_TransitionAnimation,BindingList,Promise,Scheduler,_Control,_Dispose,_ElementUtilities,_Hoverable,_ItemsManager,_UI,_ElementResizeInstrument,_Constants,_PageManager){"use strict";_Base.Namespace.define("WinJS.UI",{FlipView:_Base.Namespace._lazy(function(){function flipViewPropertyChanged(list){var that=list[0].target.winControl;that&&that instanceof FlipView&&list.some(function(record){return"dir"===record.attributeName||"style"===record.attributeName&&that._cachedStyleDir!==record.target.style.direction})&&(that._cachedStyleDir=that._flipviewDiv.style.direction,that._rtl="rtl"===_ElementUtilities._getComputedStyle(that._flipviewDiv,null).direction,that._setupOrientation())}var navButtonClass="win-navbutton",flipViewClass="win-flipview",navButtonLeftClass="win-navleft",navButtonRightClass="win-navright",navButtonTopClass="win-navtop",navButtonBottomClass="win-navbottom",previousButtonLabel="Previous",nextButtonLabel="Next",buttonFadeDelay=3e3,avoidTrapDelay=500,leftArrowGlyph="&#57570;",rightArrowGlyph="&#57571;",topArrowGlyph="&#57572;",bottomArrowGlyph="&#57573;",animationMoveDelta=40,strings={get badAxis(){return"Invalid argument: orientation must be a string, either 'horizontal' or 'vertical'"},get badCurrentPage(){return"Invalid argument: currentPage must be a number greater than or equal to zero and be within the bounds of the datasource"},get noitemsManagerForCount(){return"Invalid operation: can't get count if no dataSource has been set"},get badItemSpacingAmount(){return"Invalid argument: itemSpacing must be a number greater than or equal to zero"},get navigationDuringStateChange(){return"Error: After changing itemDataSource or itemTemplate, any navigation in the FlipView control should be delayed until the pageselected event is fired."},get panningContainerAriaLabel(){return _Resources._getWinJSString("ui/flipViewPanningContainerAriaLabel").value}},FlipView=_Base.Class.define(function(element,options){_WriteProfilerMark("WinJS.UI.FlipView:constructor,StartTM"),this._disposed=!1,element=element||_Global.document.createElement("div");var isHorizontal=!0,dataSource=null,itemRenderer=_ItemsManager._trivialHtmlRenderer,initialIndex=0,itemSpacing=0;if(options){if(options.orientation&&"string"==typeof options.orientation)switch(options.orientation.toLowerCase()){case"horizontal":isHorizontal=!0;break;case"vertical":isHorizontal=!1}options.currentPage&&(initialIndex=options.currentPage>>0,initialIndex=initialIndex<0?0:initialIndex),options.itemDataSource&&(dataSource=options.itemDataSource),options.itemTemplate&&(itemRenderer=this._getItemRenderer(options.itemTemplate)),options.itemSpacing&&(itemSpacing=options.itemSpacing>>0,itemSpacing=itemSpacing<0?0:itemSpacing)}if(!dataSource){var list=new BindingList.List;dataSource=list.dataSource}_ElementUtilities.empty(element),this._flipviewDiv=element,element.winControl=this,_Control._setOptions(this,options,!0),this._initializeFlipView(element,isHorizontal,dataSource,itemRenderer,initialIndex,itemSpacing),_ElementUtilities.addClass(element,"win-disposable"),this._avoidTrappingTime=0,this._windowWheelHandlerBound=this._windowWheelHandler.bind(this),_ElementUtilities._globalListener.addEventListener(element,"wheel",this._windowWheelHandlerBound),_ElementUtilities._globalListener.addEventListener(element,"mousewheel",this._windowWheelHandlerBound),_WriteProfilerMark("WinJS.UI.FlipView:constructor,StopTM")},{dispose:function(){_WriteProfilerMark("WinJS.UI.FlipView:dispose,StopTM"),this._disposed||(_ElementUtilities._globalListener.removeEventListener(this._flipviewDiv,"wheel",this._windowWheelHandlerBound),_ElementUtilities._globalListener.removeEventListener(this._flipviewDiv,"mousewheel",this._windowWheelHandlerBound),_ElementUtilities._resizeNotifier.unsubscribe(this._flipviewDiv,this._resizeHandlerBound),this._elementResizeInstrument.dispose(),this._disposed=!0,this._pageManager.dispose(),this._itemsManager.release(),this.itemDataSource=null)},next:function(){_WriteProfilerMark("WinJS.UI.FlipView:next,info");var cancelAnimationCallback=this._nextAnimation?null:this._cancelDefaultAnimation;return this._navigate(!0,cancelAnimationCallback)},previous:function(){_WriteProfilerMark("WinJS.UI.FlipView:prev,info");var cancelAnimationCallback=this._prevAnimation?null:this._cancelDefaultAnimation;return this._navigate(!1,cancelAnimationCallback)},element:{get:function(){return this._flipviewDiv}},currentPage:{get:function(){return this._getCurrentIndex()},set:function(index){if(_WriteProfilerMark("WinJS.UI.FlipView:set_currentPage,info"),this._pageManager._notificationsEndedSignal){var that=this;return void this._pageManager._notificationsEndedSignal.promise.done(function(){that._pageManager._notificationsEndedSignal=null,that.currentPage=index})}if(!this._animating||this._cancelAnimation())if(index>>=0,index=index<0?0:index,this._refreshTimer)this._indexAfterRefresh=index;else{this._pageManager._cachedSize>0?index=Math.min(this._pageManager._cachedSize-1,index):0===this._pageManager._cachedSize&&(index=0);var that=this;if(this._jumpingToIndex===index)return;var clearJumpToIndex=function(){that._jumpingToIndex=null};this._jumpingToIndex=index;var jumpAnimation=this._jumpAnimation?this._jumpAnimation:this._defaultAnimation.bind(this),cancelAnimationCallback=this._jumpAnimation?null:this._cancelDefaultAnimation,completionCallback=function(){that._completeJump()};this._pageManager.startAnimatedJump(index,cancelAnimationCallback,completionCallback).then(function(elements){if(elements){that._animationsStarted();var currElement=elements.oldPage.pageRoot,newCurrElement=elements.newPage.pageRoot;that._contentDiv.appendChild(currElement),that._contentDiv.appendChild(newCurrElement),that._completeJumpPending=!0,jumpAnimation(currElement,newCurrElement).then(function(){that._completeJumpPending&&(completionCallback(),_WriteProfilerMark("WinJS.UI.FlipView:set_currentPage.animationComplete,info"))}).done(clearJumpToIndex,clearJumpToIndex)}else clearJumpToIndex()},clearJumpToIndex)}}},orientation:{get:function(){return this._axisAsString()},set:function(orientation){_WriteProfilerMark("WinJS.UI.FlipView:set_orientation,info");var isHorizontal="horizontal"===orientation;isHorizontal!==this._isHorizontal&&(this._isHorizontal=isHorizontal,this._setupOrientation(),this._pageManager.setOrientation(this._isHorizontal))}},itemDataSource:{get:function(){return this._dataSource},set:function(dataSource){_WriteProfilerMark("WinJS.UI.FlipView:set_itemDataSource,info"),this._dataSourceAfterRefresh=dataSource||(new BindingList.List).dataSource,this._refresh()}},itemTemplate:{get:function(){return this._itemRenderer},set:function(itemTemplate){_WriteProfilerMark("WinJS.UI.FlipView:set_itemTemplate,info"),this._itemRendererAfterRefresh=this._getItemRenderer(itemTemplate),this._refresh()}},itemSpacing:{get:function(){return this._pageManager.getItemSpacing()},set:function(spacing){_WriteProfilerMark("WinJS.UI.FlipView:set_itemSpacing,info"),spacing>>=0,spacing=spacing<0?0:spacing,this._pageManager.setItemSpacing(spacing)}},count:function(){_WriteProfilerMark("WinJS.UI.FlipView:count,info");var that=this;return new Promise(function(complete,error){that._itemsManager?that._pageManager._cachedSize===_UI.CountResult.unknown||that._pageManager._cachedSize>=0?complete(that._pageManager._cachedSize):that._dataSource.getCount().then(function(count){that._pageManager._cachedSize=count,complete(count)}):error(FlipView.noitemsManagerForCount)})},setCustomAnimations:function(animations){_WriteProfilerMark("WinJS.UI.FlipView:setCustomAnimations,info"),void 0!==animations.next&&(this._nextAnimation=animations.next),void 0!==animations.previous&&(this._prevAnimation=animations.previous),void 0!==animations.jump&&(this._jumpAnimation=animations.jump)},forceLayout:function(){_WriteProfilerMark("WinJS.UI.FlipView:forceLayout,info"),this._pageManager.resized()},_initializeFlipView:function(element,isHorizontal,dataSource,itemRenderer,initialIndex,itemSpacing){function setUpButton(button){button.setAttribute("aria-hidden",!0),button.style.visibility="hidden",button.style.opacity=0,button.tabIndex=-1,button.style.zIndex=1e3}function handleShowButtons(e){if(e.pointerType!==PT_TOUCH){if(that._touchInteraction=!1,e.screenX===that._lastMouseX&&e.screenY===that._lastMouseY)return;that._lastMouseX=e.screenX,that._lastMouseY=e.screenY,that._mouseInViewport=!0,that._fadeInButton("prev"),that._fadeInButton("next"),that._fadeOutButtons()}}function handlePointerDown(e){e.pointerType===PT_TOUCH?(that._mouseInViewport=!1,that._touchInteraction=!0,that._fadeOutButtons(!0)):(that._touchInteraction=!1,that._isInteractive(e.target)||0!==(4&e.buttons)&&(e.stopPropagation(),e.preventDefault()))}function handlePointerUp(e){e.pointerType!==PT_TOUCH&&(that._touchInteraction=!1)}var that=this,flipViewInitialized=!1;this._flipviewDiv=element,_ElementUtilities.addClass(this._flipviewDiv,flipViewClass),this._contentDiv=_Global.document.createElement("div"),this._panningDivContainer=_Global.document.createElement("div"),this._panningDivContainer.className="win-surface",this._panningDiv=_Global.document.createElement("div"),this._prevButton=_Global.document.createElement("button"),this._nextButton=_Global.document.createElement("button"),this._isHorizontal=isHorizontal,this._dataSource=dataSource,this._itemRenderer=itemRenderer,this._itemsManager=null,this._pageManager=null;for(var stylesRequiredForFullFeatureMode=["scroll-limit-x-max","scroll-limit-x-min","scroll-limit-y-max","scroll-limit-y-min","scroll-snap-type","scroll-snap-x","scroll-snap-y","overflow-style"],allFeaturesSupported=!0,styleEquivalents=_BaseUtils._browserStyleEquivalents,i=0,len=stylesRequiredForFullFeatureMode.length;i<len;i++)allFeaturesSupported=allFeaturesSupported&&!!styleEquivalents[stylesRequiredForFullFeatureMode[i]];allFeaturesSupported=allFeaturesSupported&&!!_BaseUtils._browserEventEquivalents.manipulationStateChanged,allFeaturesSupported=allFeaturesSupported&&_ElementUtilities._supportsSnapPoints,this._environmentSupportsTouch=allFeaturesSupported;var accName=this._flipviewDiv.getAttribute("aria-label");accName||this._flipviewDiv.setAttribute("aria-label",""),this._flipviewDiv.setAttribute("role","listbox"),this._flipviewDiv.style.overflow||(this._flipviewDiv.style.overflow="hidden"),this._contentDiv.style.position="relative",this._contentDiv.style.zIndex=0,this._contentDiv.style.width="100%",this._contentDiv.style.height="100%",this._panningDiv.style.position="relative",this._panningDivContainer.style.position="relative",this._panningDivContainer.style.width="100%",this._panningDivContainer.style.height="100%",this._panningDivContainer.setAttribute("role","group"),this._panningDivContainer.setAttribute("aria-label",strings.panningContainerAriaLabel),this._contentDiv.appendChild(this._panningDivContainer),this._flipviewDiv.appendChild(this._contentDiv),this._panningDiv.style.width="100%",this._panningDiv.style.height="100%",this._setupOrientation(),setUpButton(this._prevButton),setUpButton(this._nextButton),this._prevButton.setAttribute("aria-label",previousButtonLabel),this._nextButton.setAttribute("aria-label",nextButtonLabel),this._prevButton.setAttribute("type","button"),this._nextButton.setAttribute("type","button"),this._panningDivContainer.appendChild(this._panningDiv),this._contentDiv.appendChild(this._prevButton),this._contentDiv.appendChild(this._nextButton),this._itemsManagerCallback={inserted:function(itemPromise,previousHandle,nextHandle){that._itemsManager._itemFromPromise(itemPromise).then(function(element){var previous=that._itemsManager._elementFromHandle(previousHandle),next=that._itemsManager._elementFromHandle(nextHandle);that._pageManager.inserted(element,previous,next,!0)})},countChanged:function(newCount,oldCount){that._pageManager._cachedSize=newCount,oldCount!==_UI.CountResult.unknown&&that._fireDatasourceCountChangedEvent()},changed:function(newElement,oldElement){that._pageManager.changed(newElement,oldElement)},moved:function(element,prev,next,itemPromise){var elementReady=function(element){that._pageManager.moved(element,prev,next)};element?elementReady(element):that._itemsManager._itemFromPromise(itemPromise).then(elementReady)},removed:function(element,mirage){element&&that._pageManager.removed(element,mirage,!0)},knownUpdatesComplete:function(){},beginNotifications:function(){that._cancelAnimation(),that._pageManager.notificationsStarted()},endNotifications:function(){that._pageManager.notificationsEnded()},itemAvailable:function(real,placeholder){that._pageManager.itemRetrieved(real,placeholder)},reload:function(){that._pageManager.reload()}},this._dataSource&&(this._itemsManager=_ItemsManager._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv})),this._pageManager=new _PageManager._FlipPageManager(this._flipviewDiv,this._panningDiv,this._panningDivContainer,this._itemsManager,itemSpacing,this._environmentSupportsTouch,{hidePreviousButton:function(){that._hasPrevContent=!1,that._fadeOutButton("prev"),that._prevButton.setAttribute("aria-hidden",!0)},showPreviousButton:function(){that._hasPrevContent=!0,that._fadeInButton("prev"),that._prevButton.setAttribute("aria-hidden",!1)},hideNextButton:function(){that._hasNextContent=!1,that._fadeOutButton("next"),that._nextButton.setAttribute("aria-hidden",!0)},showNextButton:function(){that._hasNextContent=!0,
that._fadeInButton("next"),that._nextButton.setAttribute("aria-hidden",!1)}}),this._pageManager.initialize(initialIndex,this._isHorizontal),this._dataSource.getCount().then(function(count){that._pageManager._cachedSize=count}),this._prevButton.addEventListener("click",function(){that.previous()},!1),this._nextButton.addEventListener("click",function(){that.next()},!1),new _ElementUtilities._MutationObserver(flipViewPropertyChanged).observe(this._flipviewDiv,{attributes:!0,attributeFilter:["dir","style"]}),this._cachedStyleDir=this._flipviewDiv.style.direction,this._contentDiv.addEventListener("mouseleave",function(){that._mouseInViewport=!1},!1);var PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch";this._environmentSupportsTouch&&(_ElementUtilities._addEventListener(this._contentDiv,"pointerdown",handlePointerDown,!1),_ElementUtilities._addEventListener(this._contentDiv,"pointermove",handleShowButtons,!1),_ElementUtilities._addEventListener(this._contentDiv,"pointerup",handlePointerUp,!1)),this._panningDivContainer.addEventListener("scroll",function(){that._scrollPosChanged()},!1),this._panningDiv.addEventListener("blur",function(){that._touchInteraction||that._fadeOutButtons()},!0),this._resizeHandlerBound=this._resizeHandler.bind(this),this._elementResizeInstrument=new _ElementResizeInstrument._ElementResizeInstrument,this._flipviewDiv.appendChild(this._elementResizeInstrument.element),this._elementResizeInstrument.addEventListener("resize",this._resizeHandlerBound),_ElementUtilities._resizeNotifier.subscribe(this._flipviewDiv,this._resizeHandlerBound);var initiallyParented=_Global.document.body.contains(this._flipviewDiv);initiallyParented&&this._elementResizeInstrument.addedToDom(),_ElementUtilities._addInsertedNotifier(this._flipviewDiv);var initialTrigger=!0;this._flipviewDiv.addEventListener("WinJSNodeInserted",function(event){initialTrigger?(initialTrigger=!1,initiallyParented||(that._elementResizeInstrument.addedToDom(),that._pageManager.resized())):that._pageManager.resized()},!1),this._flipviewDiv.addEventListener("keydown",function(event){if(!that._disposed){var cancelBubbleIfHandled=!0;if(!that._isInteractive(event.target)){var Key=_ElementUtilities.Key,handled=!1;if(that._isHorizontal)switch(event.keyCode){case Key.leftArrow:!that._rtl&&that.currentPage>0?(that.previous(),handled=!0):that._rtl&&that.currentPage<that._pageManager._cachedSize-1&&(that.next(),handled=!0);break;case Key.pageUp:that.currentPage>0&&(that.previous(),handled=!0);break;case Key.rightArrow:!that._rtl&&that.currentPage<that._pageManager._cachedSize-1?(that.next(),handled=!0):that._rtl&&that.currentPage>0&&(that.previous(),handled=!0);break;case Key.pageDown:that.currentPage<that._pageManager._cachedSize-1&&(that.next(),handled=!0);break;case Key.upArrow:case Key.downArrow:handled=!0,cancelBubbleIfHandled=!1}else switch(event.keyCode){case Key.upArrow:case Key.pageUp:that.currentPage>0&&(that.previous(),handled=!0);break;case Key.downArrow:case Key.pageDown:that.currentPage<that._pageManager._cachedSize-1&&(that.next(),handled=!0);break;case Key.space:handled=!0}switch(event.keyCode){case Key.home:that.currentPage=0,handled=!0;break;case Key.end:that._pageManager._cachedSize>0&&(that.currentPage=that._pageManager._cachedSize-1),handled=!0}if(handled)return event.preventDefault(),cancelBubbleIfHandled&&event.stopPropagation(),!0}}},!1),flipViewInitialized=!0},_windowWheelHandler:function(ev){if(!this._disposed){ev=ev.detail.originalEvent;var wheelWithinFlipper=ev.target&&(this._flipviewDiv.contains(ev.target)||this._flipviewDiv===ev.target),that=this,now=_BaseUtils._now(),withinAvoidTime=this._avoidTrappingTime>now;wheelWithinFlipper&&!withinAvoidTime||(this._avoidTrappingTime=now+avoidTrapDelay),wheelWithinFlipper&&withinAvoidTime?(this._panningDivContainer.style.overflowX="hidden",this._panningDivContainer.style.overflowY="hidden",_BaseUtils._yieldForDomModification(function(){that._pageManager._ensureCentered(),that._isHorizontal?(that._panningDivContainer.style.overflowX=that._environmentSupportsTouch?"scroll":"hidden",that._panningDivContainer.style.overflowY="hidden"):(that._panningDivContainer.style.overflowY=that._environmentSupportsTouch?"scroll":"hidden",that._panningDivContainer.style.overflowX="hidden")})):wheelWithinFlipper&&this._pageManager.simulateMouseWheelScroll(ev)}},_isInteractive:function(element){if(element.parentNode)for(var matches=element.parentNode.querySelectorAll(".win-interactive, .win-interactive *"),i=0,len=matches.length;i<len;i++)if(matches[i]===element)return!0;return!1},_resizeHandler:function(){_WriteProfilerMark("WinJS.UI.FlipView:resize,StartTM"),this._pageManager.resized()},_refreshHandler:function(){var dataSource=this._dataSourceAfterRefresh||this._dataSource,renderer=this._itemRendererAfterRefresh||this._itemRenderer,initialIndex=this._indexAfterRefresh||0;this._setDatasource(dataSource,renderer,initialIndex),this._dataSourceAfterRefresh=null,this._itemRendererAfterRefresh=null,this._indexAfterRefresh=0,this._refreshTimer=!1},_refresh:function(){if(!this._refreshTimer){var that=this;this._refreshTimer=!0,Scheduler.schedule(function(){that._refreshTimer&&!that._disposed&&that._refreshHandler()},Scheduler.Priority.high,null,"WinJS.UI.FlipView._refreshHandler")}},_getItemRenderer:function(itemTemplate){var itemRenderer=null;if("function"==typeof itemTemplate){var itemPromise=new Promise(function(){}),itemTemplateResult=itemTemplate(itemPromise);itemRenderer=itemTemplateResult.element?"object"==typeof itemTemplateResult.element&&"function"==typeof itemTemplateResult.element.then?function(itemPromise){var elementRoot=_Global.document.createElement("div");return elementRoot.className="win-template",_Dispose.markDisposable(elementRoot),{element:elementRoot,renderComplete:itemTemplate(itemPromise).element.then(function(element){elementRoot.appendChild(element)})}}:itemTemplate:function(itemPromise){var elementRoot=_Global.document.createElement("div");return elementRoot.className="win-template",_Dispose.markDisposable(elementRoot),{element:elementRoot,renderComplete:itemPromise.then(function(){return Promise.as(itemTemplate(itemPromise)).then(function(element){elementRoot.appendChild(element)})})}}}else"object"==typeof itemTemplate&&(itemRenderer=itemTemplate.renderItem);return itemRenderer},_navigate:function(goForward,cancelAnimationCallback){if(_BaseUtils.validation&&this._refreshTimer)throw new _ErrorFromName("WinJS.UI.FlipView.NavigationDuringStateChange",strings.navigationDuringStateChange);if(this._animating||(this._animatingForward=goForward),this._goForward=goForward,this._animating&&!this._cancelAnimation())return!1;var that=this,customAnimation=goForward?this._nextAnimation:this._prevAnimation,animation=customAnimation?customAnimation:this._defaultAnimation.bind(this),completionCallback=function(goForward){that._completeNavigation(goForward)},elements=this._pageManager.startAnimatedNavigation(goForward,cancelAnimationCallback,completionCallback);if(elements){this._animationsStarted();var outgoingElement=elements.outgoing.pageRoot,incomingElement=elements.incoming.pageRoot;return this._contentDiv.appendChild(outgoingElement),this._contentDiv.appendChild(incomingElement),this._completeNavigationPending=!0,animation(outgoingElement,incomingElement).then(function(){that._completeNavigationPending&&completionCallback(that._goForward)}).done(),!0}return!1},_cancelDefaultAnimation:function(outgoingElement,incomingElement){outgoingElement.style.opacity=0,incomingElement.style.animationName="",incomingElement.style.opacity=1},_cancelAnimation:function(){if(this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.completionCallback){var cancelCallback=this._pageManager._navigationAnimationRecord.cancelAnimationCallback;if(cancelCallback&&(cancelCallback=cancelCallback.bind(this)),this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var outgoingPage=this._pageManager._navigationAnimationRecord.elementContainers[0],incomingPage=this._pageManager._navigationAnimationRecord.elementContainers[1],outgoingElement=outgoingPage.pageRoot,incomingElement=incomingPage.pageRoot;return cancelCallback&&cancelCallback(outgoingElement,incomingElement),this._pageManager._navigationAnimationRecord.completionCallback(this._animatingForward),!0}}return!1},_completeNavigation:function(goForward){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var outgoingPage=this._pageManager._navigationAnimationRecord.elementContainers[0],incomingPage=this._pageManager._navigationAnimationRecord.elementContainers[1],outgoingElement=outgoingPage.pageRoot,incomingElement=incomingPage.pageRoot;outgoingElement.parentNode&&outgoingElement.parentNode.removeChild(outgoingElement),incomingElement.parentNode&&incomingElement.parentNode.removeChild(incomingElement),this._pageManager.endAnimatedNavigation(goForward,outgoingPage,incomingPage),this._fadeOutButtons(),this._scrollPosChanged(),this._pageManager._ensureCentered(!0),this._animationsFinished()}this._completeNavigationPending=!1}},_completeJump:function(){if(!this._disposed){if(this._pageManager._resizing=!1,this._pageManager._navigationAnimationRecord&&this._pageManager._navigationAnimationRecord.elementContainers){var outgoingPage=this._pageManager._navigationAnimationRecord.elementContainers[0],incomingPage=this._pageManager._navigationAnimationRecord.elementContainers[1],outgoingElement=outgoingPage.pageRoot,incomingElement=incomingPage.pageRoot;outgoingElement.parentNode&&outgoingElement.parentNode.removeChild(outgoingElement),incomingElement.parentNode&&incomingElement.parentNode.removeChild(incomingElement),this._pageManager.endAnimatedJump(outgoingPage,incomingPage),this._animationsFinished()}this._completeJumpPending=!1}},_setCurrentIndex:function(index){return this._pageManager.jumpToIndex(index)},_getCurrentIndex:function(){return this._pageManager.currentIndex()},_setDatasource:function(source,template,index){this._animating&&this._cancelAnimation();var initialIndex=0;void 0!==index&&(initialIndex=index),this._dataSource=source,this._itemRenderer=template;var oldItemsManager=this._itemsManager;this._itemsManager=_ItemsManager._createItemsManager(this._dataSource,this._itemRenderer,this._itemsManagerCallback,{ownerElement:this._flipviewDiv}),this._dataSource=this._itemsManager.dataSource;var that=this;this._dataSource.getCount().then(function(count){that._pageManager._cachedSize=count}),this._pageManager.setNewItemsManager(this._itemsManager,initialIndex),oldItemsManager&&oldItemsManager.release()},_fireDatasourceCountChangedEvent:function(){var that=this;Scheduler.schedule(function(){var event=_Global.document.createEvent("Event");event.initEvent(FlipView.datasourceCountChangedEvent,!0,!0),_WriteProfilerMark("WinJS.UI.FlipView:dataSourceCountChangedEvent,info"),that._flipviewDiv.dispatchEvent(event)},Scheduler.Priority.normal,null,"WinJS.UI.FlipView._dispatchDataSourceCountChangedEvent")},_scrollPosChanged:function(){this._disposed||this._pageManager.scrollPosChanged()},_axisAsString:function(){return this._isHorizontal?"horizontal":"vertical"},_setupOrientation:function(){if(this._isHorizontal){this._panningDivContainer.style.overflowX=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowY="hidden";var rtl="rtl"===_ElementUtilities._getComputedStyle(this._flipviewDiv,null).direction;this._rtl=rtl,rtl?(this._prevButton.className=navButtonClass+" "+navButtonRightClass,this._nextButton.className=navButtonClass+" "+navButtonLeftClass):(this._prevButton.className=navButtonClass+" "+navButtonLeftClass,this._nextButton.className=navButtonClass+" "+navButtonRightClass),this._prevButton.innerHTML=rtl?rightArrowGlyph:leftArrowGlyph,this._nextButton.innerHTML=rtl?leftArrowGlyph:rightArrowGlyph}else this._panningDivContainer.style.overflowY=this._environmentSupportsTouch?"scroll":"hidden",this._panningDivContainer.style.overflowX="hidden",this._prevButton.className=navButtonClass+" "+navButtonTopClass,this._nextButton.className=navButtonClass+" "+navButtonBottomClass,this._prevButton.innerHTML=topArrowGlyph,this._nextButton.innerHTML=bottomArrowGlyph;this._panningDivContainer.style.msOverflowStyle="none"},_fadeInButton:function(button,forceShow){(this._mouseInViewport||forceShow||!this._environmentSupportsTouch)&&("next"===button&&this._hasNextContent?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButton.style.visibility="visible",this._nextButtonAnimation=this._fadeInFromCurrentValue(this._nextButton)):"prev"===button&&this._hasPrevContent&&(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButton.style.visibility="visible",this._prevButtonAnimation=this._fadeInFromCurrentValue(this._prevButton)))},_fadeOutButton:function(button){var that=this;return"next"===button?(this._nextButtonAnimation&&(this._nextButtonAnimation.cancel(),this._nextButtonAnimation=null),this._nextButtonAnimation=Animations.fadeOut(this._nextButton).then(function(){that._nextButton.style.visibility="hidden"}),this._nextButtonAnimation):(this._prevButtonAnimation&&(this._prevButtonAnimation.cancel(),this._prevButtonAnimation=null),this._prevButtonAnimation=Animations.fadeOut(this._prevButton).then(function(){that._prevButton.style.visibility="hidden"}),this._prevButtonAnimation)},_fadeOutButtons:function(immediately){if(this._environmentSupportsTouch){this._buttonFadePromise&&(this._buttonFadePromise.cancel(),this._buttonFadePromise=null);var that=this;this._buttonFadePromise=(immediately?Promise.wrap():Promise.timeout(_TransitionAnimation._animationTimeAdjustment(buttonFadeDelay))).then(function(){that._fadeOutButton("prev"),that._fadeOutButton("next"),that._buttonFadePromise=null})}},_animationsStarted:function(){this._animating=!0},_animationsFinished:function(){this._animating=!1},_defaultAnimation:function(curr,next){var incomingPageMove={};next.style.left="0px",next.style.top="0px",next.style.opacity=0;var pageDirection=curr.itemIndex>next.itemIndex?-animationMoveDelta:animationMoveDelta;incomingPageMove.left=(this._isHorizontal?this._rtl?-pageDirection:pageDirection:0)+"px",incomingPageMove.top=(this._isHorizontal?0:pageDirection)+"px";var fadeOutPromise=Animations.fadeOut(curr),enterContentPromise=Animations.enterContent(next,[incomingPageMove],{mechanism:"transition"});return Promise.join([fadeOutPromise,enterContentPromise])},_fadeInFromCurrentValue:function(shown){return _TransitionAnimation.executeTransition(shown,{property:"opacity",delay:0,duration:167,timing:"linear",to:1})}},_Constants);return _Base.Class.mix(FlipView,_Events.createEventProperties(FlipView.datasourceCountChangedEvent,FlipView.pageVisibilityChangedEvent,FlipView.pageSelectedEvent,FlipView.pageCompletedEvent)),_Base.Class.mix(FlipView,_Control.DOMEventMixin),FlipView})})}),define("WinJS/Controls/ItemContainer",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","../Utilities/_UI","./ItemContainer/_Constants","./ItemContainer/_ItemEventsHandler"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,Promise,Scheduler,_Control,_Dispose,_ElementUtilities,_Hoverable,_KeyboardBehavior,_UI,_Constants,_ItemEventsHandler){"use strict";var createEvent=_Events._createEventProperty,eventNames={invoked:"invoked",selectionchanging:"selectionchanging",selectionchanged:"selectionchanged"};_Base.Namespace._moduleDefine(exports,"WinJS.UI",{ItemContainer:_Base.Namespace._lazy(function(){var strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get swipeOrientationDeprecated(){return"Invalid configuration: swipeOrientation is deprecated. The control will default this property to 'none'"},get swipeBehaviorDeprecated(){return"Invalid configuration: swipeBehavior is deprecated. The control will default this property to 'none'"}},ItemContainer=_Base.Class.define(function(element,options){function eventHandler(eventName,caseSensitive,capture){return{name:caseSensitive?eventName:eventName.toLowerCase(),handler:function(eventObject){that["_on"+eventName](eventObject)},capture:capture}}if(element=element||_Global.document.createElement("DIV"),this._id=element.id||_ElementUtilities._uniqueID(element),this._writeProfilerMark("constructor,StartTM"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.ItemContainer.DuplicateConstruction",strings.duplicateConstruction);element.winControl=this,this._element=element,_ElementUtilities.addClass(element,"win-disposable"),this._selectionMode=_UI.SelectionMode.single,this._draggable=!1,this._pressedEntity={type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX},this.tapBehavior=_UI.TapBehavior.invokeOnly,_ElementUtilities.addClass(this.element,ItemContainer._ClassName.itemContainer+" "+_Constants._containerClass),this._setupInternalTree(),this._selection=new exports._SingleItemSelectionManager(element,this._itemBox),this._setTabIndex(),_Control.setOptions(this,options),this._mutationObserver=new _ElementUtilities._MutationObserver(this._itemPropertyChange.bind(this)),this._mutationObserver.observe(element,{attributes:!0,attributeFilter:["aria-selected"]}),this._setAriaRole();var that=this;this.selectionDisabled||Scheduler.schedule(function(){that._setDirectionClass()},Scheduler.Priority.normal,null,"WinJS.UI.ItemContainer_async_initialize"),this._itemEventsHandler=new _ItemEventsHandler._ItemEventsHandler(Object.create({containerFromElement:function(){return that.element},indexForItemElement:function(){return 1},indexForHeaderElement:function(){return _Constants._INVALID_INDEX},itemBoxAtIndex:function(){return that._itemBox},itemAtIndex:function(){return that.element},headerAtIndex:function(){return null},containerAtIndex:function(){return that.element},isZombie:function(){return this._disposed},getItemPosition:function(){return that._getItemPosition()},rtl:function(){return that._rtl()},fireInvokeEvent:function(){that._fireInvokeEvent()},verifySelectionAllowed:function(){return that._verifySelectionAllowed()},changeFocus:function(){},selectRange:function(firstIndex,lastIndex){return that._selection.set({firstIndex:firstIndex,lastIndex:lastIndex})}},{pressedEntity:{get:function(){return that._pressedEntity},set:function(value){that._pressedEntity=value}},pressedElement:{enumerable:!0,set:function(value){that._pressedElement=value}},eventHandlerRoot:{enumerable:!0,get:function(){return that.element}},selectionMode:{enumerable:!0,get:function(){return that._selectionMode}},accessibleItemClass:{enumerable:!0,get:function(){return _Constants._containerClass}},canvasProxy:{enumerable:!0,get:function(){return that._captureProxy}},tapBehavior:{enumerable:!0,get:function(){return that._tapBehavior}},draggable:{enumerable:!0,get:function(){return that._draggable}},selection:{enumerable:!0,get:function(){return that._selection}},customFootprintParent:{enumerable:!0,get:function(){return null}},skipPreventDefaultOnPointerDown:{enumerable:!0,get:function(){return!0}}}));var events=[eventHandler("PointerDown"),eventHandler("Click"),eventHandler("PointerUp"),eventHandler("PointerCancel"),eventHandler("LostPointerCapture"),eventHandler("ContextMenu"),eventHandler("MSHoldVisual",!0),eventHandler("FocusIn"),eventHandler("FocusOut"),eventHandler("DragStart"),eventHandler("DragEnd"),eventHandler("KeyDown")];events.forEach(function(eventHandler){_ElementUtilities._addEventListener(that.element,eventHandler.name,eventHandler.handler,!!eventHandler.capture)}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},draggable:{get:function(){return this._draggable},set:function(value){_BaseUtils.isPhone||this._draggable!==value&&(this._draggable=value,this._updateDraggableAttribute())}},selected:{get:function(){return this._selection.selected},set:function(value){this._selection.selected!==value&&(this._selection.selected=value)}},swipeOrientation:{get:function(){return"none"},set:function(value){_ElementUtilities._deprecated(strings.swipeOrientationDeprecated)}},tapBehavior:{get:function(){return this._tapBehavior},set:function(value){_BaseUtils.isPhone&&value===_UI.TapBehavior.directSelect||(this._tapBehavior=value,this._setAriaRole())}},swipeBehavior:{get:function(){return"none"},set:function(value){_ElementUtilities._deprecated(strings.swipeBehaviorDeprecated)}},selectionDisabled:{get:function(){return this._selectionMode===_UI.SelectionMode.none},set:function(value){value?this._selectionMode=_UI.SelectionMode.none:(this._setDirectionClass(),this._selectionMode=_UI.SelectionMode.single),this._setAriaRole()}},oninvoked:createEvent(eventNames.invoked),onselectionchanging:createEvent(eventNames.selectionchanging),onselectionchanged:createEvent(eventNames.selectionchanged),forceLayout:function(){this._forceLayout()},dispose:function(){this._disposed||(this._disposed=!0,this._itemEventsHandler.dispose(),_Dispose.disposeSubTree(this.element))},_onMSManipulationStateChanged:function(eventObject){this._itemEventsHandler.onMSManipulationStateChanged(eventObject)},_onPointerDown:function(eventObject){this._itemEventsHandler.onPointerDown(eventObject)},_onClick:function(eventObject){this._itemEventsHandler.onClick(eventObject)},_onPointerUp:function(eventObject){_ElementUtilities.hasClass(this._itemBox,_Constants._itemFocusClass)&&this._onFocusOut(eventObject),this._itemEventsHandler.onPointerUp(eventObject)},_onPointerCancel:function(eventObject){this._itemEventsHandler.onPointerCancel(eventObject)},_onLostPointerCapture:function(eventObject){this._itemEventsHandler.onLostPointerCapture(eventObject)},_onContextMenu:function(eventObject){this._itemEventsHandler.onContextMenu(eventObject)},_onMSHoldVisual:function(eventObject){this._itemEventsHandler.onMSHoldVisual(eventObject)},_onFocusIn:function(){if(!this._itemBox.querySelector("."+_Constants._itemFocusOutlineClass)&&_KeyboardBehavior._keyboardSeenLast){_ElementUtilities.addClass(this._itemBox,_Constants._itemFocusClass);var outline=_Global.document.createElement("div");outline.className=_Constants._itemFocusOutlineClass,this._itemBox.appendChild(outline)}},_onFocusOut:function(){_ElementUtilities.removeClass(this._itemBox,_Constants._itemFocusClass);var outline=this._itemBox.querySelector("."+_Constants._itemFocusOutlineClass);outline&&outline.parentNode.removeChild(outline)},_onDragStart:function(eventObject){if(this._pressedElement&&this._itemEventsHandler._isInteractive(this._pressedElement))eventObject.preventDefault();else{this._dragging=!0;var that=this;if(eventObject.dataTransfer.setData("text",""),eventObject.dataTransfer.setDragImage){var rect=this.element.getBoundingClientRect();eventObject.dataTransfer.setDragImage(this.element,eventObject.clientX-rect.left,eventObject.clientY-rect.top)}_BaseUtils._yieldForDomModification(function(){that._dragging&&_ElementUtilities.addClass(that._itemBox,_Constants._dragSourceClass)})}},_onDragEnd:function(){this._dragging=!1,_ElementUtilities.removeClass(this._itemBox,_Constants._dragSourceClass),this._itemEventsHandler.resetPointerDownState()},_onKeyDown:function(eventObject){if(!this._itemEventsHandler._isInteractive(eventObject.target)){var Key=_ElementUtilities.Key,keyCode=eventObject.keyCode,handled=!1;if(eventObject.ctrlKey||keyCode!==Key.enter)eventObject.ctrlKey&&keyCode===Key.enter||keyCode===Key.space?this.selectionDisabled||(this.selected=!this.selected,handled=_ElementUtilities._setActive(this.element)):keyCode===Key.escape&&this.selected&&(this.selected=!1,handled=!0);else{var allowed=this._verifySelectionAllowed();allowed.canTapSelect&&(this.selected=!this.selected),this._fireInvokeEvent(),handled=!0}handled&&(eventObject.stopPropagation(),eventObject.preventDefault())}},_setTabIndex:function(){var currentTabIndex=this.element.getAttribute("tabindex");currentTabIndex||this.element.setAttribute("tabindex","0")},_rtl:function(){return"boolean"!=typeof this._cachedRTL&&(this._cachedRTL="rtl"===_ElementUtilities._getComputedStyle(this.element,null).direction),this._cachedRTL},_setDirectionClass:function(){_ElementUtilities[this._rtl()?"addClass":"removeClass"](this.element,_Constants._rtlListViewClass)},_forceLayout:function(){this._cachedRTL="rtl"===_ElementUtilities._getComputedStyle(this.element,null).direction,this._setDirectionClass()},_getItemPosition:function(){var container=this.element;return container?Promise.wrap({left:this._rtl()?container.offsetParent.offsetWidth-container.offsetLeft-container.offsetWidth:container.offsetLeft,top:container.offsetTop,totalWidth:_ElementUtilities.getTotalWidth(container),totalHeight:_ElementUtilities.getTotalHeight(container),contentWidth:_ElementUtilities.getContentWidth(container),contentHeight:_ElementUtilities.getContentHeight(container)}):Promise.cancel},_itemPropertyChange:function(list){if(!this._disposed){var container=list[0].target,ariaSelected="true"===container.getAttribute("aria-selected");ariaSelected!==_ElementUtilities._isSelectionRendered(this._itemBox)&&(this.selectionDisabled?_ElementUtilities._setAttribute(container,"aria-selected",!ariaSelected):(this.selected=ariaSelected,ariaSelected!==this.selected&&_ElementUtilities._setAttribute(container,"aria-selected",!ariaSelected)))}},_updateDraggableAttribute:function(){this._itemBox.setAttribute("draggable",this._draggable)},_verifySelectionAllowed:function(){if(this._selectionMode!==_UI.SelectionMode.none&&this._tapBehavior===_UI.TapBehavior.toggleSelect){var canSelect=this._selection.fireSelectionChanging();return{canSelect:canSelect,canTapSelect:canSelect&&this._tapBehavior===_UI.TapBehavior.toggleSelect}}return{canSelect:!1,canTapSelect:!1}},_setupInternalTree:function(){var item=_Global.document.createElement("div");item.className=_Constants._itemClass,this._captureProxy=_Global.document.createElement("div"),this._itemBox=_Global.document.createElement("div"),this._itemBox.className=_Constants._itemBoxClass;for(var child=this.element.firstChild;child;){var sibling=child.nextSibling;item.appendChild(child),child=sibling}this.element.appendChild(this._itemBox),this._itemBox.appendChild(item),this.element.appendChild(this._captureProxy)},_fireInvokeEvent:function(){if(this.tapBehavior!==_UI.TapBehavior.none){var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent(eventNames.invoked,!0,!1,{}),this.element.dispatchEvent(eventObject)}},_setAriaRole:function(){if(!this.element.getAttribute("role")||this._usingDefaultItemRole){this._usingDefaultItemRole=!0;var defaultItemRole;defaultItemRole=this.tapBehavior===_UI.TapBehavior.none&&this.selectionDisabled?"listitem":"option",_ElementUtilities._setAttribute(this.element,"role",defaultItemRole)}},_writeProfilerMark:function(text){var message="WinJS.UI.ItemContainer:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"itemcontainerprofiler")}},{_ClassName:{itemContainer:"win-itemcontainer",vertical:"win-vertical",horizontal:"win-horizontal"}});return _Base.Class.mix(ItemContainer,_Control.DOMEventMixin),ItemContainer}),_SingleItemSelectionManager:_Base.Namespace._lazy(function(){return _Base.Class.define(function(element,itemBox){this._selected=!1,this._element=element,this._itemBox=itemBox},{selected:{get:function(){return this._selected},set:function(value){value=!!value,this._selected!==value&&this.fireSelectionChanging()&&(this._selected=value,_ItemEventsHandler._ItemEventsHandler.renderSelection(this._itemBox,this._element,value,!0,this._element),this.fireSelectionChanged())}},count:function(){return this._selected?1:0},getIndices:function(){},getItems:function(){},getRanges:function(){},isEverything:function(){return!1},set:function(){this.selected=!0},clear:function(){this.selected=!1},add:function(){this.selected=!0},remove:function(){this.selected=!1},selectAll:function(){},fireSelectionChanging:function(){var eventObject=_Global.document.createEvent("CustomEvent");return eventObject.initCustomEvent(eventNames.selectionchanging,!0,!0,{}),this._element.dispatchEvent(eventObject)},fireSelectionChanged:function(){var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent(eventNames.selectionchanged,!0,!1,{}),this._element.dispatchEvent(eventObject)},_isIncluded:function(){return this._selected},_getFocused:function(){return{type:_UI.ObjectType.item,index:_Constants._INVALID_INDEX}}})})})}),define("WinJS/Controls/Repeater",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../BindingList","../BindingTemplate","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable"],function(exports,_Global,_Base,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,BindingList,BindingTemplate,Promise,_Control,_Dispose,_ElementUtilities,_Hoverable){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Repeater:_Base.Namespace._lazy(function(){function stringifyItem(dataItem){var itemElement=_Global.document.createElement("div");return itemElement.textContent=JSON.stringify(dataItem),itemElement}var ITEMSLOADED="itemsloaded",ITEMCHANGING="itemchanging",ITEMCHANGED="itemchanged",ITEMINSERTING="iteminserting",ITEMINSERTED="iteminserted",ITEMMOVING="itemmoving",ITEMMOVED="itemmoved",ITEMREMOVING="itemremoving",ITEMREMOVED="itemremoved",ITEMSRELOADING="itemsreloading",ITEMSRELOADED="itemsreloaded",createEvent=_Events._createEventProperty,strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get asynchronousRender(){return"Top level items must render synchronously"},get repeaterReentrancy(){return"Cannot modify Repeater data until Repeater has commited previous modification."}},Repeater=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.Repeater.DuplicateConstruction",strings.duplicateConstruction);this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),options=options||{},_ElementUtilities.addClass(this._element,"win-repeater win-disposable"),this._render=null,this._modifying=!1,this._disposed=!1,this._element.winControl=this,this._dataListeners={itemchanged:this._dataItemChangedHandler.bind(this),iteminserted:this._dataItemInsertedHandler.bind(this),itemmoved:this._dataItemMovedHandler.bind(this),itemremoved:this._dataItemRemovedHandler.bind(this),reload:this._dataReloadHandler.bind(this)};var inlineTemplate=this._extractInlineTemplate();this._initializing=!0,this.template=options.template||inlineTemplate,this.data=options.data,this._initializing=!1,_Control._setOptions(this,options,!0),this._repeatedDOM=[],this._renderAllItems(),this.dispatchEvent(ITEMSLOADED,{}),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},data:{get:function(){return this._data},set:function(data){this._writeProfilerMark("data.set,StartTM"),this._data&&this._removeDataListeners(),this._data=data||new BindingList.List,this._addDataListeners(),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(ITEMSLOADED,{})),this._writeProfilerMark("data.set,StopTM")}},template:{get:function(){return this._template},set:function(template){
this._writeProfilerMark("template.set,StartTM"),this._template=template||stringifyItem,this._render=_ElementUtilities._syncRenderer(this._template,this.element.tagName),this._initializing||(this._reloadRepeater(!0),this.dispatchEvent(ITEMSLOADED,{})),this._writeProfilerMark("template.set,StopTM")}},length:{get:function(){return this._repeatedDOM.length}},elementFromIndex:function(index){return this._repeatedDOM[index]},dispose:function(){if(!this._disposed){this._disposed=!0,this._removeDataListeners(),this._data=null,this._template=null;for(var i=0,len=this._repeatedDOM.length;i<len;i++)_Dispose._disposeElement(this._repeatedDOM[i])}},onitemsloaded:createEvent(ITEMSLOADED),onitemchanging:createEvent(ITEMCHANGING),onitemchanged:createEvent(ITEMCHANGED),oniteminserting:createEvent(ITEMINSERTING),oniteminserted:createEvent(ITEMINSERTED),onitemmoving:createEvent(ITEMMOVING),onitemmoved:createEvent(ITEMMOVED),onitemremoving:createEvent(ITEMREMOVING),onitemremoved:createEvent(ITEMREMOVED),onitemsreloading:createEvent(ITEMSRELOADING),onitemsreloaded:createEvent(ITEMSRELOADED),_extractInlineTemplate:function(){if(this._element.firstElementChild){for(var templateElement=_Global.document.createElement(this._element.tagName);this._element.firstElementChild;)templateElement.appendChild(this._element.firstElementChild);return new BindingTemplate.Template(templateElement,{extractChild:!0})}},_renderAllItems:function(){for(var fragment=_Global.document.createDocumentFragment(),i=0,len=this._data.length;i<len;i++){var renderedItem=this._render(this._data.getAt(i));if(!renderedItem)throw new _ErrorFromName("WinJS.UI.Repeater.AsynchronousRender",strings.asynchronousRender);fragment.appendChild(renderedItem),this._repeatedDOM.push(renderedItem)}this._element.appendChild(fragment)},_reloadRepeater:function(shouldDisposeElements){this._unloadRepeatedDOM(shouldDisposeElements),this._repeatedDOM=[],this._renderAllItems()},_unloadRepeatedDOM:function(shouldDisposeElements){for(var i=0,len=this._repeatedDOM.length;i<len;i++){var element=this._repeatedDOM[i];shouldDisposeElements&&_Dispose._disposeElement(element),element.parentElement===this._element&&this._element.removeChild(element)}},_addDataListeners:function(){Object.keys(this._dataListeners).forEach(function(eventName){this._data.addEventListener(eventName,this._dataListeners[eventName],!1)}.bind(this))},_beginModification:function(){if(this._modifying)throw new _ErrorFromName("WinJS.UI.Repeater.RepeaterModificationReentrancy",strings.repeaterReentrancy);this._modifying=!0},_endModification:function(){this._modifying=!1},_removeDataListeners:function(){Object.keys(this._dataListeners).forEach(function(eventName){this._data.removeEventListener(eventName,this._dataListeners[eventName],!1)}.bind(this))},_dataItemChangedHandler:function(eventInfo){this._beginModification();var animationPromise,root=this._element,index=eventInfo.detail.index,renderedItem=this._render(eventInfo.detail.newValue);if(!renderedItem)throw new _ErrorFromName("WinJS.UI.Repeater.AsynchronousRender",strings.asynchronousRender);this._repeatedDOM[index]&&(eventInfo.detail.oldElement=this._repeatedDOM[index]),eventInfo.detail.newElement=renderedItem,eventInfo.detail.setPromise=function(delayPromise){animationPromise=delayPromise},this._writeProfilerMark(ITEMCHANGING+",info"),this.dispatchEvent(ITEMCHANGING,eventInfo.detail);var oldItem=null;index<this._repeatedDOM.length?(oldItem=this._repeatedDOM[index],root.replaceChild(renderedItem,oldItem),this._repeatedDOM[index]=renderedItem):(root.appendChild(renderedItem),this._repeatedDOM.push(renderedItem)),this._endModification(),this._writeProfilerMark(ITEMCHANGED+",info"),this.dispatchEvent(ITEMCHANGED,eventInfo.detail),oldItem&&Promise.as(animationPromise).done(function(){_Dispose._disposeElement(oldItem)}.bind(this))},_dataItemInsertedHandler:function(eventInfo){this._beginModification();var index=eventInfo.detail.index,renderedItem=this._render(eventInfo.detail.value);if(!renderedItem)throw new _ErrorFromName("WinJS.UI.Repeater.AsynchronousRender",strings.asynchronousRender);var root=this._element;if(eventInfo.detail.affectedElement=renderedItem,this._writeProfilerMark(ITEMINSERTING+",info"),this.dispatchEvent(ITEMINSERTING,eventInfo.detail),index<this._repeatedDOM.length){var nextSibling=this._repeatedDOM[index];root.insertBefore(renderedItem,nextSibling)}else root.appendChild(renderedItem);this._repeatedDOM.splice(index,0,renderedItem),this._endModification(),this._writeProfilerMark(ITEMINSERTED+",info"),this.dispatchEvent(ITEMINSERTED,eventInfo.detail)},_dataItemMovedHandler:function(eventInfo){this._beginModification();var movingItem=this._repeatedDOM[eventInfo.detail.oldIndex];if(eventInfo.detail.affectedElement=movingItem,this._writeProfilerMark(ITEMMOVING+",info"),this.dispatchEvent(ITEMMOVING,eventInfo.detail),this._repeatedDOM.splice(eventInfo.detail.oldIndex,1)[0],movingItem.parentNode.removeChild(movingItem),eventInfo.detail.newIndex<this._data.length-1){var nextSibling=this._repeatedDOM[eventInfo.detail.newIndex];this._element.insertBefore(movingItem,nextSibling),this._repeatedDOM.splice(eventInfo.detail.newIndex,0,movingItem)}else this._repeatedDOM.push(movingItem),this._element.appendChild(movingItem);this._endModification(),this._writeProfilerMark(ITEMMOVED+",info"),this.dispatchEvent(ITEMMOVED,eventInfo.detail)},_dataItemRemovedHandler:function(eventInfo){this._beginModification();var animationPromise,oldItem=this._repeatedDOM[eventInfo.detail.index],eventDetail={affectedElement:oldItem,index:eventInfo.detail.index,item:eventInfo.detail.item};eventDetail.setPromise=function(delayPromise){animationPromise=delayPromise},this._writeProfilerMark(ITEMREMOVING+",info"),this.dispatchEvent(ITEMREMOVING,eventDetail),oldItem.parentNode.removeChild(oldItem),this._repeatedDOM.splice(eventInfo.detail.index,1),this._endModification(),this._writeProfilerMark(ITEMREMOVED+",info"),this.dispatchEvent(ITEMREMOVED,eventDetail),Promise.as(animationPromise).done(function(){_Dispose._disposeElement(oldItem)}.bind(this))},_dataReloadHandler:function(){this._beginModification();var animationPromise,shallowCopyBefore=this._repeatedDOM.slice(0),eventDetail={affectedElements:shallowCopyBefore};eventDetail.setPromise=function(delayPromise){animationPromise=delayPromise},this._writeProfilerMark(ITEMSRELOADING+",info"),this.dispatchEvent(ITEMSRELOADING,eventDetail),this._reloadRepeater(!1);var shallowCopyAfter=this._repeatedDOM.slice(0);this._endModification(),this._writeProfilerMark(ITEMSRELOADED+",info"),this.dispatchEvent(ITEMSRELOADED,{affectedElements:shallowCopyAfter}),Promise.as(animationPromise).done(function(){for(var i=0,len=shallowCopyBefore.length;i<len;i++)_Dispose._disposeElement(shallowCopyBefore[i])}.bind(this))},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.Repeater:"+this._id+":"+text)}},{isDeclarativeControlContainer:!0});return _Base.Class.mix(Repeater,_Control.DOMEventMixin),Repeater})})}),define("require-style!less/styles-datetimepicker",[],function(){}),define("WinJS/Controls/DatePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/styles-datetimepicker"],function(_Global,_WinRT,_Base,_BaseUtils,_Events,_Resources,_Control,_ElementUtilities,_Hoverable,_Select){"use strict";_Base.Namespace.define("WinJS.UI",{DatePicker:_Base.Namespace._lazy(function(){function newFormatter(pattern,calendar,defaultPattern){var dtf=_WinRT.Windows.Globalization.DateTimeFormatting;pattern=pattern?pattern:defaultPattern;var c=new dtf.DateTimeFormatter(pattern);return calendar?new dtf.DateTimeFormatter(pattern,c.languages,c.geographicRegion,calendar,c.clock):c}function formatCacheLookup(pattern,calendar,defaultPattern){var pat=yearFormatCache[pattern];pat||(pat=yearFormatCache[pattern]={});var cal=pat[calendar];cal||(cal=pat[calendar]={});var def=cal[defaultPattern];return def||(def=cal[defaultPattern]={},def.formatter=newFormatter(pattern,calendar,defaultPattern),def.years={}),def}function formatYear(pattern,calendar,defaultPattern,datePatterns,order,cal){var cache=formatCacheLookup(pattern,calendar,defaultPattern),y=cache.years[cal.year+"-"+cal.era];return y||(y=cache.formatter.format(cal.getDateTime()),cache.years[cal.year+"-"+cal.era]=y),y}function formatMonth(pattern,calendar,defaultPattern,cal){var cache=formatCacheLookup(pattern,calendar,defaultPattern);return cache.formatter.format(cal.getDateTime())}function formatDay(pattern,calendar,defaultPattern,cal){var cache=formatCacheLookup(pattern,calendar,defaultPattern);return cache.formatter.format(cal.getDateTime())}function newCal(calendar){var glob=_WinRT.Windows.Globalization,c=new glob.Calendar;return calendar?new glob.Calendar(c.languages,calendar,c.getClock()):c}function yearDiff(start,end){var yearCount=0;if(start.era===end.era)yearCount=end.year-start.year;else for(;start.era!==end.era||start.year!==end.year;)yearCount++,start.addYears(1);return yearCount}var DEFAULT_DAY_PATTERN="day",DEFAULT_MONTH_PATTERN="{month.full}",DEFAULT_YEAR_PATTERN="year.full",strings={get ariaLabel(){return _Resources._getWinJSString("ui/datePicker").value},get selectDay(){return _Resources._getWinJSString("ui/selectDay").value},get selectMonth(){return _Resources._getWinJSString("ui/selectMonth").value},get selectYear(){return _Resources._getWinJSString("ui/selectYear").value}},yearFormatCache={},DatePicker=_Base.Class.define(function(element,options){this._currentDate=new Date,this._minYear=this._currentDate.getFullYear()-100,this._maxYear=this._currentDate.getFullYear()+100,this._datePatterns={date:null,month:null,year:null},element=element||_Global.document.createElement("div"),_ElementUtilities.addClass(element,"win-disposable"),element.winControl=this;var label=element.getAttribute("aria-label");label||element.setAttribute("aria-label",strings.ariaLabel),this._init(element),_Control.setOptions(this,options)},{_information:null,_currentDate:null,_calendar:null,_disabled:!1,_dateElement:null,_dateControl:null,_monthElement:null,_monthControl:null,_minYear:null,_maxYear:null,_yearElement:null,_yearControl:null,_datePatterns:{date:null,month:null,year:null},_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._dateElement.setAttribute("aria-label",strings.selectDay),this._monthElement.setAttribute("aria-label",strings.selectMonth),this._yearElement.setAttribute("aria-label",strings.selectYear)},_addControlsInOrder:function(){var e=this._domElement,that=this,orderIndex=0;that._information.order.forEach(function(s){switch(s){case"month":e.appendChild(that._monthElement),_ElementUtilities.addClass(that._monthElement,"win-order"+orderIndex++);break;case"date":e.appendChild(that._dateElement),_ElementUtilities.addClass(that._dateElement,"win-order"+orderIndex++);break;case"year":e.appendChild(that._yearElement),_ElementUtilities.addClass(that._yearElement,"win-order"+orderIndex++)}})},_createControlElements:function(){this._monthElement=_Global.document.createElement("select"),this._monthElement.className="win-datepicker-month win-dropdown",this._dateElement=_Global.document.createElement("select"),this._dateElement.className="win-datepicker-date win-dropdown",this._yearElement=_Global.document.createElement("select"),this._yearElement.className="win-datepicker-year win-dropdown"},_createControls:function(){var info=this._information,index=info.getIndex(this.current);info.forceLanguage&&(this._domElement.setAttribute("lang",info.forceLanguage),this._domElement.setAttribute("dir",info.isRTL?"rtl":"ltr")),this._yearControl=new _Select._Select(this._yearElement,{dataSource:this._information.years,disabled:this.disabled,index:index.year}),this._monthControl=new _Select._Select(this._monthElement,{dataSource:this._information.months(index.year),disabled:this.disabled,index:index.month}),this._dateControl=new _Select._Select(this._dateElement,{dataSource:this._information.dates(index.year,index.month),disabled:this.disabled,index:index.date}),this._wireupEvents()},dispose:function(){},calendar:{get:function(){return this._calendar},set:function(value){this._calendar=value,this._setElement(this._domElement)}},current:{get:function(){var d=this._currentDate,y=d.getFullYear();return new Date(Math.max(Math.min(this.maxYear,y),this.minYear),d.getMonth(),d.getDate(),12,0,0,0)},set:function(value){var newDate;"string"==typeof value?(newDate=new Date(Date.parse(value)),newDate.setHours(12,0,0,0)):newDate=value;var oldDate=this._currentDate;oldDate!==newDate&&(this._currentDate=newDate,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(value){this._disabled!==value&&(this._disabled=value,this._yearControl&&(this._monthControl.setDisabled(value),this._dateControl.setDisabled(value),this._yearControl.setDisabled(value)))}},datePattern:{get:function(){return this._datePatterns.date},set:function(value){this._datePatterns.date!==value&&(this._datePatterns.date=value,this._init())}},element:{get:function(){return this._domElement}},_setElement:function(element){this._domElement=this._domElement||element,this._domElement&&(_ElementUtilities.empty(this._domElement),_ElementUtilities.addClass(this._domElement,"win-datepicker"),this._updateInformation(),this._createControlElements(),this._addControlsInOrder(),this._createControls(),this._addAccessibilityAttributes())},minYear:{get:function(){return this._information.getDate({year:0,month:0,date:0}).getFullYear()},set:function(value){this._minYear!==value&&(this._minYear=value,value>this._maxYear&&(this._maxYear=value),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},maxYear:{get:function(){var index={year:this._information.years.getLength()-1};return index.month=this._information.months(index.year).getLength()-1,index.date=this._information.dates(index.year,index.month).getLength()-1,this._information.getDate(index).getFullYear()},set:function(value){this._maxYear!==value&&(this._maxYear=value,value<this._minYear&&(this._minYear=value),this._updateInformation(),this._yearControl&&(this._yearControl.dataSource=this._information.years),this._updateDisplay())}},monthPattern:{get:function(){return this._datePatterns.month},set:function(value){this._datePatterns.month!==value&&(this._datePatterns.month=value,this._init())}},_updateInformation:function(){var min=new Date(this._minYear,0,1,12,0,0),max=new Date(this._maxYear,11,31,12,0,0);min.setFullYear(this._minYear),max.setFullYear(this._maxYear),this._information=DatePicker.getInformation(min,max,this._calendar,this._datePatterns)},_init:function(element){this._setElement(element)},_updateDisplay:function(){if(this._domElement&&this._yearControl){var index=this._information.getIndex(this.current);this._yearControl.index=index.year,this._monthControl.dataSource=this._information.months(index.year),this._monthControl.index=index.month,this._dateControl.dataSource=this._information.dates(index.year,index.month),this._dateControl.index=index.date}},_wireupEvents:function(){function changed(){that._currentDate=that._information.getDate({year:that._yearControl.index,month:that._monthControl.index,date:that._dateControl.index},that._currentDate);var index=that._information.getIndex(that._currentDate);that._monthControl.dataSource=that._information.months(index.year),that._monthControl.index=index.month,that._dateControl.dataSource=that._information.dates(index.year,index.month),that._dateControl.index=index.date}var that=this;this._dateElement.addEventListener("change",changed,!1),this._monthElement.addEventListener("change",changed,!1),this._yearElement.addEventListener("change",changed,!1)},yearPattern:{get:function(){return this._datePatterns.year},set:function(value){this._datePatterns.year!==value&&(this._datePatterns.year=value,this._init())}}},{_getInformationWinRT:function(startDate,endDate,calendar,datePatterns){function clamp(date){return new Date(Math.min(new Date(Math.max(minDateTime,date)),maxDateTime))}datePatterns=datePatterns||{date:DEFAULT_DAY_PATTERN,month:DEFAULT_MONTH_PATTERN,year:DEFAULT_YEAR_PATTERN};var tempCal=newCal(calendar),monthCal=newCal(calendar),dayCal=newCal(calendar);tempCal.setToMin();var minDateTime=tempCal.getDateTime();tempCal.setToMax();var maxDateTime=tempCal.getDateTime();tempCal.hour=12,startDate=clamp(startDate),endDate=clamp(endDate),tempCal.setDateTime(endDate);var end={year:tempCal.year,era:tempCal.era};tempCal.setDateTime(startDate);var yearLen=0;yearLen=yearDiff(tempCal,end)+1;var dateformat=formatCacheLookup("day month.full year",calendar).formatter,localdatepattern=dateformat.patterns[0],isRTL=8207===localdatepattern.charCodeAt(0),order=["date","month","year"],indexes={month:localdatepattern.indexOf("{month"),date:localdatepattern.indexOf("{day"),year:localdatepattern.indexOf("{year")};order.sort(function(a,b){return indexes[a]<indexes[b]?-1:indexes[a]>indexes[b]?1:0});var yearSource=function(){return{getLength:function(){return yearLen},getValue:function(index){return tempCal.setDateTime(startDate),tempCal.addYears(index),formatYear(datePatterns.year,calendar,DEFAULT_YEAR_PATTERN,datePatterns,order,tempCal)}}}(),monthSource=function(yearIndex){return monthCal.setDateTime(startDate),monthCal.addYears(yearIndex),{getLength:function(){return monthCal.numberOfMonthsInThisYear},getValue:function(index){return monthCal.month=monthCal.firstMonthInThisYear,monthCal.addMonths(index),formatMonth(datePatterns.month,calendar,DEFAULT_MONTH_PATTERN,monthCal)}}},dateSource=function(yearIndex,monthIndex){return dayCal.setDateTime(startDate),dayCal.addYears(yearIndex),dayCal.month=dayCal.firstMonthInThisYear,dayCal.addMonths(monthIndex),dayCal.day=dayCal.firstDayInThisMonth,{getLength:function(){return dayCal.numberOfDaysInThisMonth},getValue:function(index){return dayCal.day=dayCal.firstDayInThisMonth,dayCal.addDays(index),formatDay(datePatterns.date,calendar,DEFAULT_DAY_PATTERN,dayCal)}}};return{isRTL:isRTL,forceLanguage:dateformat.resolvedLanguage,order:order,getDate:function(index,lastDate){var lastCal;lastDate&&(tempCal.setDateTime(lastDate),lastCal={year:tempCal.year,month:tempCal.month,day:tempCal.day});var c=tempCal;c.setDateTime(startDate),c.addYears(index.year);var guessMonth;c.firstMonthInThisYear>c.lastMonthInThisYear?(guessMonth=index.month+c.firstMonthInThisYear>c.numberOfMonthsInThisYear?index.month+c.firstMonthInThisYear-c.numberOfMonthsInThisYear:index.month+c.firstMonthInThisYear,lastCal&&lastCal.year!==c.year&&(guessMonth=Math.max(Math.min(lastCal.month,c.numberOfMonthsInThisYear),1))):guessMonth=lastCal&&lastCal.year!==c.year?Math.max(Math.min(lastCal.month,c.firstMonthInThisYear+c.numberOfMonthsInThisYear-1),c.firstMonthInThisYear):Math.max(Math.min(index.month+c.firstMonthInThisYear,c.firstMonthInThisYear+c.numberOfMonthsInThisYear-1),c.firstMonthInThisYear),c.month=guessMonth;var guessDay=Math.max(Math.min(index.date+c.firstDayInThisMonth,c.firstDayInThisMonth+c.numberOfDaysInThisMonth-1),c.firstDayInThisMonth);return!lastCal||lastCal.year===c.year&&lastCal.month===c.month||(guessDay=Math.max(Math.min(lastCal.day,c.firstDayInThisMonth+c.numberOfDaysInThisMonth-1),c.firstDayInThisMonth)),c.day=c.firstDayInThisMonth,c.addDays(guessDay-c.firstDayInThisMonth),c.getDateTime()},getIndex:function(date){var curDate=clamp(date);tempCal.setDateTime(curDate);var cur={year:tempCal.year,era:tempCal.era},yearIndex=0;tempCal.setDateTime(startDate),tempCal.month=1,yearIndex=yearDiff(tempCal,cur),tempCal.setDateTime(curDate);var monthIndex=tempCal.month-tempCal.firstMonthInThisYear;monthIndex<0&&(monthIndex=tempCal.month-tempCal.firstMonthInThisYear+tempCal.numberOfMonthsInThisYear);var dateIndex=tempCal.day-tempCal.firstDayInThisMonth,index={year:yearIndex,month:monthIndex,date:dateIndex};return index},years:yearSource,months:monthSource,dates:dateSource}},_getInformationJS:function(startDate,endDate){var minYear=startDate.getFullYear(),maxYear=endDate.getFullYear(),yearSource={getLength:function(){return Math.max(0,maxYear-minYear+1)},getValue:function(index){return minYear+index}},months=["January","February","March","April","May","June","July","August","September","October","November","December"],monthSource=function(){return{getLength:function(){return months.length},getValue:function(index){return months[index]},getMonthNumber:function(index){return Math.min(index,months.length-1)}}},dateSource=function(yearIndex,monthIndex){var temp=new Date,year=yearSource.getValue(yearIndex),month=monthIndex+1;temp.setFullYear(year,month,0);var maxValue=temp.getDate();return{getLength:function(){return maxValue},getValue:function(index){return""+(index+1)},getDateNumber:function(index){return Math.min(index+1,maxValue)}}};return{order:["month","date","year"],getDate:function(index){return new Date(yearSource.getValue(index.year),monthSource(index.year).getMonthNumber(index.month),dateSource(index.year,index.month).getDateNumber(index.date),12,0)},getIndex:function(date){var yearIndex=0,year=date.getFullYear();yearIndex=year<minYear?0:year>this.maxYear?yearSource.getLength()-1:date.getFullYear()-minYear;var monthIndex=Math.min(date.getMonth(),monthSource(yearIndex).getLength()),dateIndex=Math.min(date.getDate()-1,dateSource(yearIndex,monthIndex).getLength());return{year:yearIndex,month:monthIndex,date:dateIndex}},years:yearSource,months:monthSource,dates:dateSource}}});return _WinRT.Windows.Globalization.Calendar&&_WinRT.Windows.Globalization.DateTimeFormatting?DatePicker.getInformation=DatePicker._getInformationWinRT:DatePicker.getInformation=DatePicker._getInformationJS,_Base.Class.mix(DatePicker,_Events.createEventProperties("change")),_Base.Class.mix(DatePicker,_Control.DOMEventMixin),DatePicker})})}),define("WinJS/Controls/TimePicker",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_Select","require-style!less/styles-datetimepicker"],function(_Global,_WinRT,_Base,_BaseUtils,_Events,_Resources,_Control,_ElementUtilities,_Hoverable,_Select){"use strict";_Base.Namespace.define("WinJS.UI",{TimePicker:_Base.Namespace._lazy(function(){var DEFAULT_MINUTE_PATTERN="{minute.integer(2)}",DEFAULT_HOUR_PATTERN="{hour.integer(1)}",DEFAULT_PERIOD_PATTERN="{period.abbreviated(2)}",strings={get ariaLabel(){return _Resources._getWinJSString("ui/timePicker").value},get selectHour(){return _Resources._getWinJSString("ui/selectHour").value},get selectMinute(){return _Resources._getWinJSString("ui/selectMinute").value},get selectAMPM(){return _Resources._getWinJSString("ui/selectAMPM").value}},areTimesEqual=function(date1,date2){return date1.getHours()===date2.getHours()&&date1.getMinutes()===date2.getMinutes()},TimePicker=_Base.Class.define(function(element,options){this._currentTime=TimePicker._sentinelDate(),element=element||_Global.document.createElement("div"),_ElementUtilities.addClass(element,"win-disposable"),element.winControl=this;var label=element.getAttribute("aria-label");label||element.setAttribute("aria-label",strings.ariaLabel),this._timePatterns={minute:null,hour:null,period:null},this._init(element),_Control.setOptions(this,options)},{_currentTime:null,_clock:null,_disabled:!1,_hourElement:null,_hourControl:null,_minuteElement:null,_minuteControl:null,_ampmElement:null,_ampmControl:null,_minuteIncrement:1,_timePatterns:{minute:null,hour:null,period:null},_information:null,_addAccessibilityAttributes:function(){this._domElement.setAttribute("role","group"),this._hourElement.setAttribute("aria-label",strings.selectHour),this._minuteElement.setAttribute("aria-label",strings.selectMinute),this._ampmElement&&this._ampmElement.setAttribute("aria-label",strings.selectAMPM)},_addControlsInOrder:function(info){var that=this;info.order.forEach(function(s,index){switch(s){case"hour":that._domElement.appendChild(that._hourElement),_ElementUtilities.addClass(that._hourElement,"win-order"+index);break;case"minute":that._domElement.appendChild(that._minuteElement),_ElementUtilities.addClass(that._minuteElement,"win-order"+index);break;case"period":that._ampmElement&&(that._domElement.appendChild(that._ampmElement),_ElementUtilities.addClass(that._ampmElement,"win-order"+index))}})},dispose:function(){},clock:{get:function(){return this._clock},set:function(value){this._clock!==value&&(this._clock=value,this._init())}},current:{get:function(){var cur=this._currentTime;if(cur){var time=TimePicker._sentinelDate();return time.setHours(cur.getHours()),time.setMinutes(this._getMinutesIndex(cur)*this.minuteIncrement),time.setSeconds(0),time.setMilliseconds(0),time}return cur},set:function(value){var newTime;"string"==typeof value?(newTime=TimePicker._sentinelDate(),newTime.setTime(Date.parse(newTime.toDateString()+" "+value))):(newTime=TimePicker._sentinelDate(),newTime.setHours(value.getHours()),newTime.setMinutes(value.getMinutes()));var oldTime=this._currentTime;areTimesEqual(oldTime,newTime)||(this._currentTime=newTime,this._updateDisplay())}},disabled:{get:function(){return this._disabled},set:function(value){this._disabled!==value&&(this._disabled=value,this._hourControl&&(this._hourControl.setDisabled(value),this._minuteControl.setDisabled(value)),this._ampmControl&&this._ampmControl.setDisabled(value))}},element:{get:function(){return this._domElement}},_init:function(element){this._setElement(element),this._updateDisplay()},hourPattern:{get:function(){return this._timePatterns.hour.pattern},set:function(value){this._timePatterns.hour!==value&&(this._timePatterns.hour=value,this._init())}},_getHoursAmpm:function(time){var hours24=time.getHours();return this._ampmElement?0===hours24?{hours:12,ampm:0}:hours24<12?{hours:hours24,ampm:0}:{hours:hours24-12,ampm:1}:{hours:hours24}},_getHoursIndex:function(hours){return this._ampmElement&&12===hours?0:hours},_getMinutesIndex:function(time){return parseInt(time.getMinutes()/this.minuteIncrement)},minuteIncrement:{get:function(){return Math.max(1,Math.abs(0|this._minuteIncrement)%60)},set:function(value){this._minuteIncrement!==value&&(this._minuteIncrement=value,this._init())}},minutePattern:{get:function(){return this._timePatterns.minute.pattern},set:function(value){this._timePatterns.minute!==value&&(this._timePatterns.minute=value,this._init())}},periodPattern:{get:function(){return this._timePatterns.period.pattern},set:function(value){this._timePatterns.period!==value&&(this._timePatterns.period=value,this._init())}},_setElement:function(element){if(this._domElement=this._domElement||element,this._domElement){var info=TimePicker.getInformation(this.clock,this.minuteIncrement,this._timePatterns);this._information=info,info.forceLanguage&&(this._domElement.setAttribute("lang",info.forceLanguage),this._domElement.setAttribute("dir",info.isRTL?"rtl":"ltr")),_ElementUtilities.empty(this._domElement),_ElementUtilities.addClass(this._domElement,"win-timepicker"),this._hourElement=_Global.document.createElement("select"),_ElementUtilities.addClass(this._hourElement,"win-timepicker-hour win-dropdown"),this._minuteElement=_Global.document.createElement("select"),_ElementUtilities.addClass(this._minuteElement,"win-timepicker-minute win-dropdown"),this._ampmElement=null,"12HourClock"===info.clock&&(this._ampmElement=_Global.document.createElement("select"),_ElementUtilities.addClass(this._ampmElement,"win-timepicker-period win-dropdown")),this._addControlsInOrder(info);var hoursAmpm=this._getHoursAmpm(this.current);this._hourControl=new _Select._Select(this._hourElement,{dataSource:this._getInfoHours(),disabled:this.disabled,index:this._getHoursIndex(hoursAmpm.hours)}),this._minuteControl=new _Select._Select(this._minuteElement,{dataSource:info.minutes,disabled:this.disabled,index:this._getMinutesIndex(this.current)}),this._ampmControl=null,this._ampmElement&&(this._ampmControl=new _Select._Select(this._ampmElement,{dataSource:info.periods,disabled:this.disabled,index:hoursAmpm.ampm})),this._wireupEvents(),this._updateValues(),this._addAccessibilityAttributes()}},_getInfoHours:function(){return this._information.hours},_updateLayout:function(){this._domElement&&this._updateValues()},_updateValues:function(){if(this._hourControl){var hoursAmpm=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=hoursAmpm.ampm),this._hourControl.index=this._getHoursIndex(hoursAmpm.hours),this._minuteControl.index=this._getMinutesIndex(this.current)}},_updateDisplay:function(){var hoursAmpm=this._getHoursAmpm(this.current);this._ampmControl&&(this._ampmControl.index=hoursAmpm.ampm),this._hourControl&&(this._hourControl.index=this._getHoursIndex(hoursAmpm.hours),this._minuteControl.index=this._getMinutesIndex(this.current))},_wireupEvents:function(){var that=this,fixupHour=function(){var hour=that._hourControl.index;return that._ampmElement&&1===that._ampmControl.index&&12!==hour&&(hour+=12),hour},changed=function(){var hour=fixupHour();that._currentTime.setHours(hour),that._currentTime.setMinutes(that._minuteControl.index*that.minuteIncrement)};this._hourElement.addEventListener("change",changed,!1),this._minuteElement.addEventListener("change",changed,!1),this._ampmElement&&this._ampmElement.addEventListener("change",changed,!1)}},{_sentinelDate:function(){var current=new Date;return new Date(2011,6,15,current.getHours(),current.getMinutes())},_getInformationWinRT:function(clock,minuteIncrement,timePatterns){var newFormatter=function(pattern,defaultPattern){var dtf=_WinRT.Windows.Globalization.DateTimeFormatting;pattern=pattern?pattern:defaultPattern;var formatter=new dtf.DateTimeFormatter(pattern);return clock&&(formatter=dtf.DateTimeFormatter(pattern,formatter.languages,formatter.geographicRegion,formatter.calendar,clock)),formatter},glob=_WinRT.Windows.Globalization,calendar=new glob.Calendar;clock&&(calendar=new glob.Calendar(calendar.languages,calendar.getCalendarSystem(),clock)),calendar.setDateTime(TimePicker._sentinelDate());var computedClock=calendar.getClock(),numberOfHours=24;numberOfHours=calendar.numberOfHoursInThisPeriod;var periods=function(){var periodFormatter=newFormatter(timePatterns.period,DEFAULT_PERIOD_PATTERN);return{getLength:function(){return 2},getValue:function(index){var date=TimePicker._sentinelDate();if(0===index){date.setHours(1);var am=periodFormatter.format(date);return am}if(1===index){date.setHours(13);var pm=periodFormatter.format(date);return pm}return null}}}(),minutes=function(){var minuteFormatter=newFormatter(timePatterns.minute,DEFAULT_MINUTE_PATTERN),now=TimePicker._sentinelDate();return{getLength:function(){return 60/minuteIncrement},getValue:function(index){var display=index*minuteIncrement;return now.setMinutes(display),minuteFormatter.format(now)}}}(),hours=function(){var hourFormatter=newFormatter(timePatterns.hour,DEFAULT_HOUR_PATTERN),now=TimePicker._sentinelDate();return{getLength:function(){return numberOfHours},getValue:function(index){return now.setHours(index),hourFormatter.format(now)}}}(),hourMinuteFormatter=newFormatter("hour minute"),pattern=hourMinuteFormatter.patterns[0],order=["hour","minute"],indexes={period:pattern.indexOf("{period"),hour:pattern.indexOf("{hour"),minute:pattern.indexOf("{minute")};indexes.period>-1&&order.push("period");var DateTimeFormatter=_WinRT.Windows.Globalization.DateTimeFormatting.DateTimeFormatter,dtf=new DateTimeFormatter("month.full",_WinRT.Windows.Globalization.ApplicationLanguages.languages,"ZZ","GregorianCalendar","24HourClock"),pat=dtf.patterns[0],isRTL=8207===pat.charCodeAt(0);if(isRTL){var temp=indexes.hour;indexes.hour=indexes.minute,indexes.minute=temp}return order.sort(function(a,b){return indexes[a]<indexes[b]?-1:indexes[a]>indexes[b]?1:0}),{minutes:minutes,hours:hours,clock:computedClock,
periods:periods,order:order,forceLanguage:hourMinuteFormatter.resolvedLanguage,isRTL:isRTL}},_getInformationJS:function(clock,minuteIncrement){var hours=[12,1,2,3,4,5,6,7,8,9,10,11],minutes={};minutes.getLength=function(){return 60/minuteIncrement},minutes.getValue=function(index){var display=index*minuteIncrement;return display<10?"0"+display.toString():display.toString()};var order=["hour","minute","period"];return"24HourClock"===clock&&(hours=["00","01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23],order=["hour","minute"]),{minutes:minutes,hours:hours,clock:clock||"12HourClock",periods:["AM","PM"],order:order}}});return _WinRT.Windows.Globalization.DateTimeFormatting&&_WinRT.Windows.Globalization.Calendar&&_WinRT.Windows.Globalization.ApplicationLanguages?TimePicker.getInformation=TimePicker._getInformationWinRT:TimePicker.getInformation=TimePicker._getInformationJS,_Base.Class.mix(TimePicker,_Events.createEventProperties("change")),_Base.Class.mix(TimePicker,_Control.DOMEventMixin),TimePicker})})}),define("require-style!less/styles-backbutton",[],function(){}),define("require-style!less/colors-backbutton",[],function(){}),define("WinJS/Controls/BackButton",["exports","../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Resources","../Navigation","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/styles-backbutton","require-style!less/colors-backbutton"],function(exports,_Global,_Base,_ErrorFromName,_Resources,Navigation,_Control,_ElementUtilities,_Hoverable){"use strict";var Key=_ElementUtilities.Key,navigationBackButtonClass="win-navigation-backbutton",glyphClass="win-back",MOUSE_BACK_BUTTON=3,singleton=function(){function hookUpBackButtonGlobalEventHandlers(){_Global.addEventListener("keyup",backButtonGlobalKeyUpHandler,!1),_ElementUtilities._addEventListener(_Global,"pointerup",backButtonGlobalMSPointerUpHandler,!1)}function unHookBackButtonGlobalEventHandlers(){_Global.removeEventListener("keyup",backButtonGlobalKeyUpHandler,!1),_ElementUtilities._removeEventListener(_Global,"pointerup",backButtonGlobalMSPointerUpHandler,!1)}function backButtonGlobalKeyUpHandler(event){(event.keyCode===Key.leftArrow&&event.altKey&&!event.shiftKey&&!event.ctrlKey||event.keyCode===Key.browserBack)&&(Navigation.back(),event.preventDefault())}function backButtonGlobalMSPointerUpHandler(event){event.button===MOUSE_BACK_BUTTON&&Navigation.back()}var backButtonReferenceCount=0;return{addRef:function(){0===backButtonReferenceCount&&hookUpBackButtonGlobalEventHandlers(),backButtonReferenceCount++},release:function(){backButtonReferenceCount>0&&(backButtonReferenceCount--,0===backButtonReferenceCount&&unHookBackButtonGlobalEventHandlers())},getCount:function(){return backButtonReferenceCount}}}();_Base.Namespace._moduleDefine(exports,"WinJS.UI",{BackButton:_Base.Namespace._lazy(function(){var strings={get ariaLabel(){return _Resources._getWinJSString("ui/backbuttonarialabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}},BackButton=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.BackButton.DuplicateConstruction",strings.duplicateConstruction);this._element=element||_Global.document.createElement("button"),options=options||{},this._initializeButton(),this._disposed=!1,this._element.winControl=this,_Control.setOptions(this,options),this._buttonClickHandler=this._handleBackButtonClick.bind(this),this._element.addEventListener("click",this._buttonClickHandler,!1),this._navigatedHandler=this._handleNavigatedEvent.bind(this),Navigation.addEventListener("navigated",this._navigatedHandler,!1),singleton.addRef()},{element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,Navigation.removeEventListener("navigated",this._navigatedHandler,!1),singleton.release())},refresh:function(){Navigation.canGoBack?this._element.disabled=!1:this._element.disabled=!0},_initializeButton:function(){if("BUTTON"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.BackButton.BadButtonElement",strings.badButtonElement);_ElementUtilities.addClass(this._element,navigationBackButtonClass),_ElementUtilities.addClass(this._element,"win-disposable"),this._element.innerHTML='<span class="'+glyphClass+'"></span>',this.refresh(),this._element.setAttribute("aria-label",strings.ariaLabel),this._element.setAttribute("title",strings.ariaLabel),this._element.setAttribute("type","button")},_handleNavigatedEvent:function(){this.refresh()},_handleBackButtonClick:function(){Navigation.back()}});return BackButton._getReferenceCount=function(){return singleton.getCount()},_Base.Class.mix(BackButton,_Control.DOMEventMixin),BackButton})})}),define("require-style!less/styles-tooltip",[],function(){}),define("require-style!less/colors-tooltip",[],function(){}),define("WinJS/Controls/Tooltip",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Animations","../Animations/_TransitionAnimation","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","require-style!less/styles-tooltip","require-style!less/colors-tooltip"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_Events,Animations,_TransitionAnimation,_Control,_Dispose,_ElementUtilities,_Hoverable){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Tooltip:_Base.Namespace._lazy(function(){function isInvokeEvent(eventType,pointerType){return"pointerdown"===eventType?pointerType===PT_TOUCH:eventType in EVENTS_INVOKE}function isDismissEvent(eventType,pointerType){return"pointerdown"===eventType?pointerType!==PT_TOUCH:eventType in EVENTS_DISMISS}var lastCloseTime=0,Key=_ElementUtilities.Key,DEFAULT_PLACEMENT="top",DELAY_INITIAL_TOUCH_SHORT=_TransitionAnimation._animationTimeAdjustment(400),DELAY_INITIAL_TOUCH_LONG=_TransitionAnimation._animationTimeAdjustment(1200),DEFAULT_MOUSE_HOVER_TIME=_TransitionAnimation._animationTimeAdjustment(400),DEFAULT_MESSAGE_DURATION=_TransitionAnimation._animationTimeAdjustment(5e3),DELAY_RESHOW_NONINFOTIP_TOUCH=_TransitionAnimation._animationTimeAdjustment(0),DELAY_RESHOW_NONINFOTIP_NONTOUCH=_TransitionAnimation._animationTimeAdjustment(600),DELAY_RESHOW_INFOTIP_TOUCH=_TransitionAnimation._animationTimeAdjustment(400),DELAY_RESHOW_INFOTIP_NONTOUCH=_TransitionAnimation._animationTimeAdjustment(600),RESHOW_THRESHOLD=_TransitionAnimation._animationTimeAdjustment(200),HIDE_DELAY_MAX=_TransitionAnimation._animationTimeAdjustment(3e5),OFFSET_KEYBOARD=12,OFFSET_MOUSE=20,OFFSET_TOUCH=45,OFFSET_PROGRAMMATIC_TOUCH=20,OFFSET_PROGRAMMATIC_NONTOUCH=12,SAFETY_NET_GAP=1,PT_MOUSE=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",EVENTS_INVOKE={keyup:"",pointerover:"",pointerdown:""},EVENTS_UPDATE={pointermove:""},EVENTS_DISMISS={pointerdown:"",keydown:"",focusout:"",pointerout:"",pointercancel:"",pointerup:""},EVENTS_BY_CHILD={pointerover:"",pointerout:""},msTooltip="win-tooltip",msTooltipPhantom="win-tooltip-phantom",mouseHoverTime=DEFAULT_MOUSE_HOVER_TIME,nonInfoTooltipNonTouchShowDelay=2*mouseHoverTime,infoTooltipNonTouchShowDelay=2.5*mouseHoverTime,messageDuration=DEFAULT_MESSAGE_DURATION,isLeftHanded=!1,hasInitWinRTSettings=!1,createEvent=_Events._createEventProperty;return _Base.Class.define(function(anchorElement,options){anchorElement=anchorElement||_Global.document.createElement("div");var tooltip=_ElementUtilities.data(anchorElement).tooltip;if(tooltip)return tooltip;if(!hasInitWinRTSettings&&_WinRT.Windows.UI.ViewManagement.UISettings){var uiSettings=new _WinRT.Windows.UI.ViewManagement.UISettings;mouseHoverTime=_TransitionAnimation._animationTimeAdjustment(uiSettings.mouseHoverTime),nonInfoTooltipNonTouchShowDelay=2*mouseHoverTime,infoTooltipNonTouchShowDelay=2.5*mouseHoverTime,messageDuration=_TransitionAnimation._animationTimeAdjustment(1e3*uiSettings.messageDuration);var handedness=uiSettings.handPreference;isLeftHanded=handedness===_WinRT.Windows.UI.ViewManagement.HandPreference.leftHanded}hasInitWinRTSettings=!0,this._disposed=!1,this._placement=DEFAULT_PLACEMENT,this._infotip=!1,this._innerHTML=null,this._contentElement=null,this._extraClass=null,this._lastContentType="html",this._anchorElement=anchorElement,this._domElement=null,this._phantomDiv=null,this._triggerByOpen=!1,this._eventListenerRemoveStack=[],this._lastKeyOrBlurEvent=null,this._currentKeyOrBlurEvent=null,anchorElement.winControl=this,_ElementUtilities.addClass(anchorElement,"win-disposable"),anchorElement.title&&(this._innerHTML=this._anchorElement.title,this._anchorElement.removeAttribute("title")),_Control.setOptions(this,options),this._events(),_ElementUtilities.data(anchorElement).tooltip=this},{innerHTML:{get:function(){return this._innerHTML},set:function(value){if(this._innerHTML=value,this._domElement){if(!this._innerHTML||""===this._innerHTML)return void this._onDismiss();this._domElement.innerHTML=value,this._position()}this._lastContentType="html"}},element:{get:function(){return this._anchorElement}},contentElement:{get:function(){return this._contentElement},set:function(value){if(this._contentElement=value,this._domElement){if(!this._contentElement)return void this._onDismiss();this._domElement.innerHTML="",this._domElement.appendChild(this._contentElement),this._position()}this._lastContentType="element"}},placement:{get:function(){return this._placement},set:function(value){"top"!==value&&"bottom"!==value&&"left"!==value&&"right"!==value&&(value=DEFAULT_PLACEMENT),this._placement=value,this._domElement&&this._position()}},infotip:{get:function(){return this._infotip},set:function(value){this._infotip=!!value}},extraClass:{get:function(){return this._extraClass},set:function(value){this._extraClass=value}},onbeforeopen:createEvent("beforeopen"),onopened:createEvent("opened"),onbeforeclose:createEvent("beforeclose"),onclosed:createEvent("closed"),dispose:function(){if(!this._disposed){this._disposed=!0,_Dispose.disposeSubTree(this.element);for(var i=0,len=this._eventListenerRemoveStack.length;i<len;i++)this._eventListenerRemoveStack[i]();this._onDismiss();var data=_ElementUtilities.data(this._anchorElement);data&&delete data.tooltip}},addEventListener:function(eventName,eventCallBack,capture){if(this._anchorElement){this._anchorElement.addEventListener(eventName,eventCallBack,capture);var that=this;this._eventListenerRemoveStack.push(function(){that._anchorElement.removeEventListener(eventName,eventCallBack,capture)})}},removeEventListener:function(eventName,eventCallBack,capture){this._anchorElement&&this._anchorElement.removeEventListener(eventName,eventCallBack,capture)},open:function(type){switch(this._triggerByOpen=!0,"touch"!==type&&"mouseover"!==type&&"mousedown"!==type&&"keyboard"!==type&&(type="default"),type){case"touch":this._onInvoke("touch","never");break;case"mouseover":this._onInvoke("mouse","auto");break;case"keyboard":this._onInvoke("keyboard","auto");break;case"mousedown":case"default":this._onInvoke("nodelay","never")}},close:function(){this._onDismiss()},_cleanUpDOM:function(){this._domElement&&(_Dispose.disposeSubTree(this._domElement),_Global.document.body.removeChild(this._domElement),this._domElement=null,_Global.document.body.removeChild(this._phantomDiv),this._phantomDiv=null)},_createTooltipDOM:function(){this._cleanUpDOM(),this._domElement=_Global.document.createElement("div");var id=_ElementUtilities._uniqueID(this._domElement);this._domElement.setAttribute("id",id);var computedStyle=_ElementUtilities._getComputedStyle(this._anchorElement,null),elemStyle=this._domElement.style;elemStyle.direction=computedStyle.direction,elemStyle.writingMode=computedStyle["writing-mode"],this._domElement.setAttribute("tabindex",-1),this._domElement.setAttribute("role","tooltip"),this._anchorElement.setAttribute("aria-describedby",id),"element"===this._lastContentType?this._domElement.appendChild(this._contentElement):this._domElement.innerHTML=this._innerHTML,_Global.document.body.appendChild(this._domElement),_ElementUtilities.addClass(this._domElement,msTooltip),this._extraClass&&_ElementUtilities.addClass(this._domElement,this._extraClass),this._phantomDiv=_Global.document.createElement("div"),this._phantomDiv.setAttribute("tabindex",-1),_Global.document.body.appendChild(this._phantomDiv),_ElementUtilities.addClass(this._phantomDiv,msTooltipPhantom);var zIndex=_ElementUtilities._getComputedStyle(this._domElement,null).zIndex+1;this._phantomDiv.style.zIndex=zIndex},_raiseEvent:function(type,eventProperties){if(this._anchorElement){var customEvent=_Global.document.createEvent("CustomEvent");customEvent.initCustomEvent(type,!1,!1,eventProperties),this._anchorElement.dispatchEvent(customEvent)}},_captureLastKeyBlurOrPointerOverEvent:function(event){switch(this._lastKeyOrBlurEvent=this._currentKeyOrBlurEvent,event.type){case"keyup":event.keyCode===Key.shift?this._currentKeyOrBlurEvent=null:this._currentKeyOrBlurEvent="keyboard";break;case"focusout":this._currentKeyOrBlurEvent=null}},_registerEventToListener:function(element,eventType){var that=this,handler=function(event){that._captureLastKeyBlurOrPointerOverEvent(event),that._handleEvent(event)};_ElementUtilities._addEventListener(element,eventType,handler,!1),this._eventListenerRemoveStack.push(function(){_ElementUtilities._removeEventListener(element,eventType,handler,!1)})},_events:function(){for(var eventType in EVENTS_INVOKE)this._registerEventToListener(this._anchorElement,eventType);for(var eventType in EVENTS_UPDATE)this._registerEventToListener(this._anchorElement,eventType);for(eventType in EVENTS_DISMISS)this._registerEventToListener(this._anchorElement,eventType);this._registerEventToListener(this._anchorElement,"contextmenu"),this._registerEventToListener(this._anchorElement,"MSHoldVisual")},_handleEvent:function(event){var eventType=event._normalizedType||event.type;if(!this._triggerByOpen){if(eventType in EVENTS_BY_CHILD&&_ElementUtilities.eventWithinElement(this._anchorElement,event))return;if(isInvokeEvent(eventType,event.pointerType))if(event.pointerType===PT_TOUCH)this._isShown||(this._showTrigger="touch"),this._onInvoke("touch","never",event);else{if(this._skipMouseOver&&event.pointerType===PT_MOUSE&&"pointerover"===eventType)return void(this._skipMouseOver=!1);var type="key"===eventType.substring(0,3)?"keyboard":"mouse";this._isShown||(this._showTrigger=type),this._onInvoke(type,"auto",event)}else if(eventType in EVENTS_UPDATE)this._contactPoint={x:event.clientX,y:event.clientY};else if(isDismissEvent(eventType,event.pointerType)){var eventTrigger;if(event.pointerType===PT_TOUCH){if("pointerup"===eventType){this._skipMouseOver=!0;var that=this;_BaseUtils._yieldForEvents(function(){that._skipMouseOver=!1})}eventTrigger="touch"}else eventTrigger="key"===eventType.substring(0,3)?"keyboard":"mouse";if("focusout"!==eventType&&eventTrigger!==this._showTrigger)return;this._onDismiss()}else"contextmenu"!==eventType&&"MSHoldVisual"!==eventType||event.preventDefault()}},_onShowAnimationEnd:function(){if(!this._shouldDismiss&&!this._disposed&&(this._raiseEvent("opened"),this._domElement&&"never"!==this._hideDelay)){var that=this,delay=this._infotip?Math.min(3*messageDuration,HIDE_DELAY_MAX):messageDuration;this._hideDelayTimer=this._setTimeout(function(){that._onDismiss()},delay)}},_onHideAnimationEnd:function(){_Global.document.body.removeEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._cleanUpDOM(),this._anchorElement&&this._anchorElement.removeAttribute("aria-describedby"),lastCloseTime=(new Date).getTime(),this._triggerByOpen=!1,this._disposed||this._raiseEvent("closed")},_decideOnDelay:function(type){var value;if(this._useAnimation=!0,"nodelay"===type)value=0,this._useAnimation=!1;else{var curTime=(new Date).getTime();curTime-lastCloseTime<=RESHOW_THRESHOLD?(value="touch"===type?this._infotip?DELAY_RESHOW_INFOTIP_TOUCH:DELAY_RESHOW_NONINFOTIP_TOUCH:this._infotip?DELAY_RESHOW_INFOTIP_NONTOUCH:DELAY_RESHOW_NONINFOTIP_NONTOUCH,this._useAnimation=!1):value="touch"===type?this._infotip?DELAY_INITIAL_TOUCH_LONG:DELAY_INITIAL_TOUCH_SHORT:this._infotip?infoTooltipNonTouchShowDelay:nonInfoTooltipNonTouchShowDelay}return value},_getAnchorPositionFromElementWindowCoord:function(){var rect=this._anchorElement.getBoundingClientRect();return{x:rect.left,y:rect.top,width:rect.width,height:rect.height}},_getAnchorPositionFromPointerWindowCoord:function(contactPoint){return{x:contactPoint.x,y:contactPoint.y,width:1,height:1}},_canPositionOnSide:function(placement,viewport,anchor,tip){var availWidth=0,availHeight=0;switch(placement){case"top":availWidth=tip.width+this._offset,availHeight=anchor.y;break;case"bottom":availWidth=tip.width+this._offset,availHeight=viewport.height-anchor.y-anchor.height;break;case"left":availWidth=anchor.x,availHeight=tip.height+this._offset;break;case"right":availWidth=viewport.width-anchor.x-anchor.width,availHeight=tip.height+this._offset}return availWidth>=tip.width+this._offset&&availHeight>=tip.height+this._offset},_positionOnSide:function(placement,viewport,anchor,tip){var left=0,top=0;switch(placement){case"top":case"bottom":left=anchor.x+anchor.width/2-tip.width/2,left=Math.min(Math.max(left,0),viewport.width-tip.width-SAFETY_NET_GAP),top="top"===placement?anchor.y-tip.height-this._offset:anchor.y+anchor.height+this._offset;break;case"left":case"right":top=anchor.y+anchor.height/2-tip.height/2,top=Math.min(Math.max(top,0),viewport.height-tip.height-SAFETY_NET_GAP),left="left"===placement?anchor.x-tip.width-this._offset:anchor.x+anchor.width+this._offset}this._domElement.style.left=left+"px",this._domElement.style.top=top+"px",this._phantomDiv.style.left=left+"px",this._phantomDiv.style.top=top+"px",this._phantomDiv.style.width=tip.width+"px",this._phantomDiv.style.height=tip.height+"px"},_position:function(contactType){var viewport={width:0,height:0},anchor={x:0,y:0,width:0,height:0},tip={width:0,height:0};viewport.width=_Global.document.documentElement.clientWidth,viewport.height=_Global.document.documentElement.clientHeight,"tb-rl"===_ElementUtilities._getComputedStyle(_Global.document.body,null)["writing-mode"]&&(viewport.width=_Global.document.documentElement.clientHeight,viewport.height=_Global.document.documentElement.clientWidth),anchor=!this._contactPoint||"touch"!==contactType&&"mouse"!==contactType?this._getAnchorPositionFromElementWindowCoord():this._getAnchorPositionFromPointerWindowCoord(this._contactPoint),tip.width=this._domElement.offsetWidth,tip.height=this._domElement.offsetHeight;var fallback_order={top:["top","bottom","left","right"],bottom:["bottom","top","left","right"],left:["left","right","top","bottom"],right:["right","left","top","bottom"]};isLeftHanded&&(fallback_order.top[2]="right",fallback_order.top[3]="left",fallback_order.bottom[2]="right",fallback_order.bottom[3]="left");for(var order=fallback_order[this._placement],length=order.length,i=0;i<length;i++)if(i===length-1||this._canPositionOnSide(order[i],viewport,anchor,tip)){this._positionOnSide(order[i],viewport,anchor,tip);break}return order[i]},_showTooltip:function(contactType){if(!this._shouldDismiss&&(this._isShown=!0,this._raiseEvent("beforeopen"),_Global.document.body.contains(this._anchorElement)&&!this._shouldDismiss)){if("element"===this._lastContentType){if(!this._contentElement)return void(this._isShown=!1)}else if(!this._innerHTML||""===this._innerHTML)return void(this._isShown=!1);var that=this;this._removeTooltip=function(event){for(var current=that._anchorElement;current;){if(event.target===current){_Global.document.body.removeEventListener("DOMNodeRemoved",that._removeTooltip,!1),that._cleanUpDOM();break}current=current.parentNode}},_Global.document.body.addEventListener("DOMNodeRemoved",this._removeTooltip,!1),this._createTooltipDOM(),this._position(contactType),this._useAnimation?Animations.fadeIn(this._domElement).then(this._onShowAnimationEnd.bind(this)):this._onShowAnimationEnd()}},_onInvoke:function(type,hide,event){if(this._shouldDismiss=!1,!this._isShown&&(!event||"keyup"!==event.type||"keyboard"!==this._lastKeyOrBlurEvent&&(this._lastKeyOrBlurEvent||event.keyCode===Key.tab))){this._hideDelay=hide,this._contactPoint=null,event?(this._contactPoint={x:event.clientX,y:event.clientY},"touch"===type?this._offset=OFFSET_TOUCH:"keyboard"===type?this._offset=OFFSET_KEYBOARD:this._offset=OFFSET_MOUSE):"touch"===type?this._offset=OFFSET_PROGRAMMATIC_TOUCH:this._offset=OFFSET_PROGRAMMATIC_NONTOUCH,this._clearTimeout(this._delayTimer),this._clearTimeout(this._hideDelayTimer);var delay=this._decideOnDelay(type);if(delay>0){var that=this;this._delayTimer=this._setTimeout(function(){that._showTooltip(type)},delay)}else this._showTooltip(type)}},_onDismiss:function(){this._shouldDismiss=!0,this._isShown&&(this._isShown=!1,this._showTrigger="mouse",this._domElement?(this._raiseEvent("beforeclose"),this._useAnimation?Animations.fadeOut(this._domElement).then(this._onHideAnimationEnd.bind(this)):this._onHideAnimationEnd()):(this._raiseEvent("beforeclose"),this._raiseEvent("closed")))},_setTimeout:function(callback,delay){return _Global.setTimeout(callback,delay)},_clearTimeout:function(id){_Global.clearTimeout(id)}},{_DELAY_INITIAL_TOUCH_SHORT:{get:function(){return DELAY_INITIAL_TOUCH_SHORT}},_DELAY_INITIAL_TOUCH_LONG:{get:function(){return DELAY_INITIAL_TOUCH_LONG}},_DEFAULT_MOUSE_HOVER_TIME:{get:function(){return DEFAULT_MOUSE_HOVER_TIME}},_DEFAULT_MESSAGE_DURATION:{get:function(){return DEFAULT_MESSAGE_DURATION}},_DELAY_RESHOW_NONINFOTIP_TOUCH:{get:function(){return DELAY_RESHOW_NONINFOTIP_TOUCH}},_DELAY_RESHOW_NONINFOTIP_NONTOUCH:{get:function(){return DELAY_RESHOW_NONINFOTIP_NONTOUCH}},_DELAY_RESHOW_INFOTIP_TOUCH:{get:function(){return DELAY_RESHOW_INFOTIP_TOUCH}},_DELAY_RESHOW_INFOTIP_NONTOUCH:{get:function(){return DELAY_RESHOW_INFOTIP_NONTOUCH}},_RESHOW_THRESHOLD:{get:function(){return RESHOW_THRESHOLD}},_HIDE_DELAY_MAX:{get:function(){return HIDE_DELAY_MAX}}})})})}),define("require-style!less/styles-rating",[],function(){}),define("require-style!less/colors-rating",[],function(){}),define("WinJS/Controls/Rating",["../Core/_Global","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../_Accents","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_SafeHtml","./Tooltip","require-style!less/styles-rating","require-style!less/colors-rating"],function(_Global,_Base,_ErrorFromName,_Events,_Resources,_Accents,_Control,_ElementUtilities,_Hoverable,_SafeHtml,Tooltip){"use strict";_Accents.createAccentRule(".win-rating .win-star.win-user.win-full, .win-rating .win-star.win-user.win-full.win-disabled",[{name:"color",value:_Accents.ColorTypes.accent}]),_Base.Namespace.define("WinJS.UI",{Rating:_Base.Namespace._lazy(function(){var createEvent=_Events._createEventProperty,strings={get averageRating(){return _Resources._getWinJSString("ui/averageRating").value},get clearYourRating(){return _Resources._getWinJSString("ui/clearYourRating").value},get tentativeRating(){return _Resources._getWinJSString("ui/tentativeRating").value},get tooltipStringsIsInvalid(){return"Invalid argument: tooltipStrings must be null or an array of strings."},get unrated(){return _Resources._getWinJSString("ui/unrated").value},get userRating(){return _Resources._getWinJSString("ui/userRating").value}},DEFAULT_MAX_RATING=5,DEFAULT_DISABLED=!1,CANCEL="cancel",CHANGE="change",PREVIEW_CHANGE="previewchange",MOUSE_LBUTTON=0,PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",PT_PEN=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",PT_MOUSE=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",hiddenAverageRatingCss="padding-left: 0px; padding-right: 0px; border-left: 0px; border-right: 0px; -ms-flex: none; -webkit-flex: none; flex: none; display: none",msRating="win-rating",msRatingEmpty="win-star win-empty",msRatingAverageEmpty="win-star win-average win-empty",msRatingAverageFull="win-star win-average win-full",msRatingUserEmpty="win-star win-user win-empty",msRatingUserFull="win-star win-user win-full",msRatingTentativeEmpty="win-star win-tentative win-empty",msRatingTentativeFull="win-star win-tentative win-full",msRatingDisabled="win-disabled",msAverage="win-average",msUser="win-user";return _Base.Class.define(function(element,options){this._disposed=!1,element=element||_Global.document.createElement("div"),options=options||{},this._element=element,_ElementUtilities.addClass(this._element,"win-disposable"),this._userRating=0,this._averageRating=0,this._disabled=DEFAULT_DISABLED,this._enableClear=!0,this._tooltipStrings=[],this._controlUpdateNeeded=!1,this._setControlSize(options.maxRating),options.tooltipStrings||this._updateTooltips(null),_Control.setOptions(this,options),this._controlUpdateNeeded=!0,this._forceLayout(),_ElementUtilities._addInsertedNotifier(this._element),element.winControl=this,this._events()},{maxRating:{get:function(){return this._maxRating},set:function(value){this._setControlSize(value),this._forceLayout()}},userRating:{get:function(){return this._userRating},set:function(value){this._userRating=Math.max(0,Math.min(Number(value)>>0,this._maxRating)),this._updateControl()}},averageRating:{get:function(){return this._averageRating},set:function(value){this._averageRating=Number(value)<1?0:Math.min(Number(value)||0,this._maxRating),this._averageRatingElement&&this._ensureAverageMSStarRating(),this._updateControl()}},disabled:{get:function(){return this._disabled},set:function(value){this._disabled=!!value,this._disabled&&this._clearTooltips(),this._updateTabIndex(),this._updateControl()}},enableClear:{get:function(){return this._enableClear},set:function(value){this._enableClear=!!value,this._setAriaValueMin(),this._updateControl()}},tooltipStrings:{get:function(){return this._tooltipStrings},set:function(value){if("object"!=typeof value)throw new _ErrorFromName("WinJS.UI.Rating.TooltipStringsIsInvalid",strings.tooltipStringsIsInvalid);this._updateTooltips(value),this._updateAccessibilityRestState()}},element:{get:function(){return this._element}},oncancel:createEvent(CANCEL),onchange:createEvent(CHANGE),onpreviewchange:createEvent(PREVIEW_CHANGE),dispose:function(){if(!this._disposed){this._disposed=!0;for(var i=0;i<this._toolTips.length;i++)this._toolTips[i].dispose();this._toolTips=null}},addEventListener:function(eventName,eventCallBack,capture){this._element.addEventListener(eventName,eventCallBack,capture)},removeEventListener:function(eventName,eventCallBack,capture){return this._element.removeEventListener(eventName,eventCallBack,capture)},_forceLayout:function(){if(this._controlUpdateNeeded){var updateNeeded=!1;this._updateControl=function(){updateNeeded=!0},this.userRating=this._userRating,this.averageRating=this._averageRating,this._lastEventWasChange=!1,this._lastEventWasCancel=!1,this._tentativeRating=-1,this._captured=!1,this._pointerDownFocus=!1,this._elements=[],this._toolTips=[],this._clearElement=null,this._averageRatingElement=null,this._elementWidth=null,this._elementPadding=null,this._elementBorder=null,this._floatingValue=0,this._createControl(),this._setAccessibilityProperties(),delete this._updateControl,updateNeeded&&this._updateControl()}},_hideAverageRating:function(){this._averageRatingHidden||(this._averageRatingHidden=!0,this._averageRatingElement.style.cssText=hiddenAverageRatingCss)},_createControl:function(){_ElementUtilities.addClass(this._element,msRating);var html="";this._averageRatingHidden=!0;for(var i=0;i<=this._maxRating;i++)html=i===this._maxRating?html+"<div class='"+msRatingAverageFull+"' style='"+hiddenAverageRatingCss+"'></div>":html+"<div class='"+msRatingUserEmpty+"'></div>";_SafeHtml.setInnerHTMLUnsafe(this._element,html);for(var oneStar=this._element.firstElementChild,i=0;oneStar;)this._elements[i]=oneStar,i<this._maxRating&&(_ElementUtilities.data(oneStar).msStarRating=i+1),oneStar=oneStar.nextElementSibling,i++;this._averageRatingElement=this._elements[this._maxRating],this._ensureAverageMSStarRating(),this._updateTabIndex()},_setAriaValueMin:function(){this._element.setAttribute("aria-valuemin",this._enableClear?0:1)},_setAccessibilityProperties:function(){this._element.setAttribute("role","slider"),this._element.setAttribute("aria-valuemax",this._maxRating),this._setAriaValueMin(),this._updateAccessibilityRestState()},_getText:function(number){var string=this._tooltipStrings[number];if(string){var tempDiv=_Global.document.createElement("div");return tempDiv.innerHTML=string,tempDiv.textContent}return number===this._maxRating?strings.clearYourRating:number+1},_updateAccessibilityRestState:function(){var element=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),element.setAttribute("aria-readOnly",this._disabled),0!==this._userRating?(element.setAttribute("aria-valuenow",this._userRating),element.setAttribute("aria-label",strings.userRating),element.setAttribute("aria-valuetext",this._getText(this._userRating-1))):0!==this._averageRating?(element.setAttribute("aria-valuenow",this._averageRating),element.setAttribute("aria-label",strings.averageRating),element.setAttribute("aria-valuetext",this._averageRating)):(element.setAttribute("aria-valuenow",strings.unrated),element.setAttribute("aria-label",strings.userRating),element.setAttribute("aria-valuetext",strings.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_updateAccessibilityHoverState:function(){var element=this._element;this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.disconnect(),element.setAttribute("aria-readOnly",this._disabled),this._tentativeRating>0?(element.setAttribute("aria-label",strings.tentativeRating),element.setAttribute("aria-valuenow",this._tentativeRating),element.setAttribute("aria-valuetext",this._getText(this._tentativeRating-1))):0===this._tentativeRating?(element.setAttribute("aria-valuenow",strings.unrated),element.setAttribute("aria-label",strings.tentativeRating),element.setAttribute("aria-valuetext",this._getText(this._maxRating))):(element.setAttribute("aria-valuenow",strings.unrated),element.setAttribute("aria-label",strings.tentativeRating),element.setAttribute("aria-valuetext",strings.unrated)),this._ariaValueNowMutationObserver&&this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_ensureTooltips:function(){if(!this.disabled&&0===this._toolTips.length)for(var i=0;i<this._maxRating;i++)this._toolTips[i]=new Tooltip.Tooltip(this._elements[i])},_decrementRating:function(){this._closeTooltip();var firePreviewChange=!0;this._tentativeRating<=0?firePreviewChange=!1:(this._tentativeRating>0?this._tentativeRating--:this._tentativeRating===-1&&(0!==this._userRating&&this._userRating>0?this._tentativeRating=this._userRating-1:this._tentativeRating=0),0!==this._tentativeRating||this._enableClear||(this._tentativeRating=1,firePreviewChange=!1)),this._showTentativeRating(firePreviewChange,"keyboard")},_events:function(){function ratingHandler(eventName){return{name:eventName,lowerCaseName:eventName.toLowerCase(),handler:function(event){var fn=that["_on"+eventName];fn&&fn.apply(that,[event])}}}var i,that=this,eventsRegisteredInLowerCase=[ratingHandler("KeyDown"),ratingHandler("FocusOut"),ratingHandler("FocusIn"),ratingHandler("PointerCancel"),ratingHandler("PointerDown"),ratingHandler("PointerMove"),ratingHandler("PointerOver"),ratingHandler("PointerUp"),ratingHandler("PointerOut")],events=[ratingHandler("WinJSNodeInserted")];
for(i=0;i<eventsRegisteredInLowerCase.length;++i)_ElementUtilities._addEventListener(this._element,eventsRegisteredInLowerCase[i].lowerCaseName,eventsRegisteredInLowerCase[i].handler,!1);for(i=0;i<events.length;++i)this._element.addEventListener(events[i].name,events[i].handler,!1);this._ariaValueNowMutationObserver=new _ElementUtilities._MutationObserver(this._ariaValueNowChanged.bind(this)),this._ariaValueNowMutationObserver.observe(this._element,{attributes:!0,attributeFilter:["aria-valuenow"]})},_onWinJSNodeInserted:function(){this._recalculateStarProperties(),this._updateControl()},_recalculateStarProperties:function(){var j=0;1===this._averageRating&&(j=1);var style=_ElementUtilities._getComputedStyle(this._elements[j]);this._elementWidth=style.width,"rtl"===_ElementUtilities._getComputedStyle(this._element).direction?(this._elementPadding=style.paddingRight,this._elementBorder=style.borderRight):(this._elementPadding=style.paddingLeft,this._elementBorder=style.borderLeft)},_hideAverageStar:function(){0!==this._averageRating&&this._resetAverageStar(!1)},_incrementRating:function(){this._closeTooltip();var firePreviewChange=!0;(this._tentativeRating<0||this._tentativeRating>=this._maxRating)&&(firePreviewChange=!1),this._tentativeRating!==-1?this._tentativeRating<this._maxRating&&this._tentativeRating++:0!==this._userRating?this._userRating<this._maxRating?this._tentativeRating=this._userRating+1:this._tentativeRating=this._maxRating:this._tentativeRating=1,this._showTentativeRating(firePreviewChange,"keyboard")},_ariaValueNowChanged:function(){if(!this._disabled){var attrNode=this._element.getAttributeNode("aria-valuenow");if(null!==attrNode){var value=Number(attrNode.nodeValue);this.userRating!==value&&(this.userRating=value,this._tentativeRating=this._userRating,this._raiseEvent(CHANGE,this._userRating))}}},_onPointerCancel:function(){this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(CANCEL,null),this._captured=!1},_onPointerDown:function(eventObject){eventObject.pointerType===PT_MOUSE&&eventObject.button!==MOUSE_LBUTTON||this._captured||(this._pointerDownAt={x:eventObject.clientX,y:eventObject.clientY},this._pointerDownFocus=!0,this._disabled||(_ElementUtilities._setPointerCapture(this._element,eventObject.pointerId),this._captured=!0,eventObject.pointerType===PT_TOUCH?(this._tentativeRating=_ElementUtilities.data(eventObject.target).msStarRating||0,this._setStarClasses(msRatingTentativeFull,this._tentativeRating,msRatingTentativeEmpty),this._hideAverageStar(),this._updateAccessibilityHoverState(),this._openTooltip("touch"),this._raiseEvent(PREVIEW_CHANGE,this._tentativeRating)):this._openTooltip("mousedown")))},_onCapturedPointerMove:function(eventObject,tooltipType){var star,pointerAt=this._pointerDownAt||{x:eventObject.clientX,y:eventObject.clientY},hit=_ElementUtilities._elementsFromPoint(eventObject.clientX,pointerAt.y);if(hit)for(var i=0,len=hit.length;i<len;i++){var item=hit[i];if("tooltip"===item.getAttribute("role"))return;if(_ElementUtilities.hasClass(item,"win-star")){star=item;break}}var starNum;if(star&&star.parentElement===this._element)starNum=_ElementUtilities.data(star).msStarRating||0;else{var left=0,right=this.maxRating;"rtl"===_ElementUtilities._getComputedStyle(this._element).direction&&(left=right,right=0),starNum=eventObject.clientX<pointerAt.x?left:right}var firePreviewChange=!1,newTentativeRating=Math.min(Math.ceil(starNum),this._maxRating);0!==newTentativeRating||this._enableClear||(newTentativeRating=1),newTentativeRating!==this._tentativeRating&&(this._closeTooltip(),firePreviewChange=!0),this._tentativeRating=newTentativeRating,this._showTentativeRating(firePreviewChange,tooltipType),eventObject.preventDefault()},_onPointerMove:function(eventObject){this._captured&&(eventObject.pointerType===PT_TOUCH?this._onCapturedPointerMove(eventObject,"touch"):this._onCapturedPointerMove(eventObject,"mousedown"))},_onPointerOver:function(eventObject){this._disabled||eventObject.pointerType!==PT_PEN&&eventObject.pointerType!==PT_MOUSE||this._onCapturedPointerMove(eventObject,"mouseover")},_onPointerUp:function(eventObject){this._captured&&(_ElementUtilities._releasePointerCapture(this._element,eventObject.pointerId),this._captured=!1,this._onUserRatingChanged()),this._pointerDownAt=null},_onFocusOut:function(){this._captured||(this._onUserRatingChanged(),this._lastEventWasChange||this._lastEventWasCancel||this._raiseEvent(CANCEL,null))},_onFocusIn:function(){if(!this._pointerDownFocus){if(!this._disabled){if(0===this._userRating)for(var i=0;i<this._maxRating;i++)this._elements[i].className=msRatingTentativeEmpty;this._hideAverageStar()}0!==this._userRating?this._raiseEvent(PREVIEW_CHANGE,this._userRating):this._raiseEvent(PREVIEW_CHANGE,0),this._tentativeRating=this._userRating}this._pointerDownFocus=!1},_onKeyDown:function(eventObject){var Key=_ElementUtilities.Key,keyCode=eventObject.keyCode,rtlString=_ElementUtilities._getComputedStyle(this._element).direction,handled=!0;switch(keyCode){case Key.enter:this._onUserRatingChanged();break;case Key.tab:this._onUserRatingChanged(),handled=!1;break;case Key.escape:this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(CANCEL,null);break;case Key.leftArrow:"rtl"===rtlString&&this._tentativeRating<this.maxRating?this._incrementRating():"rtl"!==rtlString&&this._tentativeRating>0?this._decrementRating():handled=!1;break;case Key.upArrow:this._tentativeRating<this.maxRating?this._incrementRating():handled=!1;break;case Key.rightArrow:"rtl"===rtlString&&this._tentativeRating>0?this._decrementRating():"rtl"!==rtlString&&this._tentativeRating<this.maxRating?this._incrementRating():handled=!1;break;case Key.downArrow:this._tentativeRating>0?this._decrementRating():handled=!1;break;default:var number=0;if(keyCode>=Key.num0&&keyCode<=Key.num9?number=Key.num0:keyCode>=Key.numPad0&&keyCode<=Key.numPad9&&(number=Key.numPad0),number>0){var firePreviewChange=!1,newTentativeRating=Math.min(keyCode-number,this._maxRating);0!==newTentativeRating||this._enableClear||(newTentativeRating=1),newTentativeRating!==this._tentativeRating&&(this._closeTooltip(),firePreviewChange=!0),this._tentativeRating=newTentativeRating,this._showTentativeRating(firePreviewChange,"keyboard")}else handled=!1}handled&&(eventObject.stopPropagation(),eventObject.preventDefault())},_onPointerOut:function(eventObject){this._captured||_ElementUtilities.eventWithinElement(this._element,eventObject)||(this._showCurrentRating(),this._lastEventWasChange||this._raiseEvent(CANCEL,null))},_onUserRatingChanged:function(){this._disabled||(this._closeTooltip(),this._userRating===this._tentativeRating||this._lastEventWasCancel||this._lastEventWasChange?this._updateControl():(this.userRating=this._tentativeRating,this._raiseEvent(CHANGE,this._userRating)))},_raiseEvent:function(eventName,tentativeRating){if(!this._disabled&&(this._lastEventWasChange=eventName===CHANGE,this._lastEventWasCancel=eventName===CANCEL,_Global.document.createEvent)){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(eventName,!1,!1,{tentativeRating:tentativeRating}),this._element.dispatchEvent(event)}},_resetNextElement:function(prevState){if(null!==this._averageRatingElement.nextSibling){_ElementUtilities._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1,shrink:1});var style=this._averageRatingElement.nextSibling.style,direction=_ElementUtilities._getComputedStyle(this._element).direction;prevState&&(direction="rtl"===direction?"ltr":"rtl"),"rtl"===direction?(style.paddingRight=this._elementPadding,style.borderRight=this._elementBorder,style.direction="rtl"):(style.paddingLeft=this._elementPadding,style.borderLeft=this._elementBorder,style.direction="ltr"),style.backgroundPosition="left",style.backgroundSize="100% 100%",style.width=this._resizeStringValue(this._elementWidth,1,style.width)}},_resetAverageStar:function(prevState){this._resetNextElement(prevState),this._hideAverageRating()},_resizeStringValue:function(string,factor,curString){var number=parseFloat(string);if(isNaN(number))return null!==curString?curString:string;var unit=string.substring(number.toString(10).length);return number*=factor,number+unit},_setControlSize:function(value){var maxRating=(Number(value)||DEFAULT_MAX_RATING)>>0;this._maxRating=maxRating>0?maxRating:DEFAULT_MAX_RATING},_updateTooltips:function(value){var i,max=0;if(null!==value)for(max=value.length<=this._maxRating+1?value.length:this._maxRating+1,i=0;i<max;i++)this._tooltipStrings[i]=value[i];else{for(i=0;i<this._maxRating;i++)this._tooltipStrings[i]=i+1;this._tooltipStrings[this._maxRating]=strings.clearYourRating}},_updateTabIndex:function(){this._element.tabIndex=this._disabled?"-1":"0"},_setStarClasses:function(classNameBeforeThreshold,threshold,classNameAfterThreshold){for(var i=0;i<this._maxRating;i++)i<threshold?this._elements[i].className=classNameBeforeThreshold:this._elements[i].className=classNameAfterThreshold},_updateAverageStar:function(){var style=this._averageRatingElement.style,nextStyle=this._averageRatingElement.nextSibling.style;"rtl"===_ElementUtilities._getComputedStyle(this._element).direction?(style.backgroundPosition="right",style.paddingRight=this._elementPadding,style.borderRight=this._elementBorder,nextStyle.paddingRight="0px",nextStyle.borderRight="0px",nextStyle.direction="ltr"):(style.backgroundPosition="left",nextStyle.backgroundPosition="right",style.paddingLeft=this._elementPadding,style.borderLeft=this._elementBorder,nextStyle.paddingLeft="0px",nextStyle.borderLeft="0px",nextStyle.direction="rtl"),_ElementUtilities._setFlexStyle(this._averageRatingElement,{grow:this._floatingValue,shrink:this._floatingValue}),style.width=this._resizeStringValue(this._elementWidth,this._floatingValue,style.width),style.backgroundSize=100/this._floatingValue+"% 100%",style.display=_ElementUtilities._getComputedStyle(this._averageRatingElement.nextSibling).display,this._averageRatingHidden=!1,_ElementUtilities._setFlexStyle(this._averageRatingElement.nextSibling,{grow:1-this._floatingValue,shrink:1-this._floatingValue}),nextStyle.width=this._resizeStringValue(this._elementWidth,1-this._floatingValue,nextStyle.width),nextStyle.backgroundSize=100/(1-this._floatingValue)+"% 100%"},_showCurrentRating:function(){this._closeTooltip(),this._tentativeRating=-1,this._disabled||this._updateControl(),this._updateAccessibilityRestState()},_showTentativeRating:function(firePreviewChange,tooltipType){!this._disabled&&this._tentativeRating>=0&&(this._setStarClasses(msRatingTentativeFull,this._tentativeRating,msRatingTentativeEmpty),this._hideAverageStar()),this._updateAccessibilityHoverState(),firePreviewChange&&(this._openTooltip(tooltipType),this._raiseEvent(PREVIEW_CHANGE,this._tentativeRating))},_openTooltip:function(tooltipType){if(!this.disabled)if(this._ensureTooltips(),this._tentativeRating>0)this._toolTips[this._tentativeRating-1].innerHTML=this._tooltipStrings[this._tentativeRating-1],this._toolTips[this._tentativeRating-1].open(tooltipType);else if(0===this._tentativeRating){this._clearElement=_Global.document.createElement("div");var distance=this._elements[0].offsetWidth+parseInt(this._elementPadding,10);"ltr"===_ElementUtilities._getComputedStyle(this._element).direction&&(distance*=-1),this._clearElement.style.cssText="visiblity:hidden; position:absolute; width:0px; height:100%; left:"+distance+"px; top:0px;",this._elements[0].appendChild(this._clearElement),this._toolTips[this._maxRating]=new Tooltip.Tooltip(this._clearElement),this._toolTips[this._maxRating].innerHTML=this._tooltipStrings[this._maxRating],this._toolTips[this._maxRating].open(tooltipType)}},_closeTooltip:function(){0!==this._toolTips.length&&(this._tentativeRating>0?this._toolTips[this._tentativeRating-1].close():0===this._tentativeRating&&null!==this._clearElement&&(this._toolTips[this._maxRating].close(),this._elements[0].removeChild(this._clearElement),this._clearElement=null))},_clearTooltips:function(){if(this._toolTips&&0!==this._toolTips.length)for(var i=0;i<this._maxRating;i++)this._toolTips[i].innerHTML=null},_appendClass:function(classNameToBeAdded){for(var i=0;i<=this._maxRating;i++)_ElementUtilities.addClass(this._elements[i],classNameToBeAdded)},_setClasses:function(classNameBeforeThreshold,threshold,classNameAfterThreshold){for(var i=0;i<this._maxRating;i++)i<threshold?this._elements[i].className=classNameBeforeThreshold:this._elements[i].className=classNameAfterThreshold},_ensureAverageMSStarRating:function(){_ElementUtilities.data(this._averageRatingElement).msStarRating=Math.ceil(this._averageRating)},_updateControl:function(){if(this._controlUpdateNeeded){if(0!==this._averageRating&&0===this._userRating&&this._averageRating>=1&&this._averageRating<=this._maxRating){this._setClasses(msRatingAverageFull,this._averageRating-1,msRatingAverageEmpty),this._averageRatingElement.className=msRatingAverageFull;for(var i=0;i<this._maxRating;i++)if(i<this._averageRating&&i+1>=this._averageRating){this._resetNextElement(!1),this._element.insertBefore(this._averageRatingElement,this._elements[i]),this._floatingValue=this._averageRating-i;var elementStyle=_ElementUtilities._getComputedStyle(this._elements[i]);this._elementWidth=elementStyle.width,"rtl"===_ElementUtilities._getComputedStyle(this._element).direction?(this._elementPadding=elementStyle.paddingRight,this._elementBorder=elementStyle.borderRight):(this._elementPadding=elementStyle.paddingLeft,this._elementBorder=elementStyle.borderLeft),this._updateAverageStar()}}0!==this._userRating&&this._userRating>=1&&this._userRating<=this._maxRating&&(this._setClasses(msRatingUserFull,this._userRating,msRatingUserEmpty),this._resetAverageStar(!1)),0===this._userRating&&0===this._averageRating&&(this._setClasses(msRatingEmpty,this._maxRating),this._resetAverageStar(!1)),this.disabled&&this._appendClass(msRatingDisabled),0!==this._averageRating&&0===this._userRating?this._appendClass(msAverage):this._appendClass(msUser),this._updateAccessibilityRestState()}}})})})}),define("require-style!less/styles-toggleswitch",[],function(){}),define("require-style!less/colors-toggleswitch",[],function(){}),define("WinJS/Controls/ToggleSwitch",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_Resources","../_Accents","../Utilities/_Control","../Utilities/_ElementUtilities","require-style!less/styles-toggleswitch","require-style!less/colors-toggleswitch"],function(_Global,_Base,_BaseUtils,_Events,_Resources,_Accents,_Control,_ElementUtilities){"use strict";_Accents.createAccentRule(".win-toggleswitch-on .win-toggleswitch-track",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule("html.win-hoverable .win-toggleswitch-on:not(.win-toggleswitch-disabled):not(.win-toggleswitch-pressed) .win-toggleswitch-clickregion:hover .win-toggleswitch-track",[{name:"background-color",value:_Accents.ColorTypes.listSelectPress}]),_Base.Namespace.define("WinJS.UI",{ToggleSwitch:_Base.Namespace._lazy(function(){var classContainer="win-toggleswitch",classHeader="win-toggleswitch-header",classClick="win-toggleswitch-clickregion",classTrack="win-toggleswitch-track",classThumb="win-toggleswitch-thumb",classValues="win-toggleswitch-values",classValue="win-toggleswitch-value",classValueOn="win-toggleswitch-value-on",classValueOff="win-toggleswitch-value-off",classDescription="win-toggleswitch-description",classOn="win-toggleswitch-on",classOff="win-toggleswitch-off",classDisabled="win-toggleswitch-disabled",classEnabled="win-toggleswitch-enabled",classDragging="win-toggleswitch-dragging",classPressed="win-toggleswitch-pressed",strings={get on(){return _Resources._getWinJSString("ui/on").value},get off(){return _Resources._getWinJSString("ui/off").value}},Toggle=_Base.Class.define(function(element,options){element=element||_Global.document.createElement("div"),this._domElement=element,_ElementUtilities.addClass(this._domElement,classContainer),this._domElement.innerHTML=['<div class="'+classHeader+'"></div>','<div class="'+classClick+'">','   <div class="'+classTrack+'">','       <div class="'+classThumb+'"></div>',"   </div>",'   <div class="'+classValues+'">','      <div class="'+classValue+" "+classValueOn+'"></div>','      <div class="'+classValue+" "+classValueOff+'"></div>',"   </div>","</div>",'<div class="'+classDescription+'"></div>'].join("\n"),this._headerElement=this._domElement.firstElementChild,this._clickElement=this._headerElement.nextElementSibling,this._trackElement=this._clickElement.firstElementChild,this._thumbElement=this._trackElement.firstElementChild,this._labelsElement=this._trackElement.nextElementSibling,this._labelOnElement=this._labelsElement.firstElementChild,this._labelOffElement=this._labelOnElement.nextElementSibling,this._descriptionElement=this._clickElement.nextElementSibling,this._headerElement.setAttribute("aria-hidden",!0),this._labelsElement.setAttribute("aria-hidden",!0),this._headerElement.setAttribute("id",_ElementUtilities._uniqueID(this._headerElement)),this._domElement.setAttribute("aria-labelledby",this._headerElement.id),this._domElement.setAttribute("role","checkbox"),this._domElement.winControl=this,_ElementUtilities.addClass(this._domElement,"win-disposable"),this._domElement.addEventListener("keydown",this._keyDownHandler.bind(this)),_ElementUtilities._addEventListener(this._clickElement,"pointerdown",this._pointerDownHandler.bind(this)),_ElementUtilities._addEventListener(this._clickElement,"pointercancel",this._pointerCancelHandler.bind(this)),this._boundPointerMove=this._pointerMoveHandler.bind(this),this._boundPointerUp=this._pointerUpHandler.bind(this),this._mutationObserver=new _ElementUtilities._MutationObserver(this._ariaChangedHandler.bind(this)),this._mutationObserver.observe(this._domElement,{attributes:!0,attributeFilter:["aria-checked"]}),this._dragX=0,this._dragging=!1,this.checked=!1,this.disabled=!1,this.labelOn=strings.on,this.labelOff=strings.off,_Control.setOptions(this,options)},{element:{get:function(){return this._domElement}},checked:{get:function(){return this._checked},set:function(value){value=!!value,value!==this.checked&&(this._checked=value,this._domElement.setAttribute("aria-checked",value),value?(_ElementUtilities.addClass(this._domElement,classOn),_ElementUtilities.removeClass(this._domElement,classOff)):(_ElementUtilities.addClass(this._domElement,classOff),_ElementUtilities.removeClass(this._domElement,classOn)),this.dispatchEvent("change"))}},disabled:{get:function(){return this._disabled},set:function(value){value=!!value,value!==this._disabled&&(value?(_ElementUtilities.addClass(this._domElement,classDisabled),_ElementUtilities.removeClass(this._domElement,classEnabled)):(_ElementUtilities.removeClass(this._domElement,classDisabled),_ElementUtilities.addClass(this._domElement,classEnabled)),this._disabled=value,this._domElement.setAttribute("aria-disabled",value),this._domElement.setAttribute("tabIndex",value?-1:0))}},labelOn:{get:function(){return this._labelOnElement.innerHTML},set:function(value){this._labelOnElement.innerHTML=value}},labelOff:{get:function(){return this._labelOffElement.innerHTML},set:function(value){this._labelOffElement.innerHTML=value}},title:{get:function(){return this._headerElement.innerHTML},set:function(value){this._headerElement.innerHTML=value}},onchange:_Events._createEventProperty("change"),dispose:function(){this._disposed||(this._disposed=!0)},_ariaChangedHandler:function(){var value=this._domElement.getAttribute("aria-checked");value="true"===value,this.checked=value},_keyDownHandler:function(e){this.disabled||(e.keyCode===_ElementUtilities.Key.space&&(e.preventDefault(),this.checked=!this.checked),e.keyCode!==_ElementUtilities.Key.rightArrow&&e.keyCode!==_ElementUtilities.Key.upArrow||(e.preventDefault(),this.checked=!0),e.keyCode!==_ElementUtilities.Key.leftArrow&&e.keyCode!==_ElementUtilities.Key.downArrow||(e.preventDefault(),this.checked=!1))},_pointerDownHandler:function(e){this.disabled||this._mousedown||(e.preventDefault(),this._mousedown=!0,this._dragXStart=e.pageX-this._trackElement.getBoundingClientRect().left,this._dragX=this._dragXStart,this._dragging=!1,_ElementUtilities.addClass(this._domElement,classPressed),_ElementUtilities._globalListener.addEventListener(this._domElement,"pointermove",this._boundPointerMove,!0),_ElementUtilities._globalListener.addEventListener(this._domElement,"pointerup",this._boundPointerUp,!0),e.pointerType===_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH&&_ElementUtilities._setPointerCapture(this._domElement,e.pointerId))},_pointerCancelHandler:function(e){this._resetPressedState(),e.pointerType===_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH&&_ElementUtilities._releasePointerCapture(this._domElement,e.pointerId)},_pointerUpHandler:function(e){if(!this.disabled&&this._mousedown){e=e.detail.originalEvent,e.preventDefault();var trackRect=this._trackElement.getBoundingClientRect(),thumbRect=this._thumbElement.getBoundingClientRect(),isRTL="rtl"===_ElementUtilities._getComputedStyle(this._domElement).direction;if(this._dragging){var maxX=trackRect.width-thumbRect.width;this.checked=isRTL?this._dragX<maxX/2:this._dragX>=maxX/2,this._dragging=!1,_ElementUtilities.removeClass(this._domElement,classDragging)}else this.checked=!this.checked;this._resetPressedState()}},_pointerMoveHandler:function(e){if(!this.disabled&&this._mousedown){e=e.detail.originalEvent,e.preventDefault();var trackRect=this._trackElement.getBoundingClientRect(),localMouseX=e.pageX-trackRect.left;if(!(localMouseX>trackRect.width)){var thumbRect=this._thumbElement.getBoundingClientRect(),maxX=trackRect.width-thumbRect.width-6;this._dragX=Math.min(maxX,localMouseX-thumbRect.width/2),this._dragX=Math.max(2,this._dragX),!this._dragging&&Math.abs(localMouseX-this._dragXStart)>3&&(this._dragging=!0,_ElementUtilities.addClass(this._domElement,classDragging)),this._thumbElement.style.left=this._dragX+"px"}}},_resetPressedState:function(){this._mousedown=!1,this._thumbElement.style.left="",_ElementUtilities.removeClass(this._domElement,classPressed),_ElementUtilities._globalListener.removeEventListener(this._domElement,"pointermove",this._boundPointerMove,!0),_ElementUtilities._globalListener.removeEventListener(this._domElement,"pointerup",this._boundPointerUp,!0)}});return _Base.Class.mix(Toggle,_Control.DOMEventMixin),Toggle})})}),define("require-style!less/styles-semanticzoom",[],function(){}),define("require-style!less/colors-semanticzoom",[],function(){}),define("WinJS/Controls/SemanticZoom",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Animations/_TransitionAnimation","../ControlProcessor","../Promise","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","./ElementResizeInstrument","require-style!less/styles-semanticzoom","require-style!less/colors-semanticzoom"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,Animations,_TransitionAnimation,ControlProcessor,Promise,_Control,_Dispose,_ElementUtilities,_ElementListUtilities,_Hoverable,_ElementResizeInstrument){"use strict";_Base.Namespace.define("WinJS.UI",{SemanticZoom:_Base.Namespace._lazy(function(){function identity(item){return item}function buildTransition(prop,duration,timing){return prop+" "+_TransitionAnimation._animationTimeAdjustment(duration)+"s "+timing+" "+_TransitionAnimation._libraryDelay+"ms"}function outgoingElementTransition(){return buildTransition(transformNames.cssName,outgoingScaleTransitionDuration,"ease-in-out")+", "+buildTransition("opacity",outgoingOpacityTransitionDuration,"ease-in-out")}function incomingElementTransition(){return buildTransition(transformNames.cssName,incomingScaleTransitionDuration,"ease-in-out")+", "+buildTransition("opacity",incomingOpacityTransitionDuration,"ease-in-out")}function bounceInTransition(){return buildTransition(transformNames.cssName,bounceInDuration,easeOutBezier)}function bounceBackTransition(){return buildTransition(transformNames.cssName,bounceBackDuration,easeOutBezier)}function getDimension(element,property){return _ElementUtilities.convertToPixels(element,property)}function scaleElement(element,scale){_TransitionAnimation.isAnimationEnabled()&&(element.style[transformNames.scriptName]="scale("+scale+")")}function onSemanticZoomPropertyChanged(list){var control=list[0].target&&list[0].target.winControl;control&&control instanceof SemanticZoom&&control._onPropertyChanged()}var browserStyleEquivalents=_BaseUtils._browserStyleEquivalents,strings={get invalidZoomFactor(){return"Invalid zoomFactor"}},sezoButtonClass="win-semanticzoom-button",sezoButtonLocationClass="win-semanticzoom-button-location",sezoButtonShowDuration=3e3,sezoButtonMouseMoveThreshold=8,semanticZoomClass="win-semanticzoom",zoomedInElementClass="win-semanticzoom-zoomedinview",zoomedOutElementClass="win-semanticzoom-zoomedoutview",zoomChangedEvent="zoomchanged",bounceFactor=1.05,defaultZoomFactor=.65,maxZoomFactor=.8,minZoomFactor=.2,canvasSizeMax=4096,outgoingOpacityTransitionDuration=.333,incomingOpacityTransitionDuration=.333,outgoingScaleTransitionDuration=.333,incomingScaleTransitionDuration=.333,zoomAnimationDuration=1e3*outgoingOpacityTransitionDuration,zoomAnimationTTFFBuffer=50,bounceInDuration=.333,bounceBackDuration=.333,easeOutBezier="cubic-bezier(0.1,0.9,0.2,1)",transformNames=browserStyleEquivalents.transform,transitionScriptName=browserStyleEquivalents.transition.scriptName,pinchDistanceCount=2,zoomOutGestureDistanceChangeFactor=.2,zoomInGestureDistanceChangeFactor=.45,zoomAnimationTimeout=1e3,eventTimeoutDelay=50,PinchDirection={none:0,zoomedIn:1,zoomedOut:2},PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",PT_PEN=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_PEN||"pen",PT_MOUSE=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",origin={x:0,y:0},SemanticZoom=_Base.Class.define(function(element,options){this._disposed=!1;var that=this,isPhone=_BaseUtils.isPhone;this._element=element,this._element.winControl=this,_ElementUtilities.addClass(this._element,"win-disposable"),_ElementUtilities.addClass(this._element,semanticZoomClass),this._element.setAttribute("role","ms-semanticzoomcontainer");var ariaLabel=this._element.getAttribute("aria-label");if(ariaLabel||this._element.setAttribute("aria-label",""),options=options||{},this._zoomedOut=!!options.zoomedOut||!!options.initiallyZoomedOut||!1,this._enableButton=!isPhone,isPhone||void 0===options.enableButton||(this._enableButton=!!options.enableButton),this._element.setAttribute("aria-checked",this._zoomedOut.toString()),this._zoomFactor=_ElementUtilities._clamp(options.zoomFactor,minZoomFactor,maxZoomFactor,defaultZoomFactor),this.zoomedInItem=options.zoomedInItem,this.zoomedOutItem=options.zoomedOutItem,_BaseUtils.validation&&options._zoomFactor&&options._zoomFactor!==this._zoomFactor)throw new _ErrorFromName("WinJS.UI.SemanticZoom.InvalidZoomFactor",strings.invalidZoomFactor);this._locked=!!options.locked,this._zoomInProgress=!1,this._isBouncingIn=!1,this._isBouncing=!1,this._zooming=!1,this._aligning=!1,this._gesturing=!1,this._gestureEnding=!1,this._buttonShown=!1,this._shouldFakeTouchCancel="TouchEvent"in _Global,this._initialize(),this._configure(),this._onResizeBound=this._onResize.bind(this),this._elementResizeInstrument=new _ElementResizeInstrument._ElementResizeInstrument,this._element.appendChild(this._elementResizeInstrument.element),this._elementResizeInstrument.addEventListener("resize",this._onResizeBound),_ElementUtilities._resizeNotifier.subscribe(this._element,this._onResizeBound);var initiallyParented=_Global.document.body.contains(this._element);initiallyParented&&this._elementResizeInstrument.addedToDom(),_ElementUtilities._addInsertedNotifier(this._element);var initialTrigger=!0;this._element.addEventListener("WinJSNodeInserted",function(event){initialTrigger?(initialTrigger=!1,initiallyParented||(that._elementResizeInstrument.addedToDom(),that._onResizeBound())):that._onResizeBound()},!1),new _ElementUtilities._MutationObserver(onSemanticZoomPropertyChanged).observe(this._element,{attributes:!0,attributeFilter:["aria-checked"]}),isPhone||(this._element.addEventListener("wheel",this._onWheel.bind(this),!0),this._element.addEventListener("mousewheel",this._onMouseWheel.bind(this),!0),this._element.addEventListener("keydown",this._onKeyDown.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointerdown",this._onPointerDown.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointermove",this._onPointerMove.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointerout",this._onPointerOut.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointercancel",this._onPointerCancel.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointerup",this._onPointerUp.bind(this),!1),this._hiddenElement.addEventListener("gotpointercapture",this._onGotPointerCapture.bind(this),!1),this._hiddenElement.addEventListener("lostpointercapture",this._onLostPointerCapture.bind(this),!1),this._element.addEventListener("click",this._onClick.bind(this),!0),this._canvasIn.addEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._canvasOut.addEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,this._onCanvasTransitionEnd.bind(this),!1),this._element.addEventListener("MSContentZoom",this._onMSContentZoom.bind(this),!0),this._resetPointerRecords()),this._onResizeImpl(),_Control._setOptions(this,options,!0),that._setVisibility()},{element:{get:function(){return this._element}},enableButton:{get:function(){return this._enableButton},set:function(value){var newValue=!!value;this._enableButton===newValue||_BaseUtils.isPhone||(this._enableButton=newValue,newValue?this._createSemanticZoomButton():this._removeSemanticZoomButton())}},zoomedOut:{get:function(){return this._zoomedOut},set:function(value){this._zoom(!!value,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1,!1,this._zoomedOut&&_BaseUtils.isPhone)}},zoomFactor:{get:function(){return this._zoomFactor},set:function(value){var oldValue=this._zoomFactor,newValue=_ElementUtilities._clamp(value,minZoomFactor,maxZoomFactor,defaultZoomFactor);oldValue!==newValue&&(this._zoomFactor=newValue,this.forceLayout())}},locked:{get:function(){return this._locked},set:function(value){this._locked=!!value,value?this._hideSemanticZoomButton():this._displayButton()}},zoomedInItem:{get:function(){return this._zoomedInItem},set:function(value){this._zoomedInItem=value||identity}},zoomedOutItem:{get:function(){return this._zoomedOutItem},set:function(value){this._zoomedOutItem=value||identity}},dispose:function(){this._disposed||(this._disposed=!0,this._elementResizeInstrument.dispose(),_ElementUtilities._resizeNotifier.unsubscribe(this._element,this._onResizeBound),_Dispose._disposeElement(this._elementIn),_Dispose._disposeElement(this._elementOut),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer))},forceLayout:function(){this._onResizeImpl()},_initialize:function(){var children=_ElementListUtilities.children(this._element);this._elementIn=children[0],this._elementOut=children[1],this._elementIn.style.height=this._elementOut.style.height=this._element.offsetHeight+"px",ControlProcessor.processAll(this._elementIn),ControlProcessor.processAll(this._elementOut),this._viewIn=this._elementIn.winControl.zoomableView,this._viewOut=this._elementOut.winControl.zoomableView,this._element.removeChild(this._elementOut),this._element.removeChild(this._elementIn),this._element.innerHTML="",this._cropViewport=_Global.document.createElement("div"),this._element.appendChild(this._cropViewport),
this._viewportIn=_Global.document.createElement("div"),this._opticalViewportIn=_Global.document.createElement("div"),this._viewportOut=_Global.document.createElement("div"),this._opticalViewportOut=_Global.document.createElement("div"),this._opticalViewportIn.appendChild(this._viewportIn),this._opticalViewportOut.appendChild(this._viewportOut),this._cropViewport.appendChild(this._opticalViewportIn),this._cropViewport.appendChild(this._opticalViewportOut),this._canvasIn=_Global.document.createElement("div"),this._canvasOut=_Global.document.createElement("div"),this._viewportIn.appendChild(this._canvasIn),this._viewportOut.appendChild(this._canvasOut),this._canvasIn.appendChild(this._elementIn),this._canvasOut.appendChild(this._elementOut),this._enableButton&&this._createSemanticZoomButton(),this._hiddenElement=_Global.document.createElement("div"),this._hiddenElement.tabIndex=-1,this._hiddenElement.visibility="hidden",this._hiddenElement.setAttribute("aria-hidden","true"),this._element.appendChild(this._hiddenElement),_ElementUtilities.addClass(this._elementIn,zoomedInElementClass),_ElementUtilities.addClass(this._elementOut,zoomedOutElementClass),this._setLayout(this._element,"relative","hidden"),this._setLayout(this._cropViewport,"absolute","hidden"),this._setLayout(this._opticalViewportIn,"absolute","auto"),this._setLayout(this._opticalViewportOut,"absolute","auto"),this._setLayout(this._viewportIn,"absolute","hidden"),this._setLayout(this._viewportOut,"absolute","hidden"),this._setLayout(this._canvasIn,"absolute","hidden"),this._setLayout(this._canvasOut,"absolute","hidden"),this._setupOpticalViewport(this._opticalViewportIn),this._setupOpticalViewport(this._opticalViewportOut),this._viewportIn.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._viewportOut.style["-ms-overflow-style"]="-ms-autohiding-scrollbar",this._elementIn.style.position="absolute",this._elementOut.style.position="absolute"},_createSemanticZoomButton:function(){this._sezoButton=_Global.document.createElement("button"),this._sezoButton.setAttribute("type","button"),this._sezoButton.className=sezoButtonClass+" "+sezoButtonLocationClass+" win-button",this._sezoButton.tabIndex=-1,this._sezoButton.style.visibility="hidden",this._sezoButton.setAttribute("aria-hidden",!0),this._element.appendChild(this._sezoButton),this._sezoButton.addEventListener("click",this._onSeZoButtonZoomOutClick.bind(this),!1),this._element.addEventListener("scroll",this._onSeZoChildrenScroll.bind(this),!0),_ElementUtilities._addEventListener(this._element,"pointermove",this._onPenHover.bind(this),!1)},_removeSemanticZoomButton:function(){this._sezoButton&&(this._element.removeChild(this._sezoButton),this._sezoButton=null)},_configure:function(){var axisIn=this._viewIn.getPanAxis(),axisOut=this._viewOut.getPanAxis(),isPhone=_BaseUtils.isPhone;if(this._pansHorizontallyIn="horizontal"===axisIn||"both"===axisIn,this._pansVerticallyIn="vertical"===axisIn||"both"===axisIn,this._pansHorizontallyOut="horizontal"===axisOut||"both"===axisOut,this._pansVerticallyOut="vertical"===axisOut||"both"===axisOut,!this._zoomInProgress){var pagesToPrefetchIn=1/this._zoomFactor-1,pagesToPrefetchOut=bounceFactor-1;this._setLayout(this._elementIn,"absolute","visible"),this._setLayout(this._elementOut,"absolute","visible"),this._viewIn.configureForZoom(!1,!this._zoomedOut,this._zoomFromCurrent.bind(this,!0),pagesToPrefetchIn),this._viewOut.configureForZoom(!0,this._zoomedOut,this._zoomFromCurrent.bind(this,!1),pagesToPrefetchOut),this._pinching=!1,this._pinchGesture=0,this._canvasLeftIn=0,this._canvasTopIn=0,this._canvasLeftOut=0,this._canvasTopOut=0,isPhone||(this._zoomedOut?scaleElement(this._canvasIn,this._zoomFactor):scaleElement(this._canvasOut,1/this._zoomFactor));var styleViewportIn=this._opticalViewportIn.style,styleViewportOut=this._opticalViewportOut.style,styleCanvasIn=this._canvasIn.style,styleCanvasOut=this._canvasOut.style;styleCanvasIn.opacity=this._zoomedOut&&!isPhone?0:1,styleCanvasOut.opacity=this._zoomedOut?1:0,isPhone&&(styleCanvasIn.zIndex=1,styleCanvasOut.zIndex=2),_TransitionAnimation.isAnimationEnabled()&&!isPhone&&(styleViewportIn[browserStyleEquivalents["transition-property"].scriptName]=transformNames.cssName,styleViewportIn[browserStyleEquivalents["transition-duration"].scriptName]="0s",styleViewportIn[browserStyleEquivalents["transition-timing-function"].scriptName]="linear",styleViewportOut[browserStyleEquivalents["transition-property"].scriptName]=transformNames.cssName,styleViewportOut[browserStyleEquivalents["transition-duration"].scriptName]="0s",styleViewportOut[browserStyleEquivalents["transition-timing-function"].scriptName]="linear")}},_onPropertyChanged:function(){var newValue=this._element.getAttribute("aria-checked"),zoomedOut="true"===newValue;this._zoomedOut!==zoomedOut&&(this.zoomedOut=zoomedOut)},_onResizeImpl:function(){this._resizing=this._resizing||0,this._resizing++;try{var positionElement=function(element,left,top,width,height){var style=element.style;style.left=left+"px",style.top=top+"px",style.width=width+"px",style.height=height+"px"},sezoComputedStyle=_ElementUtilities._getComputedStyle(this._element,null),computedWidth=parseFloat(sezoComputedStyle.width),computedHeight=parseFloat(sezoComputedStyle.height),sezoPaddingLeft=getDimension(this._element,sezoComputedStyle.paddingLeft),sezoPaddingRight=getDimension(this._element,sezoComputedStyle.paddingRight),sezoPaddingTop=getDimension(this._element,sezoComputedStyle.paddingTop),sezoPaddingBottom=getDimension(this._element,sezoComputedStyle.paddingBottom),viewportWidth=computedWidth-sezoPaddingLeft-sezoPaddingRight,viewportHeight=computedHeight-sezoPaddingTop-sezoPaddingBottom,scaleFactor=1/this._zoomFactor;if(this._viewportWidth===viewportWidth&&this._viewportHeight===viewportHeight)return;this._sezoClientHeight=computedHeight,this._sezoClientWidth=computedWidth,this._viewportWidth=viewportWidth,this._viewportHeight=viewportHeight,this._configure();var multiplierIn=2*scaleFactor-1,canvasInWidth=Math.min(canvasSizeMax,(this._pansHorizontallyIn?multiplierIn:1)*viewportWidth),canvasInHeight=Math.min(canvasSizeMax,(this._pansVerticallyIn?multiplierIn:1)*viewportHeight);this._canvasLeftIn=.5*(canvasInWidth-viewportWidth),this._canvasTopIn=.5*(canvasInHeight-viewportHeight),positionElement(this._cropViewport,sezoPaddingLeft,sezoPaddingTop,viewportWidth,viewportHeight),positionElement(this._viewportIn,0,0,viewportWidth,viewportHeight),positionElement(this._opticalViewportIn,0,0,viewportWidth,viewportHeight),positionElement(this._canvasIn,-this._canvasLeftIn,-this._canvasTopIn,canvasInWidth,canvasInHeight),positionElement(this._elementIn,this._canvasLeftIn,this._canvasTopIn,viewportWidth,viewportHeight);var multiplierOut=2*bounceFactor-1,canvasOutWidth=(this._pansHorizontallyOut?multiplierOut:1)*viewportWidth,canvasOutHeight=(this._pansVerticallyOut?multiplierOut:1)*viewportHeight;this._canvasLeftOut=.5*(canvasOutWidth-viewportWidth),this._canvasTopOut=.5*(canvasOutHeight-viewportHeight),positionElement(this._viewportOut,0,0,viewportWidth,viewportHeight),positionElement(this._opticalViewportOut,0,0,viewportWidth,viewportHeight),positionElement(this._canvasOut,-this._canvasLeftOut,-this._canvasTopOut,canvasOutWidth,canvasOutHeight),positionElement(this._elementOut,this._canvasLeftOut,this._canvasTopOut,viewportWidth,viewportHeight)}finally{this._resizing--}},_onResize:function(){this._resizing||this._onResizeImpl()},_onMouseMove:function(ev){return this._zooming||!this._lastMouseX&&!this._lastMouseY||ev.screenX===this._lastMouseX&&ev.screenY===this._lastMouseY?(this._lastMouseX=ev.screenX,void(this._lastMouseY=ev.screenY)):void(Math.abs(ev.screenX-this._lastMouseX)<=sezoButtonMouseMoveThreshold&&Math.abs(ev.screenY-this._lastMouseY)<=sezoButtonMouseMoveThreshold||(this._lastMouseX=ev.screenX,this._lastMouseY=ev.screenY,this._displayButton()))},_displayButton:function(){if(_Hoverable.isHoverable){_Global.clearTimeout(this._dismissButtonTimer),this._showSemanticZoomButton();var that=this;this._dismissButtonTimer=_Global.setTimeout(function(){that._hideSemanticZoomButton()},_TransitionAnimation._animationTimeAdjustment(sezoButtonShowDuration))}},_showSemanticZoomButton:function(){this._disposed||this._buttonShown||!this._sezoButton||this._zoomedOut||this._locked||(Animations.fadeIn(this._sezoButton),this._sezoButton.style.visibility="visible",this._buttonShown=!0)},_hideSemanticZoomButton:function(immediately){if(!this._disposed&&this._buttonShown&&this._sezoButton){if(immediately)this._sezoButton.style.visibility="hidden";else{var that=this;Animations.fadeOut(this._sezoButton).then(function(){that._sezoButton.style.visibility="hidden"})}this._buttonShown=!1}},_onSeZoChildrenScroll:function(ev){ev.target!==this.element&&this._hideSemanticZoomButton(!0)},_onWheel:function(ev){ev.ctrlKey&&(this._zoom(ev.deltaY>0,this._getPointerLocation(ev)),ev.stopPropagation(),ev.preventDefault())},_onMouseWheel:function(ev){ev.ctrlKey&&(this._zoom(ev.wheelDelta<0,this._getPointerLocation(ev)),ev.stopPropagation(),ev.preventDefault())},_onPenHover:function(ev){ev.pointerType===PT_PEN&&0===ev.buttons&&this._displayButton()},_onSeZoButtonZoomOutClick:function(){this._hideSemanticZoomButton(),this._zoom(!0,{x:.5*this._sezoClientWidth,y:.5*this._sezoClientHeight},!1)},_onKeyDown:function(ev){var handled=!1;if(ev.ctrlKey){var Key=_ElementUtilities.Key;switch(ev.keyCode){case Key.add:case Key.equal:case 61:this._zoom(!1),handled=!0;break;case Key.subtract:case Key.dash:case 173:this._zoom(!0),handled=!0}}handled&&(ev.stopPropagation(),ev.preventDefault())},_createPointerRecord:function(ev,fireCancelOnPinch){var location=this._getPointerLocation(ev),newRecord={};return newRecord.startX=newRecord.currentX=location.x,newRecord.startY=newRecord.currentY=location.y,newRecord.fireCancelOnPinch=fireCancelOnPinch,this._pointerRecords[ev.pointerId]=newRecord,this._pointerCount=Object.keys(this._pointerRecords).length,newRecord},_deletePointerRecord:function(id){var record=this._pointerRecords[id];return delete this._pointerRecords[id],this._pointerCount=Object.keys(this._pointerRecords).length,2!==this._pointerCount&&(this._pinching=!1),record},_fakeCancelOnPointer:function(ev){var touchEvent=_Global.document.createEvent("UIEvent");touchEvent.initUIEvent("touchcancel",!0,!0,_Global,0),touchEvent.touches=ev.touches,touchEvent.targetTouches=ev.targetTouches,touchEvent.changedTouches=[ev._currentTouch],touchEvent._fakedBySemanticZoom=!0,ev.target.dispatchEvent(touchEvent)},_handlePointerDown:function(ev){this._createPointerRecord(ev,!1);for(var contactKeys=Object.keys(this._pointerRecords),i=0,len=contactKeys.length;i<len;i++)try{_ElementUtilities._setPointerCapture(this._hiddenElement,contactKeys[i]||0)}catch(e){return void this._resetPointerRecords()}ev.stopImmediatePropagation(),ev.preventDefault()},_handleFirstPointerDown:function(ev){this._resetPointerRecords(),this._createPointerRecord(ev,this._shouldFakeTouchCancel),this._startedZoomedOut=this._zoomedOut},_onClick:function(ev){ev.target!==this._element&&this._isBouncing&&ev.stopImmediatePropagation()},_onPointerDown:function(ev){ev.pointerType===PT_TOUCH&&(0===this._pointerCount?this._handleFirstPointerDown(ev):this._handlePointerDown(ev))},_onPointerMove:function(ev){function distance(startX,startY,endX,endY){return Math.sqrt((endX-startX)*(endX-startX)+(endY-startY)*(endY-startY))}function midpoint(point1,point2){return{x:.5*(point1.currentX+point2.currentX)|0,y:.5*(point1.currentY+point2.currentY)|0}}if(ev.pointerType===PT_MOUSE||ev.pointerType===PT_PEN)return void this._onMouseMove(ev);if(ev.pointerType===PT_TOUCH){var pointerRecord=this._pointerRecords[ev.pointerId],location=this._getPointerLocation(ev);if(pointerRecord){if(pointerRecord.currentX=location.x,pointerRecord.currentY=location.y,2===this._pointerCount){this._pinching=!0;var contactKeys=Object.keys(this._pointerRecords),point1=this._pointerRecords[contactKeys[0]],point2=this._pointerRecords[contactKeys[1]];this._currentMidPoint=midpoint(point1,point2);var contactDistance=distance(point1.currentX,point1.currentY,point2.currentX,point2.currentY),that=this,processPinchGesture=function(zoomingOut){var pinchDirection=zoomingOut?PinchDirection.zoomedOut:PinchDirection.zoomedIn,gestureReversed=zoomingOut?that._pinchedDirection===PinchDirection.zoomedIn&&!that._zoomingOut:that._pinchedDirection===PinchDirection.zoomedOut&&that._zoomingOut,canZoomInGesturedDirection=zoomingOut?!that._zoomedOut:that._zoomedOut;if(that._pinchedDirection===PinchDirection.none)canZoomInGesturedDirection?(that._isBouncingIn=!1,that._zoom(zoomingOut,midpoint(point1,point2),!0),that._pinchedDirection=pinchDirection):that._isBouncingIn||that._playBounce(!0,midpoint(point1,point2));else if(gestureReversed){var deltaFromStart=that._lastPinchDistance/that._lastPinchStartDistance,deltaFromLast=that._lastLastPinchDistance/that._lastPinchDistance;(zoomingOut&&deltaFromStart>zoomOutGestureDistanceChangeFactor||!zoomingOut&&deltaFromLast>zoomInGestureDistanceChangeFactor)&&(that._zoom(zoomingOut,midpoint(point1,point2),!0),that._pinchedDirection=pinchDirection)}};this._updatePinchDistanceRecords(contactDistance),this._pinchDistanceCount>=pinchDistanceCount&&(this._zooming||this._isBouncing||(_WriteProfilerMark("WinJS.UI.SemanticZoom:EndPinchDetection,info"),processPinchGesture(this._lastPinchDirection===PinchDirection.zoomedOut)))}else this._pointerCount>2&&this._resetPinchDistanceRecords();this._pointerCount>=2&&(pointerRecord.fireCancelOnPinch&&(this._fakeCancelOnPointer(ev,pointerRecord),pointerRecord.fireCancelOnPinch=!1),ev.stopImmediatePropagation(),ev.preventDefault()),2!==this._pointerCount&&this._isBouncingIn&&this._playBounce(!1)}}},_onPointerOut:function(ev){ev.pointerType===PT_TOUCH&&ev.target===this._element&&this._completePointerUp(ev,!1)},_onPointerUp:function(ev){this._releasePointerCapture(ev),this._completePointerUp(ev,!0),this._completeZoomingIfTimeout()},_onPointerCancel:function(ev){ev._fakedBySemanticZoom||(this._releasePointerCapture(ev),this._completePointerUp(ev,!1),this._completeZoomingIfTimeout())},_onGotPointerCapture:function(ev){var pointerRecord=this._pointerRecords[ev.pointerId];pointerRecord&&(pointerRecord.dirty=!1)},_onLostPointerCapture:function(ev){var pointerRecord=this._pointerRecords[ev.pointerId];if(pointerRecord){pointerRecord.dirty=!0;var that=this;Promise.timeout(eventTimeoutDelay).then(function(){pointerRecord.dirty&&that._completePointerUp(ev,!1)})}},_onMSContentZoom:function(ev){var sourceElement=ev.target;if(sourceElement===this._opticalViewportIn||sourceElement===this._opticalViewportOut){var zoomingOut=sourceElement.msContentZoomFactor<.995,zoomingIn=sourceElement.msContentZoomFactor>1.005;!zoomingOut||this._zoomedOut||this._zoomingOut?zoomingIn&&(this._zoomedOut||this._zoomingOut)&&(this.zoomedOut=!1):this.zoomedOut=!0}},_updatePinchDistanceRecords:function(contactDistance){function updatePinchDirection(direction){that._lastPinchDirection===direction?that._pinchDistanceCount++:(that._pinchGesture++,that._pinchDistanceCount=0,that._lastPinchStartDistance=contactDistance),that._lastPinchDirection=direction,that._lastPinchDistance=contactDistance,that._lastLastPinchDistance=that._lastPinchDistance}var that=this;this._lastPinchDistance===-1?(_WriteProfilerMark("WinJS.UI.SemanticZoom:StartPinchDetection,info"),this._lastPinchDistance=contactDistance):this._lastPinchDistance!==contactDistance&&updatePinchDirection(this._lastPinchDistance>contactDistance?PinchDirection.zoomedOut:PinchDirection.zoomedIn)},_zoomFromCurrent:function(zoomOut){this._zoom(zoomOut,null,!1,!0)},_zoom:function(zoomOut,zoomCenter,gesture,centerOnCurrent,skipAlignment){if(_WriteProfilerMark("WinJS.UI.SemanticZoom:StartZoom(zoomOut="+zoomOut+"),info"),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._hideSemanticZoomButton(),this._resetPinchDistanceRecords(),!this._locked&&!this._gestureEnding)if(this._zoomInProgress){if(this._gesturing===!gesture)return;zoomOut!==this._zoomingOut&&this._startAnimations(zoomOut)}else if(zoomOut!==this._zoomedOut){this._zooming=!0,this._aligning=!0,this._gesturing=!!gesture,zoomCenter&&(zoomOut?this._viewIn:this._viewOut).setCurrentItem(zoomCenter.x,zoomCenter.y),this._zoomInProgress=!0,(zoomOut?this._opticalViewportOut:this._opticalViewportIn).style.visibility="visible",zoomOut&&_BaseUtils.isPhone&&(this._canvasOut.style.opacity=1);var promiseIn=this._viewIn.beginZoom(),promiseOut=this._viewOut.beginZoom(),beginZoomPromises=null;if((promiseIn||promiseOut)&&_BaseUtils.isPhone&&(beginZoomPromises=Promise.join([promiseIn,promiseOut])),centerOnCurrent&&!skipAlignment){var that=this;(zoomOut?this._viewIn:this._viewOut).getCurrentItem().then(function(current){var position=current.position;that._prepareForZoom(zoomOut,{x:that._rtl()?that._sezoClientWidth-position.left-.5*position.width:position.left+.5*position.width,y:position.top+.5*position.height},Promise.wrap(current),beginZoomPromises)})}else this._prepareForZoom(zoomOut,zoomCenter||{},null,beginZoomPromises,skipAlignment)}},_prepareForZoom:function(zoomOut,zoomCenter,completedCurrentItem,customViewAnimationPromise,skipAlignment){function setZoomCenters(adjustmentIn,adjustmentOut){that._canvasIn.style[browserStyleEquivalents["transform-origin"].scriptName]=that._canvasLeftIn+centerX-adjustmentIn.x+"px "+(that._canvasTopIn+centerY-adjustmentIn.y)+"px",that._canvasOut.style[browserStyleEquivalents["transform-origin"].scriptName]=that._canvasLeftOut+centerX-adjustmentOut.x+"px "+(that._canvasTopOut+centerY-adjustmentOut.y)+"px"}_WriteProfilerMark("WinJS.UI.SemanticZoom:prepareForZoom,StartTM");var that=this,centerX=zoomCenter.x,centerY=zoomCenter.y;"number"==typeof centerX&&this._pansHorizontallyIn&&this._pansHorizontallyOut||(centerX=.5*this._sezoClientWidth),"number"==typeof centerY&&this._pansVerticallyIn&&this._pansVerticallyOut||(centerY=.5*this._sezoClientHeight),setZoomCenters(origin,origin),skipAlignment?this._aligning=!1:this._alignViewsPromise=this._alignViews(zoomOut,centerX,centerY,completedCurrentItem).then(function(){that._aligning=!1,that._gestureEnding=!1,that._alignViewsPromise=null,that._zooming||that._gesturing||that._completeZoom()}),this._zoomingOut=zoomOut,_ElementUtilities._getComputedStyle(this._canvasIn).opacity,_ElementUtilities._getComputedStyle(this._canvasOut).opacity,_WriteProfilerMark("WinJS.UI.SemanticZoom:prepareForZoom,StopTM"),this._startAnimations(zoomOut,customViewAnimationPromise)},_alignViews:function(zoomOut,centerX,centerY,completedCurrentItem){var multiplier=1-this._zoomFactor,rtl=this._rtl(),offsetLeft=multiplier*(rtl?this._viewportWidth-centerX:centerX),offsetTop=multiplier*centerY,that=this;if(zoomOut){var item=completedCurrentItem||this._viewIn.getCurrentItem();if(item)return item.then(function(current){var positionIn=current.position,positionOut={left:positionIn.left*that._zoomFactor+offsetLeft,top:positionIn.top*that._zoomFactor+offsetTop,width:positionIn.width*that._zoomFactor,height:positionIn.height*that._zoomFactor};return that._viewOut.positionItem(that._zoomedOutItem(current.item),positionOut)})}else{var item2=completedCurrentItem||this._viewOut.getCurrentItem();if(item2)return item2.then(function(current){var positionOut=current.position,positionIn={left:(positionOut.left-offsetLeft)/that._zoomFactor,top:(positionOut.top-offsetTop)/that._zoomFactor,width:positionOut.width/that._zoomFactor,height:positionOut.height/that._zoomFactor};return that._viewIn.positionItem(that._zoomedInItem(current.item),positionIn)})}return new Promise(function(c){c({x:0,y:0})})},_startAnimations:function(zoomOut,customViewAnimationPromise){this._zoomingOut=zoomOut;var isPhone=_BaseUtils.isPhone;if(_TransitionAnimation.isAnimationEnabled()&&!isPhone&&(_WriteProfilerMark("WinJS.UI.SemanticZoom:ZoomAnimation,StartTM"),this._canvasIn.style[transitionScriptName]=zoomOut?outgoingElementTransition():incomingElementTransition(),this._canvasOut.style[transitionScriptName]=zoomOut?incomingElementTransition():outgoingElementTransition()),isPhone||(scaleElement(this._canvasIn,zoomOut?this._zoomFactor:1),scaleElement(this._canvasOut,zoomOut?1:1/this._zoomFactor)),this._canvasIn.style.opacity=zoomOut&&!isPhone?0:1,isPhone&&!zoomOut||(this._canvasOut.style.opacity=zoomOut?1:0),_TransitionAnimation.isAnimationEnabled())if(customViewAnimationPromise){var that=this,onComplete=function(){that._canvasIn.style[transformNames.scriptName]="",that._canvasOut.style[transformNames.scriptName]="",that._onZoomAnimationComplete()};customViewAnimationPromise.then(onComplete,onComplete)}else this.setTimeoutAfterTTFF(this._onZoomAnimationComplete.bind(this),_TransitionAnimation._animationTimeAdjustment(zoomAnimationDuration));else this._zooming=!1,this._canvasIn.style[transformNames.scriptName]="",this._canvasOut.style[transformNames.scriptName]="",this._completeZoom()},_onBounceAnimationComplete:function(){this._isBouncingIn||this._disposed||this._completeZoom()},_onZoomAnimationComplete:function(){_WriteProfilerMark("WinJS.UI.SemanticZoom:ZoomAnimation,StopTM"),this._disposed||(this._zooming=!1,this._aligning||this._gesturing||this._gestureEnding||this._completeZoom())},_onCanvasTransitionEnd:function(ev){if(!this._disposed)return ev.target!==this._canvasOut&&ev.target!==this._canvasIn||!this._isBouncing?void(ev.target===this._canvasIn&&ev.propertyName===transformNames.cssName&&this._onZoomAnimationComplete()):void this._onBounceAnimationComplete()},_clearTimeout:function(timer){timer&&_Global.clearTimeout(timer)},_completePointerUp:function(ev,stopPropagation){if(!this._disposed){var id=ev.pointerId,pointerRecord=this._pointerRecords[id];if(pointerRecord&&(this._deletePointerRecord(id),this._isBouncingIn&&this._playBounce(!1),stopPropagation&&this._pinchedDirection!==PinchDirection.none&&ev.stopImmediatePropagation(),0===this._pointerCount)){if(1===this._pinchGesture&&!this._zooming&&this._lastPinchDirection!==PinchDirection.none&&this._pinchDistanceCount<pinchDistanceCount)return this._zoom(this._lastPinchDirection===PinchDirection.zoomedOut,this._currentMidPoint,!1),this._pinchGesture=0,void this._attemptRecordReset();this._pinchedDirection!==PinchDirection.none&&(this._gesturing=!1,this._aligning||this._zooming||this._completeZoom()),this._pinchGesture=0,this._attemptRecordReset()}}},setTimeoutAfterTTFF:function(callback,delay){var that=this;that._TTFFTimer=_Global.setTimeout(function(){this._disposed||(that._TTFFTimer=_Global.setTimeout(callback,delay))},zoomAnimationTTFFBuffer)},_completeZoomingIfTimeout:function(){if(0===this._pointerCount){var that=this;(this._zoomInProgress||this._isBouncing)&&(that._completeZoomTimer=_Global.setTimeout(function(){that._completeZoom()},_TransitionAnimation._animationTimeAdjustment(zoomAnimationTimeout)))}},_completeZoom:function(){if(!this._disposed){if(this._isBouncing)return this._zoomedOut?this._viewOut.endZoom(!0):this._viewIn.endZoom(!0),void(this._isBouncing=!1);if(this._zoomInProgress){_WriteProfilerMark("WinJS.UI.SemanticZoom:CompleteZoom,info"),this._aligning=!1,this._alignViewsPromise&&this._alignViewsPromise.cancel(),this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._gestureEnding=!1,this[this._zoomingOut?"_opticalViewportOut":"_opticalViewportIn"].msContentZoomFactor=1,this._viewIn.endZoom(!this._zoomingOut),this._viewOut.endZoom(this._zoomingOut),this._canvasIn.style.opacity=this._zoomingOut&&!_BaseUtils.isPhone?0:1,this._canvasOut.style.opacity=this._zoomingOut?1:0,this._zoomInProgress=!1;var zoomChanged=!1;if(this._zoomingOut!==this._zoomedOut&&(this._zoomedOut=!!this._zoomingOut,this._element.setAttribute("aria-checked",this._zoomedOut.toString()),zoomChanged=!0),this._setVisibility(),zoomChanged){var ev=_Global.document.createEvent("CustomEvent");ev.initCustomEvent(zoomChangedEvent,!0,!0,this._zoomedOut),this._element.dispatchEvent(ev),this._isActive&&_ElementUtilities._setActive(this._zoomedOut?this._elementOut:this._elementIn)}_WriteProfilerMark("WinJS.UI.SemanticZoom:CompleteZoom_Custom,info")}}},_isActive:function(){var active=_Global.document.activeElement;return this._element===active||this._element.contains(active)},_setLayout:function(element,position,overflow){var style=element.style;style.position=position,style.overflow=overflow},_setupOpticalViewport:function(viewport){viewport.style["-ms-overflow-style"]="none",_BaseUtils.isPhone||(viewport.style["-ms-content-zooming"]="zoom",viewport.style["-ms-content-zoom-limit-min"]="99%",viewport.style["-ms-content-zoom-limit-max"]="101%",viewport.style["-ms-content-zoom-snap-points"]="snapList(100%)",viewport.style["-ms-content-zoom-snap-type"]="mandatory")},_setVisibility:function(){function setVisibility(element,isVisible){element.style.visibility=isVisible?"visible":"hidden"}setVisibility(this._opticalViewportIn,!this._zoomedOut||_BaseUtils.isPhone),setVisibility(this._opticalViewportOut,this._zoomedOut),this._opticalViewportIn.setAttribute("aria-hidden",!!this._zoomedOut),this._opticalViewportOut.setAttribute("aria-hidden",!this._zoomedOut)},_resetPointerRecords:function(){this._pinchedDirection=PinchDirection.none,this._pointerCount=0,this._pointerRecords={},this._resetPinchDistanceRecords()},_releasePointerCapture:function(ev){var id=ev.pointerId;try{_ElementUtilities._releasePointerCapture(this._hiddenElement,id)}catch(e){}},_attemptRecordReset:function(){this._recordResetPromise&&this._recordResetPromise.cancel();var that=this;this._recordResetPromise=Promise.timeout(eventTimeoutDelay).then(function(){0===that._pointerCount&&(that._resetPointerRecords(),that._recordResetPromise=null)})},_resetPinchDistanceRecords:function(){this._lastPinchDirection=PinchDirection.none,this._lastPinchDistance=-1,this._lastLastPinchDistance=-1,this._pinchDistanceCount=0,this._currentMidPoint=null},_getPointerLocation:function(ev){var sezoBox={left:0,top:0};try{sezoBox=this._element.getBoundingClientRect()}catch(err){}var sezoComputedStyle=_ElementUtilities._getComputedStyle(this._element,null),sezoPaddingLeft=getDimension(this._element,sezoComputedStyle.paddingLeft),sezoPaddingTop=getDimension(this._element,sezoComputedStyle.paddingTop),sezoBorderLeft=getDimension(this._element,sezoComputedStyle.borderLeftWidth);return{x:+ev.clientX===ev.clientX?ev.clientX-sezoBox.left-sezoPaddingLeft-sezoBorderLeft:0,y:+ev.clientY===ev.clientY?ev.clientY-sezoBox.top-sezoPaddingTop-sezoPaddingTop:0}},_playBounce:function(beginBounce,center){if(_TransitionAnimation.isAnimationEnabled()&&this._isBouncingIn!==beginBounce){this._clearTimeout(this._completeZoomTimer),this._clearTimeout(this._TTFFTimer),this._isBouncing=!0,this._isBouncingIn=beginBounce,beginBounce?this._bounceCenter=center:this._aligned=!0;var targetElement=this._zoomedOut?this._canvasOut:this._canvasIn,adjustmentX=this._zoomedOut?this._canvasLeftOut:this._canvasLeftIn,adjustmentY=this._zoomedOut?this._canvasTopOut:this._canvasTopIn;targetElement.style[browserStyleEquivalents["transform-origin"].scriptName]=adjustmentX+this._bounceCenter.x+"px "+(adjustmentY+this._bounceCenter.y)+"px",targetElement.style[transitionScriptName]=beginBounce?bounceInTransition():bounceBackTransition(),this._zoomedOut?this._viewOut.beginZoom():this._viewIn.beginZoom();var scale=beginBounce?this._zoomedOut?2-bounceFactor:bounceFactor:1;scaleElement(targetElement,scale),this.setTimeoutAfterTTFF(this._onBounceAnimationComplete.bind(this),_TransitionAnimation._animationTimeAdjustment(zoomAnimationDuration))}},_rtl:function(){return"rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction},_pinching:{set:function(value){this._viewIn.pinching=value,this._viewOut.pinching=value}}});return _Base.Class.mix(SemanticZoom,_Events.createEventProperties("zoomchanged")),_Base.Class.mix(SemanticZoom,_Control.DOMEventMixin),SemanticZoom})})}),define("WinJS/Controls/Pivot/_Constants",["require","exports"],function(require,exports){exports._ClassNames={pivot:"win-pivot",pivotCustomHeaders:"win-pivot-customheaders",pivotLocked:"win-pivot-locked",pivotTitle:"win-pivot-title",pivotHeaderArea:"win-pivot-header-area",pivotHeaderLeftCustom:"win-pivot-header-leftcustom",pivotHeaderRightCustom:"win-pivot-header-rightcustom",pivotHeaderItems:"win-pivot-header-items",pivotHeaders:"win-pivot-headers",pivotHeader:"win-pivot-header",pivotHeaderSelected:"win-pivot-header-selected",pivotViewport:"win-pivot-viewport",pivotSurface:"win-pivot-surface",pivotNoSnap:"win-pivot-nosnap",pivotNavButton:"win-pivot-navbutton",pivotNavButtonPrev:"win-pivot-navbutton-prev",pivotNavButtonNext:"win-pivot-navbutton-next",pivotShowNavButtons:"win-pivot-shownavbuttons",pivotInputTypeMouse:"win-pivot-mouse",pivotInputTypeTouch:"win-pivot-touch",pivotDisableContentSwipeNavigation:"win-pivot-disablecontentswipenavigation"}}),define("WinJS/Controls/Pivot/_Item",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","./_Constants"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,ControlProcessor,Promise,Scheduler,_Control,_Dispose,_ElementUtilities,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{PivotItem:_Base.Namespace._lazy(function(){var strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},PivotItem=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.PivotItem.DuplicateConstruction",strings.duplicateConstruction);element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,PivotItem._ClassName.pivotItem),_ElementUtilities.addClass(this.element,"win-disposable"),this._element.setAttribute("role","tabpanel"),this._contentElement=_Global.document.createElement("DIV"),this._contentElement.className=PivotItem._ClassName.pivotItemContent,element.appendChild(this._contentElement);for(var elementToMove=this.element.firstChild;elementToMove!==this._contentElement;){var nextElement=elementToMove.nextSibling;this._contentElement.appendChild(elementToMove),elementToMove=nextElement}this._processors=[ControlProcessor.processAll],_Control.setOptions(this,options)},{element:{get:function(){return this._element}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(value){this._header=value,this._parentPivot&&this._parentPivot._headersState.handleHeaderChanged(this)}},_parentPivot:{get:function(){for(var el=this._element;el&&!_ElementUtilities.hasClass(el,_Constants._ClassNames.pivot);)el=el.parentNode;return el&&el.winControl}},_process:function(){var that=this;return this._processors&&this._processors.push(function(){return Scheduler.schedulePromiseAboveNormal()}),this._processed=(this._processors||[]).reduce(function(promise,processor){return promise.then(function(){return processor(that.contentElement)})},this._processed||Promise.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,_Dispose.disposeSubTree(this.contentElement))}},{_ClassName:{pivotItem:"win-pivot-item",pivotItemContent:"win-pivot-item-content"},isDeclarativeControlContainer:_BaseUtils.markSupportedForProcessing(function(item,callback){callback!==ControlProcessor.processAll&&(item._processors=item._processors||[],item._processors.push(callback),item._processed&&item._process())})});return PivotItem})})}),define("require-style!less/styles-pivot",[],function(){}),define("require-style!less/colors-pivot",[],function(){});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);
__.prototype=b.prototype,d.prototype=new __};define("WinJS/Controls/Pivot/_Pivot",["require","exports","../../Core/_Global","../../Animations","../../BindingList","../../ControlProcessor","../../Promise","../../Scheduler","../../Core/_Base","../../Core/_BaseUtils","../../Utilities/_Control","../../Utilities/_Dispose","../ElementResizeInstrument","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Utilities/_Hoverable","../../Utilities/_KeyboardBehavior","../../Core/_Log","../../Core/_Resources","../../Animations/_TransitionAnimation","../../Core/_WriteProfilerMark","./_Constants"],function(require,exports,_Global,Animations,BindingList,ControlProcessor,Promise,Scheduler,_Base,_BaseUtils,_Control,_Dispose,_ElementResizeInstrument,_ElementUtilities,_ErrorFromName,_Events,_Hoverable,_KeyboardBehavior,_Log,_Resources,_TransitionAnimation,_WriteProfilerMark,_Constants){function pivotDefaultHeaderTemplate(item){var element=_Global.document.createTextNode("object"==typeof item.header?JSON.stringify(item.header):""+item.header);return element}_Hoverable.isHoverable,require(["require-style!less/styles-pivot"]),require(["require-style!less/colors-pivot"]);var _EventNames={selectionChanged:"selectionchanged",itemAnimationStart:"itemanimationstart",itemAnimationEnd:"itemanimationend"},strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateItem(){return _Resources._getWinJSString("ui/duplicateItem").value},get invalidContent(){return"Invalid content: Pivot content must be made up of PivotItems."},get pivotAriaLabel(){return _Resources._getWinJSString("ui/pivotAriaLabel").value},get pivotViewportAriaLabel(){return _Resources._getWinJSString("ui/pivotViewportAriaLabel").value}},supportsSnap=!!(_ElementUtilities._supportsSnapPoints&&"inertiaDestinationX"in _Global.MSManipulationEvent.prototype),PT_MOUSE=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_MOUSE||"mouse",PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",Keys=_ElementUtilities.Key,_headerSlideAnimationDuration=250,_invalidMeasurement=-1,Pivot=function(){function Pivot(element,options){var _this=this;if(void 0===options&&(options={}),this._disposed=!1,this._firstLoad=!0,this._hidePivotItemAnimation=Promise.wrap(),this._loadPromise=Promise.wrap(),this._pendingRefresh=!1,this._selectedIndex=0,this._showPivotItemAnimation=Promise.wrap(),this._slideHeadersAnimation=Promise.wrap(),element=element||_Global.document.createElement("DIV"),element.winControl)throw new _ErrorFromName("WinJS.UI.Pivot.DuplicateConstruction",strings.duplicateConstruction);this._handleItemChanged=this._handleItemChanged.bind(this),this._handleItemInserted=this._handleItemInserted.bind(this),this._handleItemMoved=this._handleItemMoved.bind(this),this._handleItemRemoved=this._handleItemRemoved.bind(this),this._handleItemReload=this._handleItemReload.bind(this),this._resizeHandler=this._resizeHandler.bind(this),this._updatePointerType=this._updatePointerType.bind(this),this._id=element.id||_ElementUtilities._uniqueID(element),this._writeProfilerMark("constructor,StartTM"),element.winControl=this,this._element=element,this._element.setAttribute("role","tablist"),this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",strings.pivotAriaLabel),_ElementUtilities.addClass(this.element,_Constants._ClassNames.pivot),_ElementUtilities.addClass(this.element,"win-disposable"),_ElementUtilities._addEventListener(this.element,"pointerenter",this._updatePointerType),_ElementUtilities._addEventListener(this.element,"pointerout",this._updatePointerType),this._titleElement=_Global.document.createElement("DIV"),this._titleElement.style.display="none",_ElementUtilities.addClass(this._titleElement,_Constants._ClassNames.pivotTitle),this._element.appendChild(this._titleElement),this._headerAreaElement=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._headerAreaElement,_Constants._ClassNames.pivotHeaderArea),this._element.appendChild(this._headerAreaElement),this._headerItemsElement=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._headerItemsElement,_Constants._ClassNames.pivotHeaderItems),this._headerAreaElement.appendChild(this._headerItemsElement),this._headerItemsElWidth=null,this._headersContainerElement=_Global.document.createElement("DIV"),this._headersContainerElement.tabIndex=0,_ElementUtilities.addClass(this._headersContainerElement,_Constants._ClassNames.pivotHeaders),this._headersContainerElement.addEventListener("keydown",this._headersKeyDown.bind(this)),_ElementUtilities._addEventListener(this._headersContainerElement,"pointerenter",this._showNavButtons.bind(this)),_ElementUtilities._addEventListener(this._headersContainerElement,"pointerout",this._hideNavButtons.bind(this)),this._headerItemsElement.appendChild(this._headersContainerElement),this._element.addEventListener("click",this._elementClickedHandler.bind(this)),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._headersContainerElement),this._customLeftHeader=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._customLeftHeader,_Constants._ClassNames.pivotHeaderLeftCustom),this._headerAreaElement.insertBefore(this._customLeftHeader,this._headerAreaElement.children[0]),this._customRightHeader=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._customRightHeader,_Constants._ClassNames.pivotHeaderRightCustom),this._headerAreaElement.appendChild(this._customRightHeader),this._viewportElement=_Global.document.createElement("DIV"),this._viewportElement.className=_Constants._ClassNames.pivotViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",strings.pivotViewportAriaLabel),this._elementResizeInstrument=new _ElementResizeInstrument._ElementResizeInstrument,this._element.appendChild(this._elementResizeInstrument.element),this._elementResizeInstrument.addEventListener("resize",this._resizeHandler),_ElementUtilities._inDom(this._element).then(function(){_this._disposed||_this._elementResizeInstrument.addedToDom()}),_ElementUtilities._resizeNotifier.subscribe(this.element,this._resizeHandler),this._viewportElWidth=null,this._surfaceElement=_Global.document.createElement("DIV"),this._surfaceElement.className=_Constants._ClassNames.pivotSurface,this._viewportElement.appendChild(this._surfaceElement),this._headersState=new HeaderStateBase(this),supportsSnap?this._viewportElement.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)):(_ElementUtilities.addClass(this.element,_Constants._ClassNames.pivotNoSnap),_ElementUtilities._addEventListener(this._element,"pointerdown",this._elementPointerDownHandler.bind(this)),_ElementUtilities._addEventListener(this._element,"pointerup",this._elementPointerUpHandler.bind(this))),this._parse(),options=_BaseUtils._shallowCopy(options),options.items&&(this.items=options.items,delete options.items),_Control.setOptions(this,options),this._refresh(),this._writeProfilerMark("constructor,StopTM")}return Object.defineProperty(Pivot.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"customLeftHeader",{get:function(){return this._customLeftHeader.firstElementChild},set:function(value){_ElementUtilities.empty(this._customLeftHeader),value?(this._customLeftHeader.appendChild(value),_ElementUtilities.addClass(this._element,_Constants._ClassNames.pivotCustomHeaders)):this._customLeftHeader.children.length||this._customRightHeader.childNodes.length||_ElementUtilities.removeClass(this._element,_Constants._ClassNames.pivotCustomHeaders),this.forceLayout()},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"customRightHeader",{get:function(){return this._customRightHeader.firstElementChild},set:function(value){_ElementUtilities.empty(this._customRightHeader),value?(this._customRightHeader.appendChild(value),_ElementUtilities.addClass(this._element,_Constants._ClassNames.pivotCustomHeaders)):this._customLeftHeader.children.length||this._customRightHeader.childNodes.length||_ElementUtilities.removeClass(this._element,_Constants._ClassNames.pivotCustomHeaders),this.forceLayout()},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"locked",{get:function(){return _ElementUtilities.hasClass(this.element,_Constants._ClassNames.pivotLocked)},set:function(value){_ElementUtilities[value?"addClass":"removeClass"](this.element,_Constants._ClassNames.pivotLocked),value&&this._hideNavButtons()},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"items",{get:function(){return this._pendingItems?this._pendingItems:this._items},set:function(value){this._pendingItems=value,this._refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"title",{get:function(){return this._titleElement.textContent},set:function(value){value?(this._titleElement.style.display="block",this._titleElement.textContent=value):(this._titleElement.style.display="none",this._titleElement.textContent="")},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"selectedIndex",{get:function(){return 0===this.items.length?-1:this._selectedIndex},set:function(value){value>=0&&value<this.items.length&&(this._pendingRefresh?this._selectedIndex=value:this._loadItem(value))},enumerable:!0,configurable:!0}),Object.defineProperty(Pivot.prototype,"selectedItem",{get:function(){return this.items.getAt(this.selectedIndex)},set:function(value){var index=this.items.indexOf(value);index!==-1&&(this.selectedIndex=index)},enumerable:!0,configurable:!0}),Pivot.prototype.dispose=function(){if(!this._disposed){this._disposed=!0,this._updateEvents(this._items,null),_ElementUtilities._resizeNotifier.unsubscribe(this.element,this._resizeHandler),this._elementResizeInstrument.dispose(),this._headersState.exit(),_Dispose._disposeElement(this._headersContainerElement);for(var i=0,len=this.items.length;i<len;i++)this.items.getAt(i).dispose()}},Pivot.prototype.forceLayout=function(){this._disposed||this._resizeHandler()},Pivot.prototype._applyProperties=function(){function attachItems(pivot){for(var i=0,len=pivot.items.length;i<len;i++){var item=pivot._items.getAt(i);if(item.element.parentNode===pivot._surfaceElement)throw new _ErrorFromName("WinJS.UI.Pivot.DuplicateItem",strings.duplicateItem);item.element.style.display="none",pivot._surfaceElement.appendChild(item.element)}}if(!this._disposed){if(this._pendingItems){for(this._updateEvents(this._items,this._pendingItems),this._items=this._pendingItems,this._pendingItems=null;this.element.firstElementChild!==this._titleElement;){var toRemove=this.element.firstElementChild;toRemove.parentNode.removeChild(toRemove)}_ElementUtilities.empty(this._surfaceElement)}attachItems(this),this._rtl="rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction,this._headersState.refreshHeadersState(!0),this._pendingRefresh=!1,this._firstLoad=!0,this.selectedIndex=this._selectedIndex,this._firstLoad=!1,this._recenterViewport()}},Pivot.prototype._parse=function(){for(var pivotItems=[],pivotItemEl=this.element.firstElementChild;pivotItemEl!==this._titleElement;){ControlProcessor.processAll(pivotItemEl);var pivotItemContent=pivotItemEl.winControl;if(!pivotItemContent)throw new _ErrorFromName("WinJS.UI.Pivot.InvalidContent",strings.invalidContent);pivotItems.push(pivotItemContent);var nextItemEl=pivotItemEl.nextElementSibling;pivotItemEl=nextItemEl}this.items=new BindingList.List(pivotItems)},Pivot.prototype._refresh=function(){this._pendingRefresh||(this._pendingRefresh=!0,Scheduler.schedule(this._applyProperties.bind(this),Scheduler.Priority.high))},Pivot.prototype._resizeHandler=function(){if(!this._disposed&&!this._pendingRefresh){var oldViewportWidth=this._getViewportWidth(),oldHeaderItemsWidth=this._getHeaderItemsWidth();this._invalidateMeasures(),oldViewportWidth!==this._getViewportWidth()||oldHeaderItemsWidth!==this._getHeaderItemsWidth()?(_Log.log&&_Log.log("_resizeHandler, viewport from:"+oldViewportWidth+" to: "+this._getViewportWidth()),_Log.log&&_Log.log("_resizeHandler, headers from:"+oldHeaderItemsWidth+" to: "+this._getHeaderItemsWidth()),this._hidePivotItemAnimation&&this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation&&this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation&&this._slideHeadersAnimation.cancel(),this._recenterViewport(),this._headersState.handleResize()):_Log.log&&_Log.log("_resizeHandler worthless resize")}},Pivot.prototype._activateHeader=function(headerElement){if(!this.locked){var index=this._items.indexOf(headerElement._item);index!==this.selectedIndex?this._headersState.activateHeader(headerElement):_ElementUtilities._setActiveFirstFocusableElement(this.selectedItem.element)}},Pivot.prototype._goNext=function(){this.selectedIndex<this._items.length-1?this.selectedIndex++:this.selectedIndex=0},Pivot.prototype._goPrevious=function(){this._animateToPrevious=!0,this.selectedIndex>0?this.selectedIndex--:this.selectedIndex=this._items.length-1,this._animateToPrevious=!1},Pivot.prototype._loadItem=function(index){var _this=this;this._rtl="rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction,this._hidePivotItemAnimation.cancel(),this._showPivotItemAnimation.cancel(),this._slideHeadersAnimation.cancel();var goPrev=this._animateToPrevious,newItem=this._items.getAt(index),skipAnimation=this._firstLoad,thisLoadPromise=this._loadPromise=this._loadPromise.then(function(){var oldItem=_this._items.getAt(_this.selectedIndex);oldItem&&_this._hidePivotItem(oldItem.element,goPrev,skipAnimation);var oldIndex=_this._selectedIndex;_this._selectedIndex=index;var selectionChangedDetail={index:index,direction:goPrev?"backwards":"forward",item:newItem};return _this._fireEvent(_EventNames.selectionChanged,!0,!1,selectionChangedDetail),_this._headersState.handleNavigation(goPrev,index,oldIndex),Promise.join([newItem._process(),_this._hidePivotItemAnimation,Promise.timeout()]).then(function(){if(!_this._disposed&&_this._loadPromise===thisLoadPromise)return _this._recenterViewport(),_this._showPivotItem(newItem.element,goPrev,skipAnimation).then(function(){_this._disposed||_this._loadPromise!==thisLoadPromise||(_this._loadPromise=Promise.wrap(),_this._writeProfilerMark("itemAnimationStop,info"),_this._fireEvent(_EventNames.itemAnimationEnd,!0,!1,null))})})})},Pivot.prototype._recenterViewport=function(){_ElementUtilities.setScrollPosition(this._viewportElement,{scrollLeft:this._getViewportWidth()}),this.selectedItem&&(this.selectedItem.element.style[this._getDirectionAccessor()]=this._getViewportWidth()+"px")},Pivot.prototype._fireEvent=function(type,canBubble,cancelable,detail){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent(type,!!canBubble,!!cancelable,detail),this.element.dispatchEvent(event)},Pivot.prototype._getDirectionAccessor=function(){return this._rtl?"right":"left"},Pivot.prototype._getHeaderItemsWidth=function(){return this._headerItemsElWidth||(this._headerItemsElWidth=parseFloat(_ElementUtilities._getComputedStyle(this._headerItemsElement).width)),this._headerItemsElWidth||_invalidMeasurement},Pivot.prototype._getViewportWidth=function(){return this._viewportElWidth||(this._viewportElWidth=parseFloat(_ElementUtilities._getComputedStyle(this._viewportElement).width),supportsSnap&&(this._viewportElement.style[_BaseUtils._browserStyleEquivalents["scroll-snap-points-x"].scriptName]="snapInterval(0%, "+Math.ceil(this._viewportElWidth)+"px)")),this._viewportElWidth||_invalidMeasurement},Pivot.prototype._invalidateMeasures=function(){this._viewportElWidth=this._headerItemsElWidth=null},Pivot.prototype._updateEvents=function(oldItems,newItems){oldItems&&(oldItems.removeEventListener("itemchanged",this._handleItemChanged),oldItems.removeEventListener("iteminserted",this._handleItemInserted),oldItems.removeEventListener("itemmoved",this._handleItemMoved),oldItems.removeEventListener("itemremoved",this._handleItemRemoved),oldItems.removeEventListener("reload",this._handleItemReload)),newItems&&(newItems.addEventListener("itemchanged",this._handleItemChanged),newItems.addEventListener("iteminserted",this._handleItemInserted),newItems.addEventListener("itemmoved",this._handleItemMoved),newItems.addEventListener("itemremoved",this._handleItemRemoved),newItems.addEventListener("reload",this._handleItemReload))},Pivot.prototype._writeProfilerMark=function(text){var message="WinJS.UI.Pivot:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"pivotprofiler")},Pivot.prototype._handleItemChanged=function(ev){if(!this._pendingItems){var index=ev.detail.index,newItem=ev.detail.newValue,oldItem=ev.detail.oldValue;if(newItem.element!==oldItem.element){if(newItem.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Pivot.DuplicateItem",strings.duplicateItem);newItem.element.style.display="none",this._surfaceElement.insertBefore(newItem.element,oldItem.element),this._surfaceElement.removeChild(oldItem.element),index===this.selectedIndex&&(this.selectedIndex=index)}this._headersState.render(),this._headersState.refreshHeadersState(!0)}},Pivot.prototype._handleItemInserted=function(ev){if(!this._pendingItems){var index=ev.detail.index,item=ev.detail.value;if(item.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Pivot.DuplicateItem",strings.duplicateItem);item.element.style.display="none",index<this.items.length-1?this._surfaceElement.insertBefore(item.element,this.items.getAt(index+1).element):this._surfaceElement.appendChild(item.element),index<=this.selectedIndex&&this._selectedIndex++,1===this._items.length&&(this.selectedIndex=0),this._headersState.render(),this._headersState.refreshHeadersState(!0)}},Pivot.prototype._handleItemMoved=function(ev){if(!this._pendingItems){var oldIndex=ev.detail.oldIndex,newIndex=ev.detail.newIndex,item=ev.detail.value;newIndex<this.items.length-1?this._surfaceElement.insertBefore(item.element,this.items.getAt(newIndex+1).element):this._surfaceElement.appendChild(item.element),oldIndex<this.selectedIndex&&newIndex>=this.selectedIndex?this._selectedIndex--:newIndex>this.selectedIndex&&oldIndex<=this.selectedIndex?this._selectedIndex++:oldIndex===this.selectedIndex&&(this.selectedIndex=this.selectedIndex),this._headersState.render(),this._headersState.refreshHeadersState(!0)}},Pivot.prototype._handleItemReload=function(){this.items=this.items},Pivot.prototype._handleItemRemoved=function(ev){if(!this._pendingItems){var item=ev.detail.value,index=ev.detail.index;this._surfaceElement.removeChild(item.element),index<this.selectedIndex?this._selectedIndex--:index===this._selectedIndex&&(this.selectedIndex=Math.min(this.items.length-1,this._selectedIndex)),this._headersState.render(),this._headersState.refreshHeadersState(!0)}},Pivot.prototype._elementClickedHandler=function(e){if(this.locked||this._navigationHandled)return void(this._navigationHandled=!1);var header,src=e.target;if(_ElementUtilities.hasClass(src,_Constants._ClassNames.pivotHeader))header=src;else{var hitSrcElement=!1,hitTargets=_ElementUtilities._elementsFromPoint(e.clientX,e.clientY);if(hitTargets&&hitTargets[0]===this._viewportElement)for(var i=0,len=hitTargets.length;i<len;i++)hitTargets[i]===src&&(hitSrcElement=!0),_ElementUtilities.hasClass(hitTargets[i],_Constants._ClassNames.pivotHeader)&&(header=hitTargets[i]);hitSrcElement||(header=null)}header&&this._activateHeader(header)},Pivot.prototype._elementPointerDownHandler=function(e){if(!supportsSnap){var element=e.target;this._elementPointerDownPoint={x:e.clientX,y:e.clientY,type:e.pointerType||"mouse",time:Date.now(),inHeaders:this._headersContainerElement.contains(element)}}},Pivot.prototype._elementPointerUpHandler=function(e){if(!this._elementPointerDownPoint||this.locked)return void(this._elementPointerDownPoint=null);var element=e.target,filterDistance=32,dyDxThresholdRatio=.4,dy=Math.abs(e.clientY-this._elementPointerDownPoint.y),dx=e.clientX-this._elementPointerDownPoint.x,thresholdY=Math.abs(dx*dyDxThresholdRatio),doSwipeDetection=dy<thresholdY&&Math.abs(dx)>filterDistance&&(!_ElementUtilities._supportsTouchDetection||this._elementPointerDownPoint.type===e.pointerType&&e.pointerType===PT_TOUCH)&&(!this.element.classList.contains(_Constants._ClassNames.pivotDisableContentSwipeNavigation)||this._elementPointerDownPoint.inHeaders&&this._headersContainerElement.contains(element));if(this._navigationHandled=!1,doSwipeDetection){var dt=Date.now()-this._elementPointerDownPoint.time;dx*=Math.max(1,Math.pow(350/dt,2)),dx=this._rtl?-dx:dx;var vwDiv4=this._getViewportWidth()/4;dx<-vwDiv4?(this._goNext(),this._navigationHandled=!0):dx>vwDiv4&&(this._goPrevious(),this._navigationHandled=!0)}if(!this._navigationHandled){for(;null!==element&&!_ElementUtilities.hasClass(element,_Constants._ClassNames.pivotHeader);)element=element.parentElement;null!==element&&(this._activateHeader(element),this._navigationHandled=!0)}this._elementPointerDownPoint=null},Pivot.prototype._headersKeyDown=function(e){this.locked||(e.keyCode===Keys.leftArrow||e.keyCode===Keys.pageUp?(this._rtl?this._goNext():this._goPrevious(),e.preventDefault()):e.keyCode!==Keys.rightArrow&&e.keyCode!==Keys.pageDown||(this._rtl?this._goPrevious():this._goNext(),e.preventDefault()))},Pivot.prototype._hideNavButtons=function(e){e&&this._headersContainerElement.contains(e.relatedTarget)||_ElementUtilities.removeClass(this._headersContainerElement,_Constants._ClassNames.pivotShowNavButtons)},Pivot.prototype._hidePivotItem=function(element,goPrevious,skipAnimation){return skipAnimation||!_TransitionAnimation.isAnimationEnabled()?(element.style.display="none",this._hidePivotItemAnimation=Promise.wrap(),this._hidePivotItemAnimation):(this._hidePivotItemAnimation=_TransitionAnimation.executeTransition(element,{property:"opacity",delay:0,duration:67,timing:"linear",from:"",to:"0"}).then(function(){element.style.display="none"}),this._hidePivotItemAnimation)},Pivot.prototype._MSManipulationStateChangedHandler=function(e){if(e.target===this._viewportElement&&e.currentState===_ElementUtilities._MSManipulationEvent.MS_MANIPULATION_STATE_INERTIA){var delta=e.inertiaDestinationX-this._getViewportWidth();delta>0?this._goNext():delta<0&&this._goPrevious()}},Pivot.prototype._updatePointerType=function(e){this._pointerType!==(e.pointerType||PT_MOUSE)&&(this._pointerType=e.pointerType||PT_MOUSE,this._pointerType===PT_TOUCH?(_ElementUtilities.removeClass(this.element,_Constants._ClassNames.pivotInputTypeMouse),_ElementUtilities.addClass(this.element,_Constants._ClassNames.pivotInputTypeTouch),this._hideNavButtons()):(_ElementUtilities.removeClass(this.element,_Constants._ClassNames.pivotInputTypeTouch),_ElementUtilities.addClass(this.element,_Constants._ClassNames.pivotInputTypeMouse)))},Pivot.prototype._showNavButtons=function(e){this.locked||e&&e.pointerType===PT_TOUCH||_ElementUtilities.addClass(this._headersContainerElement,_Constants._ClassNames.pivotShowNavButtons)},Pivot.prototype._showPivotItem=function(element,goPrevious,skipAnimation){function filterOnScreen(element){var elementBoundingClientRect=element.getBoundingClientRect();return elementBoundingClientRect.top<viewportBoundingClientRect.bottom&&elementBoundingClientRect.bottom>viewportBoundingClientRect.top}if(this._writeProfilerMark("itemAnimationStart,info"),this._fireEvent(_EventNames.itemAnimationStart,!0,!1,null),element.style.display="",skipAnimation||!_TransitionAnimation.isAnimationEnabled())return element.style.opacity="",this._showPivotItemAnimation=Promise.wrap(),this._showPivotItemAnimation;var negativeTransform=this._rtl?!goPrevious:goPrevious,viewportBoundingClientRect=this._viewportElement.getBoundingClientRect(),slideGroup1Els=element.querySelectorAll(".win-pivot-slide1"),slideGroup2Els=element.querySelectorAll(".win-pivot-slide2"),slideGroup3Els=element.querySelectorAll(".win-pivot-slide3");return slideGroup1Els=Array.prototype.filter.call(slideGroup1Els,filterOnScreen),slideGroup2Els=Array.prototype.filter.call(slideGroup2Els,filterOnScreen),slideGroup3Els=Array.prototype.filter.call(slideGroup3Els,filterOnScreen),this._showPivotItemAnimation=Promise.join([_TransitionAnimation.executeTransition(element,{property:"opacity",delay:0,duration:333,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"0",to:""}),_TransitionAnimation.executeTransition(element,{property:_BaseUtils._browserStyleEquivalents.transform.cssName,delay:0,duration:767,timing:"cubic-bezier(0.1,0.9,0.2,1)",from:"translateX("+(negativeTransform?"-20px":"20px")+")",to:""}),Animations[negativeTransform?"slideRightIn":"slideLeftIn"](null,slideGroup1Els,slideGroup2Els,slideGroup3Els)]),this._showPivotItemAnimation},Pivot.supportedForProcessing=!0,Pivot._ClassNames=_Constants._ClassNames,Pivot._EventNames=_EventNames,Pivot}();exports.Pivot=Pivot;var HeaderStateBase=function(){function HeaderStateBase(pivot){this.pivot=pivot}return HeaderStateBase.prototype.exit=function(){},HeaderStateBase.prototype.render=function(goPrevious){},HeaderStateBase.prototype.activateHeader=function(header){},HeaderStateBase.prototype.handleNavigation=function(goPrevious,index,oldIndex){},HeaderStateBase.prototype.handleResize=function(){},HeaderStateBase.prototype.handleHeaderChanged=function(pivotItem){},HeaderStateBase.prototype.getCumulativeHeaderWidth=function(index){if(0===index)return 0;for(var originalLength=this.pivot._headersContainerElement.children.length,i=0;i<index;i++){var header=this.renderHeader(i,!1);this.pivot._headersContainerElement.appendChild(header)}var width=0,leftElement=this.pivot._rtl?this.pivot._headersContainerElement.lastElementChild:this.pivot._headersContainerElement.children[originalLength],rightElement=this.pivot._rtl?this.pivot._headersContainerElement.children[originalLength]:this.pivot._headersContainerElement.lastElementChild;width=rightElement.offsetLeft+rightElement.offsetWidth-leftElement.offsetLeft,width+=2*HeaderStateBase.headerHorizontalMargin;for(var i=0;i<index;i++)this.pivot._headersContainerElement.removeChild(this.pivot._headersContainerElement.lastElementChild);return width},HeaderStateBase.prototype.refreshHeadersState=function(invalidateCache){invalidateCache&&(this.cachedHeaderWidth=0);var width=this.cachedHeaderWidth||this.getCumulativeHeaderWidth(this.pivot.items.length);this.cachedHeaderWidth=width,width>this.pivot._getHeaderItemsWidth()&&!(this.pivot._headersState instanceof HeaderStateOverflow)?(this.exit(),this.pivot._headersState=new HeaderStateOverflow(this.pivot)):width<=this.pivot._getHeaderItemsWidth()&&!(this.pivot._headersState instanceof HeaderStateStatic)&&(this.exit(),this.pivot._headersState=new HeaderStateStatic(this.pivot))},HeaderStateBase.prototype.renderHeader=function(index,aria){function ariaSelectedMutated(){that.pivot._disposed||that.pivot._headersContainerElement.contains(headerContainerEl)&&index!==that.pivot.selectedIndex&&"true"===headerContainerEl.getAttribute("aria-selected")&&(that.pivot.selectedIndex=index)}var that=this,template=_ElementUtilities._syncRenderer(pivotDefaultHeaderTemplate),item=this.pivot.items.getAt(index),headerContainerEl=_Global.document.createElement("BUTTON");return headerContainerEl.tabIndex=-1,headerContainerEl.setAttribute("type","button"),headerContainerEl.style.marginLeft=headerContainerEl.style.marginRight=HeaderStateBase.headerHorizontalMargin+"px",_ElementUtilities.addClass(headerContainerEl,_Constants._ClassNames.pivotHeader),headerContainerEl._item=item,headerContainerEl._pivotItemIndex=index,template(item,headerContainerEl),aria&&(headerContainerEl.setAttribute("aria-selected",""+(index===this.pivot.selectedIndex)),headerContainerEl.setAttribute("role","tab"),new _ElementUtilities._MutationObserver(ariaSelectedMutated).observe(headerContainerEl,{attributes:!0,attributeFilter:["aria-selected"]})),headerContainerEl},HeaderStateBase.prototype.updateHeader=function(item){var index=this.pivot.items.indexOf(item),headerElement=this.pivot._headersContainerElement.children[index];headerElement.innerHTML="";var template=_ElementUtilities._syncRenderer(pivotDefaultHeaderTemplate);template(item,headerElement)},HeaderStateBase.prototype.setActiveHeader=function(newSelectedHeader){var focusWasInHeaders=!1,currentSelectedHeader=this.pivot._headersContainerElement.querySelector("."+_Constants._ClassNames.pivotHeaderSelected);currentSelectedHeader&&(currentSelectedHeader.classList.remove(_Constants._ClassNames.pivotHeaderSelected),currentSelectedHeader.setAttribute("aria-selected","false"),focusWasInHeaders=this.pivot._headersContainerElement.contains(_Global.document.activeElement)),newSelectedHeader.classList.add(_Constants._ClassNames.pivotHeaderSelected),newSelectedHeader.setAttribute("aria-selected","true"),focusWasInHeaders&&this.pivot._headersContainerElement.focus()},HeaderStateBase.headersContainerLeadingMargin=12,HeaderStateBase.headerHorizontalMargin=12,HeaderStateBase}(),HeaderStateStatic=function(_super){function HeaderStateStatic(pivot){if(_super.call(this,pivot),this._firstRender=!0,this._transitionAnimation=Promise.wrap(),pivot._headersContainerElement.children.length&&_TransitionAnimation.isAnimationEnabled()){var selectedHeader=pivot._headersContainerElement.querySelector("."+_Constants._ClassNames.pivotHeaderSelected),start=0,end=0;pivot._rtl?(start=selectedHeader.offsetLeft+selectedHeader.offsetWidth+HeaderStateBase.headerHorizontalMargin,end=pivot._getHeaderItemsWidth()-this.getCumulativeHeaderWidth(pivot.selectedIndex)-HeaderStateBase.headersContainerLeadingMargin,end+=parseFloat(pivot._headersContainerElement.style.marginLeft)):(start=selectedHeader.offsetLeft,start+=parseFloat(pivot._headersContainerElement.style.marginLeft),end=this.getCumulativeHeaderWidth(pivot.selectedIndex)+HeaderStateBase.headersContainerLeadingMargin+HeaderStateBase.headerHorizontalMargin);var offset=start-end;this.render();for(var transformProperty=_BaseUtils._browserStyleEquivalents.transform.cssName,transformValue="translateX("+offset+"px)",i=0,l=pivot._headersContainerElement.children.length;i<l;i++)pivot._headersContainerElement.children[i].style[transformProperty]=transformValue;this._transitionAnimation=_TransitionAnimation.executeTransition(pivot._headersContainerElement.querySelectorAll("."+_Constants._ClassNames.pivotHeader),{property:transformProperty,delay:0,duration:_headerSlideAnimationDuration,timing:"ease-out",to:""})}else this.render()}return __extends(HeaderStateStatic,_super),HeaderStateStatic.prototype.exit=function(){this._transitionAnimation.cancel()},HeaderStateStatic.prototype.render=function(){var pivot=this.pivot;if(!pivot._pendingRefresh&&pivot._items){if(_Dispose._disposeElement(pivot._headersContainerElement),_ElementUtilities.empty(pivot._headersContainerElement),pivot._rtl?(pivot._headersContainerElement.style.marginLeft="0px",pivot._headersContainerElement.style.marginRight=HeaderStateBase.headersContainerLeadingMargin+"px"):(pivot._headersContainerElement.style.marginLeft=HeaderStateBase.headersContainerLeadingMargin+"px",pivot._headersContainerElement.style.marginRight="0px"),pivot._viewportElement.style.overflow=1===pivot.items.length?"hidden":"",pivot.items.length)for(var i=0;i<pivot.items.length;i++){var header=this.renderHeader(i,!0);pivot._headersContainerElement.appendChild(header),i===pivot.selectedIndex&&header.classList.add(_Constants._ClassNames.pivotHeaderSelected)}this._firstRender=!1}},HeaderStateStatic.prototype.activateHeader=function(headerElement){this.setActiveHeader(headerElement),this.pivot._animateToPrevious=headerElement._pivotItemIndex<this.pivot.selectedIndex,this.pivot.selectedIndex=headerElement._pivotItemIndex,this.pivot._animateToPrevious=!1},HeaderStateStatic.prototype.handleNavigation=function(goPrevious,index,oldIndex){
this._firstRender&&this.render(),this.setActiveHeader(this.pivot._headersContainerElement.children[index])},HeaderStateStatic.prototype.handleResize=function(){this.refreshHeadersState(!1)},HeaderStateStatic.prototype.handleHeaderChanged=function(pivotItem){this.updateHeader(pivotItem),this.refreshHeadersState(!0)},HeaderStateStatic}(HeaderStateBase),HeaderStateOverflow=function(_super){function HeaderStateOverflow(pivot){if(_super.call(this,pivot),this._blocked=!1,this._firstRender=!0,this._transitionAnimation=Promise.wrap(),pivot._slideHeadersAnimation=Promise.wrap(),pivot._headersContainerElement.children.length&&_TransitionAnimation.isAnimationEnabled()){var that=this,done=function(){that._blocked=!1,that.render()};this._blocked=!0;var selectedHeader=pivot._headersContainerElement.querySelector("."+_Constants._ClassNames.pivotHeaderSelected),start=0,end=0;pivot._rtl?(start=pivot._getHeaderItemsWidth()-HeaderStateBase.headersContainerLeadingMargin,end=selectedHeader.offsetLeft,end+=HeaderStateBase.headerHorizontalMargin,end+=selectedHeader.offsetWidth,end+=parseFloat(pivot._headersContainerElement.style.marginLeft)):(start=HeaderStateBase.headersContainerLeadingMargin,end=selectedHeader.offsetLeft,end-=HeaderStateBase.headerHorizontalMargin,end+=parseFloat(pivot._headersContainerElement.style.marginLeft));for(var offset=start-end,i=0;i<pivot.selectedIndex;i++)pivot._headersContainerElement.appendChild(pivot._headersContainerElement.children[i].cloneNode(!0));var transformProperty=_BaseUtils._browserStyleEquivalents.transform.cssName;this._transitionAnimation=_TransitionAnimation.executeTransition(pivot._headersContainerElement.querySelectorAll("."+_Constants._ClassNames.pivotHeader),{property:transformProperty,delay:0,duration:_headerSlideAnimationDuration,timing:"ease-out",to:"translateX("+offset+"px)"}).then(done,done)}else this.render()}return __extends(HeaderStateOverflow,_super),HeaderStateOverflow.prototype.exit=function(){this._transitionAnimation.cancel(),this.pivot._slideHeadersAnimation.cancel()},HeaderStateOverflow.prototype.render=function(goPrevious){var pivot=this.pivot;if(!this._blocked&&!pivot._pendingRefresh&&pivot._items){var restoreFocus=pivot._headersContainerElement.contains(_Global.document.activeElement);if(_Dispose._disposeElement(pivot._headersContainerElement),_ElementUtilities.empty(pivot._headersContainerElement),1===pivot._items.length){var header=this.renderHeader(0,!0);header.classList.add(_Constants._ClassNames.pivotHeaderSelected),pivot._headersContainerElement.appendChild(header),pivot._viewportElement.style.overflow="hidden",pivot._headersContainerElement.style.marginLeft="0px",pivot._headersContainerElement.style.marginRight="0px"}else if(pivot._items.length>1){var numberOfHeadersToRender=pivot._items.length+(goPrevious?2:1),maxHeaderWidth=.8*pivot._getHeaderItemsWidth(),indexToRender=pivot.selectedIndex-1;pivot._viewportElement.style.overflow&&(pivot._viewportElement.style.overflow="");for(var i=0;i<numberOfHeadersToRender;i++){indexToRender===-1?indexToRender=pivot._items.length-1:indexToRender===pivot._items.length&&(indexToRender=0);var header=this.renderHeader(indexToRender,!0);pivot._headersContainerElement.appendChild(header),header.offsetWidth>maxHeaderWidth&&(header.style.textOverflow="ellipsis",header.style.width=maxHeaderWidth+"px"),indexToRender===pivot.selectedIndex&&header.classList.add(_Constants._ClassNames.pivotHeaderSelected),indexToRender++}if(!pivot._firstLoad&&!this._firstRender){var start,end;goPrevious?(start="",end="0"):(start="0",end="");var lastHeader=pivot._headersContainerElement.children[numberOfHeadersToRender-1];lastHeader.style.opacity=start;var lastHeaderFadeInDuration=.167;lastHeader.style[_BaseUtils._browserStyleEquivalents.transition.scriptName]="opacity "+_TransitionAnimation._animationTimeAdjustment(lastHeaderFadeInDuration)+"s",_ElementUtilities._getComputedStyle(lastHeader).opacity,lastHeader.style.opacity=end}pivot._headersContainerElement.children[0].setAttribute("aria-hidden","true"),pivot._headersContainerElement.style.marginLeft="0px",pivot._headersContainerElement.style.marginRight="0px";var leadingMargin=pivot._rtl?"marginRight":"marginLeft",firstHeader=pivot._headersContainerElement.children[0],leadingSpace=_ElementUtilities.getTotalWidth(firstHeader)-HeaderStateBase.headersContainerLeadingMargin;if(firstHeader!==pivot._headersContainerElement.children[0])return;pivot._headersContainerElement.style[leadingMargin]=-1*leadingSpace+"px",pivot._prevButton=_Global.document.createElement("button"),pivot._prevButton.setAttribute("type","button"),_ElementUtilities.addClass(pivot._prevButton,_Constants._ClassNames.pivotNavButton),_ElementUtilities.addClass(pivot._prevButton,_Constants._ClassNames.pivotNavButtonPrev),pivot._prevButton.addEventListener("click",function(){pivot.locked||(pivot._rtl?pivot._goNext():pivot._goPrevious())}),pivot._headersContainerElement.appendChild(pivot._prevButton),pivot._prevButton.style.left=pivot._rtl?"0px":leadingSpace+"px",pivot._nextButton=_Global.document.createElement("button"),pivot._nextButton.setAttribute("type","button"),_ElementUtilities.addClass(pivot._nextButton,_Constants._ClassNames.pivotNavButton),_ElementUtilities.addClass(pivot._nextButton,_Constants._ClassNames.pivotNavButtonNext),pivot._nextButton.addEventListener("click",function(){pivot.locked||(pivot._rtl?pivot._goPrevious():pivot._goNext())}),pivot._headersContainerElement.appendChild(pivot._nextButton),pivot._nextButton.style.right=pivot._rtl?leadingSpace+"px":"0px"}pivot._headersContainerElement.children.length>1?1:0;restoreFocus&&pivot._headersContainerElement.focus(),this._firstRender=!1}},HeaderStateOverflow.prototype.activateHeader=function(headerElement){headerElement.previousSibling&&(this.pivot.selectedIndex=headerElement._pivotItemIndex)},HeaderStateOverflow.prototype.handleNavigation=function(goPrevious,index,oldIndex){function offset(element){return rtl?element.offsetParent.offsetWidth-element.offsetLeft-element.offsetWidth:element.offsetLeft}function headerCleanup(){pivot._disposed||(that.render(goPrevious),pivot._slideHeadersAnimation=Promise.wrap())}var that=this,pivot=this.pivot;if(this._blocked||index<0||pivot._firstLoad)return void this.render(goPrevious);var targetHeader;if(goPrevious?targetHeader=pivot._headersContainerElement.children[0]:(index<oldIndex&&(index+=pivot._items.length),targetHeader=pivot._headersContainerElement.children[1+index-oldIndex]),!targetHeader)return void this.render(goPrevious);_ElementUtilities.removeClass(pivot._headersContainerElement.children[1],_Constants._ClassNames.pivotHeaderSelected),_ElementUtilities.addClass(targetHeader,_Constants._ClassNames.pivotHeaderSelected);var rtl=pivot._rtl,endPosition=offset(pivot._headersContainerElement.children[1])-offset(targetHeader);rtl&&(endPosition*=-1);var headerAnimation;headerAnimation=_TransitionAnimation.isAnimationEnabled()?_TransitionAnimation.executeTransition(pivot._headersContainerElement.querySelectorAll("."+_Constants._ClassNames.pivotHeader),{property:_BaseUtils._browserStyleEquivalents.transform.cssName,delay:0,duration:_headerSlideAnimationDuration,timing:"ease-out",to:"translateX("+endPosition+"px)"}):Promise.wrap(),pivot._slideHeadersAnimation=headerAnimation.then(headerCleanup,headerCleanup)},HeaderStateOverflow.prototype.handleResize=function(){this.refreshHeadersState(!1)},HeaderStateOverflow.prototype.handleHeaderChanged=function(pivotItem){this.render(),this.refreshHeadersState(!0)},HeaderStateOverflow}(HeaderStateBase);_Base.Class.mix(Pivot,_Events.createEventProperties(_EventNames.itemAnimationEnd,_EventNames.itemAnimationStart,_EventNames.selectionChanged)),_Base.Class.mix(Pivot,_Control.DOMEventMixin)}),define("WinJS/Controls/Pivot",["require","exports","../Core/_Base","./Pivot/_Item"],function(require,exports,_Base,_Item){_Item.touch;var module=null;_Base.Namespace.define("WinJS.UI",{Pivot:{get:function(){return module||require(["./Pivot/_Pivot"],function(m){module=m}),module.Pivot}}})}),define("WinJS/Controls/Hub/_Section",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Resources","../../ControlProcessor","../../Promise","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,ControlProcessor,Promise,_Control,_Dispose,_ElementUtilities,_KeyboardBehavior){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{HubSection:_Base.Namespace._lazy(function(){var strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get seeMore(){return _Resources._getWinJSString("ui/seeMore").value}},HubSection=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.HubSection.DuplicateConstruction",strings.duplicateConstruction);element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,HubSection._ClassName.hubSection),_ElementUtilities.addClass(this.element,"win-disposable"),this._headerElement=_Global.document.createElement("DIV"),this._headerElement.className=HubSection._ClassName.hubSectionHeader,this._headerElement.innerHTML='<button type="button" role="link" class="'+HubSection._ClassName.hubSectionInteractive+" "+HubSection._ClassName.hubSectionHeaderTabStop+'"><div class="'+HubSection._ClassName.hubSectionHeaderWrapper+'" tabindex="-1"><h2 class="win-type-subheader '+HubSection._ClassName.hubSectionHeaderContent+'"></h2><span class="'+HubSection._ClassName.hubSectionHeaderChevron+' win-type-body">'+strings.seeMore+"</span></div></button>",this._headerTabStopElement=this._headerElement.firstElementChild,this._headerWrapperElement=this._headerTabStopElement.firstElementChild,this._headerContentElement=this._headerWrapperElement.firstElementChild,this._headerChevronElement=this._headerWrapperElement.lastElementChild,element.appendChild(this._headerElement),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._headerElement),this._contentElement=_Global.document.createElement("DIV"),this._contentElement.className=HubSection._ClassName.hubSectionContent,this._contentElement.style.visibility="hidden",element.appendChild(this._contentElement);for(var elementToMove=this.element.firstChild;elementToMove!==this._headerElement;){var nextElement=elementToMove.nextSibling;this._contentElement.appendChild(elementToMove),elementToMove=nextElement}this._processors=[ControlProcessor.processAll],_Control.setOptions(this,options)},{element:{get:function(){return this._element}},isHeaderStatic:{get:function(){return this._isHeaderStatic},set:function(value){this._isHeaderStatic=value,this._isHeaderStatic?(this._headerTabStopElement.setAttribute("role","heading"),_ElementUtilities.removeClass(this._headerTabStopElement,HubSection._ClassName.hubSectionInteractive)):(this._headerTabStopElement.setAttribute("role","link"),_ElementUtilities.addClass(this._headerTabStopElement,HubSection._ClassName.hubSectionInteractive))}},contentElement:{get:function(){return this._contentElement}},header:{get:function(){return this._header},set:function(value){this._header=value,this._renderHeader()}},_setHeaderTemplate:function(template){this._template=_ElementUtilities._syncRenderer(template),this._renderHeader()},_renderHeader:function(){this._template&&(_Dispose._disposeElement(this._headerContentElement),_ElementUtilities.empty(this._headerContentElement),this._template(this,this._headerContentElement))},_process:function(){var that=this;return this._processed=(this._processors||[]).reduce(function(promise,processor){return promise.then(function(){return processor(that.contentElement)})},this._processed||Promise.as()),this._processors=null,this._processed},dispose:function(){this._disposed||(this._disposed=!0,this._processors=null,_Dispose._disposeElement(this._headerContentElement),_Dispose.disposeSubTree(this.contentElement))}},{_ClassName:{hubSection:"win-hub-section",hubSectionHeader:"win-hub-section-header",hubSectionHeaderTabStop:"win-hub-section-header-tabstop",hubSectionHeaderWrapper:"win-hub-section-header-wrapper",hubSectionInteractive:"win-hub-section-header-interactive",hubSectionHeaderContent:"win-hub-section-header-content",hubSectionHeaderChevron:"win-hub-section-header-chevron",hubSectionContent:"win-hub-section-content"},isDeclarativeControlContainer:_BaseUtils.markSupportedForProcessing(function(section,callback){callback!==ControlProcessor.processAll&&(section._processors=section._processors||[],section._processors.push(callback),section._processed&&section._process())})});return HubSection})})}),define("require-style!less/styles-hub",[],function(){}),define("require-style!less/colors-hub",[],function(){}),define("WinJS/Controls/Hub",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../_Accents","../Animations","../Animations/_TransitionAnimation","../BindingList","../ControlProcessor","../Promise","../_Signal","../Scheduler","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_UI","./ElementResizeInstrument","./Hub/_Section","require-style!less/styles-hub","require-style!less/colors-hub"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,_Accents,Animations,_TransitionAnimation,BindingList,ControlProcessor,Promise,_Signal,Scheduler,_Control,_ElementUtilities,_Hoverable,_UI,_ElementResizeInstrument,_Section){"use strict";_Accents.createAccentRule(".win-semanticzoom-zoomedoutview .win-hub-section-header-interactive .win-hub-section-header-content,             .win-hub-section-header-interactive .win-hub-section-header-chevron",[{name:"color",value:_Accents.ColorTypes.accent}]),_Base.Namespace.define("WinJS.UI",{Hub:_Base.Namespace._lazy(function(){function hubDefaultHeaderTemplate(section){var element=_Global.document.createTextNode("object"==typeof section.header?JSON.stringify(section.header):""+section.header);return element}var Key=_ElementUtilities.Key,createEvent=_Events._createEventProperty,eventNames={contentAnimating:"contentanimating",headerInvoked:"headerinvoked",loadingStateChanged:"loadingstatechanged"},progressDelay=500,verticalNames={scrollPos:"scrollTop",scrollSize:"scrollHeight",offsetPos:"offsetTop",offsetSize:"offsetHeight",oppositeOffsetSize:"offsetWidth",marginStart:"marginTop",marginEnd:"marginBottom",borderStart:"borderTopWidth",borderEnd:"borderBottomWidth",paddingStart:"paddingTop",paddingEnd:"paddingBottom"},rtlHorizontalNames={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginRight",marginEnd:"marginLeft",borderStart:"borderRightWidth",borderEnd:"borderLeftWidth",paddingStart:"paddingRight",paddingEnd:"paddingLeft"},ltrHorizontalNames={scrollPos:"scrollLeft",scrollSize:"scrollWidth",offsetPos:"offsetLeft",offsetSize:"offsetWidth",oppositeOffsetSize:"offsetHeight",marginStart:"marginLeft",marginEnd:"marginRight",borderStart:"borderLeftWidth",borderEnd:"borderRightWidth",paddingStart:"paddingLeft",paddingEnd:"paddingRight"},Hub=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.Hub.DuplicateConstruction",strings.duplicateConstruction);this._id=element.id||_ElementUtilities._uniqueID(element),this._writeProfilerMark("constructor,StartTM"),this._windowKeyDownHandlerBound=this._windowKeyDownHandler.bind(this),_Global.addEventListener("keydown",this._windowKeyDownHandlerBound),element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,Hub._ClassName.hub),_ElementUtilities.addClass(this.element,"win-disposable"),this._parse(),this._viewportElement=_Global.document.createElement("DIV"),this._viewportElement.className=Hub._ClassName.hubViewport,this._element.appendChild(this._viewportElement),this._viewportElement.setAttribute("role","group"),this._viewportElement.setAttribute("aria-label",strings.hubViewportAriaLabel),this._surfaceElement=_Global.document.createElement("DIV"),this._surfaceElement.className=Hub._ClassName.hubSurface,this._viewportElement.appendChild(this._surfaceElement),this._visible=!1,this._viewportElement.style.opacity=0,options.orientation||(this._orientation=_UI.Orientation.horizontal,_ElementUtilities.addClass(this.element,Hub._ClassName.hubHorizontal)),this._fireEntrance=!0,this._animateEntrance=!0,this._loadId=0,this.runningAnimations=new Promise.wrap,this._currentIndexForSezo=0,_Control.setOptions(this,options),_ElementUtilities._addEventListener(this.element,"focusin",this._focusin.bind(this),!1),this.element.addEventListener("keydown",this._keyDownHandler.bind(this)),this.element.addEventListener("click",this._clickHandler.bind(this)),this._viewportElement.addEventListener("scroll",this._scrollHandler.bind(this)),this._resizeHandlerBound=this._resizeHandler.bind(this),this._elementResizeInstrument=new _ElementResizeInstrument._ElementResizeInstrument,this._element.appendChild(this._elementResizeInstrument.element),this._elementResizeInstrument.addEventListener("resize",this._resizeHandlerBound);var that=this;_ElementUtilities._inDom(this.element).then(function(){that._disposed||that._elementResizeInstrument.addedToDom()}),_ElementUtilities._resizeNotifier.subscribe(this.element,this._resizeHandlerBound),this._handleSectionChangedBind=this._handleSectionChanged.bind(this),this._handleSectionInsertedBind=this._handleSectionInserted.bind(this),this._handleSectionMovedBind=this._handleSectionMoved.bind(this),this._handleSectionRemovedBind=this._handleSectionRemoved.bind(this),this._handleSectionReloadBind=this._handleSectionReload.bind(this),this._refresh(),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},orientation:{get:function(){return this._orientation},set:function(value){if(value!==this._orientation){if(this._measured=!1,this._names){var newScrollPos={};newScrollPos[this._names.scrollPos]=0,_ElementUtilities.setScrollPosition(this._viewportElement,newScrollPos)}value===_UI.Orientation.vertical?(_ElementUtilities.removeClass(this.element,Hub._ClassName.hubHorizontal),_ElementUtilities.addClass(this.element,Hub._ClassName.hubVertical)):(value=_UI.Orientation.horizontal,_ElementUtilities.removeClass(this.element,Hub._ClassName.hubVertical),_ElementUtilities.addClass(this.element,Hub._ClassName.hubHorizontal)),this._orientation=value,Scheduler.schedule(this._updateSnapList.bind(this),Scheduler.Priority.idle)}}},sections:{get:function(){return this._pendingSections?this._pendingSections:this._sections},set:function(value){var resetScrollPosition=!this._pendingSections;this._pendingSections=value,this._refresh(),resetScrollPosition&&(this.scrollPosition=0)}},headerTemplate:{get:function(){return this._pendingHeaderTemplate?this._pendingHeaderTemplate:(this._headerTemplate||(this._headerTemplate=hubDefaultHeaderTemplate),this._headerTemplate)},set:function(value){this._pendingHeaderTemplate=value||hubDefaultHeaderTemplate,this._refresh()}},scrollPosition:{get:function(){return+this._pendingScrollLocation===this._pendingScrollLocation?this._pendingScrollLocation:(this._measure(),this._scrollPosition)},set:function(value){if(value=Math.max(0,value),this._pendingRefresh)this._pendingScrollLocation=value,this._pendingSectionOnScreen=null;else{this._measure();var targetScrollPos=Math.max(0,Math.min(this._scrollLength-this._viewportSize,value));this._scrollPosition=targetScrollPos;var newScrollPos={};newScrollPos[this._names.scrollPos]=targetScrollPos,_ElementUtilities.setScrollPosition(this._viewportElement,newScrollPos)}}},sectionOnScreen:{get:function(){if(+this._pendingSectionOnScreen===this._pendingSectionOnScreen)return this._pendingSectionOnScreen;this._measure();for(var i=0;i<this._sectionSizes.length;i++){var sectionSize=this._sectionSizes[i];if(sectionSize.offset+sectionSize.size-sectionSize.borderEnd-sectionSize.paddingEnd>this._scrollPosition+this._startSpacer+sectionSize.borderStart+sectionSize.paddingStart)return i}return-1},set:function(value){value=Math.max(0,value),this._pendingRefresh?(this._pendingSectionOnScreen=value,this._pendingScrollLocation=null):(this._measure(),value>=0&&value<this._sectionSizes.length&&this._scrollToSection(value))}},indexOfFirstVisible:{get:function(){this._measure();for(var i=0;i<this._sectionSizes.length;i++){var sectionSize=this._sectionSizes[i];if(sectionSize.offset+sectionSize.size-sectionSize.borderEnd-sectionSize.paddingEnd>this._scrollPosition)return i}return-1}},indexOfLastVisible:{get:function(){this._measure();for(var i=this._sectionSizes.length-1;i>=0;i--){var sectionSize=this._sectionSizes[i];if(sectionSize.offset+sectionSize.paddingStart+sectionSize.borderStart<this._scrollPosition+this._viewportSize)return i}return-1}},onheaderinvoked:createEvent(eventNames.headerInvoked),onloadingstatechanged:createEvent(eventNames.loadingStateChanged),oncontentanimating:createEvent(eventNames.contentAnimating),_refresh:function(){this._pendingRefresh||(this._loadId++,this._setState(Hub.LoadingState.loading),this._pendingRefresh=!0,Scheduler.schedule(this._refreshImpl.bind(this),Scheduler.Priority.high))},_refreshImpl:function(){if(!this._disposed){var fadeOutAnimation=Promise.wrap();if(this._pendingSections&&(this._animateEntrance=!0,this._fireEntrance=!this._visible,!this._fireEntrance&&(this._visible=!1,this._viewportElement.style.opacity=0,_TransitionAnimation.isAnimationEnabled()))){var animateTransition=this._fireEvent(Hub._EventName.contentAnimating,{type:Hub.AnimationType.contentTransition});animateTransition&&(this._viewportElement.style["-ms-overflow-style"]="none",fadeOutAnimation=Animations.fadeOut(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]=""}.bind(this))),this._animateEntrance=animateTransition}fadeOutAnimation.done(this._applyProperties.bind(this))}},_applyProperties:function(){if(!this._disposed){this._pendingRefresh=!1;var needsToLoadSections=!1;this._pendingSections&&(needsToLoadSections=!0,this._updateEvents(this._sections,this._pendingSections),this._sections&&this._sections.forEach(function(section){var el=section.element;el.parentElement.removeChild(el)}),this._sections=this._pendingSections,this._pendingSections=null),this._pendingHeaderTemplate&&(this._headerTemplate=this._pendingHeaderTemplate,this._pendingHeaderTemplate=null),this._assignHeaderTemplate(),needsToLoadSections&&this._attachSections(),+this._pendingSectionOnScreen===this._pendingSectionOnScreen?this.sectionOnScreen=this._pendingSectionOnScreen:+this._pendingScrollLocation===this._pendingScrollLocation?this.scrollPosition=this._pendingScrollLocation:this.scrollPosition=0,this._pendingSectionOnScreen=null,this._pendingScrollLocation=null,this._setState(Hub.LoadingState.loading),this._loadSections()}},_handleSectionChanged:function(ev){if(!this._pendingSections){var newSection=ev.detail.newValue,oldSection=ev.detail.oldValue;if(newSection._setHeaderTemplate(this.headerTemplate),newSection.element!==oldSection.element){if(newSection.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Hub.DuplicateSection",strings.duplicateSection);this._surfaceElement.insertBefore(newSection.element,oldSection.element),this._surfaceElement.removeChild(oldSection.element),this._measured=!1,this._setState(Hub.LoadingState.loading),this._loadSections()}}},_handleSectionInserted:function(ev){if(!this._pendingSections){var index=ev.detail.index,section=ev.detail.value;section._animation&&section._animation.cancel();var animation,result=this._fireEvent(Hub._EventName.contentAnimating,{type:Hub.AnimationType.insert,index:index,section:section});if(result){for(var affectedElements=[],i=index+1;i<this.sections.length;i++)affectedElements.push(this.sections.getAt(i).element);animation=new Animations._createUpdateListAnimation([section.element],[],affectedElements)}if(section.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Hub.DuplicateSection",strings.duplicateSection);if(section._setHeaderTemplate(this.headerTemplate),index<this.sections.length-1?this._surfaceElement.insertBefore(section.element,this.sections.getAt(index+1).element):this._surfaceElement.appendChild(section.element),this._measured=!1,animation){var insertAnimation=animation.execute();this.runningAnimations=Promise.join([this.runningAnimations,insertAnimation])}this._setState(Hub.LoadingState.loading),this._loadSections()}},_handleSectionMoved:function(ev){if(!this._pendingSections){var newIndex=ev.detail.newIndex,section=ev.detail.value;newIndex<this.sections.length-1?this._surfaceElement.insertBefore(section.element,this.sections.getAt(newIndex+1).element):this._surfaceElement.appendChild(section.element),this._measured=!1,this._setState(Hub.LoadingState.loading),this._loadSections()}},_handleSectionRemoved:function(ev){if(!this._pendingSections){var section=ev.detail.value,index=ev.detail.index,animationPromise=Promise.wrap(),result=this._fireEvent(Hub._EventName.contentAnimating,{type:Hub.AnimationType.remove,index:index,section:section});if(result){for(var affectedElements=[],i=index;i<this.sections.length;i++)affectedElements.push(this.sections.getAt(i).element);var animation=new Animations._createUpdateListAnimation([],[section.element],affectedElements);this._measure();var offsetTop=section.element.offsetTop,offsetLeft=section.element.offsetLeft;section.element.style.position="absolute",section.element.style.top=offsetTop,section.element.style.left=offsetLeft,section.element.style.opacity=0,this._measured=!1,animationPromise=animation.execute().then(function(){section.element.style.position="",section.element.style.top="",section.element.style.left="",section.element.style.opacity=1}.bind(this))}animationPromise.done(function(){this._disposed||(this._surfaceElement.removeChild(section.element),this._measured=!1)}.bind(this)),section._animation=animationPromise,this.runningAnimations=Promise.join([this.runningAnimations,animationPromise]),this._setState(Hub.LoadingState.loading),this._loadSections()}},_handleSectionReload:function(){this.sections=this.sections},_updateEvents:function(oldSections,newSections){oldSections&&(oldSections.removeEventListener("itemchanged",this._handleSectionChangedBind),oldSections.removeEventListener("iteminserted",this._handleSectionInsertedBind),oldSections.removeEventListener("itemmoved",this._handleSectionMovedBind),oldSections.removeEventListener("itemremoved",this._handleSectionRemovedBind),oldSections.removeEventListener("reload",this._handleSectionReloadBind)),newSections&&(newSections.addEventListener("itemchanged",this._handleSectionChangedBind),newSections.addEventListener("iteminserted",this._handleSectionInsertedBind),newSections.addEventListener("itemmoved",this._handleSectionMovedBind),newSections.addEventListener("itemremoved",this._handleSectionRemovedBind),newSections.addEventListener("reload",this._handleSectionReloadBind))},_attachSections:function(){this._measured=!1;for(var i=0;i<this.sections.length;i++){var section=this._sections.getAt(i);if(section._animation&&section._animation.cancel(),section.element.parentNode===this._surfaceElement)throw new _ErrorFromName("WinJS.UI.Hub.DuplicateSection",strings.duplicateSection);this._surfaceElement.appendChild(section.element)}},_assignHeaderTemplate:function(){this._measured=!1;for(var i=0;i<this.sections.length;i++){var section=this._sections.getAt(i);section._setHeaderTemplate(this.headerTemplate)}},_loadSection:function(index){var section=this._sections.getAt(index);return section._process().then(function(){var style=section.contentElement.style;""!==style.visibility&&(style.visibility="")})},_loadSections:function(){function loadNextSectionAfterPromise(promise){promise.then(function(){Scheduler.schedule(loadNextSection,Scheduler.Priority.idle)})}function loadNextSection(){if(loadId===that._loadId&&!that._disposed)if(sectionIndicesToLoad.length){var index=sectionIndicesToLoad.shift(),loadedPromise=that._loadSection(index);loadNextSectionAfterPromise(loadedPromise)}else allSectionsLoadedSignal.complete()}this._loadId++;var loadId=this._loadId,that=this,onScreenItemsAnimatedPromise=Promise.wrap(),sectionIndicesToLoad=[],allSectionsLoadedPromise=Promise.wrap();if(this._showProgressPromise||(this._showProgressPromise=Promise.timeout(progressDelay).then(function(){this._disposed||(this._progressBar||(this._progressBar=_Global.document.createElement("progress"),_ElementUtilities.addClass(this._progressBar,Hub._ClassName.hubProgress),this._progressBar.max=100),this._progressBar.parentNode||this.element.insertBefore(this._progressBar,this._viewportElement),this._showProgressPromise=null)}.bind(this),function(){this._showProgressPromise=null}.bind(this))),this.sections.length){var allSectionsLoadedSignal=new _Signal;allSectionsLoadedPromise=allSectionsLoadedSignal.promise;for(var synchronousProcessPromises=[],start=Math.max(0,this.indexOfFirstVisible),end=Math.max(0,this.indexOfLastVisible),i=start;i<=end;i++)synchronousProcessPromises.push(this._loadSection(i));for(start--,end++;start>=0||end<this.sections.length;)end<this.sections.length&&(sectionIndicesToLoad.push(end),end++),start>=0&&(sectionIndicesToLoad.push(start),start--);var onScreenSectionsLoadedPromise=Promise.join(synchronousProcessPromises);onScreenSectionsLoadedPromise.done(function(){loadId!==this._loadId||that._disposed||(this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar),Scheduler.schedule(function(){if(loadId===this._loadId&&!that._disposed&&!this._visible){if(this._visible=!0,this._viewportElement.style.opacity=1,this._animateEntrance&&_TransitionAnimation.isAnimationEnabled()){var eventDetail={type:Hub.AnimationType.entrance};this._fireEntrance&&!this._fireEvent(Hub._EventName.contentAnimating,eventDetail)||(this._viewportElement.style["-ms-overflow-style"]="none",onScreenItemsAnimatedPromise=Animations.enterContent(this._viewportElement).then(function(){this._viewportElement.style["-ms-overflow-style"]="",this._viewportElement.onmousewheel=function(){}}.bind(this)))}this._element===_Global.document.activeElement&&this._moveFocusIn(this.sectionOnScreen)}},Scheduler.Priority.high,this,"WinJS.UI.Hub.entranceAnimation"))}.bind(this)),loadNextSectionAfterPromise(onScreenSectionsLoadedPromise)}else this._showProgressPromise&&this._showProgressPromise.cancel(),this._progressBar&&this._progressBar.parentNode&&this._progressBar.parentNode.removeChild(this._progressBar);Promise.join([this.runningAnimations,onScreenItemsAnimatedPromise,allSectionsLoadedPromise]).done(function(){loadId!==this._loadId||that._disposed||(this.runningAnimations=Promise.wrap(),this._measured&&this._scrollLength!==this._viewportElement[this._names.scrollSize]&&(this._measured=!1),this._setState(Hub.LoadingState.complete),Scheduler.schedule(this._updateSnapList.bind(this),Scheduler.Priority.idle))}.bind(this))},loadingState:{get:function(){return this._loadingState}},_setState:function(state){if(state!==this._loadingState){this._writeProfilerMark("loadingStateChanged:"+state+",info"),this._loadingState=state;var eventObject=_Global.document.createEvent("CustomEvent");eventObject.initCustomEvent(Hub._EventName.loadingStateChanged,!0,!1,{loadingState:state}),this._element.dispatchEvent(eventObject)}},_parse:function(){for(var hubSections=[],hubSectionEl=this.element.firstElementChild;hubSectionEl;){ControlProcessor.processAll(hubSectionEl);
var hubSectionContent=hubSectionEl.winControl;if(!hubSectionContent)throw new _ErrorFromName("WinJS.UI.Hub.InvalidContent",strings.invalidContent);hubSections.push(hubSectionContent);var nextSectionEl=hubSectionEl.nextElementSibling;hubSectionEl.parentElement.removeChild(hubSectionEl),hubSectionEl=nextSectionEl}this.sections=new BindingList.List(hubSections)},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent(type,!0,!0,detail),this.element.dispatchEvent(event)},_findHeaderTabStop:function(element){if(element.parentNode&&_ElementUtilities._matchesSelector(element,".win-hub-section-header-tabstop, .win-hub-section-header-tabstop *")){for(;!_ElementUtilities.hasClass(element,"win-hub-section-header-tabstop");)element=element.parentElement;return element}return null},_isInteractive:function(element){for(;element&&element!==_Global.document.body;){if(_ElementUtilities.hasClass(element,"win-interactive"))return!0;element=element.parentElement}return!1},_clickHandler:function(ev){var headerTabStopElement=this._findHeaderTabStop(ev.target);if(headerTabStopElement&&!this._isInteractive(ev.target)){var section=headerTabStopElement.parentElement.parentElement.winControl;if(!section.isHeaderStatic){var sectionIndex=this.sections.indexOf(section);this._fireEvent(Hub._EventName.headerInvoked,{index:sectionIndex,section:section})}}},_resizeHandler:function(){this._measured=!1,Scheduler.schedule(this._updateSnapList.bind(this),Scheduler.Priority.idle)},_scrollHandler:function(){this._measured=!1,this._pendingSections||(this._pendingScrollLocation=null,this._pendingSectionOnScreen=null,this._pendingScrollHandler||(this._pendingScrollHandler=_BaseUtils._requestAnimationFrame(function(){this._pendingScrollHandler=null,this._pendingSections||this.loadingState!==Hub.LoadingState.complete&&this._loadSections()}.bind(this))))},_measure:function(){if(!this._measured||0===this._scrollLength){this._writeProfilerMark("measure,StartTM"),this._measured=!0,this._rtl="rtl"===_ElementUtilities._getComputedStyle(this._element,null).direction,this.orientation===_UI.Orientation.vertical?this._names=verticalNames:this._rtl?this._names=rtlHorizontalNames:this._names=ltrHorizontalNames,this._viewportSize=this._viewportElement[this._names.offsetSize],this._viewportOppositeSize=this._viewportElement[this._names.oppositeOffsetSize],this._scrollPosition=_ElementUtilities.getScrollPosition(this._viewportElement)[this._names.scrollPos],this._scrollLength=this._viewportElement[this._names.scrollSize];var surfaceElementComputedStyle=_ElementUtilities._getComputedStyle(this._surfaceElement);this._startSpacer=parseFloat(surfaceElementComputedStyle[this._names.marginStart])+parseFloat(surfaceElementComputedStyle[this._names.borderStart])+parseFloat(surfaceElementComputedStyle[this._names.paddingStart]),this._endSpacer=parseFloat(surfaceElementComputedStyle[this._names.marginEnd])+parseFloat(surfaceElementComputedStyle[this._names.borderEnd])+parseFloat(surfaceElementComputedStyle[this._names.paddingEnd]),this._sectionSizes=[];for(var i=0;i<this.sections.length;i++){var section=this.sections.getAt(i),computedSectionStyle=_ElementUtilities._getComputedStyle(section.element);this._sectionSizes[i]={offset:section.element[this._names.offsetPos],size:section.element[this._names.offsetSize],marginStart:parseFloat(computedSectionStyle[this._names.marginStart]),marginEnd:parseFloat(computedSectionStyle[this._names.marginEnd]),borderStart:parseFloat(computedSectionStyle[this._names.borderStart]),borderEnd:parseFloat(computedSectionStyle[this._names.borderEnd]),paddingStart:parseFloat(computedSectionStyle[this._names.paddingStart]),paddingEnd:parseFloat(computedSectionStyle[this._names.paddingEnd])},this._rtl&&this.orientation===_UI.Orientation.horizontal&&(this._sectionSizes[i].offset=this._viewportSize-(this._sectionSizes[i].offset+this._sectionSizes[i].size))}this._writeProfilerMark("measure,StopTM")}},_updateSnapList:function(){this._writeProfilerMark("updateSnapList,StartTM"),this._measure();for(var snapList="snapList(",i=0;i<this._sectionSizes.length;i++){i>0&&(snapList+=",");var sectionSize=this._sectionSizes[i];snapList+=sectionSize.offset-sectionSize.marginStart-this._startSpacer+"px"}snapList+=")";var snapListY="",snapListX="";this.orientation===_UI.Orientation.vertical?snapListY=snapList:snapListX=snapList,this._lastSnapPointY!==snapListY&&(this._lastSnapPointY=snapListY,this._viewportElement.style["-ms-scroll-snap-points-y"]=snapListY),this._lastSnapPointX!==snapListX&&(this._lastSnapPointX=snapListX,this._viewportElement.style["-ms-scroll-snap-points-x"]=snapListX),this._writeProfilerMark("updateSnapList,StopTM")},_scrollToSection:function(index,withAnimation){this._measure();var sectionSize=this._sectionSizes[index],scrollPositionToShowStartMargin=Math.min(this._scrollLength-this._viewportSize,sectionSize.offset-sectionSize.marginStart-this._startSpacer);this._scrollTo(scrollPositionToShowStartMargin,withAnimation)},_ensureVisible:function(index,withAnimation){this._measure();var targetScrollPos=this._ensureVisibleMath(index,this._scrollPosition);this._scrollTo(targetScrollPos,withAnimation)},_ensureVisibleMath:function(index,targetScrollPos){this._measure();var sectionSize=this._sectionSizes[index],scrollPositionToShowStartMargin=Math.min(this._scrollLength-this._viewportSize,sectionSize.offset-sectionSize.marginStart-this._startSpacer),scrollPositionToShowEndMargin=Math.max(0,sectionSize.offset+sectionSize.size+sectionSize.marginEnd+this._endSpacer-this._viewportSize+1);return targetScrollPos>scrollPositionToShowStartMargin?targetScrollPos=scrollPositionToShowStartMargin:targetScrollPos<scrollPositionToShowEndMargin&&(targetScrollPos=Math.min(scrollPositionToShowStartMargin,scrollPositionToShowEndMargin)),targetScrollPos},_scrollTo:function(scrollPos,withAnimation){if(this._scrollPosition=scrollPos,withAnimation)this.orientation===_UI.Orientation.vertical?_ElementUtilities._zoomTo(this._viewportElement,{contentX:0,contentY:this._scrollPosition,viewportX:0,viewportY:0}):_ElementUtilities._zoomTo(this._viewportElement,{contentX:this._scrollPosition,contentY:0,viewportX:0,viewportY:0});else{var newScrollPos={};newScrollPos[this._names.scrollPos]=this._scrollPosition,_ElementUtilities.setScrollPosition(this._viewportElement,newScrollPos)}},_windowKeyDownHandler:function(ev){if(ev.keyCode===Key.tab){this._tabSeenLast=!0;var that=this;_BaseUtils._yieldForEvents(function(){that._tabSeenLast=!1})}},_focusin:function(ev){if(this._tabSeenLast){var headerTabStopElement=this._findHeaderTabStop(ev.target);if(headerTabStopElement&&!this._isInteractive(ev.target)){var sectionIndex=this.sections.indexOf(headerTabStopElement.parentElement.parentElement.winControl);sectionIndex>-1&&this._ensureVisible(sectionIndex,!0)}}for(var sectionElement=ev.target;sectionElement&&!_ElementUtilities.hasClass(sectionElement,_Section.HubSection._ClassName.hubSection);)sectionElement=sectionElement.parentElement;if(sectionElement){var sectionIndex=this.sections.indexOf(sectionElement.winControl);sectionIndex>-1&&(this._currentIndexForSezo=sectionIndex)}if(ev.target===this.element){var indexToFocus;+this._sectionToFocus===this._sectionToFocus&&this._sectionToFocus>=0&&this._sectionToFocus<this.sections.length?(indexToFocus=this._sectionToFocus,this._sectionToFocus=null):indexToFocus=this.sectionOnScreen,this._moveFocusIn(indexToFocus)}},_moveFocusIn:function(indexToFocus){if(indexToFocus>=0){for(var i=indexToFocus;i<this.sections.length;i++){var section=this.sections.getAt(i),focusAttempt=_ElementUtilities._trySetActive(section._headerTabStopElement,this._viewportElement);if(focusAttempt)return;if(_ElementUtilities._setActiveFirstFocusableElement(section.contentElement,this._viewportElement))return}for(var i=indexToFocus-1;i>=0;i--){var section=this.sections.getAt(i);if(_ElementUtilities._setActiveFirstFocusableElement(section.contentElement,this._viewportElement))return;var focusAttempt=_ElementUtilities._trySetActive(section._headerTabStopElement,this._viewportElement);if(focusAttempt)return}}},_keyDownHandler:function(ev){if(!this._isInteractive(ev.target)&&!_ElementUtilities._hasCursorKeysBehaviors(ev.target)){var leftKey=this._rtl?Key.rightArrow:Key.leftArrow,rightKey=this._rtl?Key.leftArrow:Key.rightArrow;if(ev.keyCode===Key.upArrow||ev.keyCode===Key.downArrow||ev.keyCode===Key.leftArrow||ev.keyCode===Key.rightArrow||ev.keyCode===Key.pageUp||ev.keyCode===Key.pageDown){var headerTabStopElement=this._findHeaderTabStop(ev.target);if(headerTabStopElement){var targetSectionIndex,currentSection=this.sections.indexOf(headerTabStopElement.parentElement.parentElement.winControl),useEnsureVisible=!1;if(ev.keyCode===Key.pageDown||this.orientation===_UI.Orientation.horizontal&&ev.keyCode===rightKey||this.orientation===_UI.Orientation.vertical&&ev.keyCode===Key.downArrow){for(var i=currentSection+1;i<this.sections.length;i++)if(this._tryFocus(i)){targetSectionIndex=i;break}}else if(ev.keyCode===Key.pageUp||this.orientation===_UI.Orientation.horizontal&&ev.keyCode===leftKey||this.orientation===_UI.Orientation.vertical&&ev.keyCode===Key.upArrow)for(var i=currentSection-1;i>=0;i--)if(this._tryFocus(i)){targetSectionIndex=i;break}ev.keyCode!==Key.upArrow&&ev.keyCode!==Key.downArrow&&ev.keyCode!==Key.leftArrow&&ev.keyCode!==Key.rightArrow||(useEnsureVisible=!0),+targetSectionIndex===targetSectionIndex&&(useEnsureVisible?this._ensureVisible(targetSectionIndex,!0):this._scrollToSection(targetSectionIndex,!0),ev.preventDefault())}}else if(ev.keyCode===Key.home||ev.keyCode===Key.end){this._measure();var maxScrollPos=Math.max(0,this._scrollLength-this._viewportSize);this._scrollTo(ev.keyCode===Key.home?0:maxScrollPos,!0),ev.preventDefault()}}},_tryFocus:function(index){var targetSection=this.sections.getAt(index);return _ElementUtilities._setActive(targetSection._headerTabStopElement,this._viewportElement),_Global.document.activeElement===targetSection._headerTabStopElement},zoomableView:{get:function(){return this._zoomableView||(this._zoomableView=new ZoomableView(this)),this._zoomableView}},_getPanAxis:function(){return this.orientation===_UI.Orientation.horizontal?"horizontal":"vertical"},_configureForZoom:function(){},_setCurrentItem:function(x,y){var offset;offset=this.orientation===_UI.Orientation.horizontal?x:y,this._measure(),offset+=this._scrollPosition,this._currentIndexForSezo=this._sectionSizes.length-1;for(var i=1;i<this._sectionSizes.length;i++){var sectionSize=this._sectionSizes[i];if(sectionSize.offset-sectionSize.marginStart>offset){this._currentIndexForSezo=i-1;break}}},_getCurrentItem:function(){var itemPosition;if(this._sectionSizes.length>0){this._measure();var index=Math.max(0,Math.min(this._currentIndexForSezo,this._sectionSizes.length)),sectionSize=this._sectionSizes[index];itemPosition=this.orientation===_UI.Orientation.horizontal?{left:Math.max(0,sectionSize.offset-sectionSize.marginStart-this._scrollPosition),top:0,width:sectionSize.size,height:this._viewportOppositeSize}:{left:0,top:Math.max(0,sectionSize.offset-sectionSize.marginStart-this._scrollPosition),width:this._viewportOppositeSize,height:sectionSize.size};var section=this.sections.getAt(index);return Promise.wrap({item:{data:section,index:index,groupIndexHint:index},position:itemPosition})}},_beginZoom:function(){this._viewportElement.style["-ms-overflow-style"]="none"},_positionItem:function(item,position){if(item.index>=0&&item.index<this._sectionSizes.length){this._measure();var offsetFromViewport,sectionSize=this._sectionSizes[item.index];offsetFromViewport=this.orientation===_UI.Orientation.horizontal?position.left:position.top,this._sectionToFocus=item.index;var targetScrollPosition=sectionSize.offset-offsetFromViewport,targetScrollPosition=this._ensureVisibleMath(item.index,targetScrollPosition);this._scrollPosition=targetScrollPosition;var newScrollPos={};newScrollPos[this._names.scrollPos]=this._scrollPosition,_ElementUtilities.setScrollPosition(this._viewportElement,newScrollPos)}},_endZoom:function(){this._viewportElement.style["-ms-overflow-style"]=""},_writeProfilerMark:function(text){var message="WinJS.UI.Hub:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"hubprofiler")},dispose:function(){if(!this._disposed){this._disposed=!0,_Global.removeEventListener("keydown",this._windowKeyDownHandlerBound),_ElementUtilities._resizeNotifier.unsubscribe(this.element,this._resizeHandlerBound),this._elementResizeInstrument.dispose(),this._updateEvents(this._sections);for(var i=0;i<this.sections.length;i++)this.sections.getAt(i).dispose()}},forceLayout:function(){this._resizeHandler()}},{AnimationType:{entrance:"entrance",contentTransition:"contentTransition",insert:"insert",remove:"remove"},LoadingState:{loading:"loading",complete:"complete"},_ClassName:{hub:"win-hub",hubSurface:"win-hub-surface",hubProgress:"win-hub-progress",hubViewport:"win-hub-viewport",hubVertical:"win-hub-vertical",hubHorizontal:"win-hub-horizontal"},_EventName:{contentAnimating:eventNames.contentAnimating,headerInvoked:eventNames.headerInvoked,loadingStateChanged:eventNames.loadingStateChanged}});_Base.Class.mix(Hub,_Control.DOMEventMixin);var ZoomableView=_Base.Class.define(function(hub){this._hub=hub},{getPanAxis:function(){return this._hub._getPanAxis()},configureForZoom:function(isZoomedOut,isCurrentView,triggerZoom,prefetchedPages){this._hub._configureForZoom(isZoomedOut,isCurrentView,triggerZoom,prefetchedPages)},setCurrentItem:function(x,y){this._hub._setCurrentItem(x,y)},getCurrentItem:function(){return this._hub._getCurrentItem()},beginZoom:function(){this._hub._beginZoom()},positionItem:function(item,position){return this._hub._positionItem(item,position)},endZoom:function(isCurrentView){this._hub._endZoom(isCurrentView)}}),strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get duplicateSection(){return"Hub duplicate sections: Each HubSection must be unique"},get invalidContent(){return"Invalid content: Hub content must be made up of HubSections."},get hubViewportAriaLabel(){return _Resources._getWinJSString("ui/hubViewportAriaLabel").value}};return Hub})})}),define("require-style!less/styles-lightdismissservice",[],function(){});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define("WinJS/_LightDismissService",["require","exports","./Application","./Core/_Base","./Core/_BaseUtils","./Utilities/_ElementUtilities","./Core/_Global","./Utilities/_KeyboardBehavior","./Core/_Log","./Core/_Resources"],function(require,exports,Application,_Base,_BaseUtils,_ElementUtilities,_Global,_KeyboardBehavior,_Log,_Resources){require(["require-style!less/styles-lightdismissservice"]);var baseZIndex=1e3,Strings={get closeOverlay(){return _Resources._getWinJSString("ui/closeOverlay").value}};exports._ClassNames={_clickEater:"win-clickeater"};exports.LightDismissalReasons={tap:"tap",lostFocus:"lostFocus",escape:"escape",hardwareBackButton:"hardwareBackButton",windowResize:"windowResize",windowBlur:"windowBlur"},exports.DismissalPolicies={light:function(info){switch(info.reason){case exports.LightDismissalReasons.tap:case exports.LightDismissalReasons.escape:return!!info.active||(info.stopPropagation(),!1);case exports.LightDismissalReasons.hardwareBackButton:return info.active?(info.preventDefault(),!0):(info.stopPropagation(),!1);case exports.LightDismissalReasons.lostFocus:case exports.LightDismissalReasons.windowResize:case exports.LightDismissalReasons.windowBlur:return!0}},modal:function(info){switch(info.stopPropagation(),info.reason){case exports.LightDismissalReasons.tap:case exports.LightDismissalReasons.lostFocus:case exports.LightDismissalReasons.windowResize:case exports.LightDismissalReasons.windowBlur:return!1;case exports.LightDismissalReasons.escape:return info.active;case exports.LightDismissalReasons.hardwareBackButton:return info.preventDefault(),info.active}},sticky:function(info){return info.stopPropagation(),!1}};var KeyboardInfoType={keyDown:"keyDown",keyUp:"keyUp",keyPress:"keyPress"},AbstractDismissableElement=function(){function AbstractDismissableElement(args){this.element=args.element,this.element.tabIndex=args.tabIndex,this.onLightDismiss=args.onLightDismiss,args.onTakeFocus&&(this.onTakeFocus=args.onTakeFocus),args.onShouldLightDismiss&&(this.onShouldLightDismiss=args.onShouldLightDismiss),this._ldeOnKeyDownBound=this._ldeOnKeyDown.bind(this),this._ldeOnKeyUpBound=this._ldeOnKeyUp.bind(this),this._ldeOnKeyPressBound=this._ldeOnKeyPress.bind(this)}return AbstractDismissableElement.prototype.restoreFocus=function(){var activeElement=_Global.document.activeElement;if(activeElement&&this.containsElement(activeElement))return this._ldeCurrentFocus=activeElement,!0;var useSetActive=!_KeyboardBehavior._keyboardSeenLast;return this._ldeCurrentFocus&&this.containsElement(this._ldeCurrentFocus)&&_ElementUtilities._tryFocusOnAnyElement(this._ldeCurrentFocus,useSetActive)},AbstractDismissableElement.prototype._ldeOnKeyDown=function(eventObject){this._ldeService.keyDown(this,eventObject)},AbstractDismissableElement.prototype._ldeOnKeyUp=function(eventObject){this._ldeService.keyUp(this,eventObject)},AbstractDismissableElement.prototype._ldeOnKeyPress=function(eventObject){this._ldeService.keyPress(this,eventObject)},AbstractDismissableElement.prototype.setZIndex=function(zIndex){this.element.style.zIndex=zIndex},AbstractDismissableElement.prototype.getZIndexCount=function(){return 1},AbstractDismissableElement.prototype.containsElement=function(element){return this.element.contains(element)},AbstractDismissableElement.prototype.onTakeFocus=function(useSetActive){this.restoreFocus()||_ElementUtilities._focusFirstFocusableElement(this.element,useSetActive)||_ElementUtilities._tryFocusOnAnyElement(this.element,useSetActive)},AbstractDismissableElement.prototype.onFocus=function(element){this._ldeCurrentFocus=element},AbstractDismissableElement.prototype.onShow=function(service){this._ldeService=service,this.element.addEventListener("keydown",this._ldeOnKeyDownBound),this.element.addEventListener("keyup",this._ldeOnKeyUpBound),this.element.addEventListener("keypress",this._ldeOnKeyPressBound)},AbstractDismissableElement.prototype.onHide=function(){this._ldeCurrentFocus=null,this._ldeService=null,this.element.removeEventListener("keydown",this._ldeOnKeyDownBound),this.element.removeEventListener("keyup",this._ldeOnKeyUpBound),this.element.removeEventListener("keypress",this._ldeOnKeyPressBound)},AbstractDismissableElement.prototype.onKeyInStack=function(info){},AbstractDismissableElement.prototype.onShouldLightDismiss=function(info){return!1},AbstractDismissableElement.prototype.onLightDismiss=function(info){},AbstractDismissableElement}(),LightDismissableElement=function(_super){function LightDismissableElement(){_super.apply(this,arguments)}return __extends(LightDismissableElement,_super),LightDismissableElement.prototype.onKeyInStack=function(info){},LightDismissableElement.prototype.onShouldLightDismiss=function(info){return exports.DismissalPolicies.light(info)},LightDismissableElement}(AbstractDismissableElement);exports.LightDismissableElement=LightDismissableElement;var ModalElement=function(_super){function ModalElement(){_super.apply(this,arguments)}return __extends(ModalElement,_super),ModalElement.prototype.onKeyInStack=function(info){info.stopPropagation()},ModalElement.prototype.onShouldLightDismiss=function(info){return exports.DismissalPolicies.modal(info)},ModalElement}(AbstractDismissableElement);exports.ModalElement=ModalElement;var LightDismissableBody=function(){function LightDismissableBody(){}return LightDismissableBody.prototype.setZIndex=function(zIndex){},LightDismissableBody.prototype.getZIndexCount=function(){return 1},LightDismissableBody.prototype.containsElement=function(element){return _Global.document.body.contains(element)},LightDismissableBody.prototype.onTakeFocus=function(useSetActive){this.currentFocus&&this.containsElement(this.currentFocus)&&_ElementUtilities._tryFocusOnAnyElement(this.currentFocus,useSetActive)},LightDismissableBody.prototype.onFocus=function(element){this.currentFocus=element},LightDismissableBody.prototype.onShow=function(service){},LightDismissableBody.prototype.onHide=function(){this.currentFocus=null},LightDismissableBody.prototype.onKeyInStack=function(info){},LightDismissableBody.prototype.onShouldLightDismiss=function(info){return!1},LightDismissableBody.prototype.onLightDismiss=function(info){},LightDismissableBody}(),LightDismissService=function(){function LightDismissService(){this._debug=!1,this._clients=[],this._notifying=!1,this._bodyClient=new LightDismissableBody,this._updateDom_rendered={serviceActive:!1},this._clickEaterEl=this._createClickEater(),this._onBeforeRequestingFocusOnKeyboardInputBound=this._onBeforeRequestingFocusOnKeyboardInput.bind(this),this._onFocusInBound=this._onFocusIn.bind(this),this._onKeyDownBound=this._onKeyDown.bind(this),this._onWindowResizeBound=this._onWindowResize.bind(this),this._onClickEaterPointerUpBound=this._onClickEaterPointerUp.bind(this),this._onClickEaterPointerCancelBound=this._onClickEaterPointerCancel.bind(this),Application.addEventListener("backclick",this._onBackClick.bind(this)),_Global.window.addEventListener("blur",this._onWindowBlur.bind(this)),this.shown(this._bodyClient)}return LightDismissService.prototype.shown=function(client){var index=this._clients.indexOf(client);index===-1&&(this._clients.push(client),client.onShow(this),this._updateDom())},LightDismissService.prototype.hidden=function(client){var index=this._clients.indexOf(client);index!==-1&&(this._clients.splice(index,1),client.setZIndex(""),client.onHide(),this._updateDom())},LightDismissService.prototype.updated=function(client){this._updateDom()},LightDismissService.prototype.keyDown=function(client,eventObject){eventObject.keyCode===_ElementUtilities.Key.escape?this._escapePressed(eventObject):this._dispatchKeyboardEvent(client,KeyboardInfoType.keyDown,eventObject)},LightDismissService.prototype.keyUp=function(client,eventObject){this._dispatchKeyboardEvent(client,KeyboardInfoType.keyUp,eventObject)},LightDismissService.prototype.keyPress=function(client,eventObject){this._dispatchKeyboardEvent(client,KeyboardInfoType.keyPress,eventObject)},LightDismissService.prototype.isShown=function(client){return this._clients.indexOf(client)!==-1},LightDismissService.prototype.isTopmost=function(client){return client===this._clients[this._clients.length-1]},LightDismissService.prototype._setDebug=function(debug){this._debug=debug},LightDismissService.prototype._updateDom=function(options){options=options||{};var activeDismissableNeedsFocus=!!options.activeDismissableNeedsFocus,rendered=this._updateDom_rendered;if(!this._notifying){var serviceActive=this._clients.length>1;if(serviceActive!==rendered.serviceActive){if(serviceActive)Application.addEventListener("beforerequestingfocusonkeyboardinput",this._onBeforeRequestingFocusOnKeyboardInputBound),_ElementUtilities._addEventListener(_Global.document.documentElement,"focusin",this._onFocusInBound),_Global.document.documentElement.addEventListener("keydown",this._onKeyDownBound),_Global.window.addEventListener("resize",this._onWindowResizeBound),this._bodyClient.currentFocus=_Global.document.activeElement,_Global.document.body.appendChild(this._clickEaterEl);else{Application.removeEventListener("beforerequestingfocusonkeyboardinput",this._onBeforeRequestingFocusOnKeyboardInputBound),_ElementUtilities._removeEventListener(_Global.document.documentElement,"focusin",this._onFocusInBound),_Global.document.documentElement.removeEventListener("keydown",this._onKeyDownBound),_Global.window.removeEventListener("resize",this._onWindowResizeBound);var parent=this._clickEaterEl.parentNode;parent&&parent.removeChild(this._clickEaterEl)}rendered.serviceActive=serviceActive}var zIndexGap=0,lastUsedZIndex=baseZIndex+1;this._clients.forEach(function(c,i){var currentZIndex=lastUsedZIndex+zIndexGap;c.setZIndex(""+currentZIndex),lastUsedZIndex=currentZIndex,zIndexGap=c.getZIndexCount()+1}),serviceActive&&(this._clickEaterEl.style.zIndex=""+(lastUsedZIndex-1));var activeDismissable=this._clients.length>0?this._clients[this._clients.length-1]:null;if(this._activeDismissable!==activeDismissable&&(this._activeDismissable=activeDismissable,activeDismissableNeedsFocus=!0),activeDismissableNeedsFocus){var useSetActive=!_KeyboardBehavior._keyboardSeenLast;this._activeDismissable&&this._activeDismissable.onTakeFocus(useSetActive)}}},LightDismissService.prototype._dispatchKeyboardEvent=function(client,keyboardInfoType,eventObject){var index=this._clients.indexOf(client);if(index!==-1)for(var info={type:keyboardInfoType,keyCode:eventObject.keyCode,propagationStopped:!1,stopPropagation:function(){this.propagationStopped=!0,eventObject.stopPropagation()}},clients=this._clients.slice(0,index+1),i=clients.length-1;i>=0&&!info.propagationStopped;i--)clients[i].onKeyInStack(info)},LightDismissService.prototype._dispatchLightDismiss=function(reason,clients,options){if(this._notifying)return void(_Log.log&&_Log.log('_LightDismissService ignored dismiss trigger to avoid re-entrancy: "'+reason+'"',"winjs _LightDismissService","warning"));if(clients=clients||this._clients.slice(0),0!==clients.length){this._notifying=!0;for(var lightDismissInfo={reason:reason,active:!1,_stop:!1,stopPropagation:function(){this._stop=!0},_doDefault:!0,preventDefault:function(){this._doDefault=!1}},i=clients.length-1;i>=0&&!lightDismissInfo._stop;i--)lightDismissInfo.active=this._activeDismissable===clients[i],clients[i].onShouldLightDismiss(lightDismissInfo)&&clients[i].onLightDismiss(lightDismissInfo);return this._notifying=!1,this._updateDom(options),lightDismissInfo._doDefault}},LightDismissService.prototype._onBeforeRequestingFocusOnKeyboardInput=function(eventObject){return!0},LightDismissService.prototype._clickEaterTapped=function(){this._dispatchLightDismiss(exports.LightDismissalReasons.tap)},LightDismissService.prototype._onFocusIn=function(eventObject){for(var target=eventObject.target,i=this._clients.length-1;i>=0&&!this._clients[i].containsElement(target);i--);i!==-1&&this._clients[i].onFocus(target),i+1<this._clients.length&&this._dispatchLightDismiss(exports.LightDismissalReasons.lostFocus,this._clients.slice(i+1),{activeDismissableNeedsFocus:!0})},LightDismissService.prototype._onKeyDown=function(eventObject){eventObject.keyCode===_ElementUtilities.Key.escape&&this._escapePressed(eventObject)},LightDismissService.prototype._escapePressed=function(eventObject){eventObject.preventDefault(),eventObject.stopPropagation(),this._dispatchLightDismiss(exports.LightDismissalReasons.escape)},LightDismissService.prototype._onBackClick=function(eventObject){var doDefault=this._dispatchLightDismiss(exports.LightDismissalReasons.hardwareBackButton);return!doDefault},LightDismissService.prototype._onWindowResize=function(eventObject){this._dispatchLightDismiss(exports.LightDismissalReasons.windowResize)},LightDismissService.prototype._onWindowBlur=function(eventObject){if(!this._debug)if(_Global.document.hasFocus()){var active=_Global.document.activeElement;active&&"IFRAME"===active.tagName&&!active.msLightDismissBlur&&(active.addEventListener("blur",this._onWindowBlur.bind(this),!1),active.msLightDismissBlur=!0)}else this._dispatchLightDismiss(exports.LightDismissalReasons.windowBlur)},LightDismissService.prototype._createClickEater=function(){var clickEater=_Global.document.createElement("section");return clickEater.className=exports._ClassNames._clickEater,_ElementUtilities._addEventListener(clickEater,"pointerdown",this._onClickEaterPointerDown.bind(this),!0),clickEater.addEventListener("click",this._onClickEaterClick.bind(this),!0),clickEater.setAttribute("role","menuitem"),clickEater.setAttribute("aria-label",Strings.closeOverlay),clickEater.setAttribute("unselectable","on"),clickEater},LightDismissService.prototype._onClickEaterPointerDown=function(eventObject){eventObject.stopPropagation(),eventObject.preventDefault(),this._clickEaterPointerId=eventObject.pointerId,this._registeredClickEaterCleanUp||(_ElementUtilities._addEventListener(_Global.window,"pointerup",this._onClickEaterPointerUpBound),_ElementUtilities._addEventListener(_Global.window,"pointercancel",this._onClickEaterPointerCancelBound),this._registeredClickEaterCleanUp=!0)},LightDismissService.prototype._onClickEaterPointerUp=function(eventObject){var _this=this;if(eventObject.stopPropagation(),eventObject.preventDefault(),eventObject.pointerId===this._clickEaterPointerId){this._resetClickEaterPointerState();var element=_Global.document.elementFromPoint(eventObject.clientX,eventObject.clientY);element===this._clickEaterEl&&(this._skipClickEaterClick=!0,_BaseUtils._yieldForEvents(function(){_this._skipClickEaterClick=!1}),this._clickEaterTapped())}},LightDismissService.prototype._onClickEaterClick=function(eventObject){eventObject.stopPropagation(),eventObject.preventDefault(),this._skipClickEaterClick||this._clickEaterTapped()},LightDismissService.prototype._onClickEaterPointerCancel=function(eventObject){eventObject.pointerId===this._clickEaterPointerId&&this._resetClickEaterPointerState()},LightDismissService.prototype._resetClickEaterPointerState=function(){this._registeredClickEaterCleanUp&&(_ElementUtilities._removeEventListener(_Global.window,"pointerup",this._onClickEaterPointerUpBound),_ElementUtilities._removeEventListener(_Global.window,"pointercancel",this._onClickEaterPointerCancelBound)),this._clickEaterPointerId=null,this._registeredClickEaterCleanUp=!1},LightDismissService}(),service=new LightDismissService;exports.shown=service.shown.bind(service),exports.hidden=service.hidden.bind(service),exports.updated=service.updated.bind(service),exports.isShown=service.isShown.bind(service),exports.isTopmost=service.isTopmost.bind(service),exports.keyDown=service.keyDown.bind(service),exports.keyUp=service.keyUp.bind(service),exports.keyPress=service.keyPress.bind(service),exports._clickEaterTapped=service._clickEaterTapped.bind(service),exports._onBackClick=service._onBackClick.bind(service),exports._setDebug=service._setDebug.bind(service),_Base.Namespace.define("WinJS.UI._LightDismissService",{shown:exports.shown,hidden:exports.hidden,updated:exports.updated,isShown:exports.isShown,isTopmost:exports.isTopmost,keyDown:exports.keyDown,keyUp:exports.keyUp,keyPress:exports.keyPress,_clickEaterTapped:exports._clickEaterTapped,_onBackClick:exports._onBackClick,_setDebug:exports._setDebug,LightDismissableElement:LightDismissableElement,DismissalPolicies:exports.DismissalPolicies,LightDismissalReasons:exports.LightDismissalReasons,_ClassNames:exports._ClassNames,_service:service})}),define("WinJS/Controls/_LegacyAppBar/_Constants",["exports","../../Core/_Base"],function(exports,_Base){"use strict";_Base.Namespace._moduleDefine(exports,null,{appBarClass:"win-navbar",firstDivClass:"win-firstdiv",finalDivClass:"win-finaldiv",invokeButtonClass:"win-navbar-invokebutton",ellipsisClass:"win-navbar-ellipsis",primaryCommandsClass:"win-primarygroup",secondaryCommandsClass:"win-secondarygroup",commandLayoutClass:"win-commandlayout",menuLayoutClass:"win-menulayout",topClass:"win-top",bottomClass:"win-bottom",showingClass:"win-navbar-opening",shownClass:"win-navbar-opened",hidingClass:"win-navbar-closing",hiddenClass:"win-navbar-closed",compactClass:"win-navbar-compact",minimalClass:"win-navbar-minimal",menuContainerClass:"win-navbar-menu",appBarPlacementTop:"top",appBarPlacementBottom:"bottom",appBarLayoutCustom:"custom",appBarLayoutCommands:"commands",appBarLayoutMenu:"menu",appBarInvokeButtonWidth:32,typeSeparator:"separator",typeContent:"content",typeButton:"button",typeToggle:"toggle",typeFlyout:"flyout",
appBarCommandClass:"win-command",appBarCommandGlobalClass:"win-global",appBarCommandSelectionClass:"win-selection",commandHiddenClass:"win-command-hidden",sectionSelection:"selection",sectionGlobal:"global",sectionPrimary:"primary",sectionSecondary:"secondary",menuCommandClass:"win-command",menuCommandButtonClass:"win-command-button",menuCommandToggleClass:"win-command-toggle",menuCommandFlyoutClass:"win-command-flyout",menuCommandFlyoutActivatedClass:"win-command-flyout-activated",menuCommandSeparatorClass:"win-command-separator",_menuCommandInvokedEvent:"_invoked",menuClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",menuContainsFlyoutCommandClass:"win-menu-containsflyoutcommand",menuMouseSpacingClass:"win-menu-mousespacing",menuTouchSpacingClass:"win-menu-touchspacing",menuCommandHoverDelay:400,overlayClass:"win-overlay",flyoutClass:"win-flyout",flyoutLightClass:"win-ui-light",settingsFlyoutClass:"win-settingsflyout",scrollsClass:"win-scrolls",pinToRightEdge:-1,pinToBottomEdge:-1,separatorWidth:34,buttonWidth:68,narrowClass:"win-narrow",wideClass:"win-wide",_visualViewportClass:"win-visualviewport-space",commandPropertyMutated:"_commandpropertymutated",commandVisibilityChanged:"commandvisibilitychanged"})}),define("WinJS/Utilities/_KeyboardInfo",["require","exports","../Core/_BaseCoreUtils","../Core/_Global","../Core/_WinRT"],function(require,exports,_BaseCoreUtils,_Global,_WinRT){"use strict";var _Constants={visualViewportClass:"win-visualviewport-space",scrollTimeout:150};exports._KeyboardInfo,exports._KeyboardInfo={get _visible(){try{return _WinRT.Windows.UI.ViewManagement.InputPane&&_WinRT.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height>0}catch(e){return!1}},get _extraOccluded(){var occluded=0;return!exports._KeyboardInfo._isResized&&_WinRT.Windows.UI.ViewManagement.InputPane&&(occluded=_WinRT.Windows.UI.ViewManagement.InputPane.getForCurrentView().occludedRect.height),occluded},get _isResized(){var heightRatio=_Global.document.documentElement.clientHeight/_Global.innerHeight,widthRatio=_Global.document.documentElement.clientWidth/_Global.innerWidth;return widthRatio/heightRatio<.99},get _visibleDocBottom(){return exports._KeyboardInfo._visibleDocTop+exports._KeyboardInfo._visibleDocHeight},get _visibleDocHeight(){return exports._KeyboardInfo._visualViewportHeight-exports._KeyboardInfo._extraOccluded},get _visibleDocTop(){return 0},get _visibleDocBottomOffset(){return exports._KeyboardInfo._extraOccluded},get _visualViewportHeight(){var boundingRect=exports._KeyboardInfo._visualViewportSpace;return boundingRect.height},get _visualViewportWidth(){var boundingRect=exports._KeyboardInfo._visualViewportSpace;return boundingRect.width},get _visualViewportSpace(){var visualViewportSpace=_Global.document.body.querySelector("."+_Constants.visualViewportClass);return visualViewportSpace||(visualViewportSpace=_Global.document.createElement("DIV"),visualViewportSpace.className=_Constants.visualViewportClass,_Global.document.body.appendChild(visualViewportSpace)),visualViewportSpace.getBoundingClientRect()},get _animationShowLength(){if(_BaseCoreUtils.hasWinRT){if(_WinRT.Windows.UI.Core.AnimationMetrics){for(var a=_WinRT.Windows.UI.Core.AnimationMetrics,animationDescription=new a.AnimationDescription(a.AnimationEffect.showPanel,a.AnimationEffectTarget.primary),animations=animationDescription.animations,max=0,i=0;i<animations.size;i++){var animation=animations[i];max=Math.max(max,animation.delay+animation.duration)}return max}var animationDuration=300,animationDelay=50;return animationDelay+animationDuration}return 0},get _scrollTimeout(){return _Constants.scrollTimeout},get _layoutViewportCoords(){var topOffset=_Global.window.pageYOffset-_Global.document.documentElement.scrollTop,bottomOffset=_Global.document.documentElement.clientHeight-(topOffset+this._visibleDocHeight);return{visibleDocTop:topOffset,visibleDocBottom:bottomOffset}}}}),define("require-style!less/styles-overlay",[],function(){}),define("require-style!less/colors-overlay",[],function(){}),define("WinJS/Controls/Flyout/_Overlay",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Resources","../../Core/_WriteProfilerMark","../../_Accents","../../Animations","../../Application","../../ControlProcessor","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardInfo","../_LegacyAppBar/_Constants","require-style!less/styles-overlay","require-style!less/colors-overlay"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,_Accents,Animations,Application,ControlProcessor,Promise,Scheduler,_Control,_ElementUtilities,_KeyboardInfo,_Constants){"use strict";_Accents.createAccentRule("button[aria-checked=true].win-command:before,         .win-menu-containsflyoutcommand button.win-command-flyout-activated:before",[{name:"background-color",value:_Accents.ColorTypes.accent},{name:"border-color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-flyout, .win-settingsflyout",[{name:"border-color",value:_Accents.ColorTypes.accent}]),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_Overlay:_Base.Namespace._lazy(function(){function _allOverlaysCallback(event,nameOfFunctionCall,stopImmediatePropagationWhenHandled){var elements=_Global.document.querySelectorAll("."+_Constants.overlayClass);if(elements)for(var len=elements.length,i=0;i<len;i++){var element=elements[i],overlay=element.winControl;if(!overlay._disposed&&overlay){var handled=overlay[nameOfFunctionCall](event);if(stopImmediatePropagationWhenHandled&&handled)return handled}}}function _resolveElements(elements){if(!elements)return[];"string"!=typeof elements&&elements&&elements.length||(elements=[elements]);var i,realElements=[];for(i=0;i<elements.length;i++)if(elements[i])if("string"==typeof elements[i]){var element=_Global.document.getElementById(elements[i]);element&&realElements.push(element)}else elements[i].element?realElements.push(elements[i].element):realElements.push(elements[i]);return realElements}var _GlobalListener=_Base.Class.define(function(){this._currentState=_GlobalListener.states.off,this._inputPaneShowing=this._inputPaneShowing.bind(this),this._inputPaneHiding=this._inputPaneHiding.bind(this),this._documentScroll=this._documentScroll.bind(this),this._windowResized=this._windowResized.bind(this)},{initialize:function(){this._toggleListeners(_GlobalListener.states.on)},reset:function(){this._toggleListeners(_GlobalListener.states.off),this._toggleListeners(_GlobalListener.states.on)},_inputPaneShowing:function(event){_WriteProfilerMark(_GlobalListener.profilerString+"_showingKeyboard,StartTM"),_allOverlaysCallback(event,"_showingKeyboard"),_WriteProfilerMark(_GlobalListener.profilerString+"_showingKeyboard,StopTM")},_inputPaneHiding:function(event){_WriteProfilerMark(_GlobalListener.profilerString+"_hidingKeyboard,StartTM"),_allOverlaysCallback(event,"_hidingKeyboard"),_WriteProfilerMark(_GlobalListener.profilerString+"_hidingKeyboard,StopTM")},_documentScroll:function(event){_WriteProfilerMark(_GlobalListener.profilerString+"_checkScrollPosition,StartTM"),_allOverlaysCallback(event,"_checkScrollPosition"),_WriteProfilerMark(_GlobalListener.profilerString+"_checkScrollPosition,StopTM")},_windowResized:function(event){_WriteProfilerMark(_GlobalListener.profilerString+"_baseResize,StartTM"),_allOverlaysCallback(event,"_baseResize"),_WriteProfilerMark(_GlobalListener.profilerString+"_baseResize,StopTM")},_toggleListeners:function(newState){var listenerOperation;if(this._currentState!==newState){if(newState===_GlobalListener.states.on?listenerOperation="addEventListener":newState===_GlobalListener.states.off&&(listenerOperation="removeEventListener"),_WinRT.Windows.UI.ViewManagement.InputPane){var inputPane=_WinRT.Windows.UI.ViewManagement.InputPane.getForCurrentView();inputPane[listenerOperation]("showing",this._inputPaneShowing,!1),inputPane[listenerOperation]("hiding",this._inputPaneHiding,!1),_Global.document[listenerOperation]("scroll",this._documentScroll,!1)}_Global.addEventListener("resize",this._windowResized,!1),this._currentState=newState}}},{profilerString:{get:function(){return"WinJS.UI._Overlay Global Listener:"}},states:{get:function(){return{off:0,on:1}}}}),strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get mustContainCommands(){return"Invalid HTML: AppBars/Menus must contain only AppBarCommands/MenuCommands"},get closeOverlay(){return _Resources._getWinJSString("ui/closeOverlay").value}},_Overlay=_Base.Class.define(function(element,options){this._baseOverlayConstructor(element,options)},{_baseOverlayConstructor:function(element,options){this._disposed=!1,element||(element=_Global.document.createElement("div"));var overlay=element.winControl;if(overlay)throw new _ErrorFromName("WinJS.UI._Overlay.DuplicateConstruction",strings.duplicateConstruction);this._element||(this._element=element),this._element.hasAttribute("tabIndex")||(this._element.tabIndex=-1),this._sticky=!1,this._doNext="",this._element.style.visibility="hidden",this._element.style.opacity=0,element.winControl=this,_ElementUtilities.addClass(this._element,_Constants.overlayClass),_ElementUtilities.addClass(this._element,"win-disposable");var unselectable=this._element.getAttribute("unselectable");null!==unselectable&&void 0!==unselectable||this._element.setAttribute("unselectable","on"),this._currentAnimateIn=this._baseAnimateIn,this._currentAnimateOut=this._baseAnimateOut,this._animationPromise=Promise.as(),this._queuedToShow=[],this._queuedToHide=[],this._queuedCommandAnimation=!1,options&&_Control.setOptions(this,options),_Overlay._globalEventListeners.initialize()},element:{get:function(){return this._element}},dispose:function(){this._disposed||(this._disposed=!0,this._dispose())},_dispose:function(){},_show:function(){this._baseShow()},_hide:function(){this._baseHide()},hidden:{get:function(){return"hidden"===this._element.style.visibility||"hiding"===this._element.winAnimating||"hide"===this._doNext},set:function(hidden){var currentlyHidden=this.hidden;!hidden&&currentlyHidden?this.show():hidden&&!currentlyHidden&&this.hide()}},addEventListener:function(type,listener,useCapture){return this._element.addEventListener(type,listener,useCapture)},removeEventListener:function(type,listener,useCapture){return this._element.removeEventListener(type,listener,useCapture)},_baseShow:function(){if(this._animating||this._needToHandleHidingKeyboard)return this._doNext="show",!1;if("visible"!==this._element.style.visibility){this._element.winAnimating="showing",this._element.style.display="",this._element.style.visibility="hidden",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._beforeShow(),this._sendEvent(_Overlay.beforeShow),this._ensurePosition();var that=this;return this._animationPromise=this._currentAnimateIn().then(function(){that._baseEndShow()},function(){that._baseEndShow()}),!0}return!1},_beforeShow:function(){},_ensurePosition:function(){},_baseEndShow:function(){this._disposed||(this._element.setAttribute("aria-hidden","false"),this._element.winAnimating="","show"===this._doNext&&(this._doNext=""),this._sendEvent(_Overlay.afterShow),this._writeProfilerMark("show,StopTM"),Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_baseHide:function(){if(this._animating)return this._doNext="hide",!1;if(this._needToHandleHidingKeyboard&&(this._element.style.visibility=""),"hidden"!==this._element.style.visibility){if(this._element.winAnimating="hiding",this._element.setAttribute("aria-hidden","true"),this._sendEvent(_Overlay.beforeHide),""===this._element.style.visibility)this._element.style.opacity=0,this._baseEndHide();else{var that=this;this._animationPromise=this._currentAnimateOut().then(function(){that._baseEndHide()},function(){that._baseEndHide()})}return!0}return!1},_baseEndHide:function(){this._disposed||(this._beforeEndHide(),this._element.style.visibility="hidden",this._element.style.display="none",this._element.winAnimating="",this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),"hide"===this._doNext&&(this._doNext=""),this._afterHide(),this._sendEvent(_Overlay.afterHide),this._writeProfilerMark("hide,StopTM"),Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"))},_beforeEndHide:function(){},_afterHide:function(){},_checkDoNext:function(){this._animating||this._needToHandleHidingKeyboard||this._disposed||("hide"===this._doNext?(this._hide(),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():"show"===this._doNext&&(this._show(),this._doNext=""))},_baseAnimateIn:function(){return this._element.style.opacity=0,this._element.style.visibility="visible",_ElementUtilities._getComputedStyle(this._element,null).opacity,Animations.fadeIn(this._element)},_baseAnimateOut:function(){return this._element.style.opacity=1,_ElementUtilities._getComputedStyle(this._element,null).opacity,Animations.fadeOut(this._element)},_animating:{get:function(){return!!this._element.winAnimating}},_sendEvent:function(eventName,detail){if(!this._disposed){var event=_Global.document.createEvent("CustomEvent");event.initEvent(eventName,!0,!0,detail||{}),this._element.dispatchEvent(event)}},_showCommands:function(commands,immediate){var showHide=this._resolveCommands(commands);this._showAndHideCommands(showHide.commands,[],immediate)},_hideCommands:function(commands,immediate){var showHide=this._resolveCommands(commands);this._showAndHideCommands([],showHide.commands,immediate)},_showOnlyCommands:function(commands,immediate){var showHide=this._resolveCommands(commands);this._showAndHideCommands(showHide.commands,showHide.others,immediate)},_showAndHideCommands:function(showCommands,hideCommands,immediate){immediate||this.hidden&&!this._animating?(this._showAndHideFast(showCommands,hideCommands),this._removeFromQueue(showCommands,this._queuedToShow),this._removeFromQueue(hideCommands,this._queuedToHide)):(this._updateAnimateQueue(showCommands,this._queuedToShow,this._queuedToHide),this._updateAnimateQueue(hideCommands,this._queuedToHide,this._queuedToShow))},_removeFromQueue:function(commands,queue){var count;for(count=0;count<commands.length;count++){var countQ;for(countQ=0;countQ<queue.length;countQ++)if(queue[countQ]===commands[count]){queue.splice(countQ,1);break}}},_updateAnimateQueue:function(addCommands,toQueue,fromQueue){if(!this._disposed){var count;for(count=0;count<addCommands.length;count++){var countQ;for(countQ=0;countQ<toQueue.length&&toQueue[countQ]!==addCommands[count];countQ++);for(countQ===toQueue.length&&(toQueue[countQ]=addCommands[count]),countQ=0;countQ<fromQueue.length;countQ++)if(fromQueue[countQ]===addCommands[count]){fromQueue.splice(countQ,1);break}}this._queuedCommandAnimation||(this._animating||Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext"),this._queuedCommandAnimation=!0)}},_showAndHideFast:function(showCommands,hideCommands){var count,command;for(count=0;count<showCommands.length;count++)command=showCommands[count],command&&command.style&&(command.style.visibility="",command.style.display="");for(count=0;count<hideCommands.length;count++)command=hideCommands[count],command&&command.style&&(command.style.visibility="hidden",command.style.display="none");this._commandsUpdated()},_showAndHideQueue:function(){if(this._queuedCommandAnimation=!1,this.hidden)this._showAndHideFast(this._queuedToShow,this._queuedToHide),Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._Overlay._checkDoNext");else{var count,showCommands=this._queuedToShow,hideCommands=this._queuedToHide,siblings=this._findSiblings(showCommands.concat(hideCommands));for(count=0;count<showCommands.length;count++)showCommands[count]&&showCommands[count].style&&_Global.document.body.contains(showCommands[count])?"hidden"!==showCommands[count].style.visibility&&"0"!==showCommands[count].style.opacity&&(siblings.push(showCommands[count]),showCommands.splice(count,1),count--):(showCommands.splice(count,1),count--);for(count=0;count<hideCommands.length;count++)hideCommands[count]&&hideCommands[count].style&&_Global.document.body.contains(hideCommands[count])&&"hidden"!==hideCommands[count].style.visibility&&"0"!==hideCommands[count].style.opacity||(hideCommands.splice(count,1),count--);var commandsAnimationPromise=this._baseBeginAnimateCommands(showCommands,hideCommands,siblings),that=this;commandsAnimationPromise?commandsAnimationPromise.done(function(){that._baseEndAnimateCommands(hideCommands)},function(){that._baseEndAnimateCommands(hideCommands)}):Scheduler.schedule(function(){that._baseEndAnimateCommands([])},Scheduler.Priority.normal,null,"WinJS.UI._Overlay._endAnimateCommandsWithoutAnimation")}this._queuedToShow=[],this._queuedToHide=[]},_baseBeginAnimateCommands:function(showCommands,hideCommands,siblings){this._beginAnimateCommands(showCommands,hideCommands,this._getVisibleCommands(siblings));var showAnimated=null,hideAnimated=null;hideCommands.length>0&&(hideAnimated=Animations.createDeleteFromListAnimation(hideCommands,0===showCommands.length?siblings:void 0)),showCommands.length>0&&(showAnimated=Animations.createAddToListAnimation(showCommands,siblings));for(var count=0,len=hideCommands.length;count<len;count++){var rectangle=hideCommands[count].getBoundingClientRect(),style=_ElementUtilities._getComputedStyle(hideCommands[count]);hideCommands[count].style.top=rectangle.top-parseFloat(style.marginTop)+"px",hideCommands[count].style.left=rectangle.left-parseFloat(style.marginLeft)+"px",hideCommands[count].style.opacity=0,hideCommands[count].style.position="fixed"}this._element.winAnimating="rearranging";var promise=null;for(hideAnimated&&(promise=hideAnimated.execute()),count=0;count<showCommands.length;count++)showCommands[count].style.visibility="",showCommands[count].style.display="",showCommands[count].style.opacity=1;if(showAnimated){var newPromise=showAnimated.execute();promise=promise?Promise.join([promise,newPromise]):newPromise}return promise},_beginAnimateCommands:function(){},_getVisibleCommands:function(commandSubSet){var command,commands=commandSubSet,visibleCommands=[];commands||(commands=this.element.querySelectorAll(".win-command"));for(var i=0,len=commands.length;i<len;i++)command=commands[i].winControl||commands[i],command.hidden||visibleCommands.push(command);return visibleCommands},_baseEndAnimateCommands:function(hideCommands){if(!this._disposed){var count;for(count=0;count<hideCommands.length;count++)hideCommands[count].style.position="",hideCommands[count].style.top="",hideCommands[count].style.left="",hideCommands[count].getBoundingClientRect(),hideCommands[count].style.visibility="hidden",hideCommands[count].style.display="none",hideCommands[count].style.opacity=1;this._element.winAnimating="",this._endAnimateCommands(),this._checkDoNext()}},_endAnimateCommands:function(){},_resolveCommands:function(commands){commands=_resolveElements(commands);var result={};result.commands=[],result.others=[];var countAll,countIn,allCommands=this.element.querySelectorAll(".win-command");for(countAll=0;countAll<allCommands.length;countAll++){var found=!1;for(countIn=0;countIn<commands.length;countIn++)if(commands[countIn]===allCommands[countAll]){result.commands.push(allCommands[countAll]),commands.splice(countIn,1),found=!0;break}found||result.others.push(allCommands[countAll])}return result},_findSiblings:function(commands){var countAll,countIn,siblings=[],allCommands=this.element.querySelectorAll(".win-command");for(countAll=0;countAll<allCommands.length;countAll++){var found=!1;for(countIn=0;countIn<commands.length;countIn++)if(commands[countIn]===allCommands[countAll]){commands.splice(countIn,1),found=!0;break}found||siblings.push(allCommands[countAll])}return siblings},_baseResize:function(event){this._resize(event)},_hideOrDismiss:function(){var element=this._element;element&&_ElementUtilities.hasClass(element,_Constants.settingsFlyoutClass)?this._dismiss():element&&_ElementUtilities.hasClass(element,_Constants.appBarClass)?this.close():this.hide()},_resize:function(){},_commandsUpdated:function(){},_checkScrollPosition:function(){},_showingKeyboard:function(){},_hidingKeyboard:function(){},_verifyCommandsOnly:function(element,type){for(var children=element.children,commands=new Array(children.length),i=0;i<children.length;i++){if(!_ElementUtilities.hasClass(children[i],"win-command")&&children[i].getAttribute("data-win-control")!==type)throw new _ErrorFromName("WinJS.UI._Overlay.MustContainCommands",strings.mustContainCommands);ControlProcessor.processAll(children[i]),commands[i]=children[i].winControl}return commands},_focusOnLastFocusableElementOrThis:function(){this._focusOnLastFocusableElement()||_Overlay._trySetActive(this._element)},_focusOnLastFocusableElement:function(){if(this._element.firstElementChild){var oldFirstTabIndex=this._element.firstElementChild.tabIndex,oldLastTabIndex=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var tabResult=_ElementUtilities._focusLastFocusableElement(this._element);return tabResult&&_Overlay._trySelect(_Global.document.activeElement),this._element.firstElementChild.tabIndex=oldFirstTabIndex,this._element.lastElementChild.tabIndex=oldLastTabIndex,tabResult}return!1},_focusOnFirstFocusableElementOrThis:function(){this._focusOnFirstFocusableElement()||_Overlay._trySetActive(this._element)},_focusOnFirstFocusableElement:function(useSetActive,scroller){if(this._element.firstElementChild){var oldFirstTabIndex=this._element.firstElementChild.tabIndex,oldLastTabIndex=this._element.lastElementChild.tabIndex;this._element.firstElementChild.tabIndex=-1,this._element.lastElementChild.tabIndex=-1;var tabResult=_ElementUtilities._focusFirstFocusableElement(this._element,useSetActive,scroller);return tabResult&&_Overlay._trySelect(_Global.document.activeElement),this._element.firstElementChild.tabIndex=oldFirstTabIndex,this._element.lastElementChild.tabIndex=oldLastTabIndex,tabResult}return!1},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI._Overlay:"+this._id+":"+text)}},{_isFlyoutVisible:function(){for(var flyouts=_Global.document.querySelectorAll("."+_Constants.flyoutClass),i=0;i<flyouts.length;i++){var flyoutControl=flyouts[i].winControl;if(flyoutControl&&!flyoutControl.hidden)return!0}return!1},_trySetActive:function(element,scroller){return!!(element&&_Global.document.body&&_Global.document.body.contains(element))&&(!!_ElementUtilities._setActive(element,scroller)&&element===_Global.document.activeElement)},_trySelect:function(element){try{element&&element.select&&element.select()}catch(e){}},_sizeOfDocument:function(){return{width:_Global.document.documentElement.offsetWidth,height:_Global.document.documentElement.offsetHeight}},_getParentControlUsingClassName:function(element,className){for(;element&&element!==_Global.document.body;){if(_ElementUtilities.hasClass(element,className))return element.winControl;element=element.parentNode}return null},_globalEventListeners:new _GlobalListener,_hideAppBars:function(bars,keyboardInvoked){var allBarsAnimationPromises=bars.map(function(bar){return bar.close(),bar._animationPromise});return Promise.join(allBarsAnimationPromises)},_showAppBars:function(bars,keyboardInvoked){var allBarsAnimationPromises=bars.map(function(bar){return bar._show(),bar._animationPromise});return Promise.join(allBarsAnimationPromises)},_keyboardInfo:_KeyboardInfo._KeyboardInfo,_scrollTimeout:_KeyboardInfo._KeyboardInfo._scrollTimeout,beforeShow:"beforeshow",beforeHide:"beforehide",afterShow:"aftershow",afterHide:"afterhide",commonstrings:{get cannotChangeCommandsWhenVisible(){return"Invalid argument: You must call hide() before changing {0} commands"},get cannotChangeHiddenProperty(){return"Unable to set hidden property while parent {0} is visible."}}});return _Base.Class.mix(_Overlay,_Control.DOMEventMixin),_Overlay})})}),define("WinJS/Controls/Flyout",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Log","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../_Signal","../_LightDismissService","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_KeyboardBehavior","../Utilities/_Hoverable","./_LegacyAppBar/_Constants","./Flyout/_Overlay"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,Animations,_Signal,_LightDismissService,_Dispose,_ElementUtilities,_KeyboardBehavior,_Hoverable,_Constants,_Overlay){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Flyout:_Base.Namespace._lazy(function(){function getDimension(element,property){return _ElementUtilities.convertToPixels(element,_ElementUtilities._getComputedStyle(element,null)[property])}function measureElement(element){return{marginTop:getDimension(element,"marginTop"),marginBottom:getDimension(element,"marginBottom"),marginLeft:getDimension(element,"marginLeft"),marginRight:getDimension(element,"marginRight"),totalWidth:_ElementUtilities.getTotalWidth(element),totalHeight:_ElementUtilities.getTotalHeight(element),contentWidth:_ElementUtilities.getContentWidth(element),contentHeight:_ElementUtilities.getContentHeight(element)}}var Key=_ElementUtilities.Key,strings={get ariaLabel(){return _Resources._getWinJSString("ui/flyoutAriaLabel").value},get noAnchor(){return"Invalid argument: Flyout anchor element not found in DOM."},get badPlacement(){return"Invalid argument: Flyout placement should be 'top' (default), 'bottom', 'left', 'right', 'auto', 'autohorizontal', or 'autovertical'."},get badAlignment(){return"Invalid argument: Flyout alignment should be 'center' (default), 'left', or 'right'."},get noCoordinates(){return"Invalid argument: Flyout coordinates must contain a valid x,y pair."}},createEvent=_Events._createEventProperty,_LightDismissableLayer=_Base.Class.define(function(onLightDismiss){this._onLightDismiss=onLightDismiss,this._currentlyFocusedClient=null,this._clients=[]},{shown:function(client){client._focusable=!0;var index=this._clients.indexOf(client);index===-1&&(this._clients.push(client),client.onShow(this),_LightDismissService.isShown(this)?(_LightDismissService.updated(this),this._activateTopFocusableClientIfNeeded()):_LightDismissService.shown(this))},hiding:function(client){var index=this._clients.indexOf(client);index!==-1&&(this._clients[index]._focusable=!1,this._activateTopFocusableClientIfNeeded())},hidden:function(client){var index=this._clients.indexOf(client);index!==-1&&(this._clients.splice(index,1),client.setZIndex(""),client.onHide(),0===this._clients.length?_LightDismissService.hidden(this):(_LightDismissService.updated(this),this._activateTopFocusableClientIfNeeded()))},keyDown:function(client,eventObject){_LightDismissService.keyDown(this,eventObject)},keyUp:function(client,eventObject){_LightDismissService.keyUp(this,eventObject)},keyPress:function(client,eventObject){_LightDismissService.keyPress(this,eventObject)},clients:{get:function(){return this._clients}},_clientForElement:function(element){for(var i=this._clients.length-1;i>=0;i--)if(this._clients[i].containsElement(element))return this._clients[i];return null},_focusableClientForElement:function(element){for(var i=this._clients.length-1;i>=0;i--)if(this._clients[i]._focusable&&this._clients[i].containsElement(element))return this._clients[i];return null},_getTopmostFocusableClient:function(){for(var i=this._clients.length-1;i>=0;i--){var client=this._clients[i];if(client&&client._focusable)return client}return null},_activateTopFocusableClientIfNeeded:function(){var topClient=this._getTopmostFocusableClient();if(topClient&&_LightDismissService.isTopmost(this)){var useSetActive=!_KeyboardBehavior._keyboardSeenLast;topClient.onTakeFocus(useSetActive)}},setZIndex:function(zIndex){this._clients.forEach(function(client,index){client.setZIndex(zIndex+index)},this)},getZIndexCount:function(){return this._clients.length},containsElement:function(element){return!!this._clientForElement(element)},onTakeFocus:function(useSetActive){var client=this._focusableClientForElement(_Global.document.activeElement);!client&&this._clients.indexOf(this._currentlyFocusedClient)!==-1&&this._currentlyFocusedClient._focusable&&(client=this._currentlyFocusedClient),client||(client=this._getTopmostFocusableClient()),this._currentlyFocusedClient=client,client&&client.onTakeFocus(useSetActive)},onFocus:function(element){this._currentlyFocusedClient=this._clientForElement(element),this._currentlyFocusedClient&&this._currentlyFocusedClient.onFocus(element)},onShow:function(service){},onHide:function(){this._currentlyFocusedClient=null},onKeyInStack:function(info){var index=this._clients.indexOf(this._currentlyFocusedClient);if(index!==-1)for(var clients=this._clients.slice(0,index+1),i=clients.length-1;i>=0&&!info.propagationStopped;i--)clients[i]._focusable&&clients[i].onKeyInStack(info)},onShouldLightDismiss:function(info){return _LightDismissService.DismissalPolicies.light(info)},onLightDismiss:function(info){this._onLightDismiss(info)}}),_CascadeManager=_Base.Class.define(function(){var that=this;this._dismissableLayer=new _LightDismissableLayer(function(info){info.reason===_LightDismissService.LightDismissalReasons.escape?that.collapseFlyout(that.getAt(that.length-1)):that.collapseAll()}),this._cascadingStack=[],this._handleKeyDownInCascade_bound=this._handleKeyDownInCascade.bind(this),this._inputType=null},{appendFlyout:function(flyoutToAdd){if(_Log.log&&this.reentrancyLock&&_Log.log("_CascadeManager is attempting to append a Flyout through reentrancy.","winjs _CascadeManager","error"),this.indexOf(flyoutToAdd)<0){var collapseFn=this.collapseAll;if(flyoutToAdd._positionRequest instanceof PositionRequests.AnchorPositioning){var indexOfParentFlyout=this.indexOfElement(flyoutToAdd._positionRequest.anchor);indexOfParentFlyout>=0&&(collapseFn=function(){this.collapseFlyout(this.getAt(indexOfParentFlyout+1))})}collapseFn.call(this),flyoutToAdd.element.addEventListener("keydown",this._handleKeyDownInCascade_bound,!1),this._cascadingStack.push(flyoutToAdd)}},collapseFlyout:function(flyout){if(!this.reentrancyLock&&flyout&&this.indexOf(flyout)>=0){this.reentrancyLock=!0;var signal=new _Signal;this.unlocked=signal.promise;for(var subFlyout;this.length&&flyout!==subFlyout;)subFlyout=this._cascadingStack.pop(),subFlyout.element.removeEventListener("keydown",this._handleKeyDownInCascade_bound,!1),subFlyout._hide();0===this._cascadingStack.length&&(this._inputType=null),this.reentrancyLock=!1,this.unlocked=null,signal.complete()}},flyoutShown:function(flyout){this._dismissableLayer.shown(flyout._dismissable)},flyoutHiding:function(flyout){this._dismissableLayer.hiding(flyout._dismissable)},flyoutHidden:function(flyout){this._dismissableLayer.hidden(flyout._dismissable)},collapseAll:function(){var headFlyout=this.getAt(0);headFlyout&&this.collapseFlyout(headFlyout)},indexOf:function(flyout){return this._cascadingStack.indexOf(flyout)},indexOfElement:function(el){for(var indexOfAssociatedFlyout=-1,i=0,len=this.length;i<len;i++){var currentFlyout=this.getAt(i);if(currentFlyout.element.contains(el)){indexOfAssociatedFlyout=i;break}}return indexOfAssociatedFlyout},length:{get:function(){return this._cascadingStack.length}},getAt:function(index){return this._cascadingStack[index]},handleFocusIntoFlyout:function(event){var index=this.indexOfElement(event.target);
if(index>=0){var subFlyout=this.getAt(index+1);this.collapseFlyout(subFlyout)}},inputType:{get:function(){return this._inputType||(this._inputType=_KeyboardBehavior._lastInputType),this._inputType}},dismissableLayer:{get:function(){return this._dismissableLayer}},_handleKeyDownInCascade:function(event){var rtl="rtl"===_ElementUtilities._getComputedStyle(event.target).direction,leftKey=rtl?Key.rightArrow:Key.leftArrow,target=event.target;if(event.keyCode===leftKey){var index=this.indexOfElement(target);if(index>=1){var subFlyout=this.getAt(index);this.collapseFlyout(subFlyout),event.preventDefault()}}else event.keyCode!==Key.alt&&event.keyCode!==Key.F10||this.collapseAll()}}),AnimationOffsets={top:{top:"50px",left:"0px",keyframe:"WinJS-showFlyoutTop"},bottom:{top:"-50px",left:"0px",keyframe:"WinJS-showFlyoutBottom"},left:{top:"0px",left:"50px",keyframe:"WinJS-showFlyoutLeft"},right:{top:"0px",left:"-50px",keyframe:"WinJS-showFlyoutRight"}},PositionRequests={AnchorPositioning:_Base.Class.define(function(anchor,placement,alignment){if("string"==typeof anchor?anchor=_Global.document.getElementById(anchor):anchor&&anchor.element&&(anchor=anchor.element),!anchor)throw new _ErrorFromName("WinJS.UI.Flyout.NoAnchor",strings.noAnchor);this.anchor=anchor,this.placement=placement,this.alignment=alignment},{getTopLeft:function(flyoutMeasurements,isRtl){function configureVerticalWithScroll(anchorBorderBox){topHasMoreRoom(anchorBorderBox)?(nextContentHeight=spaceAbove(anchorBorderBox)-verticalMarginBorderPadding,nextTop=_Overlay._Overlay._keyboardInfo._visibleDocTop,nextAnimOffset=AnimationOffsets.top):(nextContentHeight=spaceBelow(anchorBorderBox)-verticalMarginBorderPadding,nextTop=_Constants.pinToBottomEdge,nextAnimOffset=AnimationOffsets.bottom),doesScroll=!0}function fitsVerticallyWithCenteredAnchor(anchorBorderBox,flyoutMeasurements){return(_Overlay._Overlay._keyboardInfo._visibleDocHeight-anchorBorderBox.height)/2>=flyoutMeasurements.totalHeight}function spaceAbove(anchorBorderBox){return anchorBorderBox.top-_Overlay._Overlay._keyboardInfo._visibleDocTop}function spaceBelow(anchorBorderBox){return _Overlay._Overlay._keyboardInfo._visibleDocBottom-anchorBorderBox.bottom}function topHasMoreRoom(anchorBorderBox){return spaceAbove(anchorBorderBox)>spaceBelow(anchorBorderBox)}function fitTop(bottomConstraint,flyoutMeasurements){return nextTop=bottomConstraint-flyoutMeasurements.totalHeight,nextAnimOffset=AnimationOffsets.top,nextTop>=_Overlay._Overlay._keyboardInfo._visibleDocTop&&nextTop+flyoutMeasurements.totalHeight<=_Overlay._Overlay._keyboardInfo._visibleDocBottom}function fitBottom(topConstraint,flyoutMeasurements){return nextTop=topConstraint,nextAnimOffset=AnimationOffsets.bottom,nextTop>=_Overlay._Overlay._keyboardInfo._visibleDocTop&&nextTop+flyoutMeasurements.totalHeight<=_Overlay._Overlay._keyboardInfo._visibleDocBottom}function fitLeft(leftConstraint,flyoutMeasurements){return nextLeft=leftConstraint-flyoutMeasurements.totalWidth,nextAnimOffset=AnimationOffsets.left,nextLeft>=0&&nextLeft+flyoutMeasurements.totalWidth<=_Overlay._Overlay._keyboardInfo._visualViewportWidth}function fitRight(rightConstraint,flyoutMeasurements){return nextLeft=rightConstraint,nextAnimOffset=AnimationOffsets.right,nextLeft>=0&&nextLeft+flyoutMeasurements.totalWidth<=_Overlay._Overlay._keyboardInfo._visualViewportWidth}function centerVertically(anchorBorderBox,flyoutMeasurements){nextTop=anchorBorderBox.top+anchorBorderBox.height/2-flyoutMeasurements.totalHeight/2,nextTop<_Overlay._Overlay._keyboardInfo._visibleDocTop?nextTop=_Overlay._Overlay._keyboardInfo._visibleDocTop:nextTop+flyoutMeasurements.totalHeight>=_Overlay._Overlay._keyboardInfo._visibleDocBottom&&(nextTop=_Constants.pinToBottomEdge)}function alignHorizontally(anchorBorderBox,flyoutMeasurements,alignment){if("center"===alignment)nextLeft=anchorBorderBox.left+anchorBorderBox.width/2-flyoutMeasurements.totalWidth/2;else if("left"===alignment)nextLeft=anchorBorderBox.left;else{if("right"!==alignment)throw new _ErrorFromName("WinJS.UI.Flyout.BadAlignment",strings.badAlignment);nextLeft=anchorBorderBox.right-flyoutMeasurements.totalWidth}nextLeft<0?nextLeft=0:nextLeft+flyoutMeasurements.totalWidth>=_Overlay._Overlay._keyboardInfo._visualViewportWidth&&(nextLeft=_Constants.pinToRightEdge)}var anchorBorderBox;try{anchorBorderBox=this.anchor.getBoundingClientRect()}catch(e){throw new _ErrorFromName("WinJS.UI.Flyout.NoAnchor",strings.noAnchor)}var nextLeft,nextTop,doesScroll,nextAnimOffset,verticalMarginBorderPadding=flyoutMeasurements.totalHeight-flyoutMeasurements.contentHeight,nextContentHeight=flyoutMeasurements.contentHeight,currentAlignment=this.alignment;switch(this.placement){case"top":fitTop(anchorBorderBox.top,flyoutMeasurements)||(nextTop=_Overlay._Overlay._keyboardInfo._visibleDocTop,doesScroll=!0,nextContentHeight=spaceAbove(anchorBorderBox)-verticalMarginBorderPadding),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment);break;case"bottom":fitBottom(anchorBorderBox.bottom,flyoutMeasurements)||(nextTop=_Constants.pinToBottomEdge,doesScroll=!0,nextContentHeight=spaceBelow(anchorBorderBox)-verticalMarginBorderPadding),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment);break;case"left":fitLeft(anchorBorderBox.left,flyoutMeasurements)||(nextLeft=0),centerVertically(anchorBorderBox,flyoutMeasurements);break;case"right":fitRight(anchorBorderBox.right,flyoutMeasurements)||(nextLeft=_Constants.pinToRightEdge),centerVertically(anchorBorderBox,flyoutMeasurements);break;case"autovertical":fitTop(anchorBorderBox.top,flyoutMeasurements)||fitBottom(anchorBorderBox.bottom,flyoutMeasurements)||configureVerticalWithScroll(anchorBorderBox),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment);break;case"autohorizontal":fitLeft(anchorBorderBox.left,flyoutMeasurements)||fitRight(anchorBorderBox.right,flyoutMeasurements)||(nextLeft=_Constants.pinToRightEdge),centerVertically(anchorBorderBox,flyoutMeasurements);break;case"auto":fitsVerticallyWithCenteredAnchor(anchorBorderBox,flyoutMeasurements)?(fitTop(anchorBorderBox.top,flyoutMeasurements)||fitBottom(anchorBorderBox.bottom,flyoutMeasurements),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment)):fitLeft(anchorBorderBox.left,flyoutMeasurements)||fitRight(anchorBorderBox.right,flyoutMeasurements)?centerVertically(anchorBorderBox,flyoutMeasurements):(configureVerticalWithScroll(anchorBorderBox),alignHorizontally(anchorBorderBox,flyoutMeasurements,currentAlignment));break;case"_cascade":fitBottom(anchorBorderBox.top-flyoutMeasurements.marginTop,flyoutMeasurements)||fitTop(anchorBorderBox.bottom+flyoutMeasurements.marginBottom,flyoutMeasurements)||centerVertically(anchorBorderBox,flyoutMeasurements);var horizontalOverlap=3,beginRight=anchorBorderBox.right-flyoutMeasurements.marginLeft-horizontalOverlap,beginLeft=anchorBorderBox.left+flyoutMeasurements.marginRight+horizontalOverlap;isRtl?fitLeft(beginLeft,flyoutMeasurements)||fitRight(beginRight,flyoutMeasurements)||(nextLeft=0,nextAnimOffset=AnimationOffsets.left):fitRight(beginRight,flyoutMeasurements)||fitLeft(beginLeft,flyoutMeasurements)||(nextLeft=_Constants.pinToRightEdge,nextAnimOffset=AnimationOffsets.right);break;default:throw new _ErrorFromName("WinJS.UI.Flyout.BadPlacement",strings.badPlacement)}return{left:nextLeft,top:nextTop,animOffset:nextAnimOffset,doesScroll:doesScroll,contentHeight:nextContentHeight,verticalMarginBorderPadding:verticalMarginBorderPadding}}}),CoordinatePositioning:_Base.Class.define(function(coordinates){if(coordinates.clientX===+coordinates.clientX&&coordinates.clientY===+coordinates.clientY){var temp=coordinates;coordinates={x:temp.clientX,y:temp.clientY}}else if(coordinates.x!==+coordinates.x||coordinates.y!==+coordinates.y)throw new _ErrorFromName("WinJS.UI.Flyout.NoCoordinates",strings.noCoordinates);this.coordinates=coordinates},{getTopLeft:function(flyoutMeasurements,isRtl){var currentCoordinates=this.coordinates,widthOfBorderBox=flyoutMeasurements.totalWidth-flyoutMeasurements.marginLeft-flyoutMeasurements.marginRight,adjustForRTL=isRtl?widthOfBorderBox:0,verticalMarginBorderPadding=flyoutMeasurements.totalHeight-flyoutMeasurements.contentHeight,nextContentHeight=flyoutMeasurements.contentHeight,nextTop=currentCoordinates.y-flyoutMeasurements.marginTop,nextLeft=currentCoordinates.x-flyoutMeasurements.marginLeft-adjustForRTL;return nextTop<0?nextTop=0:nextTop+flyoutMeasurements.totalHeight>_Overlay._Overlay._keyboardInfo._visibleDocBottom&&(nextTop=_Constants.pinToBottomEdge),nextLeft<0?nextLeft=0:nextLeft+flyoutMeasurements.totalWidth>_Overlay._Overlay._keyboardInfo._visualViewportWidth&&(nextLeft=_Constants.pinToRightEdge),{left:nextLeft,top:nextTop,verticalMarginBorderPadding:verticalMarginBorderPadding,contentHeight:nextContentHeight,doesScroll:!1,animOffset:AnimationOffsets.top}}})},Flyout=_Base.Class.derive(_Overlay._Overlay,function(element,options){options=options||{},this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseFlyoutConstructor(this._element,options);var _elms=this._element.getElementsByTagName("*"),firstDiv=this._addFirstDiv();firstDiv.tabIndex=_ElementUtilities._getLowestTabIndexInList(_elms);var finalDiv=this._addFinalDiv();return finalDiv.tabIndex=_ElementUtilities._getHighestTabIndexInList(_elms),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._writeProfilerMark("constructor,StopTM"),this},{_lastMaxHeight:null,_baseFlyoutConstructor:function(element,options){this._placement="auto",this._alignment="center",this._baseOverlayConstructor(element,options),this._element.style.visibilty="hidden",this._element.style.display="none",_ElementUtilities.addClass(this._element,_Constants.flyoutClass);var that=this;this._dismissable=new _LightDismissService.LightDismissableElement({element:this._element,tabIndex:this._element.hasAttribute("tabIndex")?this._element.tabIndex:-1,onLightDismiss:function(){that.hide()},onTakeFocus:function(useSetActive){that._dismissable.restoreFocus()||(_ElementUtilities.hasClass(that.element,_Constants.menuClass)?_Overlay._Overlay._trySetActive(that._element):that._focusOnFirstFocusableElementOrThis())}});var role=this._element.getAttribute("role");null!==role&&""!==role&&void 0!==role||(_ElementUtilities.hasClass(this._element,_Constants.menuClass)?this._element.setAttribute("role","menu"):this._element.setAttribute("role","dialog"));var label=this._element.getAttribute("aria-label");null!==label&&""!==label&&void 0!==label||this._element.setAttribute("aria-label",strings.ariaLabel),this._currentAnimateIn=this._flyoutAnimateIn,this._currentAnimateOut=this._flyoutAnimateOut,_ElementUtilities._addEventListener(this.element,"focusin",this._handleFocusIn.bind(this),!1)},anchor:{get:function(){return this._anchor},set:function(value){this._anchor=value}},placement:{get:function(){return this._placement},set:function(value){if("top"!==value&&"bottom"!==value&&"left"!==value&&"right"!==value&&"auto"!==value&&"autohorizontal"!==value&&"autovertical"!==value)throw new _ErrorFromName("WinJS.UI.Flyout.BadPlacement",strings.badPlacement);this._placement=value}},alignment:{get:function(){return this._alignment},set:function(value){if("right"!==value&&"left"!==value&&"center"!==value)throw new _ErrorFromName("WinJS.UI.Flyout.BadAlignment",strings.badAlignment);this._alignment=value}},disabled:{get:function(){return!!this._element.disabled},set:function(value){value=!!value;var oldValue=!!this._element.disabled;oldValue!==value&&(this._element.disabled=value,!this.hidden&&this._element.disabled&&this.hide())}},onbeforeshow:createEvent(_Overlay._Overlay.beforeShow),onaftershow:createEvent(_Overlay._Overlay.afterShow),onbeforehide:createEvent(_Overlay._Overlay.beforeHide),onafterhide:createEvent(_Overlay._Overlay.afterHide),_dispose:function(){_Dispose.disposeSubTree(this.element),this._hide(),Flyout._cascadeManager.flyoutHidden(this),this.anchor=null},show:function(anchor,placement,alignment){this._writeProfilerMark("show,StartTM"),this._positionRequest=new PositionRequests.AnchorPositioning(anchor||this._anchor,placement||this._placement,alignment||this._alignment),this._show()},_show:function(){this._baseFlyoutShow()},showAt:function(coordinates){this._writeProfilerMark("show,StartTM"),this._positionRequest=new PositionRequests.CoordinatePositioning(coordinates),this._show()},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){Flyout._cascadeManager.collapseFlyout(this),this._baseHide()&&Flyout._cascadeManager.flyoutHiding(this)},_beforeEndHide:function(){Flyout._cascadeManager.flyoutHidden(this)},_baseFlyoutShow:function(){if(!this.disabled&&!this._disposed)if(Flyout._cascadeManager.appendFlyout(this),this._element.winAnimating)this._doNext="show";else if(Flyout._cascadeManager.reentrancyLock){this._doNext="show";var that=this;Flyout._cascadeManager.unlocked.then(function(){that._checkDoNext()})}else if(this._baseShow()){if(!_ElementUtilities.hasClass(this.element,"win-menu")){var _elms=this._element.getElementsByTagName("*"),firstDiv=this.element.querySelectorAll(".win-first");this.element.children.length&&!_ElementUtilities.hasClass(this.element.children[0],_Constants.firstDivClass)&&(firstDiv&&firstDiv.length>0&&firstDiv.item(0).parentNode.removeChild(firstDiv.item(0)),firstDiv=this._addFirstDiv()),firstDiv.tabIndex=_ElementUtilities._getLowestTabIndexInList(_elms);var finalDiv=this.element.querySelectorAll(".win-final");_ElementUtilities.hasClass(this.element.children[this.element.children.length-1],_Constants.finalDivClass)||(finalDiv&&finalDiv.length>0&&finalDiv.item(0).parentNode.removeChild(finalDiv.item(0)),finalDiv=this._addFinalDiv()),finalDiv.tabIndex=_ElementUtilities._getHighestTabIndexInList(_elms)}Flyout._cascadeManager.flyoutShown(this)}},_lightDismiss:function(){Flyout._cascadeManager.collapseAll()},_ensurePosition:function(){this._keyboardMovedUs=!1,this._clearAdjustedStyles(),this._setAlignment();var flyoutMeasurements=measureElement(this._element),isRtl="rtl"===_ElementUtilities._getComputedStyle(this._element).direction;this._currentPosition=this._positionRequest.getTopLeft(flyoutMeasurements,isRtl),this._currentPosition.top<0?(this._element.style.bottom=_Overlay._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top=this._currentPosition.top+"px",this._element.style.bottom="auto"),this._currentPosition.left<0?(this._element.style.right="0px",this._element.style.left="auto"):(this._element.style.left=this._currentPosition.left+"px",this._element.style.right="auto"),this._currentPosition.doesScroll&&(_ElementUtilities.addClass(this._element,_Constants.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight,this._element.style.maxHeight=this._currentPosition.contentHeight+"px"),_Overlay._Overlay._keyboardInfo._visible&&(this._checkKeyboardFit(),this._keyboardMovedUs&&this._adjustForKeyboard())},_clearAdjustedStyles:function(){this._element.style.top="0px",this._element.style.bottom="auto",this._element.style.left="0px",this._element.style.right="auto",_ElementUtilities.removeClass(this._element,_Constants.scrollsClass),null!==this._lastMaxHeight&&(this._element.style.maxHeight=this._lastMaxHeight,this._lastMaxHeight=null),_ElementUtilities.removeClass(this._element,"win-rightalign"),_ElementUtilities.removeClass(this._element,"win-leftalign")},_setAlignment:function(){switch(this._positionRequest.alignment){case"left":_ElementUtilities.addClass(this._element,"win-leftalign");break;case"right":_ElementUtilities.addClass(this._element,"win-rightalign")}},_showingKeyboard:function(event){if(!this.hidden&&(event.ensuredFocusedElementInView=!0,this._checkKeyboardFit(),this._keyboardMovedUs)){this._element.style.opacity=0;var that=this;_Global.setTimeout(function(){that._adjustForKeyboard(),that._baseAnimateIn()},_Overlay._Overlay._keyboardInfo._animationShowLength)}},_resize:function(){if((!this.hidden||this._animating)&&this._needToHandleHidingKeyboard){var that=this;_BaseUtils._setImmediate(function(){that.hidden&&!that._animating||that._ensurePosition()}),this._needToHandleHidingKeyboard=!1}},_checkKeyboardFit:function(){var keyboardMovedUs=!1,viewportHeight=_Overlay._Overlay._keyboardInfo._visibleDocHeight,adjustedMarginBoxHeight=this._currentPosition.contentHeight+this._currentPosition.verticalMarginBorderPadding;adjustedMarginBoxHeight>viewportHeight?(keyboardMovedUs=!0,this._currentPosition.top=_Constants.pinToBottomEdge,this._currentPosition.contentHeight=viewportHeight-this._currentPosition.verticalMarginBorderPadding,this._currentPosition.doesScroll=!0):this._currentPosition.top>=0&&this._currentPosition.top+adjustedMarginBoxHeight>_Overlay._Overlay._keyboardInfo._visibleDocBottom?(this._currentPosition.top=_Constants.pinToBottomEdge,keyboardMovedUs=!0):this._currentPosition.top===_Constants.pinToBottomEdge&&(keyboardMovedUs=!0),this._keyboardMovedUs=keyboardMovedUs},_adjustForKeyboard:function(){this._currentPosition.doesScroll&&(this._lastMaxHeight||(_ElementUtilities.addClass(this._element,_Constants.scrollsClass),this._lastMaxHeight=this._element.style.maxHeight),this._element.style.maxHeight=this._currentPosition.contentHeight+"px"),this._checkScrollPosition(!0)},_hidingKeyboard:function(){if(!this.hidden||this._animating)if(_Overlay._Overlay._keyboardInfo._isResized)this._needToHandleHidingKeyboard=!0;else{var that=this;_BaseUtils._setImmediate(function(){that.hidden&&!that._animating||that._ensurePosition()})}},_checkScrollPosition:function(showing){this.hidden&&!showing||void 0!==this._currentPosition&&(this._currentPosition.top<0?(this._element.style.bottom=_Overlay._Overlay._keyboardInfo._visibleDocBottomOffset+"px",this._element.style.top="auto"):(this._element.style.top=this._currentPosition.top+"px",this._element.style.bottom="auto"))},_flyoutAnimateIn:function(){return this._keyboardMovedUs?this._baseAnimateIn():(this._element.style.opacity=1,this._element.style.visibility="visible",Animations.showPopup(this._element,this._currentPosition.animOffset))},_flyoutAnimateOut:function(){return this._keyboardMovedUs?this._baseAnimateOut():(this._element.style.opacity=0,Animations.hidePopup(this._element,this._currentPosition.animOffset))},_hideAllOtherFlyouts:function(thisFlyout){for(var flyouts=_Global.document.querySelectorAll("."+_Constants.flyoutClass),i=0;i<flyouts.length;i++){var flyoutControl=flyouts[i].winControl;flyoutControl&&!flyoutControl.hidden&&flyoutControl!==thisFlyout&&flyoutControl.hide()}},_handleKeyDown:function(event){event.keyCode!==Key.space&&event.keyCode!==Key.enter||this!==_Global.document.activeElement?!event.shiftKey||event.keyCode!==Key.tab||this!==_Global.document.activeElement||event.altKey||event.ctrlKey||event.metaKey||(event.preventDefault(),event.stopPropagation(),this.winControl._focusOnLastFocusableElementOrThis()):(event.preventDefault(),event.stopPropagation(),this.winControl.hide())},_handleFocusIn:function(event){this.element.contains(event.relatedTarget)||Flyout._cascadeManager.handleFocusIntoFlyout(event)},_addFirstDiv:function(){var firstDiv=_Global.document.createElement("div");firstDiv.className=_Constants.firstDivClass,firstDiv.style.display="inline",firstDiv.setAttribute("role","menuitem"),firstDiv.setAttribute("aria-hidden","true"),this._element.children[0]?this._element.insertBefore(firstDiv,this._element.children[0]):this._element.appendChild(firstDiv);var that=this;return _ElementUtilities._addEventListener(firstDiv,"focusin",function(){that._focusOnLastFocusableElementOrThis()},!1),firstDiv},_addFinalDiv:function(){var finalDiv=_Global.document.createElement("div");finalDiv.className=_Constants.finalDivClass,finalDiv.style.display="inline",finalDiv.setAttribute("role","menuitem"),finalDiv.setAttribute("aria-hidden","true"),this._element.appendChild(finalDiv);var that=this;return _ElementUtilities._addEventListener(finalDiv,"focusin",function(){that._focusOnFirstFocusableElementOrThis()},!1),finalDiv},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.Flyout:"+this._id+":"+text)}},{_cascadeManager:new _CascadeManager});return Flyout})})}),define("WinJS/Controls/CommandingSurface/_Constants",["require","exports"],function(require,exports){exports.ClassNames={controlCssClass:"win-commandingsurface",disposableCssClass:"win-disposable",tabStopClass:"win-commandingsurface-tabstop",contentClass:"win-commandingsurface-content",actionAreaCssClass:"win-commandingsurface-actionarea",actionAreaContainerCssClass:"win-commandingsurface-actionareacontainer",overflowButtonCssClass:"win-commandingsurface-overflowbutton",spacerCssClass:"win-commandingsurface-spacer",ellipsisCssClass:"win-commandingsurface-ellipsis",overflowAreaCssClass:"win-commandingsurface-overflowarea",overflowAreaContainerCssClass:"win-commandingsurface-overflowareacontainer",contentFlyoutCssClass:"win-commandingsurface-contentflyout",menuCssClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",insetOutlineClass:"win-commandingsurface-insetoutline",openingClass:"win-commandingsurface-opening",openedClass:"win-commandingsurface-opened",closingClass:"win-commandingsurface-closing",closedClass:"win-commandingsurface-closed",noneClass:"win-commandingsurface-closeddisplaynone",minimalClass:"win-commandingsurface-closeddisplayminimal",compactClass:"win-commandingsurface-closeddisplaycompact",fullClass:"win-commandingsurface-closeddisplayfull",overflowTopClass:"win-commandingsurface-overflowtop",overflowBottomClass:"win-commandingsurface-overflowbottom",commandHiddenClass:"win-commandingsurface-command-hidden",commandPrimaryOverflownPolicyClass:"win-commandingsurface-command-primary-overflown",commandSecondaryOverflownPolicyClass:"win-commandingsurface-command-secondary-overflown",commandSeparatorHiddenPolicyClass:"win-commandingsurface-command-separator-hidden"},exports.EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose",commandPropertyMutated:"_commandpropertymutated"},exports.actionAreaCommandWidth=68,exports.actionAreaSeparatorWidth=34,exports.actionAreaOverflowButtonWidth=32,exports.overflowCommandHeight=44,exports.overflowSeparatorHeight=12,exports.controlMinWidth=exports.actionAreaOverflowButtonWidth,exports.overflowAreaMaxWidth=480,exports.heightOfMinimal=24,exports.heightOfCompact=48,exports.contentMenuCommandDefaultLabel="Custom content",exports.defaultClosedDisplayMode="compact",exports.defaultOpened=!1,exports.defaultOverflowDirection="bottom",exports.typeSeparator="separator",exports.typeContent="content",exports.typeButton="button",exports.typeToggle="toggle",exports.typeFlyout="flyout",exports.commandSelector=".win-command",exports.primaryCommandSection="primary",exports.secondaryCommandSection="secondary"}),define("WinJS/Controls/ToolBar/_Constants",["require","exports","../CommandingSurface/_Constants"],function(require,exports,_CommandingSurfaceConstants){exports.ClassNames={controlCssClass:"win-toolbar",disposableCssClass:"win-disposable",actionAreaCssClass:"win-toolbar-actionarea",overflowButtonCssClass:"win-toolbar-overflowbutton",spacerCssClass:"win-toolbar-spacer",ellipsisCssClass:"win-toolbar-ellipsis",overflowAreaCssClass:"win-toolbar-overflowarea",contentFlyoutCssClass:"win-toolbar-contentflyout",emptytoolbarCssClass:"win-toolbar-empty",menuCssClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",openedClass:"win-toolbar-opened",closedClass:"win-toolbar-closed",compactClass:"win-toolbar-closeddisplaycompact",fullClass:"win-toolbar-closeddisplayfull",overflowTopClass:"win-toolbar-overflowtop",overflowBottomClass:"win-toolbar-overflowbottom",placeHolderCssClass:"win-toolbar-placeholder"},exports.EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose"},exports.OverflowDirection={top:"top",bottom:"bottom"},exports.overflowAreaMaxWidth=_CommandingSurfaceConstants.overflowAreaMaxWidth,exports.controlMinWidth=_CommandingSurfaceConstants.controlMinWidth,exports.defaultClosedDisplayMode="compact",exports.defaultOpened=!1,exports.typeSeparator="separator",exports.typeContent="content",exports.typeButton="button",exports.typeToggle="toggle",exports.typeFlyout="flyout",exports.commandSelector=".win-command",exports.primaryCommandSection="primary",exports.secondaryCommandSection="secondary"}),define("WinJS/Controls/AppBar/_Icon",["exports","../../Core/_Base","../../Core/_Resources"],function(exports,_Base,_Resources){"use strict";var glyphs=["previous","next","play","pause","edit","save","clear","delete","remove","add","cancel","accept","more","redo","undo","home","up","forward","right","back","left","favorite","camera","settings","video","sync","download","mail","find","help","upload","emoji","twopage","leavechat","mailforward","clock","send","crop","rotatecamera","people","closepane","openpane","world","flag","previewlink","globe","trim","attachcamera","zoomin","bookmarks","document","protecteddocument","page","bullets","comment","mail2","contactinfo","hangup","viewall","mappin","phone","videochat","switch","contact","rename","pin","musicinfo","go","keyboard","dockleft","dockright","dockbottom","remote","refresh","rotate","shuffle","list","shop","selectall","orientation","import","importall","browsephotos","webcam","pictures","savelocal","caption","stop","showresults","volume","repair","message","page2","calendarday","calendarweek","calendar","characters","mailreplyall","read","link","accounts","showbcc","hidebcc","cut","attach","paste","filter","copy","emoji2","important","mailreply","slideshow","sort","manage","allapps","disconnectdrive","mapdrive","newwindow","openwith","contactpresence","priority","uploadskydrive","gototoday","font","fontcolor","contact2","folder","audio","placeholder","view","setlockscreen","settile","cc","stopslideshow","permissions","highlight","disableupdates","unfavorite","unpin","openlocal","mute","italic","underline","bold","movetofolder","likedislike","dislike","like","alignright","aligncenter","alignleft","zoom","zoomout","openfile","otheruser","admin","street","map","clearselection","fontdecrease","fontincrease","fontsize","cellphone","reshare","tag","repeatone","repeatall","outlinestar","solidstar","calculator","directions","target","library","phonebook","memo","microphone","postupdate","backtowindow","fullscreen","newfolder","calendarreply","unsyncfolder","reporthacked","syncfolder","blockcontact","switchapps","addfriend","touchpointer","gotostart","zerobars","onebar","twobars","threebars","fourbars","scan","preview","hamburger"],icons=glyphs.reduce(function(fixedIcons,item){return fixedIcons[item]={get:function(){return _Resources._getWinJSString("ui/appBarIcons/"+item).value}},fixedIcons},{});_Base.Namespace._moduleDefine(exports,"WinJS.UI.AppBarIcon",icons)}),define("WinJS/Controls/AppBar/_Command",["exports","../../Core/_Global","../../Core/_WinRT","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Resources","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../Flyout/_Overlay","../Tooltip","../_LegacyAppBar/_Constants","./_Icon"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_Control,_Dispose,_ElementUtilities,_Overlay,Tooltip,_Constants,_Icon){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{AppBarCommand:_Base.Namespace._lazy(function(){function _handleClick(event){var command=this.winControl;if(command){if(command._type===_Constants.typeToggle)command.selected=!command.selected;else if(command._type===_Constants.typeFlyout&&command._flyout){var flyout=command._flyout;"string"==typeof flyout&&(flyout=_Global.document.getElementById(flyout)),flyout.show||(flyout=flyout.winControl),flyout&&flyout.show&&flyout.show(this,"autovertical")}command.onclick&&command.onclick(event)}}function makeObservable(command,propertyName){var _value=command[propertyName],proto=command.constructor.prototype,originalDesc=getPropertyDescriptor(proto,propertyName)||{},getter=originalDesc.get.bind(command)||function(){return _value},setter=originalDesc.set.bind(command)||function(value){_value=value};Object.defineProperty(command,propertyName,{get:function(){return getter()},set:function(value){var oldValue=getter();setter(value);var newValue=getter();this._disposed||oldValue===value||oldValue===newValue||command._disposed||command._propertyMutations.dispatchEvent(_Constants.commandPropertyMutated,{command:command,propertyName:propertyName,oldValue:oldValue,newValue:newValue})}})}function getPropertyDescriptor(obj,propertyName){for(var desc=null;obj&&!desc;)desc=Object.getOwnPropertyDescriptor(obj,propertyName),obj=Object.getPrototypeOf(obj);return desc}var PropertyMutations=_Base.Class.define(function(){this._observer=_BaseUtils._merge({},_Events.eventMixin)},{bind:function(callback){this._observer.addEventListener(_Constants.commandPropertyMutated,callback)},unbind:function(callback){this._observer.removeEventListener(_Constants.commandPropertyMutated,callback)},dispatchEvent:function(type,detail){this._observer.dispatchEvent(type,detail)}}),strings={get ariaLabel(){return _Resources._getWinJSString("ui/appBarCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badDivElement(){return"Invalid argument: For a content command, the element must be null or a div element"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"},get badPriority(){return"Invalid argument: the priority of an {0} must be a non-negative integer"}},AppBarCommand=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.AppBarCommand.DuplicateConstruction",strings.duplicateConstruction);if(this._disposed=!1,options||(options={}),options.type||(this._type=_Constants.typeButton),options.section=options.section||_Constants.sectionPrimary,this._element=element,options.type===_Constants.typeContent?this._createContent():options.type===_Constants.typeSeparator?this._createSeparator():this._createButton(),_ElementUtilities.addClass(this._element,"win-disposable"),this._element.winControl=this,_ElementUtilities.addClass(this._element,_Constants.appBarCommandClass),options.onclick&&(this.onclick=options.onclick),options.onclick=_handleClick,_Control.setOptions(this,options),this._type!==_Constants.typeToggle||options.selected||(this.selected=!1),this._type!==_Constants.typeSeparator){var role=this._element.getAttribute("role");null!==role&&""!==role&&void 0!==role||(role=this._type===_Constants.typeToggle?"checkbox":this._type===_Constants.typeContent?"group":"menuitem",this._element.setAttribute("role",role),this._type===_Constants.typeFlyout&&this._element.setAttribute("aria-haspopup",!0));var label=this._element.getAttribute("aria-label");null!==label&&""!==label&&void 0!==label||this._element.setAttribute("aria-label",strings.ariaLabel)}this._propertyMutations=new PropertyMutations;var that=this;ObservablePropertyWhiteList.forEach(function(propertyName){makeObservable(that,propertyName)})},{id:{get:function(){return this._element.id},set:function(value){value&&!this._element.id&&(this._element.id=value)}},type:{get:function(){return this._type},set:function(value){this._type||(value!==_Constants.typeContent&&value!==_Constants.typeFlyout&&value!==_Constants.typeToggle&&value!==_Constants.typeSeparator?this._type=_Constants.typeButton:this._type=value);
}},label:{get:function(){return this._label},set:function(value){this._label=value,this._labelSpan&&(this._labelSpan.textContent=this.label),!this.tooltip&&this._tooltipControl&&(this._tooltip=this.label,this._tooltipControl.innerHTML=this.label),this._element.setAttribute("aria-label",this.label),this._testIdenticalTooltip()}},icon:{get:function(){return this._icon},set:function(value){this._icon=_Icon[value]||value,this._imageSpan&&(this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",_ElementUtilities.addClass(this._imageSpan,"win-commandglyph")):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",_ElementUtilities.removeClass(this._imageSpan,"win-commandglyph")))}},onclick:{get:function(){return this._onclick},set:function(value){if(value&&"function"!=typeof value)throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadClick",_Resources._formatString(strings.badClick,"AppBarCommand"));this._onclick=value}},priority:{get:function(){return this._priority},set:function(value){if(!(void 0===value||"number"==typeof value&&value>=0))throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadPriority",_Resources._formatString(strings.badPriority,"AppBarCommand"));this._priority=value}},flyout:{get:function(){var flyout=this._flyout;return"string"==typeof flyout&&(flyout=_Global.document.getElementById(flyout)),flyout&&!flyout.element&&flyout.winControl&&(flyout=flyout.winControl),flyout},set:function(value){var id=value;id&&"string"!=typeof id&&(id.element&&(id=id.element),id&&(id.id?id=id.id:(id.id=_ElementUtilities._uniqueID(id),id=id.id))),"string"==typeof id&&this._element.setAttribute("aria-owns",id),this._flyout=value}},section:{get:function(){return this._section},set:function(value){this._section&&!_WinRT.Windows.ApplicationModel.DesignMode.designModeEnabled||this._setSection(value)}},tooltip:{get:function(){return this._tooltip},set:function(value){this._tooltip=value,this._tooltipControl&&(this._tooltipControl.innerHTML=this._tooltip),this._testIdenticalTooltip()}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(value){this._element.setAttribute("aria-checked",value)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(value){this._element.disabled=value}},hidden:{get:function(){return _ElementUtilities.hasClass(this._element,_Constants.commandHiddenClass)},set:function(value){if(value!==this.hidden){var wasHidden=this.hidden;value?_ElementUtilities.addClass(this._element,_Constants.commandHiddenClass):_ElementUtilities.removeClass(this._element,_Constants.commandHiddenClass),this._sendEvent(_Constants.commandVisibilityChanged)||(wasHidden?_ElementUtilities.addClass(this._element,_Constants.commandHiddenClass):_ElementUtilities.removeClass(this._element,_Constants.commandHiddenClass))}}},firstElementFocus:{get:function(){return this._firstElementFocus||this._lastElementFocus||this._element},set:function(element){this._firstElementFocus=element===this.element?null:element,this._updateTabStop()}},lastElementFocus:{get:function(){return this._lastElementFocus||this._firstElementFocus||this._element},set:function(element){this._lastElementFocus=element===this.element?null:element,this._updateTabStop()}},dispose:function(){this._disposed||(this._disposed=!0,this._tooltipControl&&this._tooltipControl.dispose(),this._type===_Constants.typeContent&&_Dispose.disposeSubTree(this.element))},addEventListener:function(type,listener,useCapture){return this._element.addEventListener(type,listener,useCapture)},removeEventListener:function(type,listener,useCapture){return this._element.removeEventListener(type,listener,useCapture)},extraClass:{get:function(){return this._extraClass},set:function(value){this._extraClass&&_ElementUtilities.removeClass(this._element,this._extraClass),this._extraClass=value,_ElementUtilities.addClass(this._element,this._extraClass)}},_testIdenticalTooltip:function(){this._hideIfFullSize=this._label===this._tooltip},_createContent:function(){if(this._element){if("DIV"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadDivElement",strings.badDivElement)}else this._element=_Global.document.createElement("div");parseInt(this._element.getAttribute("tabIndex"),10)!==this._element.tabIndex&&(this._element.tabIndex=0)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadHrElement",strings.badHrElement)}else this._element=_Global.document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.AppBarCommand.BadButtonElement",strings.badButtonElement);var type=this._element.getAttribute("type");null!==type&&""!==type&&void 0!==type||this._element.setAttribute("type","button"),this._element.innerHTML=""}else this._element=_Global.document.createElement("button");this._element.type="button",this._iconSpan=_Global.document.createElement("span"),this._iconSpan.setAttribute("aria-hidden","true"),this._iconSpan.className="win-commandicon",this._iconSpan.tabIndex=-1,this._element.appendChild(this._iconSpan),this._imageSpan=_Global.document.createElement("span"),this._imageSpan.setAttribute("aria-hidden","true"),this._imageSpan.className="win-commandimage",this._imageSpan.tabIndex=-1,this._iconSpan.appendChild(this._imageSpan),this._labelSpan=_Global.document.createElement("span"),this._labelSpan.setAttribute("aria-hidden","true"),this._labelSpan.className="win-label",this._labelSpan.tabIndex=-1,this._element.appendChild(this._labelSpan),this._tooltipControl=new Tooltip.Tooltip(this._element);var that=this;this._tooltipControl.addEventListener("beforeopen",function(){that._hideIfFullSize&&!_Overlay._Overlay._getParentControlUsingClassName(that._element.parentElement,_Constants.reducedClass)&&that._tooltipControl.close()},!1)},_setSection:function(section){section||(section=_Constants.sectionPrimary),this._section&&(this._section===_Constants.sectionGlobal?_ElementUtilities.removeClass(this._element,_Constants.appBarCommandGlobalClass):this.section===_Constants.sectionSelection&&_ElementUtilities.removeClass(this._element,_Constants.appBarCommandSelectionClass)),this._section=section,section===_Constants.sectionGlobal?_ElementUtilities.addClass(this._element,_Constants.appBarCommandGlobalClass):section===_Constants.sectionSelection&&_ElementUtilities.addClass(this._element,_Constants.appBarCommandSelectionClass)},_updateTabStop:function(){this._firstElementFocus||this._lastElementFocus?this.element.tabIndex=-1:this.element.tabIndex=0},_isFocusable:function(){return!this.hidden&&this._type!==_Constants.typeSeparator&&!this.element.disabled&&(this.firstElementFocus.tabIndex>=0||this.lastElementFocus.tabIndex>=0)},_sendEvent:function(eventName,detail){if(!this._disposed){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent(eventName,!0,!0,detail||{}),this._element.dispatchEvent(event)}}}),ObservablePropertyWhiteList=["label","disabled","flyout","extraClass","selected","onclick","hidden"];return AppBarCommand})}),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Command:_Base.Namespace._lazy(function(){return exports.AppBarCommand})})}),define("WinJS/Controls/Menu/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Promise","../../Utilities/_Control","../../Utilities/_ElementUtilities","../_LegacyAppBar/_Constants","../Flyout/_Overlay"],function(exports,_Global,_Base,_ErrorFromName,_Resources,Promise,_Control,_ElementUtilities,_Constants,_Overlay){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{MenuCommand:_Base.Namespace._lazy(function(){var strings={get ariaLabel(){return _Resources._getWinJSString("ui/menuCommandAriaLabel").value},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badClick(){return"Invalid argument: The onclick property for an {0} must be a function"},get badHrElement(){return"Invalid argument: For a separator, the element must be null or an hr element"},get badButtonElement(){return"Invalid argument: For a button, toggle, or flyout command, the element must be null or a button element"}},MenuCommand=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.MenuCommand.DuplicateConstruction",strings.duplicateConstruction);if(this._disposed=!1,options||(options={}),options.type||(this._type=_Constants.typeButton),this._element=element,options.type===_Constants.typeSeparator?this._createSeparator():this._createButton(),_ElementUtilities.addClass(this._element,"win-disposable"),this._element.winControl=this,_ElementUtilities.addClass(this._element,_Constants.menuCommandClass),options.selected||options.type!==_Constants.typeToggle||(this.selected=!1),options.onclick&&(this.onclick=options.onclick),options.onclick=this._handleClick.bind(this),_Control.setOptions(this,options),this._type!==_Constants.typeSeparator){var role=this._element.getAttribute("role");null!==role&&""!==role&&void 0!==role||(role="menuitem",this._type===_Constants.typeToggle&&(role="checkbox"),this._element.setAttribute("role",role),this._type===_Constants.typeFlyout&&this._element.setAttribute("aria-haspopup",!0));var label=this._element.getAttribute("aria-label");null!==label&&""!==label&&void 0!==label||this._element.setAttribute("aria-label",strings.ariaLabel)}},{id:{get:function(){return this._element.id},set:function(value){this._element.id||(this._element.id=value)}},type:{get:function(){return this._type},set:function(value){this._type||(value!==_Constants.typeButton&&value!==_Constants.typeFlyout&&value!==_Constants.typeToggle&&value!==_Constants.typeSeparator&&(value=_Constants.typeButton),this._type=value,value===_Constants.typeButton?_ElementUtilities.addClass(this.element,_Constants.menuCommandButtonClass):value===_Constants.typeFlyout?(_ElementUtilities.addClass(this.element,_Constants.menuCommandFlyoutClass),this.element.addEventListener("keydown",this._handleKeyDown.bind(this),!1)):value===_Constants.typeSeparator?_ElementUtilities.addClass(this.element,_Constants.menuCommandSeparatorClass):value===_Constants.typeToggle&&_ElementUtilities.addClass(this.element,_Constants.menuCommandToggleClass))}},label:{get:function(){return this._label},set:function(value){this._label=value||"",this._labelSpan&&(this._labelSpan.textContent=this.label),this._element.setAttribute("aria-label",this.label)}},onclick:{get:function(){return this._onclick},set:function(value){if(value&&"function"!=typeof value)throw new _ErrorFromName("WinJS.UI.MenuCommand.BadClick",_Resources._formatString(strings.badClick,"MenuCommand"));this._onclick=value}},flyout:{get:function(){var flyout=this._flyout;return"string"==typeof flyout&&(flyout=_Global.document.getElementById(flyout)),flyout&&!flyout.element&&(flyout=flyout.winControl),flyout},set:function(value){var id=value;id&&"string"!=typeof id&&(id.element&&(id=id.element),id&&(id.id?id=id.id:(id.id=_ElementUtilities._uniqueID(id),id=id.id))),"string"==typeof id&&this._element.setAttribute("aria-owns",id),this._flyout!==value&&MenuCommand._deactivateFlyoutCommand(this),this._flyout=value}},selected:{get:function(){return"true"===this._element.getAttribute("aria-checked")},set:function(value){this._element.setAttribute("aria-checked",!!value)}},element:{get:function(){return this._element}},disabled:{get:function(){return!!this._element.disabled},set:function(value){value=!!value,value&&this.type===_Constants.typeFlyout&&MenuCommand._deactivateFlyoutCommand(this),this._element.disabled=value}},hidden:{get:function(){return"hidden"===this._element.style.visibility},set:function(value){var menuControl=_Overlay._Overlay._getParentControlUsingClassName(this._element,_Constants.menuClass);if(menuControl&&!menuControl.hidden)throw new _ErrorFromName("WinJS.UI.MenuCommand.CannotChangeHiddenProperty",_Resources._formatString(_Overlay._Overlay.commonstrings.cannotChangeHiddenProperty,"Menu"));var style=this._element.style;value?(this.type===_Constants.typeFlyout&&MenuCommand._deactivateFlyoutCommand(this),style.visibility="hidden",style.display="none"):(style.visibility="",style.display="block")}},extraClass:{get:function(){return this._extraClass},set:function(value){this._extraClass&&_ElementUtilities.removeClass(this._element,this._extraClass),this._extraClass=value,_ElementUtilities.addClass(this._element,this._extraClass)}},dispose:function(){this._disposed||(this._disposed=!0)},addEventListener:function(type,listener,useCapture){return this._element.addEventListener(type,listener,useCapture)},removeEventListener:function(type,listener,useCapture){return this._element.removeEventListener(type,listener,useCapture)},_createSeparator:function(){if(this._element){if("HR"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.MenuCommand.BadHrElement",strings.badHrElement)}else this._element=_Global.document.createElement("hr")},_createButton:function(){if(this._element){if("BUTTON"!==this._element.tagName)throw new _ErrorFromName("WinJS.UI.MenuCommand.BadButtonElement",strings.badButtonElement)}else this._element=_Global.document.createElement("button");this._element.innerHTML='<div class="win-menucommand-liner"><span class="win-toggleicon" aria-hidden="true"></span><span class="win-label" aria-hidden="true"></span><span class="win-flyouticon" aria-hidden="true"></span></div>',this._element.type="button",this._menuCommandLiner=this._element.firstElementChild,this._toggleSpan=this._menuCommandLiner.firstElementChild,this._labelSpan=this._toggleSpan.nextElementSibling,this._flyoutSpan=this._labelSpan.nextElementSibling},_sendEvent:function(eventName,detail){if(!this._disposed){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(eventName,!0,!0,detail||{}),this._element.dispatchEvent(event)}},_invoke:function(event){this.hidden||this.disabled||this._disposed||(this._type===_Constants.typeToggle?this.selected=!this.selected:this._type===_Constants.typeFlyout&&MenuCommand._activateFlyoutCommand(this),event&&"click"===event.type&&this.onclick&&this.onclick(event),this._sendEvent(_Constants._menuCommandInvokedEvent,{command:this}))},_handleClick:function(event){this._invoke(event)},_handleKeyDown:function(event){var Key=_ElementUtilities.Key,rtl="rtl"===_ElementUtilities._getComputedStyle(this.element).direction,rightKey=rtl?Key.leftArrow:Key.rightArrow;event.keyCode===rightKey&&this.type===_Constants.typeFlyout&&(this._invoke(event),event.preventDefault())}},{_activateFlyoutCommand:function(menuCommand){return new Promise(function(c,e){menuCommand=menuCommand.winControl||menuCommand;var subFlyout=menuCommand.flyout;subFlyout&&subFlyout.hidden&&subFlyout.show?(_ElementUtilities.addClass(menuCommand.element,_Constants.menuCommandFlyoutActivatedClass),subFlyout.element.setAttribute("aria-expanded","true"),subFlyout.addEventListener("beforehide",function beforeHide(){subFlyout.removeEventListener("beforehide",beforeHide,!1),_ElementUtilities.removeClass(menuCommand.element,_Constants.menuCommandFlyoutActivatedClass),subFlyout.element.removeAttribute("aria-expanded")},!1),subFlyout.addEventListener("aftershow",function afterShow(){subFlyout.removeEventListener("aftershow",afterShow,!1),c()},!1),subFlyout.show(menuCommand,"_cascade")):e()})},_deactivateFlyoutCommand:function(menuCommand){return new Promise(function(c){menuCommand=menuCommand.winControl||menuCommand,_ElementUtilities.removeClass(menuCommand.element,_Constants.menuCommandFlyoutActivatedClass);var subFlyout=menuCommand.flyout;subFlyout&&!subFlyout.hidden&&subFlyout.hide?(subFlyout.addEventListener("afterhide",function afterHide(){subFlyout.removeEventListener("afterhide",afterHide,!1),c()},!1),subFlyout.hide()):c()})}});return MenuCommand})})});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};return define("WinJS/Controls/CommandingSurface/_MenuCommand",["require","exports","../Menu/_Command"],function(require,exports,_MenuCommandBase){var _MenuCommand=function(_super){function _MenuCommand(element,options){options&&options.beforeInvoke&&(this._beforeInvoke=options.beforeInvoke),_super.call(this,element,options)}return __extends(_MenuCommand,_super),_MenuCommand.prototype._invoke=function(event){this._beforeInvoke&&this._beforeInvoke(event),_super.prototype._invoke.call(this,event)},_MenuCommand}(_MenuCommandBase.MenuCommand);exports._MenuCommand=_MenuCommand}),define("WinJS/Utilities/_OpenCloseMachine",["require","exports","../Core/_Global","../Promise","../_Signal"],function(require,exports,_Global,Promise,_Signal){"use strict";function cancelablePromise(animationPromise){return Promise._cancelBlocker(animationPromise,function(){animationPromise.cancel()})}function _(){}function interruptible(object,workFn){object._interruptibleWorkPromises=object._interruptibleWorkPromises||[];var workStoredSignal=new _Signal;object._interruptibleWorkPromises.push(workFn(workStoredSignal.promise)),workStoredSignal.complete()}function cancelInterruptibles(){(this._interruptibleWorkPromises||[]).forEach(function(workPromise){workPromise.cancel()})}var EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose",_openCloseStateSettled:"_openCloseStateSettled"},OpenCloseMachine=function(){function OpenCloseMachine(args){this._control=args,this._initializedSignal=new _Signal,this._disposed=!1,this._setState(States.Init)}return OpenCloseMachine.prototype.exitInit=function(){this._initializedSignal.complete()},OpenCloseMachine.prototype.updateDom=function(){this._state.updateDom()},OpenCloseMachine.prototype.open=function(){this._state.open()},OpenCloseMachine.prototype.close=function(){this._state.close()},Object.defineProperty(OpenCloseMachine.prototype,"opened",{get:function(){return this._state.opened},set:function(value){value?this.open():this.close()},enumerable:!0,configurable:!0}),OpenCloseMachine.prototype.dispose=function(){this._setState(States.Disposed),this._disposed=!0,this._control=null},OpenCloseMachine.prototype._setState=function(NewState,arg0){this._disposed||(this._state&&this._state.exit(),this._state=new NewState,this._state.machine=this,this._state.enter(arg0))},OpenCloseMachine.prototype._fireEvent=function(eventName,options){options=options||{};var detail=options.detail||null,cancelable=!!options.cancelable,eventObject=_Global.document.createEvent("CustomEvent");return eventObject.initCustomEvent(eventName,!0,cancelable,detail),this._control.eventElement.dispatchEvent(eventObject)},OpenCloseMachine.prototype._fireBeforeOpen=function(){return this._fireEvent(EventNames.beforeOpen,{cancelable:!0})},OpenCloseMachine.prototype._fireBeforeClose=function(){return this._fireEvent(EventNames.beforeClose,{cancelable:!0})},OpenCloseMachine}();exports.OpenCloseMachine=OpenCloseMachine;var States;!function(States){function updateDomImpl(){this.machine._control.onUpdateDom()}var Init=function(){function Init(){this.name="Init",this.exit=cancelInterruptibles,this.updateDom=_}return Init.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this.machine._initializedSignal.promise}).then(function(){_this.machine._control.onUpdateDomWithIsOpened(_this._opened),_this.machine._setState(_this._opened?Opened:Closed)})})},Object.defineProperty(Init.prototype,"opened",{get:function(){return this._opened},enumerable:!0,configurable:!0}),Init.prototype.open=function(){this._opened=!0},Init.prototype.close=function(){this._opened=!1},Init}();States.Init=Init;var Closed=function(){function Closed(){this.name="Closed",this.exit=_,this.opened=!1,this.close=_,this.updateDom=updateDomImpl}return Closed.prototype.enter=function(args){args=args||{},args.openIsPending&&this.open(),this.machine._fireEvent(EventNames._openCloseStateSettled)},Closed.prototype.open=function(){this.machine._setState(BeforeOpen)},Closed}(),BeforeOpen=function(){function BeforeOpen(){this.name="BeforeOpen",this.exit=cancelInterruptibles,this.opened=!1,this.open=_,this.close=_,this.updateDom=updateDomImpl}return BeforeOpen.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this.machine._fireBeforeOpen()}).then(function(shouldOpen){shouldOpen?_this.machine._setState(Opening):_this.machine._setState(Closed)})})},BeforeOpen}(),Opening=function(){function Opening(){this.name="Opening",this.exit=cancelInterruptibles,this.updateDom=_}return Opening.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this._closeIsPending=!1,cancelablePromise(_this.machine._control.onOpen())}).then(function(){_this.machine._fireEvent(EventNames.afterOpen)}).then(function(){_this.machine._control.onUpdateDom(),_this.machine._setState(Opened,{closeIsPending:_this._closeIsPending})})})},Object.defineProperty(Opening.prototype,"opened",{get:function(){return!this._closeIsPending},enumerable:!0,configurable:!0}),Opening.prototype.open=function(){this._closeIsPending=!1},Opening.prototype.close=function(){this._closeIsPending=!0},Opening}(),Opened=function(){function Opened(){this.name="Opened",this.exit=_,this.opened=!0,this.open=_,this.updateDom=updateDomImpl}return Opened.prototype.enter=function(args){args=args||{},args.closeIsPending&&this.close(),this.machine._fireEvent(EventNames._openCloseStateSettled)},Opened.prototype.close=function(){this.machine._setState(BeforeClose)},Opened}(),BeforeClose=function(){function BeforeClose(){this.name="BeforeClose",this.exit=cancelInterruptibles,this.opened=!0,this.open=_,this.close=_,this.updateDom=updateDomImpl}return BeforeClose.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this.machine._fireBeforeClose()}).then(function(shouldClose){shouldClose?_this.machine._setState(Closing):_this.machine._setState(Opened)})})},BeforeClose}(),Closing=function(){function Closing(){this.name="Closing",this.exit=cancelInterruptibles,this.updateDom=_}return Closing.prototype.enter=function(){var _this=this;interruptible(this,function(ready){return ready.then(function(){return _this._openIsPending=!1,cancelablePromise(_this.machine._control.onClose())}).then(function(){_this.machine._fireEvent(EventNames.afterClose)}).then(function(){_this.machine._control.onUpdateDom(),_this.machine._setState(Closed,{openIsPending:_this._openIsPending})})})},Object.defineProperty(Closing.prototype,"opened",{get:function(){return this._openIsPending},enumerable:!0,configurable:!0}),Closing.prototype.open=function(){this._openIsPending=!0},Closing.prototype.close=function(){this._openIsPending=!1},Closing}(),Disposed=function(){function Disposed(){this.name="Disposed",this.enter=_,this.exit=_,this.opened=!1,this.open=_,this.close=_,this.updateDom=_}return Disposed}();States.Disposed=Disposed}(States||(States={}))}),define("require-style!less/styles-commandingsurface",[],function(){}),define("require-style!less/colors-commandingsurface",[],function(){}),define("WinJS/Controls/CommandingSurface/_CommandingSurface",["require","exports","../../Animations","../../Core/_Base","../../Core/_BaseUtils","../../BindingList","../../ControlProcessor","../CommandingSurface/_Constants","../AppBar/_Command","../CommandingSurface/_MenuCommand","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Controls/Flyout","../../Core/_Global","../../Utilities/_Hoverable","../../Utilities/_KeyboardBehavior","../../Core/_Log","../../Promise","../../Core/_Resources","../../Scheduler","../../Utilities/_OpenCloseMachine","../../_Signal","../../Core/_WriteProfilerMark"],function(require,exports,Animations,_Base,_BaseUtils,BindingList,ControlProcessor,_Constants,_Command,_CommandingSurfaceMenuCommand,_Control,_Dispose,_ElementUtilities,_ErrorFromName,_Events,_Flyout,_Global,_Hoverable,_KeyboardBehavior,_Log,Promise,_Resources,Scheduler,_OpenCloseMachine,_Signal,_WriteProfilerMark){function addClass(element,className){className&&_ElementUtilities.addClass(element,className)}function removeClass(element,className){className&&_ElementUtilities.removeClass(element,className)}function diffElements(lhs,rhs){return lhs.filter(function(commandElement){return rhs.indexOf(commandElement)<0})}function intersectElements(arr1,arr2){return arr1.filter(function(x){return arr2.indexOf(x)!==-1})}require(["require-style!less/styles-commandingsurface"]),require(["require-style!less/colors-commandingsurface"]);var strings={get overflowButtonAriaLabel(){return _Resources._getWinJSString("ui/commandingSurfaceOverflowButtonAriaLabel").value},get badData(){return"Invalid argument: The data property must an instance of a WinJS.Binding.List"},get mustContainCommands(){return"The commandingSurface can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},OverflowDirection={bottom:"bottom",top:"top"},overflowDirectionClassMap={};overflowDirectionClassMap[OverflowDirection.top]=_Constants.ClassNames.overflowTopClass,overflowDirectionClassMap[OverflowDirection.bottom]=_Constants.ClassNames.overflowBottomClass;var ClosedDisplayMode={none:"none",minimal:"minimal",compact:"compact",full:"full"},closedDisplayModeClassMap={};closedDisplayModeClassMap[ClosedDisplayMode.none]=_Constants.ClassNames.noneClass,closedDisplayModeClassMap[ClosedDisplayMode.minimal]=_Constants.ClassNames.minimalClass,closedDisplayModeClassMap[ClosedDisplayMode.compact]=_Constants.ClassNames.compactClass,closedDisplayModeClassMap[ClosedDisplayMode.full]=_Constants.ClassNames.fullClass;var _CommandingSurface=function(){function _CommandingSurface(element,options){var _this=this;if(void 0===options&&(options={}),this._hoverable=_Hoverable.isHoverable,this._dataChangedEvents=["itemchanged","iteminserted","itemmoved","itemremoved","reload"],this._updateDomImpl=function(){var _renderedState={closedDisplayMode:void 0,isOpenedMode:void 0,overflowDirection:void 0,overflowAlignmentOffset:void 0},_renderDisplayMode=function(){var rendered=_renderedState,dom=_this._dom;if(rendered.isOpenedMode!==_this._isOpenedMode&&(_this._isOpenedMode?(removeClass(dom.root,_Constants.ClassNames.closedClass),addClass(dom.root,_Constants.ClassNames.openedClass),dom.overflowButton.setAttribute("aria-expanded","true"),dom.firstTabStop.tabIndex=0,dom.finalTabStop.tabIndex=0,dom.firstTabStop.setAttribute("x-ms-aria-flowfrom",dom.finalTabStop.id),dom.finalTabStop.setAttribute("aria-flowto",dom.firstTabStop.id)):(removeClass(dom.root,_Constants.ClassNames.openedClass),addClass(dom.root,_Constants.ClassNames.closedClass),dom.overflowButton.setAttribute("aria-expanded","false"),dom.firstTabStop.tabIndex=-1,dom.finalTabStop.tabIndex=-1,dom.firstTabStop.removeAttribute("x-ms-aria-flowfrom"),dom.finalTabStop.removeAttribute("aria-flowto")),rendered.isOpenedMode=_this._isOpenedMode),rendered.closedDisplayMode!==_this.closedDisplayMode&&(removeClass(dom.root,closedDisplayModeClassMap[rendered.closedDisplayMode]),addClass(dom.root,closedDisplayModeClassMap[_this.closedDisplayMode]),rendered.closedDisplayMode=_this.closedDisplayMode),rendered.overflowDirection!==_this.overflowDirection&&(removeClass(dom.root,overflowDirectionClassMap[rendered.overflowDirection]),addClass(dom.root,overflowDirectionClassMap[_this.overflowDirection]),rendered.overflowDirection=_this.overflowDirection),_this._overflowAlignmentOffset!==rendered.overflowAlignmentOffset){var offsetProperty=_this._rtl?"left":"right",offsetTextValue=_this._overflowAlignmentOffset+"px";dom.overflowAreaContainer.style[offsetProperty]=offsetTextValue}},CommandLayoutPipeline={newDataStage:3,measuringStage:2,layoutStage:1,idle:0},_currentLayoutStage=CommandLayoutPipeline.idle,_updateCommands=function(){_this._writeProfilerMark("_updateDomImpl_updateCommands,info");for(var currentStage=_currentLayoutStage;currentStage!==CommandLayoutPipeline.idle;){var prevStage=currentStage,okToProceed=!1;switch(currentStage){case CommandLayoutPipeline.newDataStage:currentStage=CommandLayoutPipeline.measuringStage,okToProceed=_this._processNewData();break;case CommandLayoutPipeline.measuringStage:currentStage=CommandLayoutPipeline.layoutStage,okToProceed=_this._measure();break;case CommandLayoutPipeline.layoutStage:currentStage=CommandLayoutPipeline.idle,okToProceed=_this._layoutCommands()}if(!okToProceed){currentStage=prevStage;break}}_currentLayoutStage=currentStage,currentStage===CommandLayoutPipeline.idle?_this._layoutCompleteCallback&&_this._layoutCompleteCallback():_this._minimalLayout()};return{get renderedState(){return{get closedDisplayMode(){return _renderedState.closedDisplayMode},get isOpenedMode(){return _renderedState.isOpenedMode},get overflowDirection(){return _renderedState.overflowDirection},get overflowAlignmentOffset(){return _renderedState.overflowAlignmentOffset}}},update:function(){_renderDisplayMode(),_updateCommands()},dataDirty:function(){_currentLayoutStage=Math.max(CommandLayoutPipeline.newDataStage,_currentLayoutStage)},measurementsDirty:function(){_currentLayoutStage=Math.max(CommandLayoutPipeline.measuringStage,_currentLayoutStage)},layoutDirty:function(){_currentLayoutStage=Math.max(CommandLayoutPipeline.layoutStage,_currentLayoutStage)},get _currentLayoutStage(){return _currentLayoutStage}}}(),this._writeProfilerMark("constructor,StartTM"),element){if(element.winControl)throw new _ErrorFromName("WinJS.UI._CommandingSurface.DuplicateConstruction",strings.duplicateConstruction);options.data||(options=_BaseUtils._shallowCopy(options),options.data=options.data||this._getDataFromDOMElements(element))}this._initializeDom(element||_Global.document.createElement("div")),this._machine=options.openCloseMachine||new _OpenCloseMachine.OpenCloseMachine({eventElement:this._dom.root,onOpen:function(){return _this.synchronousOpen(),Promise.wrap()},onClose:function(){return _this.synchronousClose(),Promise.wrap()},onUpdateDom:function(){_this._updateDomImpl.update()},onUpdateDomWithIsOpened:function(isOpened){isOpened?_this.synchronousOpen():_this.synchronousClose()}}),this._disposed=!1,this._primaryCommands=[],this._secondaryCommands=[],this._refreshBound=this._refresh.bind(this),this._resizeHandlerBound=this._resizeHandler.bind(this),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._dom.root),this._refreshPending=!1,this._rtl=!1,this._initializedSignal=new _Signal,this._isOpenedMode=_Constants.defaultOpened,this._menuCommandProjections=[],this.overflowDirection=_Constants.defaultOverflowDirection,this.closedDisplayMode=_Constants.defaultClosedDisplayMode,this.opened=this._isOpenedMode,_Control.setOptions(this,options),_ElementUtilities._resizeNotifier.subscribe(this._dom.root,this._resizeHandlerBound),this._dom.root.addEventListener("keydown",this._keyDownHandler.bind(this)),_ElementUtilities._addEventListener(this._dom.firstTabStop,"focusin",function(){_this._focusLastFocusableElementOrThis(!1)}),_ElementUtilities._addEventListener(this._dom.finalTabStop,"focusin",function(){_this._focusFirstFocusableElementOrThis(!1)}),_ElementUtilities._inDom(this._dom.root).then(function(){_this._rtl="rtl"===_ElementUtilities._getComputedStyle(_this._dom.root).direction,options.openCloseMachine||_this._machine.exitInit(),_this._initializedSignal.complete(),_this._writeProfilerMark("constructor,StopTM")})}return Object.defineProperty(_CommandingSurface.prototype,"element",{
get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(_CommandingSurface.prototype,"data",{get:function(){return this._data},set:function(value){if(this._writeProfilerMark("set_data,info"),value!==this.data){if(!(value instanceof BindingList.List))throw new _ErrorFromName("WinJS.UI._CommandingSurface.BadData",strings.badData);this._data&&this._removeDataListeners(),this._data=value,this._addDataListeners(),this._dataUpdated()}},enumerable:!0,configurable:!0}),Object.defineProperty(_CommandingSurface.prototype,"closedDisplayMode",{get:function(){return this._closedDisplayMode},set:function(value){this._writeProfilerMark("set_closedDisplayMode,info");var isChangingState=value!==this._closedDisplayMode;ClosedDisplayMode[value]&&isChangingState&&(this._updateDomImpl.layoutDirty(),this._closedDisplayMode=value,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(_CommandingSurface.prototype,"overflowDirection",{get:function(){return this._overflowDirection},set:function(value){var isChangingState=value!==this._overflowDirection;OverflowDirection[value]&&isChangingState&&(this._overflowDirection=value,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(_CommandingSurface.prototype,"opened",{get:function(){return this._machine.opened},set:function(value){this._machine.opened=value},enumerable:!0,configurable:!0}),_CommandingSurface.prototype.open=function(){this._machine.open()},_CommandingSurface.prototype.close=function(){this._machine.close()},_CommandingSurface.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._machine.dispose(),_ElementUtilities._resizeNotifier.unsubscribe(this._dom.root,this._resizeHandlerBound),this._contentFlyout&&(this._contentFlyout.dispose(),this._contentFlyout.element.parentNode.removeChild(this._contentFlyout.element)),_Dispose.disposeSubTree(this._dom.root))},_CommandingSurface.prototype.forceLayout=function(){this._updateDomImpl.measurementsDirty(),this._machine.updateDom()},_CommandingSurface.prototype.getBoundingRects=function(){return{commandingSurface:this._dom.root.getBoundingClientRect(),overflowArea:this._dom.overflowArea.getBoundingClientRect()}},_CommandingSurface.prototype.getCommandById=function(id){if(this._data)for(var i=0,len=this._data.length;i<len;i++){var command=this._data.getAt(i);if(command.id===id)return command}return null},_CommandingSurface.prototype.showOnlyCommands=function(commands){if(this._data){for(var i=0,len=this._data.length;i<len;i++)this._data.getAt(i).hidden=!0;for(var i=0,len=commands.length;i<len;i++){var command="string"==typeof commands[i]?this.getCommandById(commands[i]):commands[i];command&&(command.hidden=!1)}}},_CommandingSurface.prototype.takeFocus=function(useSetActive){this._focusFirstFocusableElementOrThis(useSetActive)},_CommandingSurface.prototype._focusFirstFocusableElementOrThis=function(useSetActive){_ElementUtilities._focusFirstFocusableElement(this._dom.content,useSetActive)||_ElementUtilities._tryFocusOnAnyElement(this.element,useSetActive)},_CommandingSurface.prototype._focusLastFocusableElementOrThis=function(useSetActive){_ElementUtilities._focusLastFocusableElement(this._dom.content,useSetActive)||_ElementUtilities._tryFocusOnAnyElement(this.element,useSetActive)},_CommandingSurface.prototype.deferredDomUpate=function(){this._machine.updateDom()},_CommandingSurface.prototype.createOpenAnimation=function(closedHeight){_Log.log&&this._updateDomImpl.renderedState.isOpenedMode&&_Log.log("The CommandingSurface should only attempt to create an open animation when it's not already opened");var that=this;return{execute:function(){_ElementUtilities.addClass(that.element,_Constants.ClassNames.openingClass);var boundingRects=that.getBoundingRects();return that._dom.overflowAreaContainer.style.width=boundingRects.overflowArea.width+"px",that._dom.overflowAreaContainer.style.height=boundingRects.overflowArea.height+"px",Animations._commandingSurfaceOpenAnimation({actionAreaClipper:that._dom.actionAreaContainer,actionArea:that._dom.actionArea,overflowAreaClipper:that._dom.overflowAreaContainer,overflowArea:that._dom.overflowArea,oldHeight:closedHeight,newHeight:boundingRects.commandingSurface.height,overflowAreaHeight:boundingRects.overflowArea.height,menuPositionedAbove:that.overflowDirection===OverflowDirection.top}).then(function(){_ElementUtilities.removeClass(that.element,_Constants.ClassNames.openingClass),that._clearAnimation()})}}},_CommandingSurface.prototype.createCloseAnimation=function(closedHeight){_Log.log&&!this._updateDomImpl.renderedState.isOpenedMode&&_Log.log("The CommandingSurface should only attempt to create an closed animation when it's not already closed");var openedHeight=this.getBoundingRects().commandingSurface.height,overflowAreaOpenedHeight=this._dom.overflowArea.offsetHeight,that=(this._dom.overflowArea.offsetTop,this);return{execute:function(){return _ElementUtilities.addClass(that.element,_Constants.ClassNames.closingClass),Animations._commandingSurfaceCloseAnimation({actionAreaClipper:that._dom.actionAreaContainer,actionArea:that._dom.actionArea,overflowAreaClipper:that._dom.overflowAreaContainer,overflowArea:that._dom.overflowArea,oldHeight:openedHeight,newHeight:closedHeight,overflowAreaHeight:overflowAreaOpenedHeight,menuPositionedAbove:that.overflowDirection===OverflowDirection.top}).then(function(){_ElementUtilities.removeClass(that.element,_Constants.ClassNames.closingClass),that._clearAnimation()})}}},Object.defineProperty(_CommandingSurface.prototype,"initialized",{get:function(){return this._initializedSignal.promise},enumerable:!0,configurable:!0}),_CommandingSurface.prototype._writeProfilerMark=function(text){_WriteProfilerMark("WinJS.UI._CommandingSurface:"+this._id+":"+text)},_CommandingSurface.prototype._initializeDom=function(root){var _this=this;this._writeProfilerMark("_intializeDom,info"),root.winControl=this,this._id=root.id||_ElementUtilities._uniqueID(root),root.hasAttribute("tabIndex")||(root.tabIndex=-1),_ElementUtilities.addClass(root,_Constants.ClassNames.controlCssClass),_ElementUtilities.addClass(root,_Constants.ClassNames.disposableCssClass);var content=_Global.document.createElement("div");_ElementUtilities.addClass(content,_Constants.ClassNames.contentClass),root.appendChild(content);var actionArea=_Global.document.createElement("div");_ElementUtilities.addClass(actionArea,_Constants.ClassNames.actionAreaCssClass);var actionAreaInsetOutline=document.createElement("div");_ElementUtilities.addClass(actionAreaInsetOutline,_Constants.ClassNames.insetOutlineClass);var actionAreaContainer=_Global.document.createElement("div");_ElementUtilities.addClass(actionAreaContainer,_Constants.ClassNames.actionAreaContainerCssClass),actionAreaContainer.appendChild(actionArea),actionAreaContainer.appendChild(actionAreaInsetOutline),content.appendChild(actionAreaContainer);var actionAreaSpacer=_Global.document.createElement("div");_ElementUtilities.addClass(actionAreaSpacer,_Constants.ClassNames.spacerCssClass),actionAreaSpacer.tabIndex=-1,actionArea.appendChild(actionAreaSpacer);var overflowButton=_Global.document.createElement("button");overflowButton.tabIndex=0,overflowButton.innerHTML="<span class='"+_Constants.ClassNames.ellipsisCssClass+"'></span>",overflowButton.setAttribute("aria-label",strings.overflowButtonAriaLabel),_ElementUtilities.addClass(overflowButton,_Constants.ClassNames.overflowButtonCssClass),actionArea.appendChild(overflowButton),overflowButton.addEventListener("click",function(){_this.opened=!_this.opened});var overflowArea=_Global.document.createElement("div");_ElementUtilities.addClass(overflowArea,_Constants.ClassNames.overflowAreaCssClass),_ElementUtilities.addClass(overflowArea,_Constants.ClassNames.menuCssClass);var overflowInsetOutline=_Global.document.createElement("DIV");_ElementUtilities.addClass(overflowInsetOutline,_Constants.ClassNames.insetOutlineClass);var overflowAreaContainer=_Global.document.createElement("div");_ElementUtilities.addClass(overflowAreaContainer,_Constants.ClassNames.overflowAreaContainerCssClass),overflowAreaContainer.appendChild(overflowArea),overflowAreaContainer.appendChild(overflowInsetOutline),content.appendChild(overflowAreaContainer);var overflowAreaSpacer=_Global.document.createElement("div");_ElementUtilities.addClass(overflowAreaSpacer,_Constants.ClassNames.spacerCssClass),overflowAreaSpacer.tabIndex=-1,overflowArea.appendChild(overflowAreaSpacer);var firstTabStop=_Global.document.createElement("div");_ElementUtilities.addClass(firstTabStop,_Constants.ClassNames.tabStopClass),_ElementUtilities._ensureId(firstTabStop),root.insertBefore(firstTabStop,root.children[0]);var finalTabStop=_Global.document.createElement("div");_ElementUtilities.addClass(finalTabStop,_Constants.ClassNames.tabStopClass),_ElementUtilities._ensureId(finalTabStop),root.appendChild(finalTabStop),this._dom={root:root,content:content,actionArea:actionArea,actionAreaContainer:actionAreaContainer,actionAreaSpacer:actionAreaSpacer,overflowButton:overflowButton,overflowArea:overflowArea,overflowAreaContainer:overflowAreaContainer,overflowAreaSpacer:overflowAreaSpacer,firstTabStop:firstTabStop,finalTabStop:finalTabStop}},_CommandingSurface.prototype._getFocusableElementsInfo=function(){var _this=this,focusableCommandsInfo={elements:[],focusedIndex:-1},elementsInReach=Array.prototype.slice.call(this._dom.actionArea.children);return this._updateDomImpl.renderedState.isOpenedMode&&(elementsInReach=elementsInReach.concat(Array.prototype.slice.call(this._dom.overflowArea.children))),elementsInReach.forEach(function(element){_this._isElementFocusable(element)&&(focusableCommandsInfo.elements.push(element),element.contains(_Global.document.activeElement)&&(focusableCommandsInfo.focusedIndex=focusableCommandsInfo.elements.length-1))}),focusableCommandsInfo},_CommandingSurface.prototype._dataUpdated=function(){var _this=this;this._primaryCommands=[],this._secondaryCommands=[],this.data.length>0&&this.data.forEach(function(command){"secondary"===command.section?_this._secondaryCommands.push(command):_this._primaryCommands.push(command)}),this._updateDomImpl.dataDirty(),this._machine.updateDom()},_CommandingSurface.prototype._refresh=function(){var _this=this;this._refreshPending||(this._refreshPending=!0,this._batchDataUpdates(function(){_this._refreshPending&&!_this._disposed&&(_this._refreshPending=!1,_this._dataUpdated())}))},_CommandingSurface.prototype._batchDataUpdates=function(updateFn){Scheduler.schedule(function(){updateFn()},Scheduler.Priority.high,null,"WinJS.UI._CommandingSurface._refresh")},_CommandingSurface.prototype._addDataListeners=function(){var _this=this;this._dataChangedEvents.forEach(function(eventName){_this._data.addEventListener(eventName,_this._refreshBound,!1)})},_CommandingSurface.prototype._removeDataListeners=function(){var _this=this;this._dataChangedEvents.forEach(function(eventName){_this._data.removeEventListener(eventName,_this._refreshBound,!1)})},_CommandingSurface.prototype._isElementFocusable=function(element){var focusable=!1;if(element){var command=element.winControl;focusable=command?!this._hasAnyHiddenClasses(command)&&command.type!==_Constants.typeSeparator&&!command.hidden&&!command.disabled&&(!command.firstElementFocus||command.firstElementFocus.tabIndex>=0||command.lastElementFocus.tabIndex>=0):"none"!==element.style.display&&"hidden"!==_ElementUtilities._getComputedStyle(element).visibility&&element.tabIndex>=0}return focusable},_CommandingSurface.prototype._clearHiddenPolicyClasses=function(command){_ElementUtilities.removeClass(command.element,_Constants.ClassNames.commandPrimaryOverflownPolicyClass),_ElementUtilities.removeClass(command.element,_Constants.ClassNames.commandSecondaryOverflownPolicyClass),_ElementUtilities.removeClass(command.element,_Constants.ClassNames.commandSeparatorHiddenPolicyClass)},_CommandingSurface.prototype._hasHiddenPolicyClasses=function(command){return _ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandPrimaryOverflownPolicyClass)||_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandSecondaryOverflownPolicyClass)||_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandSeparatorHiddenPolicyClass)},_CommandingSurface.prototype._hasAnyHiddenClasses=function(command){return _ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandHiddenClass)||this._hasHiddenPolicyClasses(command)},_CommandingSurface.prototype._isCommandInActionArea=function(element){return element&&element.winControl&&element.parentElement===this._dom.actionArea},_CommandingSurface.prototype._getLastElementFocus=function(element){return this._isCommandInActionArea(element)?element.winControl.lastElementFocus:element},_CommandingSurface.prototype._getFirstElementFocus=function(element){return this._isCommandInActionArea(element)?element.winControl.firstElementFocus:element},_CommandingSurface.prototype._keyDownHandler=function(ev){if(!ev.altKey){if(_ElementUtilities._matchesSelector(ev.target,".win-interactive, .win-interactive *"))return;var targetCommand,Key=_ElementUtilities.Key,focusableElementsInfo=this._getFocusableElementsInfo();if(focusableElementsInfo.elements.length)switch(ev.keyCode){case this._rtl?Key.rightArrow:Key.leftArrow:case Key.upArrow:var index=Math.max(0,focusableElementsInfo.focusedIndex-1);targetCommand=this._getLastElementFocus(focusableElementsInfo.elements[index%focusableElementsInfo.elements.length]);break;case this._rtl?Key.leftArrow:Key.rightArrow:case Key.downArrow:var index=Math.min(focusableElementsInfo.focusedIndex+1,focusableElementsInfo.elements.length-1);targetCommand=this._getFirstElementFocus(focusableElementsInfo.elements[index]);break;case Key.home:var index=0;targetCommand=this._getFirstElementFocus(focusableElementsInfo.elements[index]);break;case Key.end:var index=focusableElementsInfo.elements.length-1;targetCommand=this._getLastElementFocus(focusableElementsInfo.elements[index])}targetCommand&&targetCommand!==_Global.document.activeElement&&(targetCommand.focus(),ev.preventDefault())}},_CommandingSurface.prototype._getDataFromDOMElements=function(root){this._writeProfilerMark("_getDataFromDOMElements,info"),ControlProcessor.processAll(root,!0);for(var child,commands=[],childrenLength=root.children.length,i=0;i<childrenLength;i++){if(child=root.children[i],!(child.winControl&&child.winControl instanceof _Command.AppBarCommand))throw new _ErrorFromName("WinJS.UI._CommandingSurface.MustContainCommands",strings.mustContainCommands);commands.push(child.winControl)}return new BindingList.List(commands)},_CommandingSurface.prototype._canMeasure=function(){return(this._updateDomImpl.renderedState.isOpenedMode||this._updateDomImpl.renderedState.closedDisplayMode===ClosedDisplayMode.compact||this._updateDomImpl.renderedState.closedDisplayMode===ClosedDisplayMode.full)&&_Global.document.body.contains(this._dom.root)&&this._dom.actionArea.offsetWidth>0},_CommandingSurface.prototype._resizeHandler=function(){if(this._canMeasure()){var currentActionAreaWidth=_ElementUtilities._getPreciseContentWidth(this._dom.actionArea);this._cachedMeasurements&&this._cachedMeasurements.actionAreaContentBoxWidth!==currentActionAreaWidth&&(this._cachedMeasurements.actionAreaContentBoxWidth=currentActionAreaWidth,this._updateDomImpl.layoutDirty(),this._machine.updateDom())}else this._updateDomImpl.measurementsDirty()},_CommandingSurface.prototype.synchronousOpen=function(){this._overflowAlignmentOffset=0,this._isOpenedMode=!0,this._updateDomImpl.update(),this._overflowAlignmentOffset=this._computeAdjustedOverflowAreaOffset(),this._updateDomImpl.update()},_CommandingSurface.prototype._computeAdjustedOverflowAreaOffset=function(){_Log.log&&(!this._updateDomImpl.renderedState.isOpenedMode&&_Log.log("The CommandingSurface should only attempt to compute adjusted overflowArea offset  when it has been rendered opened"),0!==this._updateDomImpl.renderedState.overflowAlignmentOffset&&_Log.log("The CommandingSurface should only attempt to compute adjusted overflowArea offset  when it has been rendered with an overflowAlignementOffset of 0"));var boundingClientRects=(this._dom.overflowArea,this.getBoundingRects()),adjustedOffset=0;if(this._rtl){var viewportRight=window.innerWidth,rightOffsetFromViewport=boundingClientRects.overflowArea.right;adjustedOffset=Math.min(viewportRight-rightOffsetFromViewport,0)}else{var leftOffsetFromViewport=boundingClientRects.overflowArea.left;adjustedOffset=Math.min(0,leftOffsetFromViewport)}return adjustedOffset},_CommandingSurface.prototype.synchronousClose=function(){this._isOpenedMode=!1,this._updateDomImpl.update()},_CommandingSurface.prototype.updateDom=function(){this._updateDomImpl.update()},_CommandingSurface.prototype._getDataChangeInfo=function(){var _this=this,added=[],deleted=[],unchanged=[],prevVisible=[],prevElements=[],nextVisible=[],nextElements=[],nextOverflown=[],nextHiding=[],nextShowing=[];return Array.prototype.forEach.call(this._dom.actionArea.querySelectorAll(_Constants.commandSelector),function(commandElement){_this._hasAnyHiddenClasses(commandElement.winControl)||prevVisible.push(commandElement),prevElements.push(commandElement)}),this.data.forEach(function(command){var hidden=command.hidden,hiding=hidden&&!_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandHiddenClass),showing=!hidden&&_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandHiddenClass),overflown=_ElementUtilities.hasClass(command.element,_Constants.ClassNames.commandPrimaryOverflownPolicyClass);_this._hasAnyHiddenClasses(command.element.winControl)||nextVisible.push(command.element),overflown?nextOverflown.push(command.element):hiding?nextHiding.push(command.element):showing&&nextShowing.push(command.element),nextElements.push(command.element)}),deleted=diffElements(prevElements,nextElements),unchanged=intersectElements(prevVisible,nextVisible),added=diffElements(nextElements,prevElements),{nextElements:nextElements,prevElements:prevElements,added:added,deleted:deleted,unchanged:unchanged,hiding:nextHiding,showing:nextShowing,overflown:nextOverflown}},_CommandingSurface.prototype._processNewData=function(){var _this=this;this._writeProfilerMark("_processNewData,info");var changeInfo=this._getDataChangeInfo(),updateCommandAnimation=Animations._createUpdateListAnimation(changeInfo.added.concat(changeInfo.showing).concat(changeInfo.overflown),changeInfo.deleted.concat(changeInfo.hiding),changeInfo.unchanged);return changeInfo.deleted.forEach(function(deletedElement){var command=deletedElement.winControl;command&&command._propertyMutations&&command._propertyMutations.unbind(_this._refreshBound)}),changeInfo.added.forEach(function(addedElement){var command=addedElement.winControl;command&&command._propertyMutations&&command._propertyMutations.bind(_this._refreshBound)}),changeInfo.prevElements.forEach(function(element){element.parentElement&&element.parentElement.removeChild(element)}),changeInfo.nextElements.forEach(function(element){_this._dom.actionArea.appendChild(element)}),changeInfo.hiding.forEach(function(element){_ElementUtilities.addClass(element,_Constants.ClassNames.commandHiddenClass)}),changeInfo.showing.forEach(function(element){_ElementUtilities.removeClass(element,_Constants.ClassNames.commandHiddenClass)}),this._dom.actionArea.appendChild(this._dom.overflowButton),updateCommandAnimation.execute(),!0},_CommandingSurface.prototype._measure=function(){var _this=this;if(this._writeProfilerMark("_measure,info"),this._canMeasure()){var originalDisplayStyle=this._dom.overflowButton.style.display;this._dom.overflowButton.style.display="";var overflowButtonWidth=_ElementUtilities._getPreciseTotalWidth(this._dom.overflowButton);this._dom.overflowButton.style.display=originalDisplayStyle;var actionAreaContentBoxWidth=_ElementUtilities._getPreciseContentWidth(this._dom.actionArea),separatorWidth=0,standardCommandWidth=0,contentCommandWidths={};return this._primaryCommands.forEach(function(command){var originalDisplayStyle=command.element.style.display;command.element.style.display="inline-block",command.type===_Constants.typeContent?contentCommandWidths[_this._commandUniqueId(command)]=_ElementUtilities._getPreciseTotalWidth(command.element):command.type===_Constants.typeSeparator?separatorWidth||(separatorWidth=_ElementUtilities._getPreciseTotalWidth(command.element)):standardCommandWidth||(standardCommandWidth=_ElementUtilities._getPreciseTotalWidth(command.element)),command.element.style.display=originalDisplayStyle}),this._cachedMeasurements={contentCommandWidths:contentCommandWidths,separatorWidth:separatorWidth,standardCommandWidth:standardCommandWidth,overflowButtonWidth:overflowButtonWidth,actionAreaContentBoxWidth:actionAreaContentBoxWidth},!0}return!1},_CommandingSurface.prototype._layoutCommands=function(){var _this=this;this._writeProfilerMark("_layoutCommands,StartTM");var visibleSecondaryCommands=[],visiblePrimaryCommands=[],visiblePrimaryCommandsForActionArea=[],visiblePrimaryCommandsForOverflowArea=[];this.data.forEach(function(command){_this._clearHiddenPolicyClasses(command),command.hidden||(command.section===_Constants.secondaryCommandSection?visibleSecondaryCommands.push(command):visiblePrimaryCommands.push(command))});var hasVisibleSecondaryCommand=visibleSecondaryCommands.length>0,primaryCommandsLocation=this._getVisiblePrimaryCommandsLocation(visiblePrimaryCommands,hasVisibleSecondaryCommand);visiblePrimaryCommandsForActionArea=primaryCommandsLocation.commandsForActionArea,visiblePrimaryCommandsForOverflowArea=primaryCommandsLocation.commandsForOverflowArea,visiblePrimaryCommandsForOverflowArea.forEach(function(command){return _ElementUtilities.addClass(command.element,_Constants.ClassNames.commandPrimaryOverflownPolicyClass)}),visibleSecondaryCommands.forEach(function(command){return _ElementUtilities.addClass(command.element,_Constants.ClassNames.commandSecondaryOverflownPolicyClass)}),this._hideSeparatorsIfNeeded(visiblePrimaryCommandsForActionArea),_ElementUtilities.empty(this._dom.overflowArea),this._menuCommandProjections.map(function(menuCommand){menuCommand.dispose()});var isCustomContent=function(command){return command.type===_Constants.typeContent},hasCustomContent=visiblePrimaryCommandsForOverflowArea.some(isCustomContent)||visibleSecondaryCommands.some(isCustomContent);hasCustomContent&&!this._contentFlyout&&(this._contentFlyoutInterior=_Global.document.createElement("div"),_ElementUtilities.addClass(this._contentFlyoutInterior,_Constants.ClassNames.contentFlyoutCssClass),this._contentFlyout=new _Flyout.Flyout,this._contentFlyout.element.appendChild(this._contentFlyoutInterior),_Global.document.body.appendChild(this._contentFlyout.element),this._contentFlyout.onbeforeshow=function(){_ElementUtilities.empty(_this._contentFlyoutInterior),_ElementUtilities._reparentChildren(_this._chosenCommand.element,_this._contentFlyoutInterior)},this._contentFlyout.onafterhide=function(){_ElementUtilities._reparentChildren(_this._contentFlyoutInterior,_this._chosenCommand.element)});var hasToggleCommands=!1,menuCommandProjections=[];if(visiblePrimaryCommandsForOverflowArea.forEach(function(command){command.type===_Constants.typeToggle&&(hasToggleCommands=!0),menuCommandProjections.push(_this._projectAsMenuCommand(command))}),visiblePrimaryCommandsForOverflowArea.length>0&&visibleSecondaryCommands.length>0){var separator=new _CommandingSurfaceMenuCommand._MenuCommand(null,{type:_Constants.typeSeparator});menuCommandProjections.push(separator)}visibleSecondaryCommands.forEach(function(command){command.type===_Constants.typeToggle&&(hasToggleCommands=!0),menuCommandProjections.push(_this._projectAsMenuCommand(command))}),this._hideSeparatorsIfNeeded(menuCommandProjections),menuCommandProjections.forEach(function(command){_this._dom.overflowArea.appendChild(command.element)}),this._menuCommandProjections=menuCommandProjections,_ElementUtilities[hasToggleCommands?"addClass":"removeClass"](this._dom.overflowArea,_Constants.ClassNames.menuContainsToggleCommandClass),menuCommandProjections.length>0&&this._dom.overflowArea.appendChild(this._dom.overflowAreaSpacer);var needsOverflowButton=this._needsOverflowButton(visiblePrimaryCommandsForActionArea.length>0,menuCommandProjections.length>0);return this._dom.overflowButton.style.display=needsOverflowButton?"":"none",this._writeProfilerMark("_layoutCommands,StopTM"),!0},_CommandingSurface.prototype._getVisiblePrimaryCommandsInfo=function(visibleCommands){for(var width=0,visibleCommandsInfo=[],priority=0,currentAssignedPriority=0,i=visibleCommands.length-1;i>=0;i--){var command=visibleCommands[i];priority=void 0===command.priority?currentAssignedPriority--:command.priority,width=this._getCommandWidth(command),visibleCommandsInfo.unshift({command:command,width:width,priority:priority})}return visibleCommandsInfo},_CommandingSurface.prototype._getVisiblePrimaryCommandsLocation=function(visiblePrimaryCommands,isThereAVisibleSecondaryCommand){for(var commandsForActionArea=[],commandsForOverflowArea=[],visibleCommandsInfo=this._getVisiblePrimaryCommandsInfo(visiblePrimaryCommands),sortedCommandsInfo=visibleCommandsInfo.slice(0).sort(function(commandInfo1,commandInfo2){return commandInfo1.priority-commandInfo2.priority}),maxPriority=Number.MAX_VALUE,currentAvailableWidth=this._cachedMeasurements.actionAreaContentBoxWidth,overflowButtonAlreadyNeeded=this._needsOverflowButton(visiblePrimaryCommands.length>0,isThereAVisibleSecondaryCommand),i=0,len=sortedCommandsInfo.length;i<len;i++){currentAvailableWidth-=sortedCommandsInfo[i].width;var additionalSpaceNeeded=overflowButtonAlreadyNeeded||i!==len-1?this._cachedMeasurements.overflowButtonWidth:0;if(currentAvailableWidth<additionalSpaceNeeded){maxPriority=sortedCommandsInfo[i].priority-1;break}}return visibleCommandsInfo.forEach(function(commandInfo){commandInfo.priority<=maxPriority?commandsForActionArea.push(commandInfo.command):commandsForOverflowArea.push(commandInfo.command)}),{commandsForActionArea:commandsForActionArea,commandsForOverflowArea:commandsForOverflowArea}},_CommandingSurface.prototype._needsOverflowButton=function(hasVisibleCommandsInActionArea,hasVisibleCommandsInOverflowArea){return!!hasVisibleCommandsInOverflowArea||!(!this._hasExpandableActionArea()||!hasVisibleCommandsInActionArea)},_CommandingSurface.prototype._minimalLayout=function(){if(this.closedDisplayMode===ClosedDisplayMode.minimal){var isCommandVisible=function(command){return!command.hidden},hasVisibleCommand=this.data.some(isCommandVisible);this._dom.overflowButton.style.display=hasVisibleCommand?"":"none"}},_CommandingSurface.prototype._commandUniqueId=function(command){return _ElementUtilities._uniqueID(command.element)},_CommandingSurface.prototype._getCommandWidth=function(command){return command.type===_Constants.typeContent?this._cachedMeasurements.contentCommandWidths[this._commandUniqueId(command)]:command.type===_Constants.typeSeparator?this._cachedMeasurements.separatorWidth:this._cachedMeasurements.standardCommandWidth},_CommandingSurface.prototype._projectAsMenuCommand=function(originalCommand){var _this=this,menuCommand=new _CommandingSurfaceMenuCommand._MenuCommand(null,{label:originalCommand.label,type:(originalCommand.type===_Constants.typeContent?_Constants.typeFlyout:originalCommand.type)||_Constants.typeButton,disabled:originalCommand.disabled,flyout:originalCommand.flyout,beforeInvoke:function(){_this._chosenCommand=menuCommand._originalICommand,_this._chosenCommand.type===_Constants.typeToggle&&(_this._chosenCommand.selected=!_this._chosenCommand.selected)}});return originalCommand.selected&&(menuCommand.selected=!0),originalCommand.extraClass&&(menuCommand.extraClass=originalCommand.extraClass),originalCommand.type===_Constants.typeContent?(menuCommand.label||(menuCommand.label=_Constants.contentMenuCommandDefaultLabel),menuCommand.flyout=this._contentFlyout):menuCommand.onclick=originalCommand.onclick,menuCommand._originalICommand=originalCommand,menuCommand},_CommandingSurface.prototype._hideSeparatorsIfNeeded=function(commands){var command,prevType=_Constants.typeSeparator,commandsLength=commands.length;commands.forEach(function(command){command.type===_Constants.typeSeparator&&prevType===_Constants.typeSeparator&&_ElementUtilities.addClass(command.element,_Constants.ClassNames.commandSeparatorHiddenPolicyClass),prevType=command.type});for(var i=commandsLength-1;i>=0&&(command=commands[i],command.type===_Constants.typeSeparator);i--)_ElementUtilities.addClass(command.element,_Constants.ClassNames.commandSeparatorHiddenPolicyClass)},_CommandingSurface.prototype._hasExpandableActionArea=function(){switch(this.closedDisplayMode){case ClosedDisplayMode.none:case ClosedDisplayMode.minimal:case ClosedDisplayMode.compact:return!0;case ClosedDisplayMode.full:default:return!1}},_CommandingSurface.prototype._clearAnimation=function(){var transformScriptName=_BaseUtils._browserStyleEquivalents.transform.scriptName;this._dom.actionAreaContainer.style[transformScriptName]="",this._dom.actionArea.style[transformScriptName]="",this._dom.overflowAreaContainer.style[transformScriptName]="",this._dom.overflowArea.style[transformScriptName]=""},_CommandingSurface.ClosedDisplayMode=ClosedDisplayMode,_CommandingSurface.OverflowDirection=OverflowDirection,_CommandingSurface.supportedForProcessing=!0,_CommandingSurface}();exports._CommandingSurface=_CommandingSurface,_Base.Class.mix(_CommandingSurface,_Events.createEventProperties(_Constants.EventNames.beforeOpen,_Constants.EventNames.afterOpen,_Constants.EventNames.beforeClose,_Constants.EventNames.afterClose)),_Base.Class.mix(_CommandingSurface,_Control.DOMEventMixin)}),define("WinJS/Controls/CommandingSurface",["require","exports"],function(require,exports){function getModule(){return module||require(["./CommandingSurface/_CommandingSurface"],function(m){module=m}),module._CommandingSurface}var module=null,publicMembers=Object.create({},{_CommandingSurface:{get:function(){return getModule()}}});return publicMembers}),define("require-style!less/styles-toolbar",[],function(){}),define("WinJS/Controls/ToolBar/_ToolBar",["require","exports","../../Core/_Base","../ToolBar/_Constants","../CommandingSurface","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../_LightDismissService","../../Core/_Resources","../../Utilities/_OpenCloseMachine","../../Core/_WriteProfilerMark"],function(require,exports,_Base,_Constants,_CommandingSurface,_Control,_Dispose,_ElementUtilities,_ErrorFromName,_Events,_Global,_LightDismissService,_Resources,_OpenCloseMachine,_WriteProfilerMark){function addClass(element,className){className&&_ElementUtilities.addClass(element,className)}function removeClass(element,className){className&&_ElementUtilities.removeClass(element,className)}require(["require-style!less/styles-toolbar"]);var strings={get ariaLabel(){return _Resources._getWinJSString("ui/toolbarAriaLabel").value},get overflowButtonAriaLabel(){return _Resources._getWinJSString("ui/toolbarOverflowButtonAriaLabel").value},get mustContainCommands(){return"The toolbar can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},ClosedDisplayMode={compact:"compact",full:"full"},closedDisplayModeClassMap={};closedDisplayModeClassMap[ClosedDisplayMode.compact]=_Constants.ClassNames.compactClass,closedDisplayModeClassMap[ClosedDisplayMode.full]=_Constants.ClassNames.fullClass;var ToolBar=function(){function ToolBar(element,options){var _this=this;if(void 0===options&&(options={}),this._updateDomImpl_renderedState={isOpenedMode:void 0,closedDisplayMode:void 0,prevInlineWidth:void 0},this._writeProfilerMark("constructor,StartTM"),
element&&element.winControl)throw new _ErrorFromName("WinJS.UI.ToolBar.DuplicateConstruction",strings.duplicateConstruction);this._initializeDom(element||_Global.document.createElement("div"));var stateMachine=new _OpenCloseMachine.OpenCloseMachine({eventElement:this.element,onOpen:function(){var openAnimation=_this._commandingSurface.createOpenAnimation(_this._getClosedHeight());return _this._synchronousOpen(),openAnimation.execute()},onClose:function(){var closeAnimation=_this._commandingSurface.createCloseAnimation(_this._getClosedHeight());return closeAnimation.execute().then(function(){_this._synchronousClose()})},onUpdateDom:function(){_this._updateDomImpl()},onUpdateDomWithIsOpened:function(isOpened){_this._isOpenedMode=isOpened,_this._updateDomImpl()}});this._handleShowingKeyboardBound=this._handleShowingKeyboard.bind(this),_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),this._disposed=!1,this._cachedClosedHeight=null,this._commandingSurface=new _CommandingSurface._CommandingSurface(this._dom.commandingSurfaceEl,{openCloseMachine:stateMachine}),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-actionarea"),_Constants.ClassNames.actionAreaCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowarea"),_Constants.ClassNames.overflowAreaCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowbutton"),_Constants.ClassNames.overflowButtonCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-ellipsis"),_Constants.ClassNames.ellipsisCssClass),this._isOpenedMode=_Constants.defaultOpened,this._dismissable=new _LightDismissService.LightDismissableElement({element:this._dom.root,tabIndex:this._dom.root.hasAttribute("tabIndex")?this._dom.root.tabIndex:-1,onLightDismiss:function(){_this.close()},onTakeFocus:function(useSetActive){_this._dismissable.restoreFocus()||_this._commandingSurface.takeFocus(useSetActive)}}),this.closedDisplayMode=_Constants.defaultClosedDisplayMode,this.opened=this._isOpenedMode,_Control.setOptions(this,options),_ElementUtilities._inDom(this.element).then(function(){return _this._commandingSurface.initialized}).then(function(){stateMachine.exitInit(),_this._writeProfilerMark("constructor,StopTM")})}return Object.defineProperty(ToolBar.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(ToolBar.prototype,"data",{get:function(){return this._commandingSurface.data},set:function(value){this._commandingSurface.data=value},enumerable:!0,configurable:!0}),Object.defineProperty(ToolBar.prototype,"closedDisplayMode",{get:function(){return this._commandingSurface.closedDisplayMode},set:function(value){ClosedDisplayMode[value]&&(this._commandingSurface.closedDisplayMode=value,this._cachedClosedHeight=null)},enumerable:!0,configurable:!0}),Object.defineProperty(ToolBar.prototype,"opened",{get:function(){return this._commandingSurface.opened},set:function(value){this._commandingSurface.opened=value},enumerable:!0,configurable:!0}),ToolBar.prototype.open=function(){this._commandingSurface.open()},ToolBar.prototype.close=function(){this._commandingSurface.close()},ToolBar.prototype.dispose=function(){this._disposed||(this._disposed=!0,_LightDismissService.hidden(this._dismissable),this._commandingSurface.dispose(),this._synchronousClose(),_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),_Dispose.disposeSubTree(this.element))},ToolBar.prototype.forceLayout=function(){this._commandingSurface.forceLayout()},ToolBar.prototype.getCommandById=function(id){return this._commandingSurface.getCommandById(id)},ToolBar.prototype.showOnlyCommands=function(commands){return this._commandingSurface.showOnlyCommands(commands)},ToolBar.prototype._writeProfilerMark=function(text){_WriteProfilerMark("WinJS.UI.ToolBar:"+this._id+":"+text)},ToolBar.prototype._initializeDom=function(root){this._writeProfilerMark("_intializeDom,info"),root.winControl=this,this._id=root.id||_ElementUtilities._uniqueID(root),_ElementUtilities.addClass(root,_Constants.ClassNames.controlCssClass),_ElementUtilities.addClass(root,_Constants.ClassNames.disposableCssClass);var role=root.getAttribute("role");role||root.setAttribute("role","menubar");var label=root.getAttribute("aria-label");label||root.setAttribute("aria-label",strings.ariaLabel);var commandingSurfaceEl=document.createElement("DIV");_ElementUtilities._reparentChildren(root,commandingSurfaceEl),root.appendChild(commandingSurfaceEl);var placeHolder=_Global.document.createElement("DIV");_ElementUtilities.addClass(placeHolder,_Constants.ClassNames.placeHolderCssClass),_Dispose.markDisposable(placeHolder,this.dispose.bind(this)),this._dom={root:root,commandingSurfaceEl:commandingSurfaceEl,placeHolder:placeHolder}},ToolBar.prototype._handleShowingKeyboard=function(event){this.close()},ToolBar.prototype._synchronousOpen=function(){this._isOpenedMode=!0,this._updateDomImpl()},ToolBar.prototype._synchronousClose=function(){this._isOpenedMode=!1,this._updateDomImpl()},ToolBar.prototype._updateDomImpl=function(){var rendered=this._updateDomImpl_renderedState;rendered.isOpenedMode!==this._isOpenedMode&&(this._isOpenedMode?this._updateDomImpl_renderOpened():this._updateDomImpl_renderClosed(),rendered.isOpenedMode=this._isOpenedMode),rendered.closedDisplayMode!==this.closedDisplayMode&&(removeClass(this._dom.root,closedDisplayModeClassMap[rendered.closedDisplayMode]),addClass(this._dom.root,closedDisplayModeClassMap[this.closedDisplayMode]),rendered.closedDisplayMode=this.closedDisplayMode),this._commandingSurface.updateDom()},ToolBar.prototype._getClosedHeight=function(){if(null===this._cachedClosedHeight){var wasOpen=this._isOpenedMode;this._isOpenedMode&&this._synchronousClose(),this._cachedClosedHeight=this._commandingSurface.getBoundingRects().commandingSurface.height,wasOpen&&this._synchronousOpen()}return this._cachedClosedHeight},ToolBar.prototype._updateDomImpl_renderOpened=function(){var _this=this;this._updateDomImpl_renderedState.prevInlineWidth=this._dom.root.style.width;var closedBorderBox=this._dom.root.getBoundingClientRect(),closedContentWidth=_ElementUtilities._getPreciseContentWidth(this._dom.root),closedContentHeight=_ElementUtilities._getPreciseContentHeight(this._dom.root),closedStyle=_ElementUtilities._getComputedStyle(this._dom.root),closedPaddingTop=_ElementUtilities._convertToPrecisePixels(closedStyle.paddingTop),closedBorderTop=_ElementUtilities._convertToPrecisePixels(closedStyle.borderTopWidth),closedMargins=_ElementUtilities._getPreciseMargins(this._dom.root),closedContentBoxTop=closedBorderBox.top+closedBorderTop+closedPaddingTop,closedContentBoxBottom=closedContentBoxTop+closedContentHeight,placeHolder=this._dom.placeHolder,placeHolderStyle=placeHolder.style;placeHolderStyle.width=closedBorderBox.width+"px",placeHolderStyle.height=closedBorderBox.height+"px",placeHolderStyle.marginTop=closedMargins.top+"px",placeHolderStyle.marginRight=closedMargins.right+"px",placeHolderStyle.marginBottom=closedMargins.bottom+"px",placeHolderStyle.marginLeft=closedMargins.left+"px",_ElementUtilities._maintainFocus(function(){_this._dom.root.parentElement.insertBefore(placeHolder,_this._dom.root),_Global.document.body.appendChild(_this._dom.root),_this._dom.root.style.width=closedContentWidth+"px",_this._dom.root.style.left=closedBorderBox.left-closedMargins.left+"px";var topOfViewport=0,bottomOfViewport=_Global.innerHeight,distanceFromTop=closedContentBoxTop-topOfViewport,distanceFromBottom=bottomOfViewport-closedContentBoxBottom;distanceFromTop>distanceFromBottom?(_this._commandingSurface.overflowDirection=_Constants.OverflowDirection.top,_this._dom.root.style.bottom=bottomOfViewport-closedBorderBox.bottom-closedMargins.bottom+"px"):(_this._commandingSurface.overflowDirection=_Constants.OverflowDirection.bottom,_this._dom.root.style.top=topOfViewport+closedBorderBox.top-closedMargins.top+"px"),_ElementUtilities.addClass(_this._dom.root,_Constants.ClassNames.openedClass),_ElementUtilities.removeClass(_this._dom.root,_Constants.ClassNames.closedClass)}),this._commandingSurface.synchronousOpen(),_LightDismissService.shown(this._dismissable)},ToolBar.prototype._updateDomImpl_renderClosed=function(){var _this=this;_ElementUtilities._maintainFocus(function(){if(_this._dom.placeHolder.parentElement){var placeHolder=_this._dom.placeHolder;placeHolder.parentElement.insertBefore(_this._dom.root,placeHolder),placeHolder.parentElement.removeChild(placeHolder)}_this._dom.root.style.top="",_this._dom.root.style.right="",_this._dom.root.style.bottom="",_this._dom.root.style.left="",_this._dom.root.style.width=_this._updateDomImpl_renderedState.prevInlineWidth,_ElementUtilities.addClass(_this._dom.root,_Constants.ClassNames.closedClass),_ElementUtilities.removeClass(_this._dom.root,_Constants.ClassNames.openedClass)}),this._commandingSurface.synchronousClose(),_LightDismissService.hidden(this._dismissable)},ToolBar.ClosedDisplayMode=ClosedDisplayMode,ToolBar.supportedForProcessing=!0,ToolBar}();exports.ToolBar=ToolBar,_Base.Class.mix(ToolBar,_Events.createEventProperties(_Constants.EventNames.beforeOpen,_Constants.EventNames.afterOpen,_Constants.EventNames.beforeClose,_Constants.EventNames.afterClose)),_Base.Class.mix(ToolBar,_Control.DOMEventMixin)}),define("WinJS/Controls/ToolBar",["require","exports","../Core/_Base"],function(require,exports,_Base){var module=null;_Base.Namespace.define("WinJS.UI",{ToolBar:{get:function(){return module||require(["./ToolBar/_ToolBar"],function(m){module=m}),module.ToolBar}}})}),define("WinJS/Controls/_LegacyAppBar/_Layouts",["exports","../../Animations/_TransitionAnimation","../../BindingList","../../Core/_BaseUtils","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Controls/ToolBar","../../Controls/ToolBar/_Constants","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../AppBar/_Command","./_Constants"],function(exports,_TransitionAnimation,BindingList,_BaseUtils,_Global,_Base,_ErrorFromName,_Resources,_WriteProfilerMark,ToolBar,_ToolBarConstants,Promise,Scheduler,_Control,_Dispose,_ElementUtilities,_Command,_Constants){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_AppBarBaseLayout:_Base.Namespace._lazy(function(){var baseType=_Constants.appBarLayoutCustom,strings={get nullCommand(){return"Invalid argument: command must not be null"}},_AppBarBaseLayout=_Base.Class.define(function(appBarEl,options){this._disposed=!1,options=options||{},_Control.setOptions(this,options),appBarEl&&this.connect(appBarEl)},{className:{get:function(){return this._className}},type:{get:function(){return this._type||baseType}},commandsInOrder:{get:function(){var commandElements=this.appBarEl.querySelectorAll("."+_Constants.appBarCommandClass);return Array.prototype.map.call(commandElements,function(commandElement){return commandElement.winControl})}},connect:function(appBarEl){this.className&&_ElementUtilities.addClass(appBarEl,this.className),this.appBarEl=appBarEl},disconnect:function(){this.className&&_ElementUtilities.removeClass(this.appBarEl,this.className),this.appBarEl=null,this.dispose()},layout:function(commands){for(var len=commands.length,i=0;i<len;i++){var command=this.sanitizeCommand(commands[i]);this.appBarEl.appendChild(command._element)}},showCommands:function(commands){this.appBarEl.winControl._showCommands(commands)},showOnlyCommands:function(commands){this.appBarEl.winControl._showOnlyCommands(commands)},hideCommands:function(commands){this.appBarEl.winControl._hideCommands(commands)},sanitizeCommand:function(command){if(!command)throw new _ErrorFromName("WinJS.UI.AppBar.NullCommand",strings.nullCommand);return command=command.winControl||command,command._element||(command=new _Command.AppBarCommand(null,command)),command._element.parentElement&&command._element.parentElement.removeChild(command._element),command},dispose:function(){this._disposed=!0},disposeChildren:function(){var appBarFirstDiv=this.appBarEl.querySelectorAll("."+_Constants.firstDivClass);appBarFirstDiv=appBarFirstDiv.length>=1?appBarFirstDiv[0]:null;var appBarFinalDiv=this.appBarEl.querySelectorAll("."+_Constants.finalDivClass);appBarFinalDiv=appBarFinalDiv.length>=1?appBarFinalDiv[0]:null;for(var children=this.appBarEl.children,length=children.length,i=0;i<length;i++){var element=children[i];element!==appBarFirstDiv&&element!==appBarFinalDiv&&_Dispose.disposeSubTree(element)}},handleKeyDown:function(){},commandsUpdated:function(){},beginAnimateCommands:function(){},endAnimateCommands:function(){},scale:function(){},resize:function(){},positionChanging:function(fromPosition,toPosition){return Promise.wrap()},setFocusOnShow:function(){this.appBarEl.winControl._setFocusToAppBar()}});return _AppBarBaseLayout})}),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_AppBarCommandsLayout:_Base.Namespace._lazy(function(){var layoutClassName=_Constants.commandLayoutClass,layoutType=_Constants.appBarLayoutCommands,_AppBarCommandsLayout=_Base.Class.derive(exports._AppBarBaseLayout,function(appBarEl){exports._AppBarBaseLayout.call(this,appBarEl,{_className:layoutClassName,_type:layoutType}),this._commandLayoutsInit(appBarEl)},{commandsInOrder:{get:function(){return this._originalCommands.filter(function(command){return this.appBarEl.contains(command.element)},this)}},layout:function(commands){_ElementUtilities.empty(this._primaryCommands),_ElementUtilities.empty(this._secondaryCommands),this._originalCommands=[];for(var i=0,len=commands.length;i<len;i++){var command=this.sanitizeCommand(commands[i]);this._originalCommands.push(command),"primary"===command.section||"global"===command.section?this._primaryCommands.appendChild(command._element):this._secondaryCommands.appendChild(command._element)}this.appBarEl.appendChild(this._secondaryCommands),this.appBarEl.appendChild(this._primaryCommands),this._needToMeasureNewCommands=!0,Scheduler.schedule(function(){this._needToMeasureNewCommands&&!this._disposed&&this.scale()}.bind(this),Scheduler.Priority.idle,this,"WinJS._commandLayoutsMixin._scaleNewCommands")},disposeChildren:function(){_Dispose.disposeSubTree(this._primaryCommands),_Dispose.disposeSubTree(this._secondaryCommands)},handleKeyDown:function(event){var Key=_ElementUtilities.Key;if(!_ElementUtilities._matchesSelector(event.target,".win-interactive, .win-interactive *")){var rtl="rtl"===_ElementUtilities._getComputedStyle(this.appBarEl).direction,leftKey=rtl?Key.rightArrow:Key.leftArrow,rightKey=rtl?Key.leftArrow:Key.rightArrow;if(event.keyCode===leftKey||event.keyCode===rightKey||event.keyCode===Key.home||event.keyCode===Key.end){var targetCommand,globalCommandHasFocus=this._primaryCommands.contains(_Global.document.activeElement),focusableCommands=this._getFocusableCommandsInLogicalOrder(globalCommandHasFocus);if(focusableCommands.length)switch(event.keyCode){case leftKey:var index=Math.max(-1,focusableCommands.focusedIndex-1)+focusableCommands.length;targetCommand=focusableCommands[index%focusableCommands.length].winControl.lastElementFocus;break;case rightKey:var index=focusableCommands.focusedIndex+1+focusableCommands.length;targetCommand=focusableCommands[index%focusableCommands.length].winControl.firstElementFocus;break;case Key.home:var index=0;targetCommand=focusableCommands[index].winControl.firstElementFocus;break;case Key.end:var index=focusableCommands.length-1;targetCommand=focusableCommands[index].winControl.lastElementFocus}targetCommand&&targetCommand!==_Global.document.activeElement&&(targetCommand.focus(),event.preventDefault())}}},commandsUpdated:function(newSetOfVisibleCommands){var visibleCommands=newSetOfVisibleCommands?newSetOfVisibleCommands:this.commandsInOrder.filter(function(command){return!command.hidden});this._fullSizeWidthOfLastKnownVisibleCommands=this._getWidthOfFullSizeCommands(visibleCommands)},beginAnimateCommands:function(showCommands,hideCommands,otherVisibleCommands){this._scaleAfterAnimations=!1;var changeInWidth=this._getWidthOfFullSizeCommands(showCommands)-this._getWidthOfFullSizeCommands(hideCommands);if(changeInWidth>0){var visibleCommandsAfterAnimations=otherVisibleCommands.concat(showCommands);this.commandsUpdated(visibleCommandsAfterAnimations),this.scale()}else changeInWidth<0&&(this._scaleAfterAnimations=!0)},endAnimateCommands:function(){this._scaleAfterAnimations&&(this.commandsUpdated(),this.scale())},resize:function(){this._disposed||(this._appBarTotalKnownWidth=null,this.appBarEl.winControl.opened&&this.scale())},disconnect:function(){exports._AppBarBaseLayout.prototype.disconnect.call(this)},_getWidthOfFullSizeCommands:function(commands){this._needToMeasureNewCommands&&this._measureContentCommands();var accumulatedWidth=0,separatorsCount=0,buttonsCount=0;if(!commands)return this._fullSizeWidthOfLastKnownVisibleCommands;for(var command,i=0,len=commands.length;i<len;i++)command=commands[i].winControl||commands[i],command._type===_Constants.typeSeparator?separatorsCount++:command._type!==_Constants.typeContent?buttonsCount++:accumulatedWidth+=command._fullSizeWidth;return accumulatedWidth+=separatorsCount*_Constants.separatorWidth+buttonsCount*_Constants.buttonWidth},_getFocusableCommandsInLogicalOrder:function(){var secondaryCommands=this._secondaryCommands.children,primaryCommands=this._primaryCommands.children,focusedIndex=-1,getFocusableCommandsHelper=function(commandsInReach){for(var focusableCommands=[],i=0,len=commandsInReach.length;i<len;i++){var element=commandsInReach[i];if(_ElementUtilities.hasClass(element,_Constants.appBarCommandClass)&&element.winControl){var containsFocus=element.contains(_Global.document.activeElement);(element.winControl._isFocusable()||containsFocus)&&(focusableCommands.push(element),containsFocus&&(focusedIndex=focusableCommands.length-1))}}return focusableCommands},commandsInReach=Array.prototype.slice.call(secondaryCommands).concat(Array.prototype.slice.call(primaryCommands)),focusableCommands=getFocusableCommandsHelper(commandsInReach);return focusableCommands.focusedIndex=focusedIndex,focusableCommands},_commandLayoutsInit:function(){this._primaryCommands=_Global.document.createElement("DIV"),this._secondaryCommands=_Global.document.createElement("DIV"),_ElementUtilities.addClass(this._primaryCommands,_Constants.primaryCommandsClass),_ElementUtilities.addClass(this._secondaryCommands,_Constants.secondaryCommandsClass)},_scaleHelper:function(){var extraPadding="minimal"===this.appBarEl.winControl.closedDisplayMode?_Constants.appBarInvokeButtonWidth:0;return _Global.document.documentElement.clientWidth-extraPadding},_measureContentCommands:function(){if(_Global.document.body.contains(this.appBarEl)){this._needToMeasureNewCommands=!1;var hadHiddenClass=_ElementUtilities.hasClass(this.appBarEl,"win-navbar-closed");_ElementUtilities.removeClass(this.appBarEl,"win-navbar-closed");var prevAppBarDisplay=this.appBarEl.style.display;this.appBarEl.style.display="";for(var prevCommandDisplay,element,contentElements=this.appBarEl.querySelectorAll("div."+_Constants.appBarCommandClass),i=0,len=contentElements.length;i<len;i++)element=contentElements[i],element.winControl&&element.winControl._type===_Constants.typeContent&&(prevCommandDisplay=element.style.display,element.style.display="",element.winControl._fullSizeWidth=_ElementUtilities.getTotalWidth(element)||0,element.style.display=prevCommandDisplay);this.appBarEl.style.display=prevAppBarDisplay,hadHiddenClass&&_ElementUtilities.addClass(this.appBarEl,"win-navbar-closed"),this.commandsUpdated()}}});return _AppBarCommandsLayout})}),_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_AppBarMenuLayout:_Base.Namespace._lazy(function(){function transformWithTransition(element,transition){var duration=transition.duration*_TransitionAnimation._animationFactor,transitionProperty=_BaseUtils._browserStyleEquivalents.transition.scriptName;element.style[transitionProperty]=duration+"ms "+transformNames.cssName+" "+transition.timing,element.style[transformNames.scriptName]=transition.to;var finish;return new Promise(function(c){var onTransitionEnd=function(eventObject){eventObject.target===element&&eventObject.propertyName===transformNames.cssName&&finish()},didFinish=!1;finish=function(){didFinish||(_Global.clearTimeout(timeoutId),element.removeEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,onTransitionEnd),element.style[transitionProperty]="",didFinish=!0),c()};var timeoutId=_Global.setTimeout(function(){timeoutId=_Global.setTimeout(finish,duration)},50);element.addEventListener(_BaseUtils._browserEventEquivalents.transitionEnd,onTransitionEnd)},function(){finish()})}function growTransition(elementClipper,element,args){var diff=args.anchorTrailingEdge?args.to.total-args.from.total:args.from.total-args.to.total,translate="width"===args.dimension?"translateX":"translateY",size=args.dimension,duration=args.duration||367,timing=args.timing||"cubic-bezier(0.1, 0.9, 0.2, 1)";elementClipper.style[size]=args.to.total+"px",elementClipper.style[transformNames.scriptName]=translate+"("+diff+"px)",element.style[size]=args.to.content+"px",element.style[transformNames.scriptName]=translate+"("+-diff+"px)",_ElementUtilities._getComputedStyle(elementClipper).opacity,_ElementUtilities._getComputedStyle(element).opacity;var transition={duration:duration,timing:timing,to:""};return Promise.join([transformWithTransition(elementClipper,transition),transformWithTransition(element,transition)])}function shrinkTransition(elementClipper,element,args){var diff=args.anchorTrailingEdge?args.from.total-args.to.total:args.to.total-args.from.total,translate="width"===args.dimension?"translateX":"translateY",duration=args.duration||367,timing=args.timing||"cubic-bezier(0.1, 0.9, 0.2, 1)";elementClipper.style[transformNames.scriptName]="",element.style[transformNames.scriptName]="",_ElementUtilities._getComputedStyle(elementClipper).opacity,_ElementUtilities._getComputedStyle(element).opacity;var transition={duration:duration,timing:timing},clipperTransition=_BaseUtils._merge(transition,{to:translate+"("+diff+"px)"}),elementTransition=_BaseUtils._merge(transition,{to:translate+"("+-diff+"px)"});return Promise.join([transformWithTransition(elementClipper,clipperTransition),transformWithTransition(element,elementTransition)])}function resizeTransition(elementClipper,element,args){return args.to.total>args.from.total?growTransition(elementClipper,element,args):args.to.total<args.from.total?shrinkTransition(elementClipper,element,args):Promise.as()}var layoutClassName=_Constants.menuLayoutClass,layoutType=_Constants.appBarLayoutMenu,transformNames=_BaseUtils._browserStyleEquivalents.transform,_AppBarMenuLayout=_Base.Class.derive(exports._AppBarBaseLayout,function(appBarEl){exports._AppBarBaseLayout.call(this,appBarEl,{_className:layoutClassName,_type:layoutType}),this._tranformNames=_BaseUtils._browserStyleEquivalents.transform,this._animationCompleteBound=this._animationComplete.bind(this),this._positionToolBarBound=this._positionToolBar.bind(this)},{commandsInOrder:{get:function(){return this._originalCommands}},layout:function(commands){this._writeProfilerMark("layout,info"),commands=commands||[],this._originalCommands=[];var that=this;commands.forEach(function(command){that._originalCommands.push(that.sanitizeCommand(command))}),this._displayedCommands=this._originalCommands.slice(0),this._menu?_ElementUtilities.empty(this._menu):(this._menu=_Global.document.createElement("div"),_ElementUtilities.addClass(this._menu,_Constants.menuContainerClass)),this.appBarEl.appendChild(this._menu),this._toolbarEl=_Global.document.createElement("div"),this._menu.appendChild(this._toolbarEl),this._createToolBar(commands)},showCommands:function(commands){var elements=this._getCommandsElements(commands),data=[],newDisplayedCommands=[],that=this;this._originalCommands.forEach(function(command){(elements.indexOf(command.element)>=0||that._displayedCommands.indexOf(command)>=0)&&(newDisplayedCommands.push(command),data.push(command))}),this._displayedCommands=newDisplayedCommands,this._updateData(data)},showOnlyCommands:function(commands){this._displayedCommands=[],this.showCommands(commands)},hideCommands:function(commands){var elements=this._getCommandsElements(commands),data=[],newDisplayedCommands=[],that=this;this._originalCommands.forEach(function(command){elements.indexOf(command.element)===-1&&that._displayedCommands.indexOf(command)>=0&&(newDisplayedCommands.push(command),data.push(command))}),this._displayedCommands=newDisplayedCommands,this._updateData(data)},connect:function(appBarEl){this._writeProfilerMark("connect,info"),exports._AppBarBaseLayout.prototype.connect.call(this,appBarEl),this._id=_ElementUtilities._uniqueID(appBarEl)},resize:function(){this._writeProfilerMark("resize,info"),this._initialized&&(this._forceLayoutPending=!0)},positionChanging:function(fromPosition,toPosition){return this._writeProfilerMark("positionChanging from:"+fromPosition+" to: "+toPosition+",info"),this._animationPromise=this._animationPromise||Promise.wrap(),this._animating&&this._animationPromise.cancel(),this._animating=!0,"shown"===toPosition||"shown"!==fromPosition&&"compact"===toPosition?(this._positionToolBar(),this._animationPromise=this._animateToolBarEntrance()):"minimal"===fromPosition||"compact"===fromPosition||"hidden"===fromPosition?this._animationPromise=Promise.wrap():this._animationPromise=this._animateToolBarExit(),this._animationPromise.then(this._animationCompleteBound,this._animationCompleteBound),this._animationPromise},disposeChildren:function(){this._writeProfilerMark("disposeChildren,info"),this._toolbar&&_Dispose.disposeSubTree(this._toolbarEl),this._originalCommands=[],this._displayedCommands=[]},setFocusOnShow:function(){this.appBarEl.winControl._setFocusToAppBar(!0,this._menu)},_updateData:function(data){var hadHiddenClass=_ElementUtilities.hasClass(this.appBarEl,"win-navbar-closed"),hadShownClass=_ElementUtilities.hasClass(this.appBarEl,"win-navbar-opened");_ElementUtilities.removeClass(this.appBarEl,"win-navbar-closed");var prevAppBarDisplay=this.appBarEl.style.display;this.appBarEl.style.display="",this._toolbar.data=new BindingList.List(data),hadHiddenClass&&this._positionToolBar(),this.appBarEl.style.display=prevAppBarDisplay,hadHiddenClass&&_ElementUtilities.addClass(this.appBarEl,"win-navbar-closed"),hadShownClass&&(this._positionToolBar(),this._animateToolBarEntrance())},_getCommandsElements:function(commands){if(!commands)return[];"string"!=typeof commands&&commands&&commands.length||(commands=[commands]);for(var elements=[],i=0,len=commands.length;i<len;i++)if(commands[i])if("string"==typeof commands[i]){var element=_Global.document.getElementById(commands[i]);if(element)elements.push(element);else for(var j=0,len2=this._originalCommands.length;j<len2;j++){var element=this._originalCommands[j].element;element.id===commands[i]&&elements.push(element)}}else commands[i].element?elements.push(commands[i].element):elements.push(commands[i]);return elements},_animationComplete:function(){this._disposed||(this._animating=!1)},_createToolBar:function(commands){this._writeProfilerMark("_createToolBar,info");var hadHiddenClass=_ElementUtilities.hasClass(this.appBarEl,"win-navbar-closed");_ElementUtilities.removeClass(this.appBarEl,"win-navbar-closed");var prevAppBarDisplay=this.appBarEl.style.display;this.appBarEl.style.display="",this._toolbar=new ToolBar.ToolBar(this._toolbarEl,{data:new BindingList.List(this._originalCommands),shownDisplayMode:"full"});var that=this;this._appbarInvokeButton=this.appBarEl.querySelector("."+_Constants.invokeButtonClass),this._overflowButton=this._toolbarEl.querySelector("."+_ToolBarConstants.overflowButtonCssClass),this._overflowButton.addEventListener("click",function(){that._appbarInvokeButton.click()}),this._positionToolBar(),this.appBarEl.style.display=prevAppBarDisplay,hadHiddenClass&&_ElementUtilities.addClass(this.appBarEl,"win-navbar-closed")},_positionToolBar:function(){this._disposed||(this._writeProfilerMark("_positionToolBar,info"),this._initialized=!0)},_animateToolBarEntrance:function(){this._writeProfilerMark("_animateToolBarEntrance,info"),this._forceLayoutPending&&(this._forceLayoutPending=!1,this._toolbar.forceLayout(),this._positionToolBar());var heightVisible=this._isMinimal()?0:this.appBarEl.offsetHeight;if(this._isBottom()){var offsetTop=this._menu.offsetHeight-heightVisible;return this._executeTranslate(this._menu,"translateY("+-offsetTop+"px)")}return resizeTransition(this._menu,this._toolbarEl,{from:{content:heightVisible,total:heightVisible},to:{content:this._menu.offsetHeight,total:this._menu.offsetHeight},dimension:"height",duration:400,timing:"ease-in"})},_animateToolBarExit:function(){this._writeProfilerMark("_animateToolBarExit,info");var heightVisible=this._isMinimal()?0:this.appBarEl.offsetHeight;return this._isBottom()?this._executeTranslate(this._menu,"none"):resizeTransition(this._menu,this._toolbarEl,{from:{content:this._menu.offsetHeight,total:this._menu.offsetHeight},to:{content:heightVisible,total:heightVisible},dimension:"height",duration:400,timing:"ease-in"})},_executeTranslate:function(element,value){return _TransitionAnimation.executeTransition(element,{property:this._tranformNames.cssName,delay:0,duration:400,timing:"ease-in",to:value})},_isMinimal:function(){return"minimal"===this.appBarEl.winControl.closedDisplayMode},_isBottom:function(){return"bottom"===this.appBarEl.winControl.placement},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI._AppBarMenuLayout:"+this._id+":"+text)}});return _AppBarMenuLayout})})}),define("WinJS/Controls/_LegacyAppBar",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Promise","../Scheduler","../_LightDismissService","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","./_LegacyAppBar/_Constants","./_LegacyAppBar/_Layouts","./AppBar/_Command","./AppBar/_Icon","./Flyout/_Overlay","../Application"],function(exports,_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,Animations,Promise,Scheduler,_LightDismissService,_Control,_Dispose,_ElementUtilities,_Hoverable,_KeyboardBehavior,_Constants,_Layouts,_Command,_Icon,_Overlay,Application){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_LegacyAppBar:_Base.Namespace._lazy(function(){function _allManipulationChanged(event){var elements=_Global.document.querySelectorAll("."+_Constants.appBarClass);if(elements)for(var len=elements.length,i=0;i<len;i++){var element=elements[i],appbar=element.winControl;appbar&&!element.disabled&&appbar._manipulationChanged(event)}}var EVENTS={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose"},createEvent=_Events._createEventProperty,knownVisibleHeights={none:0,hidden:0,minimal:25,compact:48},displayModeVisiblePositions={none:"hidden",hidden:"hidden",minimal:"minimal",shown:"shown",compact:"compact"},closedDisplayModes={none:"none",minimal:"minimal",compact:"compact"},appbarShownState="shown",appbarHiddenState="hidden",globalEventsInitialized=!1,strings={get ariaLabel(){return _Resources._getWinJSString("ui/appBarAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get cannotChangePlacementWhenVisible(){return"Invalid argument: The placement property cannot be set when the AppBar is visible, call hide() first"},get cannotChangeLayoutWhenVisible(){return"Invalid argument: The layout property cannot be set when the AppBar is visible, call hide() first";
}},_LegacyAppBar=_Base.Class.derive(_Overlay._Overlay,function(element,options){this._initializing=!0,options=options||{},this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),_ElementUtilities.addClass(this._element,_Constants.appBarClass);var that=this;this._dismissable=new _LightDismissService.LightDismissableElement({element:this._element,tabIndex:this._element.hasAttribute("tabIndex")?this._element.tabIndex:-1,onLightDismiss:function(){that.close()},onTakeFocus:function(useSetActive){that._dismissable.restoreFocus()||that._layoutImpl.setFocusOnShow()}});var role=this._element.getAttribute("role");role||this._element.setAttribute("role","menubar");var label=this._element.getAttribute("aria-label");label||this._element.setAttribute("aria-label",strings.ariaLabel),this._baseOverlayConstructor(this._element),this._lastPositionVisited=displayModeVisiblePositions.none,_ElementUtilities.addClass(this._element,_Constants.hiddenClass),this._invokeButton=_Global.document.createElement("button"),this._invokeButton.tabIndex=0,this._invokeButton.setAttribute("type","button"),this._invokeButton.innerHTML="<span class='"+_Constants.ellipsisClass+"'></span>",_ElementUtilities.addClass(this._invokeButton,_Constants.invokeButtonClass),this._element.appendChild(this._invokeButton),this._invokeButton.addEventListener("click",function(){that.opened?that._hide():that._show()},!1),this._layout=_Constants.appBarLayoutCustom,delete options._layout,this.placement=options.placement||_Constants.appBarPlacementBottom,this.closedDisplayMode=options.closedDisplayMode||closedDisplayModes.compact,_Control.setOptions(this,options);var commandsUpdatedBound=this._commandsUpdated.bind(this);return this._element.addEventListener(_Constants.commandVisibilityChanged,function(ev){that._disposed||(that.opened&&ev.preventDefault(),commandsUpdatedBound())}),this._initializing=!1,this._setFocusToAppBarBound=this._setFocusToAppBar.bind(this),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!1),globalEventsInitialized||(_Global.document.addEventListener("MSManipulationStateChanged",_allManipulationChanged,!1),globalEventsInitialized=!0),this.closedDisplayMode===closedDisplayModes.none&&this.layout===_Constants.appBarLayoutCommands&&(this._element.style.display="none"),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._element),this._writeProfilerMark("constructor,StopTM"),this},{placement:{get:function(){return this._placement},set:function(value){var wasShown=!1;if(_WinRT.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),wasShown=!0),this.opened)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.CannotChangePlacementWhenVisible",strings.cannotChangePlacementWhenVisible);this._placement=value===_Constants.appBarPlacementTop?_Constants.appBarPlacementTop:_Constants.appBarPlacementBottom,this._placement===_Constants.appBarPlacementTop?(_ElementUtilities.addClass(this._element,_Constants.topClass),_ElementUtilities.removeClass(this._element,_Constants.bottomClass)):this._placement===_Constants.appBarPlacementBottom&&(_ElementUtilities.removeClass(this._element,_Constants.topClass),_ElementUtilities.addClass(this._element,_Constants.bottomClass)),this._ensurePosition(),wasShown&&this._show()}},_layout:{get:function(){return this._layoutImpl.type},set:function(layout){layout!==_Constants.appBarLayoutCommands&&layout!==_Constants.appBarLayoutCustom&&layout!==_Constants.appBarLayoutMenu;var wasShown=!1;if(_WinRT.Windows.ApplicationModel.DesignMode.designModeEnabled&&(this._hide(),wasShown=!0),this.opened)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.CannotChangeLayoutWhenVisible",strings.cannotChangeLayoutWhenVisible);var commands;this._initializing||(commands=this._layoutImpl.commandsInOrder,this._layoutImpl.disconnect()),layout===_Constants.appBarLayoutCommands?this._layoutImpl=new _Layouts._AppBarCommandsLayout:layout===_Constants.appBarLayoutMenu?this._layoutImpl=new _Layouts._AppBarMenuLayout:this._layoutImpl=new _Layouts._AppBarBaseLayout,this._layoutImpl.connect(this._element),commands&&commands.length&&this._layoutCommands(commands),wasShown&&this._show()},configurable:!0},commands:{set:function(commands){if(this.opened)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.CannotChangeCommandsWhenVisible",_Resources._formatString(_Overlay._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"_LegacyAppBar"));this._initializing||this._disposeChildren(),this._layoutCommands(commands)}},_layoutCommands:function(commands){_ElementUtilities.empty(this._element),this._element.appendChild(this._invokeButton),Array.isArray(commands)||(commands=[commands]),this._layoutImpl.layout(commands)},closedDisplayMode:{get:function(){return this._closedDisplayMode},set:function(value){var oldValue=this._closedDisplayMode;if(oldValue!==value){var changeVisiblePosition=_ElementUtilities.hasClass(this._element,_Constants.hiddenClass)||_ElementUtilities.hasClass(this._element,_Constants.hidingClass);value===closedDisplayModes.none?(this._closedDisplayMode=closedDisplayModes.none,changeVisiblePosition&&oldValue||(_ElementUtilities.removeClass(this._element,_Constants.minimalClass),_ElementUtilities.removeClass(this._element,_Constants.compactClass))):value===closedDisplayModes.minimal?(this._closedDisplayMode=closedDisplayModes.minimal,changeVisiblePosition&&oldValue&&oldValue!==closedDisplayModes.none||(_ElementUtilities.addClass(this._element,_Constants.minimalClass),_ElementUtilities.removeClass(this._element,_Constants.compactClass))):(this._closedDisplayMode=closedDisplayModes.compact,_ElementUtilities.addClass(this._element,_Constants.compactClass),_ElementUtilities.removeClass(this._element,_Constants.minimalClass)),this._layoutImpl.resize(),changeVisiblePosition&&this._changeVisiblePosition(displayModeVisiblePositions[this._closedDisplayMode])}}},opened:{get:function(){return!_ElementUtilities.hasClass(this._element,_Constants.hiddenClass)&&!_ElementUtilities.hasClass(this._element,_Constants.hidingClass)&&this._doNext!==displayModeVisiblePositions.minimal&&this._doNext!==displayModeVisiblePositions.compact&&this._doNext!==displayModeVisiblePositions.none},set:function(opened){var currentlyOpen=this.opened;opened&&!currentlyOpen?this._show():!opened&&currentlyOpen&&this._hide()}},onbeforeopen:createEvent(EVENTS.beforeOpen),onafteropen:createEvent(EVENTS.afterOpen),onbeforeclose:createEvent(EVENTS.beforeClose),onafterclose:createEvent(EVENTS.afterClose),getCommandById:function(id){var commands=this._layoutImpl.commandsInOrder.filter(function(command){return command.id===id||command.element.id===id});return 1===commands.length?commands[0]:0===commands.length?null:commands},showCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.RequiresCommands",strings.requiresCommands);this._layoutImpl.showCommands(commands)},hideCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.RequiresCommands",strings.requiresCommands);this._layoutImpl.hideCommands(commands)},showOnlyCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI._LegacyAppBar.RequiresCommands",strings.requiresCommands);this._layoutImpl.showOnlyCommands(commands)},open:function(){this._writeProfilerMark("show,StartTM"),this._show()},_show:function(){var toPosition=displayModeVisiblePositions.shown,showing=null;this.disabled||!_ElementUtilities.hasClass(this._element,_Constants.hiddenClass)&&!_ElementUtilities.hasClass(this._element,_Constants.hidingClass)||(showing=appbarShownState),this._changeVisiblePosition(toPosition,showing),showing&&(this._updateFirstAndFinalDiv(),_LightDismissService.shown(this._dismissable))},close:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(toPosition){var toPosition=toPosition||displayModeVisiblePositions[this.closedDisplayMode],hiding=null;_ElementUtilities.hasClass(this._element,_Constants.hiddenClass)||_ElementUtilities.hasClass(this._element,_Constants.hidingClass)||(hiding=appbarHiddenState),this._changeVisiblePosition(toPosition,hiding)},_dispose:function(){_Dispose.disposeSubTree(this.element),_LightDismissService.hidden(this._dismissable),this._layoutImpl.dispose(),this.disabled=!0,this.close()},_disposeChildren:function(){this._layoutImpl.disposeChildren()},_handleKeyDown:function(event){this._invokeButton.contains(_Global.document.activeElement)||this._layoutImpl.handleKeyDown(event)},_visiblePixels:{get:function(){return{hidden:knownVisibleHeights.hidden,minimal:knownVisibleHeights.minimal,compact:Math.max(this._heightWithoutLabels||0,knownVisibleHeights.compact),shown:this._element.offsetHeight}}},_visiblePosition:{get:function(){return this._animating&&displayModeVisiblePositions[this._element.winAnimating]?this._element.winAnimating:this._lastPositionVisited}},_visible:{get:function(){return this._visiblePosition!==displayModeVisiblePositions.none}},_changeVisiblePosition:function(toPosition,newState){if(this._visiblePosition===toPosition&&!this._keyboardObscured||this.disabled&&toPosition!==displayModeVisiblePositions.disabled)this._afterPositionChange(null);else if(this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard)this._doNext=toPosition,this._afterPositionChange(null);else{this._element.winAnimating=toPosition;var performAnimation=!this._initializing,fromPosition=this._lastPositionVisited;this._element.style.display="";var hidingCompletely=toPosition===displayModeVisiblePositions.hidden;this._keyboardObscured&&(hidingCompletely?performAnimation=!1:fromPosition=displayModeVisiblePositions.hidden,this._keyboardObscured=!1),newState===appbarShownState?this._beforeShow():newState===appbarHiddenState&&this._beforeHide(),this._ensurePosition(),this._element.style.opacity=1,this._element.style.visibility="visible",this._animationPromise=performAnimation?this._animatePositionChange(fromPosition,toPosition):Promise.wrap(),this._animationPromise.then(function(){this._afterPositionChange(toPosition,newState)}.bind(this),function(){this._afterPositionChange(toPosition,newState)}.bind(this))}},_afterPositionChange:function(newPosition,newState){if(!this._disposed){if(newPosition){newPosition===displayModeVisiblePositions.minimal&&(_ElementUtilities.addClass(this._element,_Constants.minimalClass),_ElementUtilities.removeClass(this._element,_Constants.compactClass)),newPosition===displayModeVisiblePositions.hidden&&this.closedDisplayMode===closedDisplayModes.none&&(_ElementUtilities.removeClass(this._element,_Constants.minimalClass),_ElementUtilities.removeClass(this._element,_Constants.compactClass)),this._element.winAnimating="",this._lastPositionVisited=newPosition,this._doNext===this._lastPositionVisited&&(this._doNext=""),newState===appbarHiddenState&&_LightDismissService.hidden(this._dismissable),newPosition===displayModeVisiblePositions.hidden&&(this._element.style.visibility="hidden",this._element.style.display="none");var transformProperty=_BaseUtils._browserStyleEquivalents.transform.scriptName;this._element.style[transformProperty]="",newState===appbarShownState?this._afterShow():newState===appbarHiddenState&&this._afterHide(),Scheduler.schedule(this._checkDoNext,Scheduler.Priority.normal,this,"WinJS.UI._LegacyAppBar._checkDoNext")}this._afterPositionChangeCallBack()}},_afterPositionChangeCallBack:function(){},_beforeShow:function(){this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),this._layoutImpl.scale(),this.closedDisplayMode===closedDisplayModes.compact&&(this._heightWithoutLabels=this._element.offsetHeight),_ElementUtilities.removeClass(this._element,_Constants.hiddenClass),_ElementUtilities.addClass(this._element,_Constants.showingClass),this._sendEvent(EVENTS.beforeOpen)},_afterShow:function(){_ElementUtilities.removeClass(this._element,_Constants.showingClass),_ElementUtilities.addClass(this._element,_Constants.shownClass),this._sendEvent(EVENTS.afterOpen),this._writeProfilerMark("show,StopTM")},_beforeHide:function(){_ElementUtilities.removeClass(this._element,_Constants.shownClass),_ElementUtilities.addClass(this._element,_Constants.hidingClass),this._sendEvent(EVENTS.beforeClose)},_afterHide:function(){this._queuedCommandAnimation&&(this._showAndHideFast(this._queuedToShow,this._queuedToHide),this._queuedToShow=[],this._queuedToHide=[]),_ElementUtilities.removeClass(this._element,_Constants.hidingClass),_ElementUtilities.addClass(this._element,_Constants.hiddenClass),this._sendEvent(EVENTS.afterClose),this._writeProfilerMark("hide,StopTM")},_animatePositionChange:function(fromPosition,toPosition){var appBarElementAnimationPromise,layoutElementsAnimationPromise=this._layoutImpl.positionChanging(fromPosition,toPosition),beginningVisiblePixelHeight=this._visiblePixels[fromPosition],endingVisiblePixelHeight=this._visiblePixels[toPosition],distance=Math.abs(endingVisiblePixelHeight-beginningVisiblePixelHeight),offsetTop=this._placement===_Constants.appBarPlacementTop?-distance:distance;if(this._placement===_Constants.appBarPlacementTop&&(fromPosition===displayModeVisiblePositions.shown&&toPosition===displayModeVisiblePositions.compact||fromPosition===displayModeVisiblePositions.compact&&toPosition===displayModeVisiblePositions.shown)&&(offsetTop=0),endingVisiblePixelHeight>beginningVisiblePixelHeight){var fromOffset={top:offsetTop+"px",left:"0px"};appBarElementAnimationPromise=Animations.showEdgeUI(this._element,fromOffset,{mechanism:"transition"})}else{var toOffset={top:offsetTop+"px",left:"0px"};appBarElementAnimationPromise=Animations.hideEdgeUI(this._element,toOffset,{mechanism:"transition"})}return Promise.join([layoutElementsAnimationPromise,appBarElementAnimationPromise])},_checkDoNext:function(){this._animating||this._needToHandleShowingKeyboard||this._needToHandleHidingKeyboard||this._disposed||(this._doNext===displayModeVisiblePositions.disabled||this._doNext===displayModeVisiblePositions.hidden||this._doNext===displayModeVisiblePositions.minimal||this._doNext===displayModeVisiblePositions.compact?(this._hide(this._doNext),this._doNext=""):this._queuedCommandAnimation?this._showAndHideQueue():this._doNext===displayModeVisiblePositions.shown&&(this._show(),this._doNext=""))},_setFocusToAppBar:function(useSetActive,scroller){this._focusOnFirstFocusableElement(useSetActive,scroller)||_Overlay._Overlay._trySetActive(this._element,scroller)},_commandsUpdated:function(){this._initializing||(this._layoutImpl.commandsUpdated(),this._layoutImpl.scale())},_beginAnimateCommands:function(showCommands,hideCommands,otherVisibleCommands){this._layoutImpl.beginAnimateCommands(showCommands,hideCommands,otherVisibleCommands)},_endAnimateCommands:function(){this._layoutImpl.endAnimateCommands(),this._endAnimateCommandsCallBack()},_endAnimateCommandsCallBack:function(){},_getTopOfVisualViewport:function(){return _Overlay._Overlay._keyboardInfo._visibleDocTop},_getAdjustedBottom:function(){return _Overlay._Overlay._keyboardInfo._visibleDocBottomOffset},_showingKeyboard:function(event){if(this._keyboardObscured=!1,this._needToHandleHidingKeyboard=!1,!_Overlay._Overlay._keyboardInfo._visible||!this._alreadyInPlace()){this._needToHandleShowingKeyboard=!0,this.opened&&this._element.contains(_Global.document.activeElement)&&(event.ensuredFocusedElementInView=!0),this._visible&&this._placement!==_Constants.appBarPlacementTop&&_Overlay._Overlay._isFlyoutVisible()?this._keyboardObscured=!0:this._scrollHappened=!1;var that=this;_Global.setTimeout(function(e){that._checkKeyboardTimer(e)},_Overlay._Overlay._keyboardInfo._animationShowLength+_Overlay._Overlay._scrollTimeout)}},_hidingKeyboard:function(){this._keyboardObscured=!1,this._needToHandleShowingKeyboard=!1,this._needToHandleHidingKeyboard=!0,_Overlay._Overlay._keyboardInfo._isResized||((this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display=""),this._needToHandleHidingKeyboard=!1)},_resize:function(event){this._needToHandleShowingKeyboard?this._visible&&(this._placement===_Constants.appBarPlacementTop||this._keyboardObscured||(this._element.style.display="none")):this._needToHandleHidingKeyboard&&(this._needToHandleHidingKeyboard=!1,(this._visible||this._animating)&&(this._checkScrollPosition(),this._element.style.display="")),this._initializing||this._layoutImpl.resize(event)},_checkKeyboardTimer:function(){this._scrollHappened||this._mayEdgeBackIn()},_manipulationChanged:function(event){0===event.currentState&&this._scrollHappened&&this._mayEdgeBackIn()},_mayEdgeBackIn:function(){if(this._needToHandleShowingKeyboard)if(this._needToHandleShowingKeyboard=!1,this._keyboardObscured||this._placement===_Constants.appBarPlacementTop&&0===_Overlay._Overlay._keyboardInfo._visibleDocTop)this._checkDoNext();else{var toPosition=this._visiblePosition;this._lastPositionVisited=displayModeVisiblePositions.hidden,this._changeVisiblePosition(toPosition,!1)}this._scrollHappened=!1},_ensurePosition:function(){var offSet=this._computePositionOffset();this._element.style.bottom=offSet.bottom,this._element.style.top=offSet.top},_computePositionOffset:function(){var positionOffSet={};return this._placement===_Constants.appBarPlacementBottom?(positionOffSet.bottom=this._getAdjustedBottom()+"px",positionOffSet.top=""):this._placement===_Constants.appBarPlacementTop&&(positionOffSet.bottom="",positionOffSet.top=this._getTopOfVisualViewport()+"px"),positionOffSet},_checkScrollPosition:function(){return this._needToHandleShowingKeyboard?void(this._scrollHappened=!0):void((this._visible||this._animating)&&(this._ensurePosition(),this._checkDoNext()))},_alreadyInPlace:function(){var offSet=this._computePositionOffset();return offSet.top===this._element.style.top&&offSet.bottom===this._element.style.bottom},_updateFirstAndFinalDiv:function(){var appBarFirstDiv=this._element.querySelectorAll("."+_Constants.firstDivClass);appBarFirstDiv=appBarFirstDiv.length>=1?appBarFirstDiv[0]:null;var appBarFinalDiv=this._element.querySelectorAll("."+_Constants.finalDivClass);appBarFinalDiv=appBarFinalDiv.length>=1?appBarFinalDiv[0]:null,appBarFirstDiv&&this._element.children[0]!==appBarFirstDiv&&(appBarFirstDiv.parentNode.removeChild(appBarFirstDiv),appBarFirstDiv=null),appBarFinalDiv&&this._element.children[this._element.children.length-1]!==appBarFinalDiv&&(appBarFinalDiv.parentNode.removeChild(appBarFinalDiv),appBarFinalDiv=null),appBarFirstDiv||(appBarFirstDiv=_Global.document.createElement("div"),appBarFirstDiv.style.display="inline",appBarFirstDiv.className=_Constants.firstDivClass,appBarFirstDiv.tabIndex=-1,appBarFirstDiv.setAttribute("aria-hidden","true"),_ElementUtilities._addEventListener(appBarFirstDiv,"focusin",this._focusOnLastFocusableElementOrThis.bind(this),!1),this._element.children[0]?this._element.insertBefore(appBarFirstDiv,this._element.children[0]):this._element.appendChild(appBarFirstDiv)),appBarFinalDiv||(appBarFinalDiv=_Global.document.createElement("div"),appBarFinalDiv.style.display="inline",appBarFinalDiv.className=_Constants.finalDivClass,appBarFinalDiv.tabIndex=-1,appBarFinalDiv.setAttribute("aria-hidden","true"),_ElementUtilities._addEventListener(appBarFinalDiv,"focusin",this._focusOnFirstFocusableElementOrThis.bind(this),!1),this._element.appendChild(appBarFinalDiv)),this._element.children[this._element.children.length-2]!==this._invokeButton&&this._element.insertBefore(this._invokeButton,appBarFinalDiv);var elms=this._element.getElementsByTagName("*"),highestTabIndex=_ElementUtilities._getHighestTabIndexInList(elms);this._invokeButton.tabIndex=highestTabIndex,appBarFirstDiv&&(appBarFirstDiv.tabIndex=_ElementUtilities._getLowestTabIndexInList(elms)),appBarFinalDiv&&(appBarFinalDiv.tabIndex=highestTabIndex)},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI._LegacyAppBar:"+this._id+":"+text)}},{_Events:EVENTS});return _LegacyAppBar})})}),define("WinJS/Controls/Menu",["exports","../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Core/_WriteProfilerMark","../Promise","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../Utilities/_KeyboardBehavior","./_LegacyAppBar/_Constants","./Flyout","./Flyout/_Overlay","./Menu/_Command"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,_WriteProfilerMark,Promise,_ElementUtilities,_Hoverable,_KeyboardBehavior,_Constants,Flyout,_Overlay,_Command){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{Menu:_Base.Namespace._lazy(function(){function isCommandInMenu(object){var element=object.element||object;return _ElementUtilities._matchesSelector(element,"."+_Constants.menuClass+" ."+_Constants.menuCommandClass)}var Key=_ElementUtilities.Key,strings={get ariaLabel(){return _Resources._getWinJSString("ui/menuAriaLabel").value},get requiresCommands(){return"Invalid argument: commands must not be empty"},get nullCommand(){return"Invalid argument: command must not be null"}},Menu=_Base.Class.derive(Flyout.Flyout,function(element,options){options=options||{},this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),!options.commands&&this._element&&(options=_BaseUtils._shallowCopy(options),options.commands=this._verifyCommandsOnly(this._element,"WinJS.UI.MenuCommand"));var role="menu",label=null;this._element&&(role=this._element.getAttribute("role")||role,label=this._element.getAttribute("aria-label")||label),this._baseFlyoutConstructor(this._element,options),this._element.setAttribute("role",role),this._element.setAttribute("aria-label",label),this._element.addEventListener("keydown",this._handleKeyDown.bind(this),!0),this._element.addEventListener(_Constants._menuCommandInvokedEvent,this._handleCommandInvoked.bind(this),!1),this._element.addEventListener("mouseover",this._handleMouseOver.bind(this),!1),this._element.addEventListener("mouseout",this._handleMouseOut.bind(this),!1),_ElementUtilities.addClass(this._element,_Constants.menuClass),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._element),this.hide(),this._writeProfilerMark("constructor,StopTM")},{commands:{set:function(value){if(!this.hidden)throw new _ErrorFromName("WinJS.UI.Menu.CannotChangeCommandsWhenVisible",_Resources._formatString(_Overlay._Overlay.commonstrings.cannotChangeCommandsWhenVisible,"Menu"));_ElementUtilities.empty(this._element),Array.isArray(value)||(value=[value]);for(var len=value.length,i=0;i<len;i++)this._addCommand(value[i])}},getCommandById:function(id){for(var commands=this.element.querySelectorAll("#"+id),newCommands=[],count=0,len=commands.length;count<len;count++)commands[count].winControl&&newCommands.push(commands[count].winControl);return 1===newCommands.length?newCommands[0]:0===newCommands.length?null:newCommands},showCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI.Menu.RequiresCommands",strings.requiresCommands);this._showCommands(commands,!0)},hideCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI.Menu.RequiresCommands",strings.requiresCommands);this._hideCommands(commands,!0)},showOnlyCommands:function(commands){if(!commands)throw new _ErrorFromName("WinJS.UI.Menu.RequiresCommands",strings.requiresCommands);this._showOnlyCommands(commands,!0)},_hide:function(){this._hoverPromise&&this._hoverPromise.cancel(),Flyout.Flyout.prototype._hide.call(this)},_afterHide:function(){_ElementUtilities.removeClass(this.element,_Constants.menuMouseSpacingClass),_ElementUtilities.removeClass(this.element,_Constants.menuTouchSpacingClass)},_beforeShow:function(){_ElementUtilities.hasClass(this.element,_Constants.menuMouseSpacingClass)||_ElementUtilities.hasClass(this.element,_Constants.menuTouchSpacingClass)||_ElementUtilities.addClass(this.element,Flyout.Flyout._cascadeManager.inputType===_KeyboardBehavior._InputTypes.mouse||Flyout.Flyout._cascadeManager.inputType===_KeyboardBehavior._InputTypes.keyboard?_Constants.menuMouseSpacingClass:_Constants.menuTouchSpacingClass),this._checkMenuCommands()},_addCommand:function(command){if(!command)throw new _ErrorFromName("WinJS.UI.Menu.NullCommand",strings.nullCommand);command._element||(command=new _Command.MenuCommand(null,command)),command._element.parentElement&&command._element.parentElement.removeChild(command._element),this._element.appendChild(command._element)},_dispose:function(){this._hoverPromise&&this._hoverPromise.cancel(),Flyout.Flyout.prototype._dispose.call(this)},_commandsUpdated:function(){this.hidden||this._checkMenuCommands()},_checkMenuCommands:function(){var menuCommands=this._element.querySelectorAll(".win-command"),hasToggleCommands=!1,hasFlyoutCommands=!1;if(menuCommands)for(var i=0,len=menuCommands.length;i<len;i++){var menuCommand=menuCommands[i].winControl;menuCommand&&!menuCommand.hidden&&(hasToggleCommands||menuCommand.type!==_Constants.typeToggle||(hasToggleCommands=!0),hasFlyoutCommands||menuCommand.type!==_Constants.typeFlyout||(hasFlyoutCommands=!0))}_ElementUtilities[hasToggleCommands?"addClass":"removeClass"](this._element,_Constants.menuContainsToggleCommandClass),_ElementUtilities[hasFlyoutCommands?"addClass":"removeClass"](this._element,_Constants.menuContainsFlyoutCommandClass)},_handleKeyDown:function(event){event.keyCode===Key.upArrow?(Menu._focusOnPreviousElement(this.element),event.preventDefault()):event.keyCode===Key.downArrow?(Menu._focusOnNextElement(this.element),event.preventDefault()):event.keyCode!==Key.space&&event.keyCode!==Key.enter||this.element!==_Global.document.activeElement?event.keyCode===Key.tab&&event.preventDefault():(event.preventDefault(),this.hide())},_handleFocusIn:function(event){var target=event.target;if(isCommandInMenu(target)){var command=target.winControl;if(_ElementUtilities.hasClass(command.element,_Constants.menuCommandFlyoutActivatedClass))command.flyout.element.focus();else{var activatedSiblingCommand=this.element.querySelector("."+_Constants.menuCommandFlyoutActivatedClass);activatedSiblingCommand&&_Command.MenuCommand._deactivateFlyoutCommand(activatedSiblingCommand)}}else target===this.element&&Flyout.Flyout.prototype._handleFocusIn.call(this,event)},_handleCommandInvoked:function(event){this._hoverPromise&&this._hoverPromise.cancel();var command=event.detail.command;command._type!==_Constants.typeFlyout&&command._type!==_Constants.typeSeparator&&this._lightDismiss()},_hoverPromise:null,_handleMouseOver:function(event){var target=event.target;if(isCommandInMenu(target)){var command=target.winControl,that=this;target.focus&&(target.focus(),_ElementUtilities.removeClass(target,"win-keyboard"),command.type===_Constants.typeFlyout&&command.flyout&&command.flyout.hidden&&(this._hoverPromise=this._hoverPromise||Promise.timeout(_Constants.menuCommandHoverDelay).then(function(){that.hidden||that._disposed||command._invoke(event),that._hoverPromise=null},function(){that._hoverPromise=null})))}},_handleMouseOut:function(event){var target=event.target;isCommandInMenu(target)&&!target.contains(event.relatedTarget)&&(target===_Global.document.activeElement&&this.element.focus(),this._hoverPromise&&this._hoverPromise.cancel())},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.Menu:"+this._id+":"+text)}});return Menu._focusOnNextElement=function(menu){var _currentElement=_Global.document.activeElement;do _currentElement=_currentElement===menu?_currentElement.firstElementChild:_currentElement.nextElementSibling,_currentElement?_currentElement.focus():_currentElement=menu;while(_currentElement!==_Global.document.activeElement)},Menu._focusOnPreviousElement=function(menu){var _currentElement=_Global.document.activeElement;do _currentElement=_currentElement===menu?_currentElement.lastElementChild:_currentElement.previousElementSibling,_currentElement?_currentElement.focus():_currentElement=menu;while(_currentElement!==_Global.document.activeElement)},Menu})})}),define("WinJS/Controls/AutoSuggestBox/_SearchSuggestionManagerShim",["exports","../../_Signal","../../Core/_Base","../../Core/_BaseUtils","../../Core/_Events","../../BindingList"],function(exports,_Signal,_Base,_BaseUtils,_Events,BindingList){"use strict";var CollectionChange={reset:0,itemInserted:1,itemRemoved:2,itemChanged:3},SearchSuggestionKind={Query:0,Result:1,Separator:2},SuggestionVectorShim=_Base.Class.derive(Array,function(){},{reset:function(){this.length=0,this.dispatchEvent("vectorchanged",{collectionChange:CollectionChange.reset,index:0})},insert:function(index,data){this.splice(index,0,data),this.dispatchEvent("vectorchanged",{collectionChange:CollectionChange.itemInserted,index:index})},remove:function(index){this.splice(index,1),this.dispatchEvent("vectorchanged",{collectionChange:CollectionChange.itemRemoved,index:index})}});_Base.Class.mix(SuggestionVectorShim,_Events.eventMixin);var SearchSuggestionCollectionShim=_Base.Class.define(function(){this._data=[]},{size:{get:function(){return this._data.length}},appendQuerySuggestion:function(text){this._data.push({kind:SearchSuggestionKind.Query,text:text})},appendQuerySuggestions:function(suggestions){suggestions.forEach(this.appendQuerySuggestion.bind(this))},appendResultSuggestion:function(text,detailText,tag,imageUrl,imageAlternateText){this._data.push({kind:SearchSuggestionKind.Result,text:text,detailText:detailText,tag:tag,imageUrl:imageUrl,imageAlternateText:imageAlternateText,image:null})},appendSearchSeparator:function(label){this._data.push({kind:SearchSuggestionKind.Separator,text:label})}}),SuggestionsRequestedEventArgShim=_Base.Class.define(function(queryText,language,linguisticDetails){this._queryText=queryText,this._language=language,this._linguisticDetails=linguisticDetails,this._searchSuggestionCollection=new SearchSuggestionCollectionShim},{language:{get:function(){return this._language}},linguisticDetails:{get:function(){return this._linguisticDetails}},queryText:{get:function(){return this._queryText}},searchSuggestionCollection:{get:function(){return this._searchSuggestionCollection}},getDeferral:function(){return this._deferralSignal||(this._deferralSignal=new _Signal)},_deferralSignal:null}),SearchSuggestionManagerShim=_Base.Class.define(function(){this._updateVector=this._updateVector.bind(this),this._suggestionVector=new SuggestionVectorShim,this._query="",this._history={"":[]},this._dataSource=[],this.searchHistoryContext="",this.searchHistoryEnabled=!0},{addToHistory:function(queryText){if(queryText&&queryText.trim()){for(var history=this._history[this.searchHistoryContext],dupeIndex=-1,i=0,l=history.length;i<l;i++){var item=history[i];if(item.text.toLowerCase()===queryText.toLowerCase()){dupeIndex=i;break}}dupeIndex>=0&&history.splice(dupeIndex,1),history.splice(0,0,{text:queryText,kind:SearchSuggestionKind.Query}),this._updateVector()}},clearHistory:function(){this._history[this.searchHistoryContext]=[],this._updateVector()},setLocalContentSuggestionSettings:function(settings){},setQuery:function(queryText){function update(arr){that._dataSource=arr,that._updateVector()}var that=this;this._query=queryText;var arg=new SuggestionsRequestedEventArgShim(queryText);this.dispatchEvent("suggestionsrequested",{request:arg}),arg._deferralSignal?arg._deferralSignal.promise.then(update.bind(this,arg.searchSuggestionCollection._data)):update(arg.searchSuggestionCollection._data)},searchHistoryContext:{get:function(){return""+this._searchHistoryContext},set:function(value){value=""+value,this._history[value]||(this._history[value]=[]),this._searchHistoryContext=value}},searchHistoryEnabled:{get:function(){return this._searchHistoryEnabled},set:function(value){this._searchHistoryEnabled=value}},suggestions:{get:function(){return this._suggestionVector}},_updateVector:function(){for(this.suggestions.insert(this.suggestions.length,{
text:"",kind:SearchSuggestionKind.Query});this.suggestions.length>1;)this.suggestions.remove(0);var index=0,added={};if(this.searchHistoryEnabled){var q=this._query.toLowerCase();this._history[this.searchHistoryContext].forEach(function(item){var text=item.text.toLowerCase();0===text.indexOf(q)&&(this.suggestions.insert(index,item),added[text]=!0,index++)},this)}this._dataSource.forEach(function(item){item.kind===SearchSuggestionKind.Query?added[item.text.toLowerCase()]||(this.suggestions.insert(index,item),index++):(this.suggestions.insert(index,item),index++)},this),this.suggestions.remove(this.suggestions.length-1)}});_Base.Class.mix(SearchSuggestionManagerShim,_Events.eventMixin),_Base.Namespace._moduleDefine(exports,null,{_CollectionChange:CollectionChange,_SearchSuggestionKind:SearchSuggestionKind,_SearchSuggestionManagerShim:SearchSuggestionManagerShim})}),define("require-style!less/styles-autosuggestbox",[],function(){}),define("require-style!less/colors-autosuggestbox",[],function(){}),define("WinJS/Controls/AutoSuggestBox",["exports","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementListUtilities","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../_Accents","../Animations","../BindingList","../Promise","./Repeater","./AutoSuggestBox/_SearchSuggestionManagerShim","require-style!less/styles-autosuggestbox","require-style!less/colors-autosuggestbox"],function(exports,_Global,_WinRT,_Base,_ErrorFromName,_Events,_Resources,_Control,_ElementListUtilities,_ElementUtilities,_Hoverable,_Accents,Animations,BindingList,Promise,Repeater,_SuggestionManagerShim){"use strict";_Accents.createAccentRule("html.win-hoverable .win-autosuggestbox .win-autosuggestbox-suggestion-selected:hover",[{name:"background-color",value:_Accents.ColorTypes.listSelectHover}]),_Accents.createAccentRule(".win-autosuggestbox .win-autosuggestbox-suggestion-selected",[{name:"background-color",value:_Accents.ColorTypes.listSelectRest}]),_Accents.createAccentRule(".win-autosuggestbox .win-autosuggestbox-suggestion-selected.win-autosuggestbox-suggestion-selected:hover:active",[{name:"background-color",value:_Accents.ColorTypes.listSelectPress}]);var ClassNames={asb:"win-autosuggestbox",asbDisabled:"win-autosuggestbox-disabled",asbFlyout:"win-autosuggestbox-flyout",asbFlyoutAbove:"win-autosuggestbox-flyout-above",asbBoxFlyoutHighlightText:"win-autosuggestbox-flyout-highlighttext",asbHitHighlightSpan:"win-autosuggestbox-hithighlight-span",asbInput:"win-autosuggestbox-input",asbInputFocus:"win-autosuggestbox-input-focus",asbSuggestionQuery:"win-autosuggestbox-suggestion-query",asbSuggestionResult:"win-autosuggestbox-suggestion-result",asbSuggestionResultText:"win-autosuggestbox-suggestion-result-text",asbSuggestionResultDetailedText:"win-autosuggestbox-suggestion-result-detailed-text",asbSuggestionSelected:"win-autosuggestbox-suggestion-selected",asbSuggestionSeparator:"win-autosuggestbox-suggestion-separator"};_Base.Namespace._moduleDefine(exports,"WinJS.UI",{AutoSuggestBox:_Base.Namespace._lazy(function(){function addHitHighlightedText(element,item,text,hitFinder){function addNewSpan(element,textContent,insertBefore){var spanElement=_Global.document.createElement("span");return spanElement.textContent=textContent,spanElement.setAttribute("aria-hidden","true"),spanElement.classList.add(ClassNames.asbHitHighlightSpan),element.insertBefore(spanElement,insertBefore),spanElement}if(text){_ElementListUtilities.query("."+ClassNames.asbHitHighlightSpan,element).forEach(function(childElement){childElement.parentNode.removeChild(childElement)});var firstChild=element.firstChild,hitsProvided=item.hits;!hitsProvided&&hitFinder&&item.kind!==_SuggestionManagerShim._SearchSuggestionKind.Separator&&(hitsProvided=hitFinder.find(text));for(var hits=AutoSuggestBox._sortAndMergeHits(hitsProvided),lastPosition=0,i=0;i<hits.length;i++){var hit=hits[i];addNewSpan(element,text.substring(lastPosition,hit.startPosition),firstChild),lastPosition=hit.startPosition+hit.length;var spanHitHighlightedText=addNewSpan(element,text.substring(hit.startPosition,lastPosition),firstChild);_ElementUtilities.addClass(spanHitHighlightedText,ClassNames.asbBoxFlyoutHighlightText)}lastPosition<text.length&&addNewSpan(element,text.substring(lastPosition),firstChild)}}function getKeyModifiers(ev){var VirtualKeys={ctrlKey:1,altKey:2,shiftKey:4},keyModifiers=0;return ev.ctrlKey&&(keyModifiers|=VirtualKeys.ctrlKey),ev.altKey&&(keyModifiers|=VirtualKeys.altKey),ev.shiftKey&&(keyModifiers|=VirtualKeys.shiftKey),keyModifiers}function resultSuggestionRenderer(asb,item){function handleInvoke(e){asb._internalFocusMove=!0,asb._inputElement.focus(),asb._processSuggestionChosen(item,e)}var root=_Global.document.createElement("div"),image=new _Global.Image;image.style.opacity=0;var loadImage=function(url){function onload(){image.removeEventListener("load",onload,!1),Animations.fadeIn(image)}image.addEventListener("load",onload,!1),image.src=url};null!==item.image?item.image.openReadAsync().then(function(streamWithContentType){null!==streamWithContentType&&loadImage(_Global.URL.createObjectURL(streamWithContentType,{oneTimeOnly:!0}))}):null!==item.imageUrl&&loadImage(item.imageUrl),image.setAttribute("aria-hidden","true"),root.appendChild(image);var divElement=_Global.document.createElement("div");_ElementUtilities.addClass(divElement,ClassNames.asbSuggestionResultText),addHitHighlightedText(divElement,item,item.text),divElement.title=item.text,divElement.setAttribute("aria-hidden","true"),root.appendChild(divElement);var brElement=_Global.document.createElement("br");divElement.appendChild(brElement);var divDetailElement=_Global.document.createElement("span");_ElementUtilities.addClass(divDetailElement,ClassNames.asbSuggestionResultDetailedText),addHitHighlightedText(divDetailElement,item,item.detailText),divDetailElement.title=item.detailText,divDetailElement.setAttribute("aria-hidden","true"),divElement.appendChild(divDetailElement),_ElementUtilities.addClass(root,ClassNames.asbSuggestionResult),_ElementUtilities._addEventListener(root,"click",function(e){asb._isFlyoutPointerDown||handleInvoke(e)}),_ElementUtilities._addEventListener(root,"pointerup",handleInvoke),root.setAttribute("role","option");var ariaLabel=_Resources._formatString(Strings.ariaLabelResult,item.text,item.detailText);return root.setAttribute("aria-label",ariaLabel),root}function querySuggestionRenderer(asb,item){function handleInvoke(e){asb._internalFocusMove=!0,asb._inputElement.focus(),asb._processSuggestionChosen(item,e)}var root=_Global.document.createElement("div");addHitHighlightedText(root,item,item.text),root.title=item.text,root.classList.add(ClassNames.asbSuggestionQuery),_ElementUtilities._addEventListener(root,"click",function(e){asb._isFlyoutPointerDown||handleInvoke(e)}),_ElementUtilities._addEventListener(root,"pointerup",handleInvoke);var ariaLabel=_Resources._formatString(Strings.ariaLabelQuery,item.text);return root.setAttribute("role","option"),root.setAttribute("aria-label",ariaLabel),root}function separatorSuggestionRenderer(item){var root=_Global.document.createElement("div");if(item.text.length>0){var textElement=_Global.document.createElement("div");textElement.textContent=item.text,textElement.title=item.text,textElement.setAttribute("aria-hidden","true"),root.appendChild(textElement)}root.insertAdjacentHTML("beforeend","<hr/>"),_ElementUtilities.addClass(root,ClassNames.asbSuggestionSeparator),root.setAttribute("role","separator");var ariaLabel=_Resources._formatString(Strings.ariaLabelSeparator,item.text);return root.setAttribute("aria-label",ariaLabel),root}var Key=_ElementUtilities.Key,EventNames={querychanged:"querychanged",querysubmitted:"querysubmitted",resultsuggestionchosen:"resultsuggestionchosen",suggestionsrequested:"suggestionsrequested"},Strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get invalidSuggestionKind(){return"Error: Invalid suggestion kind."},get ariaLabel(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelInputPlaceHolder").value},get ariaLabelQuery(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelQuery").value},get ariaLabelResult(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelResult").value},get ariaLabelSeparator(){return _Resources._getWinJSString("ui/autoSuggestBoxAriaLabelSeparator").value}},AutoSuggestBox=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("div"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.AutoSuggestBox.DuplicateConstruction",Strings.duplicateConstruction);this._suggestionsChangedHandler=this._suggestionsChangedHandler.bind(this),this._suggestionsRequestedHandler=this._suggestionsRequestedHandler.bind(this),this._element=element,element.winControl=this,element.classList.add(ClassNames.asb),element.classList.add("win-disposable"),this._setupDOM(),this._setupSSM(),this._chooseSuggestionOnEnter=!1,this._currentFocusedIndex=-1,this._currentSelectedIndex=-1,this._flyoutOpenPromise=Promise.wrap(),this._lastKeyPressLanguage="",this._prevLinguisticDetails=this._getLinguisticDetails(),this._prevQueryText="",_Control.setOptions(this,options),this._hideFlyout()},{onresultsuggestionchosen:_Events._createEventProperty(EventNames.resultsuggestionchosen),onquerychanged:_Events._createEventProperty(EventNames.querychanged),onquerysubmitted:_Events._createEventProperty(EventNames.querysubmitted),onsuggestionsrequested:_Events._createEventProperty(EventNames.suggestionsrequested),element:{get:function(){return this._element}},chooseSuggestionOnEnter:{get:function(){return this._chooseSuggestionOnEnter},set:function(value){this._chooseSuggestionOnEnter=!!value}},disabled:{get:function(){return this._inputElement.disabled},set:function(value){this._inputElement.disabled!==!!value&&(value?this._disableControl():this._enableControl())}},placeholderText:{get:function(){return this._inputElement.placeholder},set:function(value){this._inputElement.placeholder=value,this._updateInputElementAriaLabel()}},queryText:{get:function(){return this._inputElement.value},set:function(value){this._inputElement.value="",this._inputElement.value=value}},searchHistoryDisabled:{get:function(){return!this._suggestionManager.searchHistoryEnabled},set:function(value){this._suggestionManager.searchHistoryEnabled=!value}},searchHistoryContext:{get:function(){return this._suggestionManager.searchHistoryContext},set:function(value){this._suggestionManager.searchHistoryContext=value}},dispose:function(){this._disposed||(this._flyoutOpenPromise.cancel(),this._suggestions.removeEventListener("vectorchanged",this._suggestionsChangedHandler),this._suggestionManager.removeEventListener("suggestionsrequested",this._suggestionsRequestedHandler),this._suggestionManager=null,this._suggestions=null,this._hitFinder=null,this._disposed=!0)},setLocalContentSuggestionSettings:function(settings){this._suggestionManager.setLocalContentSuggestionSettings(settings)},_setupDOM:function(){function repeaterTemplate(suggestion){return that._renderSuggestion(suggestion)}var flyoutPointerReleasedHandler=this._flyoutPointerReleasedHandler.bind(this),inputOrImeChangeHandler=this._inputOrImeChangeHandler.bind(this);this._element.getAttribute("aria-label")||this._element.setAttribute("aria-label",Strings.ariaLabel),this._element.setAttribute("role","group"),this._inputElement=_Global.document.createElement("input"),this._inputElement.autocorrect="off",this._inputElement.type="search",this._inputElement.classList.add(ClassNames.asbInput),this._inputElement.classList.add("win-textbox"),this._inputElement.setAttribute("role","textbox"),this._inputElement.addEventListener("keydown",this._keyDownHandler.bind(this)),this._inputElement.addEventListener("keypress",this._keyPressHandler.bind(this)),this._inputElement.addEventListener("keyup",this._keyUpHandler.bind(this)),this._inputElement.addEventListener("focus",this._inputFocusHandler.bind(this)),this._inputElement.addEventListener("blur",this._inputBlurHandler.bind(this)),this._inputElement.addEventListener("input",inputOrImeChangeHandler),this._inputElement.addEventListener("compositionstart",inputOrImeChangeHandler),this._inputElement.addEventListener("compositionupdate",inputOrImeChangeHandler),this._inputElement.addEventListener("compositionend",inputOrImeChangeHandler),_ElementUtilities._addEventListener(this._inputElement,"pointerdown",this._inputPointerDownHandler.bind(this)),this._updateInputElementAriaLabel(),this._element.appendChild(this._inputElement);var context=this._tryGetInputContext();context&&(context.addEventListener("MSCandidateWindowShow",this._msCandidateWindowShowHandler.bind(this)),context.addEventListener("MSCandidateWindowHide",this._msCandidateWindowHideHandler.bind(this))),this._flyoutElement=_Global.document.createElement("div"),this._flyoutElement.classList.add(ClassNames.asbFlyout),this._flyoutElement.addEventListener("blur",this._flyoutBlurHandler.bind(this)),_ElementUtilities._addEventListener(this._flyoutElement,"pointerup",flyoutPointerReleasedHandler),_ElementUtilities._addEventListener(this._flyoutElement,"pointercancel",flyoutPointerReleasedHandler),_ElementUtilities._addEventListener(this._flyoutElement,"pointerout",flyoutPointerReleasedHandler),_ElementUtilities._addEventListener(this._flyoutElement,"pointerdown",this._flyoutPointerDownHandler.bind(this)),this._element.appendChild(this._flyoutElement);var that=this;this._suggestionsData=new BindingList.List,this._repeaterElement=_Global.document.createElement("div"),this._repeater=new Repeater.Repeater(this._repeaterElement,{data:this._suggestionsData,template:repeaterTemplate}),_ElementUtilities._ensureId(this._repeaterElement),this._repeaterElement.setAttribute("role","listbox"),this._repeaterElement.setAttribute("aria-live","polite"),this._flyoutElement.appendChild(this._repeaterElement)},_setupSSM:function(){this._suggestionManager=new _SuggestionManagerShim._SearchSuggestionManagerShim,this._suggestions=this._suggestionManager.suggestions,this._suggestions.addEventListener("vectorchanged",this._suggestionsChangedHandler),this._suggestionManager.addEventListener("suggestionsrequested",this._suggestionsRequestedHandler)},_hideFlyout:function(){this._isFlyoutShown()&&(this._flyoutElement.style.display="none")},_showFlyout:function(){var prevNumSuggestions=this._prevNumSuggestions||0;if(this._prevNumSuggestions=this._suggestionsData.length,(!this._isFlyoutShown()||prevNumSuggestions!==this._suggestionsData.length)&&0!==this._suggestionsData.length){this._flyoutElement.style.display="block";var inputRect=this._inputElement.getBoundingClientRect(),flyoutRect=this._flyoutElement.getBoundingClientRect(),documentClientWidth=_Global.document.documentElement.clientWidth,spaceAbove=inputRect.top,spaceBelow=_Global.document.documentElement.clientHeight-inputRect.bottom;this._flyoutBelowInput=spaceBelow>=spaceAbove,this._flyoutBelowInput?(this._flyoutElement.classList.remove(ClassNames.asbFlyoutAbove),this._flyoutElement.scrollTop=0):(this._flyoutElement.classList.add(ClassNames.asbFlyoutAbove),this._flyoutElement.scrollTop=this._flyoutElement.scrollHeight-this._flyoutElement.clientHeight),this._addFlyoutIMEPaddingIfRequired();var alignRight;alignRight="rtl"===_ElementUtilities._getComputedStyle(this._flyoutElement).direction?inputRect.right-flyoutRect.width>=0||inputRect.left+flyoutRect.width>documentClientWidth:inputRect.left+flyoutRect.width>documentClientWidth&&inputRect.right-flyoutRect.width>=0,alignRight?this._flyoutElement.style.left=inputRect.width-flyoutRect.width-this._element.clientLeft+"px":this._flyoutElement.style.left="-"+this._element.clientLeft+"px",this._flyoutElement.style.touchAction=this._flyoutElement.scrollHeight>flyoutRect.height?"pan-y":"none",this._flyoutOpenPromise.cancel();var animationKeyframe=this._flyoutBelowInput?"WinJS-flyoutBelowASB-showPopup":"WinJS-flyoutAboveASB-showPopup";this._flyoutOpenPromise=Animations.showPopup(this._flyoutElement,{top:"0px",left:"0px",keyframe:animationKeyframe})}},_addFlyoutIMEPaddingIfRequired:function(){var context=this._tryGetInputContext();if(context&&this._isFlyoutShown()&&this._flyoutBelowInput){var flyoutRect=this._flyoutElement.getBoundingClientRect(),imeRect=context.getCandidateWindowClientRect(),inputRect=this._inputElement.getBoundingClientRect(),flyoutTop=inputRect.bottom,flyoutBottom=inputRect.bottom+flyoutRect.height;if(!(imeRect.top>flyoutBottom||imeRect.bottom<flyoutTop)){var animation=Animations.createRepositionAnimation(this._flyoutElement);imeRect.width<.45*inputRect.width?this._flyoutElement.style.marginLeft=imeRect.width+"px":this._flyoutElement.style.marginTop=imeRect.bottom-imeRect.top+4+"px",animation.execute()}}},_findNextSuggestionElementIndex:function(curIndex){for(var startIndex=curIndex<0?0:curIndex+1,i=startIndex;i<this._suggestionsData.length;i++)if(this._repeater.elementFromIndex(i)&&this._isSuggestionSelectable(this._suggestionsData.getAt(i)))return i;return-1},_findPreviousSuggestionElementIndex:function(curIndex){for(var startIndex=curIndex>=this._suggestionsData.length?this._suggestionsData.length-1:curIndex-1,i=startIndex;i>=0;i--)if(this._repeater.elementFromIndex(i)&&this._isSuggestionSelectable(this._suggestionsData.getAt(i)))return i;return-1},_isFlyoutShown:function(){return"none"!==this._flyoutElement.style.display},_isSuggestionSelectable:function(suggestion){return suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Query||suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Result},_processSuggestionChosen:function(item,event){this.queryText=item.text,item.kind===_SuggestionManagerShim._SearchSuggestionKind.Query?this._submitQuery(item.text,!1,event):item.kind===_SuggestionManagerShim._SearchSuggestionKind.Result&&this._fireEvent(EventNames.resultsuggestionchosen,{tag:item.tag,keyModifiers:getKeyModifiers(event),storageFile:null}),this._hideFlyout()},_selectSuggestionAtIndex:function(indexToSelect){function scrollToView(targetElement){var popupHeight=that._flyoutElement.getBoundingClientRect().bottom-that._flyoutElement.getBoundingClientRect().top;if(targetElement.offsetTop+targetElement.offsetHeight>that._flyoutElement.scrollTop+popupHeight){var scrollDifference=targetElement.offsetTop+targetElement.offsetHeight-(that._flyoutElement.scrollTop+popupHeight);_ElementUtilities._zoomTo(that._flyoutElement,{contentX:0,contentY:that._flyoutElement.scrollTop+scrollDifference,viewportX:0,viewportY:0})}else targetElement.offsetTop<that._flyoutElement.scrollTop&&_ElementUtilities._zoomTo(that._flyoutElement,{contentX:0,contentY:targetElement.offsetTop,viewportX:0,viewportY:0})}for(var that=this,curElement=null,i=0;i<this._suggestionsData.length;i++)curElement=this._repeater.elementFromIndex(i),i!==indexToSelect?(curElement.classList.remove(ClassNames.asbSuggestionSelected),curElement.setAttribute("aria-selected","false")):(curElement.classList.add(ClassNames.asbSuggestionSelected),scrollToView(curElement),curElement.setAttribute("aria-selected","true"));this._currentSelectedIndex=indexToSelect,curElement?this._inputElement.setAttribute("aria-activedescendant",this._repeaterElement.id+indexToSelect):this._inputElement.hasAttribute("aria-activedescendant")&&this._inputElement.removeAttribute("aria-activedescendant")},_updateFakeFocus:function(){var firstElementIndex;firstElementIndex=this._isFlyoutShown()&&this._chooseSuggestionOnEnter?this._findNextSuggestionElementIndex(-1):-1,this._selectSuggestionAtIndex(firstElementIndex)},_updateQueryTextWithSuggestionText:function(suggestionIndex){suggestionIndex>=0&&suggestionIndex<this._suggestionsData.length&&(this.queryText=this._suggestionsData.getAt(suggestionIndex).text)},_disableControl:function(){this._isFlyoutShown()&&this._hideFlyout(),this._element.disabled=!0,this._element.classList.add(ClassNames.asbDisabled),this._inputElement.disabled=!0},_enableControl:function(){this._element.disabled=!1,this._element.classList.remove(ClassNames.asbDisabled),this._inputElement.disabled=!1,_Global.document.activeElement===this._element&&_ElementUtilities._setActive(this._inputElement)},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");return event.initCustomEvent(type,!0,!0,detail),this._element.dispatchEvent(event)},_getLinguisticDetails:function(useCache,createFilled){function createQueryLinguisticDetails(compositionAlternatives,compositionStartOffset,compositionLength,queryTextPrefix,queryTextSuffix){for(var linguisticDetails=null,fullCompositionAlternatives=[],i=0;i<compositionAlternatives.length;i++)fullCompositionAlternatives[i]=queryTextPrefix+compositionAlternatives[i]+queryTextSuffix;if(_WinRT.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails)try{linguisticDetails=new _WinRT.Windows.ApplicationModel.Search.SearchQueryLinguisticDetails(fullCompositionAlternatives,compositionStartOffset,compositionLength)}catch(e){}return linguisticDetails||(linguisticDetails={queryTextAlternatives:fullCompositionAlternatives,queryTextCompositionStart:compositionStartOffset,queryTextCompositionLength:compositionLength}),linguisticDetails}var linguisticDetails=null;if(this._inputElement.value===this._prevQueryText&&useCache&&this._prevLinguisticDetails&&createFilled)linguisticDetails=this._prevLinguisticDetails;else{var compositionAlternatives=[],compositionStartOffset=0,compositionLength=0,queryTextPrefix="",queryTextSuffix="";if(createFilled){var context=this._tryGetInputContext();context&&context.getCompositionAlternatives&&(compositionAlternatives=context.getCompositionAlternatives(),compositionStartOffset=context.compositionStartOffset,compositionLength=context.compositionEndOffset-context.compositionStartOffset,this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||compositionLength>0?(queryTextPrefix=this._inputElement.value.substring(0,compositionStartOffset),queryTextSuffix=this._inputElement.value.substring(compositionStartOffset+compositionLength)):(queryTextPrefix=this._inputElement.value.substring(0,this._prevCompositionStart),queryTextSuffix=this._inputElement.value.substring(this._prevCompositionStart+this._prevCompositionLength)))}linguisticDetails=createQueryLinguisticDetails(compositionAlternatives,compositionStartOffset,compositionLength,queryTextPrefix,queryTextSuffix)}return linguisticDetails},_isElementInSearchControl:function(targetElement){return this.element.contains(targetElement)||this.element===targetElement},_renderSuggestion:function(suggestion){var root=null;if(!suggestion)return root;if(suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Query)root=querySuggestionRenderer(this,suggestion);else if(suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Separator)root=separatorSuggestionRenderer(suggestion);else{if(suggestion.kind!==_SuggestionManagerShim._SearchSuggestionKind.Result)throw new _ErrorFromName("WinJS.UI.AutoSuggestBox.invalidSuggestionKind",Strings.invalidSuggestionKind);root=resultSuggestionRenderer(this,suggestion)}return root},_shouldIgnoreInput:function(){var processingIMEFocusLossKey=this._isProcessingDownKey||this._isProcessingUpKey||this._isProcessingTabKey||this._isProcessingEnterKey;return processingIMEFocusLossKey||this._isFlyoutPointerDown},_submitQuery:function(queryText,fillLinguisticDetails,event){this._disposed||(_WinRT.Windows.Globalization.Language&&(this._lastKeyPressLanguage=_WinRT.Windows.Globalization.Language.currentInputMethodLanguageTag),this._fireEvent(EventNames.querysubmitted,{language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,fillLinguisticDetails),queryText:queryText,keyModifiers:getKeyModifiers(event)}),this._suggestionManager&&this._suggestionManager.addToHistory(this._inputElement.value,this._lastKeyPressLanguage))},_tryGetInputContext:function(){if(this._inputElement.msGetInputContext)try{return this._inputElement.msGetInputContext()}catch(e){return null}return null},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?_Resources._formatString(Strings.ariaLabelInputPlaceHolder,this._inputElement.placeholder):Strings.ariaLabelInputNoPlaceHolder)},_flyoutBlurHandler:function(event){this._isElementInSearchControl(_Global.document.activeElement)?this._internalFocusMove=!0:(this._element.classList.remove(ClassNames.asbInputFocus),this._hideFlyout())},_flyoutPointerDownHandler:function(ev){function findSuggestionElementIndex(){if(srcElement)for(var i=0;i<that._suggestionsData.length;i++)if(that._repeater.elementFromIndex(i)===srcElement)return i;return-1}var that=this,srcElement=ev.target;for(this._isFlyoutPointerDown=!0;srcElement&&srcElement.parentNode!==this._repeaterElement;)srcElement=srcElement.parentNode;var index=findSuggestionElementIndex();index>=0&&index<this._suggestionsData.length&&this._currentFocusedIndex!==index&&this._isSuggestionSelectable(this._suggestionsData.getAt(index))&&(this._currentFocusedIndex=index,this._selectSuggestionAtIndex(index),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)),ev.preventDefault()},_flyoutPointerReleasedHandler:function(){if(this._isFlyoutPointerDown=!1,this._reflowImeOnPointerRelease){this._reflowImeOnPointerRelease=!1;var animation=Animations.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="",this._flyoutElement.style.marginLeft="",animation.execute()}},_inputBlurHandler:function(event){this._isElementInSearchControl(_Global.document.activeElement)||(this._element.classList.remove(ClassNames.asbInputFocus),this._hideFlyout()),this.queryText=this._prevQueryText,this._isProcessingDownKey=!1,this._isProcessingUpKey=!1,this._isProcessingTabKey=!1,this._isProcessingEnterKey=!1},_inputFocusHandler:function(event){this._inputElement.value!==this._prevQueryText&&_WinRT.Windows.Data.Text.SemanticTextQuery&&(""!==this._inputElement.value?this._hitFinder=new _WinRT.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._inputElement.lang):this._hitFinder=null),event.target!==this._inputElement||this._internalFocusMove||(this._showFlyout(),this._currentFocusedIndex!==-1?this._selectSuggestionAtIndex(this._currentFocusedIndex):this._updateFakeFocus(),this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,this._getLinguisticDetails(!0,!0))),this._internalFocusMove=!1,this._element.classList.add(ClassNames.asbInputFocus)},_inputOrImeChangeHandler:function(){function hasLinguisticDetailsChanged(newLinguisticDetails){var hasLinguisticDetailsChanged=!1;return that._prevLinguisticDetails.queryTextCompositionStart===newLinguisticDetails.queryTextCompositionStart&&that._prevLinguisticDetails.queryTextCompositionLength===newLinguisticDetails.queryTextCompositionLength&&that._prevLinguisticDetails.queryTextAlternatives.length===newLinguisticDetails.queryTextAlternatives.length||(hasLinguisticDetailsChanged=!0),that._prevLinguisticDetails=newLinguisticDetails,hasLinguisticDetailsChanged}var that=this;if(!this._shouldIgnoreInput()){var linguisticDetails=this._getLinguisticDetails(!1,!0),hasLinguisticDetailsChanged=hasLinguisticDetailsChanged(linguisticDetails);if((this._inputElement.value!==this._prevQueryText||0===this._prevCompositionLength||linguisticDetails.queryTextCompositionLength>0)&&(this._prevCompositionStart=linguisticDetails.queryTextCompositionStart,this._prevCompositionLength=linguisticDetails.queryTextCompositionLength),this._prevQueryText===this._inputElement.value&&!hasLinguisticDetailsChanged)return;this._prevQueryText=this._inputElement.value,_WinRT.Windows.Globalization.Language&&(this._lastKeyPressLanguage=_WinRT.Windows.Globalization.Language.currentInputMethodLanguageTag),_WinRT.Windows.Data.Text.SemanticTextQuery&&(""!==this._inputElement.value?this._hitFinder=new _WinRT.Windows.Data.Text.SemanticTextQuery(this._inputElement.value,this._lastKeyPressLanguage):this._hitFinder=null),this._fireEvent(EventNames.querychanged,{language:this._lastKeyPressLanguage,queryText:this._inputElement.value,linguisticDetails:linguisticDetails}),this._suggestionManager.setQuery(this._inputElement.value,this._lastKeyPressLanguage,linguisticDetails)}},_inputPointerDownHandler:function(){_Global.document.activeElement===this._inputElement&&this._currentSelectedIndex!==-1&&(this._currentFocusedIndex=-1,this._selectSuggestionAtIndex(this._currentFocusedIndex))},_keyDownHandler:function(event){function setSelection(index){that._currentFocusedIndex=index,that._selectSuggestionAtIndex(index),event.preventDefault(),event.stopPropagation()}var that=this;if(this._lastKeyPressLanguage=event.locale,event.keyCode===Key.tab?this._isProcessingTabKey=!0:event.keyCode===Key.upArrow?this._isProcessingUpKey=!0:event.keyCode===Key.downArrow?this._isProcessingDownKey=!0:event.keyCode===Key.enter&&"ko"===event.locale&&(this._isProcessingEnterKey=!0),event.keyCode!==Key.IME)if(event.keyCode===Key.tab){var closeFlyout=!0;event.shiftKey?this._currentFocusedIndex!==-1&&(setSelection(-1),closeFlyout=!1):this._currentFocusedIndex===-1&&(this._currentFocusedIndex=this._flyoutBelowInput?this._findNextSuggestionElementIndex(this._currentFocusedIndex):this._findPreviousSuggestionElementIndex(this._suggestionsData.length),this._currentFocusedIndex!==-1&&(setSelection(this._currentFocusedIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex),closeFlyout=!1)),closeFlyout&&this._hideFlyout()}else if(event.keyCode===Key.escape)this._currentFocusedIndex!==-1?(this.queryText=this._prevQueryText,setSelection(-1)):""!==this.queryText&&(this.queryText="",this._inputOrImeChangeHandler(null),event.preventDefault(),event.stopPropagation());else if(this._flyoutBelowInput&&event.keyCode===Key.upArrow||!this._flyoutBelowInput&&event.keyCode===Key.downArrow){var prevIndex;this._currentSelectedIndex!==-1?(prevIndex=this._findPreviousSuggestionElementIndex(this._currentSelectedIndex),prevIndex===-1&&(this.queryText=this._prevQueryText)):prevIndex=this._findPreviousSuggestionElementIndex(this._suggestionsData.length),setSelection(prevIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)}else if(this._flyoutBelowInput&&event.keyCode===Key.downArrow||!this._flyoutBelowInput&&event.keyCode===Key.upArrow){var nextIndex=this._findNextSuggestionElementIndex(this._currentSelectedIndex);this._currentSelectedIndex!==-1&&nextIndex===-1&&(this.queryText=this._prevQueryText),setSelection(nextIndex),this._updateQueryTextWithSuggestionText(this._currentFocusedIndex)}else event.keyCode===Key.enter&&(this._currentSelectedIndex===-1?this._submitQuery(this._inputElement.value,!0,event):this._processSuggestionChosen(this._suggestionsData.getAt(this._currentSelectedIndex),event),this._hideFlyout())},_keyUpHandler:function(event){event.keyCode===Key.tab?this._isProcessingTabKey=!1:event.keyCode===Key.upArrow?this._isProcessingUpKey=!1:event.keyCode===Key.downArrow?this._isProcessingDownKey=!1:event.keyCode===Key.enter&&(this._isProcessingEnterKey=!1)},_keyPressHandler:function(event){this._lastKeyPressLanguage=event.locale},_msCandidateWindowHideHandler:function(){if(this._isFlyoutPointerDown)this._reflowImeOnPointerRelease=!0;else{var animation=Animations.createRepositionAnimation(this._flyoutElement);this._flyoutElement.style.marginTop="",this._flyoutElement.style.marginLeft="",animation.execute()}},_msCandidateWindowShowHandler:function(){this._addFlyoutIMEPaddingIfRequired(),this._reflowImeOnPointerRelease=!1},_suggestionsChangedHandler:function(event){
var collectionChange=event.collectionChange||event.detail.collectionChange,changeIndex=+event.index===event.index?event.index:event.detail.index,ChangeEnum=_SuggestionManagerShim._CollectionChange;if(collectionChange===ChangeEnum.reset)this._isFlyoutShown()&&this._hideFlyout(),this._suggestionsData.splice(0,this._suggestionsData.length);else if(collectionChange===ChangeEnum.itemInserted){var suggestion=this._suggestions[changeIndex];this._suggestionsData.splice(changeIndex,0,suggestion),this._showFlyout()}else if(collectionChange===ChangeEnum.itemRemoved)1===this._suggestionsData.length&&(_ElementUtilities._setActive(this._inputElement),this._hideFlyout()),this._suggestionsData.splice(changeIndex,1);else if(collectionChange===ChangeEnum.itemChanged){var suggestion=this._suggestions[changeIndex];if(suggestion!==this._suggestionsData.getAt(changeIndex))this._suggestionsData.setAt(changeIndex,suggestion);else{var existingElement=this._repeater.elementFromIndex(changeIndex);if(_ElementUtilities.hasClass(existingElement,ClassNames.asbSuggestionQuery))addHitHighlightedText(existingElement,suggestion,suggestion.text);else{var resultSuggestionDiv=existingElement.querySelector("."+ClassNames.asbSuggestionResultText);if(resultSuggestionDiv){addHitHighlightedText(resultSuggestionDiv,suggestion,suggestion.text);var resultSuggestionDetailDiv=existingElement.querySelector("."+ClassNames.asbSuggestionResultDetailedText);resultSuggestionDetailDiv&&addHitHighlightedText(resultSuggestionDetailDiv,suggestion,suggestion.detailText)}}}}_Global.document.activeElement===this._inputElement&&this._updateFakeFocus()},_suggestionsRequestedHandler:function(event){_WinRT.Windows.Globalization.Language&&(this._lastKeyPressLanguage=_WinRT.Windows.Globalization.Language.currentInputMethodLanguageTag);var deferral,request=event.request||event.detail.request;this._fireEvent(EventNames.suggestionsrequested,{setPromise:function(promise){deferral=request.getDeferral(),promise.then(function(){deferral.complete()})},searchSuggestionCollection:request.searchSuggestionCollection,language:this._lastKeyPressLanguage,linguisticDetails:this._getLinguisticDetails(!0,!0),queryText:this._inputElement.value})}},{createResultSuggestionImage:function(url){return _WinRT.Windows.Foundation.Uri&&_WinRT.Windows.Storage.Streams.RandomAccessStreamReference?_WinRT.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new _WinRT.Windows.Foundation.Uri(url)):url},_EventNames:EventNames,_sortAndMergeHits:function(hitsProvided){function hitStartPositionAscendingSorter(firstHit,secondHit){var returnValue=0;return firstHit.startPosition<secondHit.startPosition?returnValue=-1:firstHit.startPosition>secondHit.startPosition&&(returnValue=1),returnValue}function hitIntersectionReducer(reducedHits,nextHit,currentIndex){if(0===currentIndex)reducedHits.push(nextHit);else{var curHit=reducedHits[reducedHits.length-1],curHitEndPosition=curHit.startPosition+curHit.length;if(nextHit.startPosition<=curHitEndPosition){var nextHitEndPosition=nextHit.startPosition+nextHit.length;nextHitEndPosition>curHitEndPosition&&(curHit.length=nextHitEndPosition-curHit.startPosition)}else reducedHits.push(nextHit)}return reducedHits}var reducedHits=[];if(hitsProvided){for(var hits=new Array(hitsProvided.length),i=0;i<hitsProvided.length;i++)hits.push({startPosition:hitsProvided[i].startPosition,length:hitsProvided[i].length});hits.sort(hitStartPositionAscendingSorter),hits.reduce(hitIntersectionReducer,reducedHits)}return reducedHits}});return _Base.Class.mix(AutoSuggestBox,_Control.DOMEventMixin),AutoSuggestBox})}),exports.ClassNames=ClassNames}),define("require-style!less/styles-searchbox",[],function(){}),define("require-style!less/colors-searchbox",[],function(){}),define("WinJS/Controls/SearchBox",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","./AutoSuggestBox","../_Accents","../Utilities/_Control","../Utilities/_ElementUtilities","./AutoSuggestBox/_SearchSuggestionManagerShim","../Application","require-style!less/styles-searchbox","require-style!less/colors-searchbox"],function(_Global,_WinRT,_Base,_ErrorFromName,_Events,_Resources,AutoSuggestBox,_Accents,_Control,_ElementUtilities,_SuggestionManagerShim,Application){"use strict";_Accents.createAccentRule("html.win-hoverable .win-searchbox-button:not(.win-searchbox-button-disabled):hover",[{name:"color",value:_Accents.ColorTypes.accent}]),_Accents.createAccentRule(".win-searchbox-button.win-searchbox-button:not(.win-searchbox-button-disabled):hover:active",[{name:"background-color",value:_Accents.ColorTypes.accent}]),_Base.Namespace.define("WinJS.UI",{SearchBox:_Base.Namespace._lazy(function(){var ClassName={searchBox:"win-searchbox",searchBoxDisabled:"win-searchbox-disabled",searchBoxInput:"win-searchbox-input",searchBoxInputFocus:"win-searchbox-input-focus",searchBoxButton:"win-searchbox-button",searchBoxFlyout:"win-searchbox-flyout",searchBoxFlyoutHighlightText:"win-searchbox-flyout-highlighttext",searchBoxHitHighlightSpan:"win-searchbox-hithighlight-span",searchBoxSuggestionResult:"win-searchbox-suggestion-result",searchBoxSuggestionResultText:"win-searchbox-suggestion-result-text",searchBoxSuggestionResultDetailedText:"win-searchbox-suggestion-result-detailed-text",searchBoxSuggestionSelected:"win-searchbox-suggestion-selected",searchBoxSuggestionQuery:"win-searchbox-suggestion-query",searchBoxSuggestionSeparator:"win-searchbox-suggestion-separator",searchBoxButtonInputFocus:"win-searchbox-button-input-focus",searchBoxButtonDisabled:"win-searchbox-button-disabled"},EventName={receivingfocusonkeyboardinput:"receivingfocusonkeyboardinput"},strings={get invalidSearchBoxSuggestionKind(){return"Error: Invalid search suggestion kind."},get ariaLabel(){return _Resources._getWinJSString("ui/searchBoxAriaLabel").value},get ariaLabelInputNoPlaceHolder(){return _Resources._getWinJSString("ui/searchBoxAriaLabelInputNoPlaceHolder").value},get ariaLabelInputPlaceHolder(){return _Resources._getWinJSString("ui/searchBoxAriaLabelInputPlaceHolder").value},get searchBoxDeprecated(){return"SearchBox is deprecated and may not be available in future releases. Instead use AutoSuggestBox."}},SearchBox=_Base.Class.derive(AutoSuggestBox.AutoSuggestBox,function(element,options){_ElementUtilities._deprecated(strings.searchBoxDeprecated),this._requestingFocusOnKeyboardInputHandlerBind=this._requestingFocusOnKeyboardInputHandler.bind(this),this._buttonElement=_Global.document.createElement("div"),this._focusOnKeyboardInput=!1,AutoSuggestBox.AutoSuggestBox.call(this,element,options),this.element.classList.add(ClassName.searchBox),this._flyoutElement.classList.add(ClassName.searchBoxFlyout),this._inputElement.classList.add(ClassName.searchBoxInput),this._inputElement.addEventListener("blur",this._searchboxInputBlurHandler.bind(this)),this._inputElement.addEventListener("focus",this._searchboxInputFocusHandler.bind(this)),this._buttonElement.tabIndex=-1,this._buttonElement.classList.add(ClassName.searchBoxButton),this._buttonElement.addEventListener("click",this._buttonClickHandler.bind(this)),_ElementUtilities._addEventListener(this._buttonElement,"pointerdown",this._buttonPointerDownHandler.bind(this)),this.element.appendChild(this._buttonElement)},{focusOnKeyboardInput:{get:function(){return this._focusOnKeyboardInput},set:function(value){this._focusOnKeyboardInput&&!value?Application._applicationListener.removeEventListener(this.element,"requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind):!this._focusOnKeyboardInput&&value&&Application._applicationListener.addEventListener(this.element,"requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind),this._focusOnKeyboardInput=!!value}},dispose:function(){this._disposed||(AutoSuggestBox.AutoSuggestBox.prototype.dispose.call(this),this._focusOnKeyboardInput&&Application._applicationListener.removeEventListener(this.element,"requestingfocusonkeyboardinput",this._requestingFocusOnKeyboardInputHandlerBind))},_disableControl:function(){AutoSuggestBox.AutoSuggestBox.prototype._disableControl.call(this),this._buttonElement.disabled=!0,this._buttonElement.classList.add(ClassName.searchBoxButtonDisabled),this.element.classList.add(ClassName.searchBoxDisabled)},_enableControl:function(){AutoSuggestBox.AutoSuggestBox.prototype._enableControl.call(this),this._buttonElement.disabled=!1,this._buttonElement.classList.remove(ClassName.searchBoxButtonDisabled),this.element.classList.remove(ClassName.searchBoxDisabled)},_renderSuggestion:function(suggestion){var render=AutoSuggestBox.AutoSuggestBox.prototype._renderSuggestion.call(this,suggestion);if(suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Query)render.classList.add(ClassName.searchBoxSuggestionQuery);else if(suggestion.kind===_SuggestionManagerShim._SearchSuggestionKind.Separator)render.classList.add(ClassName.searchBoxSuggestionSeparator);else{render.classList.add(ClassName.searchBoxSuggestionResult);var resultText=render.querySelector("."+AutoSuggestBox.ClassNames.asbSuggestionResultText);resultText.classList.add(ClassName.searchBoxSuggestionResultText);var resultDetailText=render.querySelector("."+AutoSuggestBox.ClassNames.asbSuggestionResultDetailedText);resultDetailText.classList.add(ClassName.searchBoxSuggestionResultDetailedText);for(var spans=render.querySelectorAll("."+AutoSuggestBox.ClassNames.asbHitHighlightSpan),i=0,len=spans.length;i<len;i++)spans[i].classList.add(ClassName.searchBoxHitHighlightSpan);for(var highlightTexts=render.querySelectorAll("."+AutoSuggestBox.ClassNames.asbBoxFlyoutHighlightText),i=0,len=highlightTexts.length;i<len;i++)highlightTexts[i].classList.add(ClassName.searchBoxFlyoutHighlightText)}return render},_selectSuggestionAtIndex:function(indexToSelect){AutoSuggestBox.AutoSuggestBox.prototype._selectSuggestionAtIndex.call(this,indexToSelect);var currentSelected=this.element.querySelector("."+ClassName.searchBoxSuggestionSelected);currentSelected&&currentSelected.classList.remove(ClassName.searchBoxSuggestionSelected);var newSelected=this.element.querySelector("."+AutoSuggestBox.ClassNames.asbSuggestionSelected);newSelected&&newSelected.classList.add(ClassName.searchBoxSuggestionSelected)},_shouldIgnoreInput:function(){var shouldIgnore=AutoSuggestBox.AutoSuggestBox.prototype._shouldIgnoreInput(),isButtonDown=_ElementUtilities._matchesSelector(this._buttonElement,":active");return shouldIgnore||isButtonDown},_updateInputElementAriaLabel:function(){this._inputElement.setAttribute("aria-label",this._inputElement.placeholder?_Resources._formatString(strings.ariaLabelInputPlaceHolder,this._inputElement.placeholder):strings.ariaLabelInputNoPlaceHolder)},_buttonPointerDownHandler:function(e){this._inputElement.focus(),e.preventDefault()},_buttonClickHandler:function(event){this._inputElement.focus(),this._submitQuery(this._inputElement.value,!0,event),this._hideFlyout()},_searchboxInputBlurHandler:function(){_ElementUtilities.removeClass(this.element,ClassName.searchBoxInputFocus),_ElementUtilities.removeClass(this._buttonElement,ClassName.searchBoxButtonInputFocus)},_searchboxInputFocusHandler:function(){_ElementUtilities.addClass(this.element,ClassName.searchBoxInputFocus),_ElementUtilities.addClass(this._buttonElement,ClassName.searchBoxButtonInputFocus)},_requestingFocusOnKeyboardInputHandler:function(){if(this._fireEvent(EventName.receivingfocusonkeyboardinput,null),_Global.document.activeElement!==this._inputElement)try{this._inputElement.focus()}catch(e){}}},{createResultSuggestionImage:function(url){return _ElementUtilities._deprecated(strings.searchBoxDeprecated),_WinRT.Windows.Foundation.Uri&&_WinRT.Windows.Storage.Streams.RandomAccessStreamReference?_WinRT.Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new _WinRT.Windows.Foundation.Uri(url)):url},_getKeyModifiers:function(ev){var VirtualKeys={ctrlKey:1,altKey:2,shiftKey:4},keyModifiers=0;return ev.ctrlKey&&(keyModifiers|=VirtualKeys.ctrlKey),ev.altKey&&(keyModifiers|=VirtualKeys.altKey),ev.shiftKey&&(keyModifiers|=VirtualKeys.shiftKey),keyModifiers},_isTypeToSearchKey:function(event){return!(event.shiftKey||event.ctrlKey||event.altKey)}});return _Base.Class.mix(SearchBox,_Control.DOMEventMixin),SearchBox})})}),define("WinJS/Controls/SettingsFlyout",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Events","../Core/_Resources","../Core/_WriteProfilerMark","../Animations","../Pages","../Promise","../_LightDismissService","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_ElementListUtilities","../Utilities/_Hoverable","./_LegacyAppBar/_Constants","./Flyout/_Overlay"],function(_Global,_WinRT,_Base,_BaseUtils,_ErrorFromName,_Events,_Resources,_WriteProfilerMark,Animations,Pages,Promise,_LightDismissService,_Dispose,_ElementUtilities,_ElementListUtilities,_Hoverable,_Constants,_Overlay){"use strict";_Base.Namespace.define("WinJS.UI",{SettingsFlyout:_Base.Namespace._lazy(function(){function _shouldAnimateFromLeft(){if(_WinRT.Windows.UI.ApplicationSettings.SettingsEdgeLocation){var appSettings=_WinRT.Windows.UI.ApplicationSettings;return appSettings.SettingsPane.edge===appSettings.SettingsEdgeLocation.left}return!1}function _getChildSettingsControl(parentElement,id){for(var retValue,control,settingElements=parentElement.querySelectorAll("."+_Constants.settingsFlyoutClass),i=0;i<settingElements.length;i++)if(control=settingElements[i].winControl){if(control.settingsCommandId===id){retValue=control;break}settingElements[i].id===id&&(retValue=retValue||control)}return retValue}var settingsPageIsFocusedOnce,Key=_ElementUtilities.Key,createEvent=_Events._createEventProperty,settingsNarrow="narrow",settingsWide="wide",SettingsFlyout=_Base.Class.derive(_Overlay._Overlay,function(element,options){_ElementUtilities._deprecated(strings.settingsFlyoutIsDeprecated),this._element=element||_Global.document.createElement("div"),this._id=this._element.id||_ElementUtilities._uniqueID(this._element),this._writeProfilerMark("constructor,StartTM"),this._baseOverlayConstructor(this._element,options),this._addFirstDiv(),this._addFinalDiv(),this._element.addEventListener("keydown",this._handleKeyDown,!0),this._element.style.visibilty="hidden",this._element.style.display="none",_ElementUtilities.addClass(this._element,_Constants.settingsFlyoutClass);var that=this;this._dismissable=new _LightDismissService.LightDismissableElement({element:this._element,tabIndex:this._element.hasAttribute("tabIndex")?this._element.tabIndex:-1,onLightDismiss:function(){that.hide()},onTakeFocus:function(useSetActive){if(!that._dismissable.restoreFocus()){var firstDiv=that.element.querySelector("."+_Constants.firstDivClass);firstDiv&&(firstDiv.msSettingsFlyoutFocusOut||(_ElementUtilities._addEventListener(firstDiv,"focusout",function(){settingsPageIsFocusedOnce=1},!1),firstDiv.msSettingsFlyoutFocusOut=!0),settingsPageIsFocusedOnce=0,_ElementUtilities._tryFocus(firstDiv,useSetActive))}}}),_ElementListUtilities.query("div.win-content",this._element).forEach(function(e){_ElementUtilities._matchesSelector(e,".win-ui-dark, .win-ui-dark *")||_ElementUtilities.addClass(e,_Constants.flyoutLightClass)});var role=this._element.getAttribute("role");null!==role&&""!==role&&void 0!==role||this._element.setAttribute("role","dialog");var label=this._element.getAttribute("aria-label");null!==label&&""!==label&&void 0!==label||this._element.setAttribute("aria-label",strings.ariaLabel),this._currentAnimateIn=this._animateSlideIn,this._currentAnimateOut=this._animateSlideOut,this._writeProfilerMark("constructor,StopTM")},{width:{get:function(){return this._width},set:function(value){_ElementUtilities._deprecated(strings.widthDeprecationMessage),value!==this._width&&(this._width===settingsNarrow?_ElementUtilities.removeClass(this._element,_Constants.narrowClass):this._width===settingsWide&&_ElementUtilities.removeClass(this._element,_Constants.wideClass),this._width=value,this._width===settingsNarrow?_ElementUtilities.addClass(this._element,_Constants.narrowClass):this._width===settingsWide&&_ElementUtilities.addClass(this._element,_Constants.wideClass))}},settingsCommandId:{get:function(){return this._settingsCommandId},set:function(value){this._settingsCommandId=value}},disabled:{get:function(){return!!this._element.disabled},set:function(value){value=!!value;var oldValue=!!this._element.disabled;oldValue!==value&&(this._element.disabled=value,!this.hidden&&this._element.disabled&&this._dismiss())}},onbeforeshow:createEvent(_Overlay._Overlay.beforeShow),onaftershow:createEvent(_Overlay._Overlay.afterShow),onbeforehide:createEvent(_Overlay._Overlay.beforeHide),onafterhide:createEvent(_Overlay._Overlay.afterHide),show:function(){this.disabled||(this._writeProfilerMark("show,StartTM"),this._show())},_dispose:function(){_LightDismissService.hidden(this._dismissable),_Dispose.disposeSubTree(this.element),this._dismiss()},_show:function(){if(this._baseShow()){if(!_ElementUtilities.hasClass(this.element.children[0],_Constants.firstDivClass)){var firstDiv=this.element.querySelectorAll("."+_Constants.firstDivClass);firstDiv&&firstDiv.length>0&&firstDiv.item(0).parentNode.removeChild(firstDiv.item(0)),this._addFirstDiv()}if(!_ElementUtilities.hasClass(this.element.children[this.element.children.length-1],_Constants.finalDivClass)){var finalDiv=this.element.querySelectorAll("."+_Constants.finalDivClass);finalDiv&&finalDiv.length>0&&finalDiv.item(0).parentNode.removeChild(finalDiv.item(0)),this._addFinalDiv()}this._setBackButtonsAriaLabel(),_LightDismissService.shown(this._dismissable)}},_setBackButtonsAriaLabel:function(){for(var label,backbuttons=this.element.querySelectorAll(".win-backbutton"),i=0;i<backbuttons.length;i++)label=backbuttons[i].getAttribute("aria-label"),null!==label&&""!==label&&void 0!==label||backbuttons[i].setAttribute("aria-label",strings.backbuttonAriaLabel)},hide:function(){this._writeProfilerMark("hide,StartTM"),this._hide()},_hide:function(){this._baseHide()},_beforeEndHide:function(){_LightDismissService.hidden(this._dismissable)},_animateSlideIn:function(){var animateFromLeft=_shouldAnimateFromLeft(),offset=animateFromLeft?"-100px":"100px";_ElementListUtilities.query("div.win-content",this._element).forEach(function(e){Animations.enterPage(e,{left:offset})});var where,width=this._element.offsetWidth;return animateFromLeft?(where={top:"0px",left:"-"+width+"px"},this._element.style.right="auto",this._element.style.left="0px"):(where={top:"0px",left:width+"px"},this._element.style.right="0px",this._element.style.left="auto"),this._element.style.opacity=1,this._element.style.visibility="visible",Animations.showPanel(this._element,where)},_animateSlideOut:function(){var where,width=this._element.offsetWidth;return _shouldAnimateFromLeft()?(where={top:"0px",left:width+"px"},this._element.style.right="auto",this._element.style.left="-"+width+"px"):(where={top:"0px",left:"-"+width+"px"},this._element.style.right="-"+width+"px",this._element.style.left="auto"),Animations.showPanel(this._element,where)},_fragmentDiv:{get:function(){return this._fragDiv},set:function(value){this._fragDiv=value}},_unloadPage:function(event){var settingsControl=event.currentTarget.winControl;settingsControl.removeEventListener(_Overlay._Overlay.afterHide,this._unloadPage,!1),Promise.as().then(function(){settingsControl._fragmentDiv&&(_Global.document.body.removeChild(settingsControl._fragmentDiv),settingsControl._fragmentDiv=null)})},_dismiss:function(){this.addEventListener(_Overlay._Overlay.afterHide,this._unloadPage,!1),this._hide()},_handleKeyDown:function(event){if(event.keyCode!==Key.space&&event.keyCode!==Key.enter||this.children[0]!==_Global.document.activeElement){if(event.shiftKey&&event.keyCode===Key.tab&&this.children[0]===_Global.document.activeElement){event.preventDefault(),event.stopPropagation();for(var _elms=this.getElementsByTagName("*"),i=_elms.length-2;i>=0&&(_elms[i].focus(),_elms[i]!==_Global.document.activeElement);i--);}}else event.preventDefault(),event.stopPropagation(),this.winControl._dismiss()},_focusOnLastFocusableElementFromParent:function(){var active=_Global.document.activeElement;if(settingsPageIsFocusedOnce&&active&&_ElementUtilities.hasClass(active,_Constants.firstDivClass)){var _elms=this.parentElement.getElementsByTagName("*");if(!(_elms.length<=2)){var i,_highestTabIndex=_elms[_elms.length-1].tabIndex;if(_highestTabIndex){for(i=_elms.length-2;i>0;i--)if(_elms[i].tabIndex===_highestTabIndex){_elms[i].focus();break}}else for(i=_elms.length-2;i>0&&("DIV"===_elms[i].tagName&&null===_elms[i].getAttribute("tabIndex")||(_elms[i].focus(),_elms[i]!==_Global.document.activeElement));i--);}}},_focusOnFirstFocusableElementFromParent:function(){var active=_Global.document.activeElement;if(active&&_ElementUtilities.hasClass(active,_Constants.finalDivClass)){var _elms=this.parentElement.getElementsByTagName("*");if(!(_elms.length<=2)){var i,_lowestTabIndex=_elms[0].tabIndex;if(_lowestTabIndex){for(i=1;i<_elms.length-1;i++)if(_elms[i].tabIndex===_lowestTabIndex){_elms[i].focus();break}}else for(i=1;i<_elms.length-1&&("DIV"===_elms[i].tagName&&null===_elms[i].getAttribute("tabIndex")||(_elms[i].focus(),_elms[i]!==_Global.document.activeElement));i++);}}},_addFirstDiv:function(){for(var _elms=this._element.getElementsByTagName("*"),_minTab=0,i=0;i<_elms.length;i++)0<_elms[i].tabIndex&&(0===_minTab||_elms[i].tabIndex<_minTab)&&(_minTab=_elms[i].tabIndex);var firstDiv=_Global.document.createElement("div");firstDiv.className=_Constants.firstDivClass,firstDiv.style.display="inline",firstDiv.setAttribute("role","menuitem"),firstDiv.setAttribute("aria-hidden","true"),firstDiv.tabIndex=_minTab,_ElementUtilities._addEventListener(firstDiv,"focusin",this._focusOnLastFocusableElementFromParent,!1),this._element.children[0]?this._element.insertBefore(firstDiv,this._element.children[0]):this._element.appendChild(firstDiv)},_addFinalDiv:function(){for(var _elms=this._element.getElementsByTagName("*"),_maxTab=0,i=0;i<_elms.length;i++)_elms[i].tabIndex>_maxTab&&(_maxTab=_elms[i].tabIndex);var finalDiv=_Global.document.createElement("div");finalDiv.className=_Constants.finalDivClass,finalDiv.style.display="inline",finalDiv.setAttribute("role","menuitem"),finalDiv.setAttribute("aria-hidden","true"),finalDiv.tabIndex=_maxTab,_ElementUtilities._addEventListener(finalDiv,"focusin",this._focusOnFirstFocusableElementFromParent,!1),this._element.appendChild(finalDiv)},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.SettingsFlyout:"+this._id+":"+text)}});SettingsFlyout.show=function(){_WinRT.Windows.UI.ApplicationSettings.SettingsPane&&_WinRT.Windows.UI.ApplicationSettings.SettingsPane.show();for(var elements=_Global.document.querySelectorAll('div[data-win-control="WinJS.UI.SettingsFlyout"]'),len=elements.length,i=0;i<len;i++){var settingsFlyout=elements[i].winControl;settingsFlyout&&settingsFlyout._dismiss()}};var _settingsEvent={event:void 0};SettingsFlyout.populateSettings=function(e){if(_settingsEvent.event=e.detail,_settingsEvent.event.applicationcommands){var n=_WinRT.Windows.UI.ApplicationSettings;Object.keys(_settingsEvent.event.applicationcommands).forEach(function(name){var setting=_settingsEvent.event.applicationcommands[name];setting.title||(setting.title=name);var command=new n.SettingsCommand(name,setting.title,SettingsFlyout._onSettingsCommand);_settingsEvent.event.e.request.applicationCommands.append(command)})}},SettingsFlyout._onSettingsCommand=function(command){var id=command.id;_settingsEvent.event.applicationcommands&&_settingsEvent.event.applicationcommands[id]&&SettingsFlyout.showSettings(id,_settingsEvent.event.applicationcommands[id].href)},SettingsFlyout.showSettings=function(id,path){var control=_getChildSettingsControl(_Global.document,id);if(control)control.show();else{if(!path)throw new _ErrorFromName("WinJS.UI.SettingsFlyout.BadReference",strings.badReference);var divElement=_Global.document.createElement("div");divElement=_Global.document.body.appendChild(divElement),Pages.render(path,divElement).then(function(){control=_getChildSettingsControl(divElement,id),control?(control._fragmentDiv=divElement,control.show()):_Global.document.body.removeChild(divElement)})}};var strings={get ariaLabel(){return _Resources._getWinJSString("ui/settingsFlyoutAriaLabel").value},get badReference(){return"Invalid argument: Invalid href to settings flyout fragment"},get backbuttonAriaLabel(){return _Resources._getWinJSString("ui/backbuttonarialabel").value},get widthDeprecationMessage(){return"SettingsFlyout.width may be altered or unavailable in future versions. Instead, style the CSS width property on elements with the .win-settingsflyout class."},get settingsFlyoutIsDeprecated(){return"SettingsFlyout is deprecated and may not be available in future releases. Instead, put settings on their own page within the app."}};return SettingsFlyout})})}),define("require-style!less/styles-splitviewcommand",[],function(){}),define("require-style!less/colors-splitviewcommand",[],function(){}),define("WinJS/Controls/SplitView/Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Core/_Events","../../ControlProcessor","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior","../AppBar/_Icon","require-style!less/styles-splitviewcommand","require-style!less/colors-splitviewcommand"],function(exports,_Global,_Base,_ErrorFromName,_Events,ControlProcessor,_Control,_ElementUtilities,_KeyboardBehavior,_Icon){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{_WinPressed:_Base.Namespace._lazy(function(){var WinPressed=_Base.Class.define(function(element){this._element=element,_ElementUtilities._addEventListener(this._element,"pointerdown",this._MSPointerDownButtonHandler.bind(this))},{_MSPointerDownButtonHandler:function(ev){this._pointerUpBound||(this._pointerUpBound=this._MSPointerUpHandler.bind(this),this._pointerCancelBound=this._MSPointerCancelHandler.bind(this),this._pointerOverBound=this._MSPointerOverHandler.bind(this),this._pointerOutBound=this._MSPointerOutHandler.bind(this)),ev.isPrimary&&(this._pointerId&&this._resetPointer(),_ElementUtilities._matchesSelector(ev.target,".win-interactive, .win-interactive *")||(this._pointerId=ev.pointerId,_ElementUtilities._addEventListener(_Global,"pointerup",this._pointerUpBound,!0),_ElementUtilities._addEventListener(_Global,"pointercancel",this._pointerCancelBound),!0,_ElementUtilities._addEventListener(this._element,"pointerover",this._pointerOverBound,!0),_ElementUtilities._addEventListener(this._element,"pointerout",this._pointerOutBound,!0),_ElementUtilities.addClass(this._element,WinPressed.winPressed)))},_MSPointerOverHandler:function(ev){this._pointerId===ev.pointerId&&_ElementUtilities.addClass(this._element,WinPressed.winPressed)},_MSPointerOutHandler:function(ev){this._pointerId===ev.pointerId&&_ElementUtilities.removeClass(this._element,WinPressed.winPressed)},_MSPointerCancelHandler:function(ev){this._pointerId===ev.pointerId&&this._resetPointer()},_MSPointerUpHandler:function(ev){this._pointerId===ev.pointerId&&this._resetPointer()},_resetPointer:function(){this._pointerId=null,_ElementUtilities._removeEventListener(_Global,"pointerup",this._pointerUpBound,!0),_ElementUtilities._removeEventListener(_Global,"pointercancel",this._pointerCancelBound,!0),_ElementUtilities._removeEventListener(this._element,"pointerover",this._pointerOverBound,!0),_ElementUtilities._removeEventListener(this._element,"pointerout",this._pointerOutBound,!0),_ElementUtilities.removeClass(this._element,WinPressed.winPressed)},dispose:function(){this._disposed||(this._disposed=!0,this._resetPointer())}},{winPressed:"win-pressed"});return WinPressed}),SplitViewCommand:_Base.Namespace._lazy(function(){var Key=_ElementUtilities.Key,strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},ClassNames={command:"win-splitviewcommand",commandButton:"win-splitviewcommand-button",commandButtonContent:"win-splitviewcommand-button-content",commandSplitButton:"win-splitviewcommand-splitbutton",commandSplitButtonOpened:"win-splitviewcommand-splitbutton-opened",commandIcon:"win-splitviewcommand-icon",commandLabel:"win-splitviewcommand-label"},EventNames={invoked:"invoked",_splitToggle:"_splittoggle"},createEvent=_Events._createEventProperty,SplitViewCommand=_Base.Class.define(function(element,options){if(element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.SplitViewCommand.DuplicateConstruction",strings.duplicateConstruction);this._winKeyboard=new _KeyboardBehavior._WinKeyboard(element),this._baseConstructor(element,options)},{_baseConstructor:function(element,options,classNames){this._classNames=classNames||ClassNames,element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,this._classNames.command),_ElementUtilities.addClass(this.element,"win-disposable"),this._tooltip=null,this._splitOpened=!1,this._buildDom(),element.addEventListener("keydown",this._keydownHandler.bind(this)),_Control.setOptions(this,options)},element:{get:function(){return this._element}},label:{get:function(){return this._label},set:function(value){this._label=value,this._labelEl.textContent=value}},tooltip:{get:function(){return this._tooltip},set:function(value){this._tooltip=value,this._tooltip||""===this._tooltip?this._element.setAttribute("title",this._tooltip):this._element.removeAttribute("title")}},icon:{get:function(){return this._icon},set:function(value){this._icon=_Icon[value]||value,this._icon&&1===this._icon.length?(this._imageSpan.textContent=this._icon,this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display=""):this._icon&&this._icon.length>1?(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage=this._icon,this._imageSpan.style.msHighContrastAdjust="none",this._imageSpan.style.display=""):(this._imageSpan.textContent="",this._imageSpan.style.backgroundImage="",this._imageSpan.style.msHighContrastAdjust="",this._imageSpan.style.display="none")}},oninvoked:createEvent(EventNames.invoked),_toggleSplit:function(){this._splitOpened=!this._splitOpened,this._splitOpened?(_ElementUtilities.addClass(this._splitButtonEl,this._classNames.commandSplitButtonOpened),this._splitButtonEl.setAttribute("aria-expanded","true")):(_ElementUtilities.removeClass(this._splitButtonEl,this._classNames.commandSplitButtonOpened),this._splitButtonEl.setAttribute("aria-expanded","false")),this._fireEvent(SplitViewCommand._EventName._splitToggle)},_rtl:{get:function(){return"rtl"===_ElementUtilities._getComputedStyle(this.element).direction}},_keydownHandler:function(ev){if(!_ElementUtilities._matchesSelector(ev.target,".win-interactive, .win-interactive *")){var leftStr=this._rtl?Key.rightArrow:Key.leftArrow,rightStr=this._rtl?Key.leftArrow:Key.rightArrow;ev.altKey||ev.keyCode!==leftStr&&ev.keyCode!==Key.home&&ev.keyCode!==Key.end||ev.target!==this._splitButtonEl?ev.altKey||ev.keyCode!==rightStr||!this.splitButton||ev.target!==this._buttonEl&&!this._buttonEl.contains(ev.target)?ev.keyCode!==Key.space&&ev.keyCode!==Key.enter||ev.target!==this._buttonEl&&!this._buttonEl.contains(ev.target)?ev.keyCode!==Key.space&&ev.keyCode!==Key.enter||ev.target!==this._splitButtonEl||this._toggleSplit():this._invoke():(_ElementUtilities._setActive(this._splitButtonEl),ev.keyCode===rightStr&&ev.stopPropagation(),ev.preventDefault()):(_ElementUtilities._setActive(this._buttonEl),ev.keyCode===leftStr&&ev.stopPropagation(),ev.preventDefault())}},_getFocusInto:function(keyCode){var leftStr=this._rtl?Key.rightArrow:Key.leftArrow;return keyCode===leftStr&&this.splitButton?this._splitButtonEl:this._buttonEl;
},_buildDom:function(){var markup='<div tabindex="0" role="button" class="'+this._classNames.commandButton+'"><div class="'+this._classNames.commandButtonContent+'"><div class="'+this._classNames.commandIcon+'"></div><div class="'+this._classNames.commandLabel+'"></div></div></div><div tabindex="-1" aria-expanded="false" class="'+this._classNames.commandSplitButton+'"></div>';this.element.insertAdjacentHTML("afterBegin",markup),this._buttonEl=this.element.firstElementChild,this._buttonPressedBehavior=new exports._WinPressed(this._buttonEl),this._contentEl=this._buttonEl.firstElementChild,this._imageSpan=this._contentEl.firstElementChild,this._imageSpan.style.display="none",this._labelEl=this._imageSpan.nextElementSibling,this._splitButtonEl=this._buttonEl.nextElementSibling,this._splitButtonPressedBehavior=new exports._WinPressed(this._splitButtonEl),this._splitButtonEl.style.display="none",_ElementUtilities._ensureId(this._buttonEl),this._splitButtonEl.setAttribute("aria-labelledby",this._buttonEl.id),this._buttonEl.addEventListener("click",this._handleButtonClick.bind(this));var mutationObserver=new _ElementUtilities._MutationObserver(this._splitButtonAriaExpandedPropertyChangeHandler.bind(this));mutationObserver.observe(this._splitButtonEl,{attributes:!0,attributeFilter:["aria-expanded"]}),this._splitButtonEl.addEventListener("click",this._handleSplitButtonClick.bind(this));for(var tempEl=this._splitButtonEl.nextSibling;tempEl;)this._buttonEl.insertBefore(tempEl,this._contentEl),"#text"!==tempEl.nodeName&&ControlProcessor.processAll(tempEl),tempEl=this._splitButtonEl.nextSibling},_handleButtonClick:function(ev){var srcElement=ev.target;_ElementUtilities._matchesSelector(srcElement,".win-interactive, .win-interactive *")||this._invoke()},_splitButtonAriaExpandedPropertyChangeHandler:function(){"true"===this._splitButtonEl.getAttribute("aria-expanded")!==this._splitOpened&&this._toggleSplit()},_handleSplitButtonClick:function(){this._toggleSplit()},_invoke:function(){this._fireEvent(SplitViewCommand._EventName.invoked)},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(type,!0,!1,detail),this.element.dispatchEvent(event)},dispose:function(){this._disposed||(this._disposed=!0,this._buttonPressedBehavior.dispose(),this._splitButtonPressedBehavior.dispose())}},{_ClassName:ClassNames,_EventName:EventNames});return _Base.Class.mix(SplitViewCommand,_Control.DOMEventMixin),SplitViewCommand})})}),define("WinJS/Controls/NavBar/_Command",["exports","../../Core/_Global","../../Core/_Base","../../Core/_ErrorFromName","../../Navigation","../../Utilities/_ElementUtilities","../SplitView/Command"],function(exports,_Global,_Base,_ErrorFromName,Navigation,_ElementUtilities,SplitViewCommand){"use strict";_Base.Namespace._moduleDefine(exports,"WinJS.UI",{NavBarCommand:_Base.Namespace._lazy(function(){var strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get navBarCommandDeprecated(){return"NavBarCommand is deprecated and may not be available in future releases. If you were using a NavBarCommand inside of a SplitView, use SplitViewCommand instead."}},ClassNames={command:"win-navbarcommand",commandButton:"win-navbarcommand-button",commandButtonContent:"win-navbarcommand-button-content",commandSplitButton:"win-navbarcommand-splitbutton",commandSplitButtonOpened:"win-navbarcommand-splitbutton-opened",commandIcon:"win-navbarcommand-icon",commandLabel:"win-navbarcommand-label"},superClass=SplitViewCommand.SplitViewCommand.prototype,NavBarCommand=_Base.Class.derive(SplitViewCommand.SplitViewCommand,function(element,options){if(_ElementUtilities._deprecated(strings.navBarCommandDeprecated),element=element||_Global.document.createElement("DIV"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.NavBarCommand.DuplicateConstruction",strings.duplicateConstruction);this._baseConstructor(element,options,ClassNames)},{element:{get:function(){return Object.getOwnPropertyDescriptor(superClass,"element").get.call(this)}},label:{get:function(){return Object.getOwnPropertyDescriptor(superClass,"label").get.call(this)},set:function(value){return Object.getOwnPropertyDescriptor(superClass,"label").set.call(this,value)}},tooltip:{get:function(){return Object.getOwnPropertyDescriptor(superClass,"tooltip").get.call(this)},set:function(value){return Object.getOwnPropertyDescriptor(superClass,"tooltip").set.call(this,value)}},icon:{get:function(){return Object.getOwnPropertyDescriptor(superClass,"icon").get.call(this)},set:function(value){return Object.getOwnPropertyDescriptor(superClass,"icon").set.call(this,value)}},location:{get:function(){return this._location},set:function(value){this._location=value}},oninvoked:{get:function(){},enumerable:!1},state:{get:function(){return this._state},set:function(value){this._state=value}},splitButton:{get:function(){return this._split},set:function(value){this._split=value,this._split?this._splitButtonEl.style.display="":this._splitButtonEl.style.display="none"}},splitOpened:{get:function(){return this._splitOpened},set:function(value){this._splitOpened!==!!value&&this._toggleSplit()}},dispose:function(){superClass.dispose.call(this)},_invoke:function(){this.location&&Navigation.navigate(this.location,this.state),this._fireEvent(NavBarCommand._EventName._invoked)}},{_ClassName:ClassNames,_EventName:{_invoked:"_invoked",_splitToggle:"_splittoggle"}});return NavBarCommand})})}),define("WinJS/Controls/NavBar/_Container",["exports","../../Core/_Global","../../Core/_Base","../../Core/_BaseUtils","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Log","../../Core/_Resources","../../Core/_WriteProfilerMark","../../Animations","../../Animations/_TransitionAnimation","../../BindingList","../../ControlProcessor","../../Navigation","../../Promise","../../Scheduler","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Utilities/_KeyboardBehavior","../../Utilities/_UI","../_LegacyAppBar/_Constants","../Repeater","./_Command"],function(exports,_Global,_Base,_BaseUtils,_ErrorFromName,_Events,_Log,_Resources,_WriteProfilerMark,Animations,_TransitionAnimation,BindingList,ControlProcessor,Navigation,Promise,Scheduler,_Control,_ElementUtilities,_KeyboardBehavior,_UI,_Constants,Repeater,NavBarCommand){"use strict";function nobodyHasFocus(){return null===_Global.document.activeElement||_Global.document.activeElement===_Global.document.body}_Base.Namespace._moduleDefine(exports,"WinJS.UI",{NavBarContainer:_Base.Namespace._lazy(function(){var Key=_ElementUtilities.Key,buttonFadeDelay=3e3,PT_TOUCH=_ElementUtilities._MSPointerEvent.MSPOINTER_TYPE_TOUCH||"touch",MS_MANIPULATION_STATE_STOPPED=0,createEvent=_Events._createEventProperty,eventNames={invoked:"invoked",splittoggle:"splittoggle"},strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get navBarContainerViewportAriaLabel(){return _Resources._getWinJSString("ui/navBarContainerViewportAriaLabel").value},get navBarContainerIsDeprecated(){return"NavBarContainer is deprecated and may not be available in future releases. Instead, use a WinJS SplitView to display navigation targets within the app."}},NavBarContainer=_Base.Class.define(function(element,options){if(_ElementUtilities._deprecated(strings.navBarContainerIsDeprecated),element=element||_Global.document.createElement("DIV"),this._id=element.id||_ElementUtilities._uniqueID(element),this._writeProfilerMark("constructor,StartTM"),options=options||{},element.winControl)throw new _ErrorFromName("WinJS.UI.NavBarContainer.DuplicateConstruction",strings.duplicateConstruction);element.winControl=this,this._element=element,_ElementUtilities.addClass(this.element,NavBarContainer._ClassName.navbarcontainer),_ElementUtilities.addClass(this.element,"win-disposable"),element.getAttribute("tabIndex")||(element.tabIndex=-1),this._focusCurrentItemPassivelyBound=this._focusCurrentItemPassively.bind(this),this._closeSplitAndResetBound=this._closeSplitAndReset.bind(this),this._currentManipulationState=MS_MANIPULATION_STATE_STOPPED,this._panningDisabled=!_ElementUtilities._supportsSnapPoints,this._fixedSize=!1,this._maxRows=1,this._sizes={},this._setupTree(),this._duringConstructor=!0,this._dataChangingBound=this._dataChanging.bind(this),this._dataChangedBound=this._dataChanged.bind(this),Navigation.addEventListener("navigated",this._closeSplitAndResetBound),this.layout=options.layout||_UI.Orientation.horizontal,options.maxRows&&(this.maxRows=options.maxRows),options.template&&(this.template=options.template),options.data&&(this.data=options.data),options.fixedSize&&(this.fixedSize=options.fixedSize),_Control._setOptions(this,options,!0),this._duringConstructor=!1,options.currentIndex&&(this.currentIndex=options.currentIndex),this._updatePageUI(),Scheduler.schedule(function(){this._updateAppBarReference()},Scheduler.Priority.normal,this,"WinJS.UI.NavBarContainer_async_initialize"),this._writeProfilerMark("constructor,StopTM")},{element:{get:function(){return this._element}},template:{get:function(){return this._template},set:function(value){if(this._template=value,this._repeater){var hadFocus=this.element.contains(_Global.document.activeElement);this._duringConstructor||this._closeSplitIfOpen(),this._repeater.template=this._repeater.template,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),hadFocus&&this._keyboardBehavior._focus(0))}}},_render:function(item){var navbarCommandEl=_Global.document.createElement("div"),template=this._template;template&&(template.render?template.render(item,navbarCommandEl):template.winControl&&template.winControl.render?template.winControl.render(item,navbarCommandEl):navbarCommandEl.appendChild(template(item)));var navbarCommand=new NavBarCommand.NavBarCommand(navbarCommandEl,item);return navbarCommand._element},data:{get:function(){return this._repeater&&this._repeater.data},set:function(value){value||(value=new BindingList.List),this._duringConstructor||this._closeSplitIfOpen(),this._removeDataChangingEvents(),this._removeDataChangedEvents();var hadFocus=this.element.contains(_Global.document.activeElement);this._repeater||(this._surfaceEl.innerHTML="",this._repeater=new Repeater.Repeater(this._surfaceEl,{template:this._render.bind(this)})),this._addDataChangingEvents(value),this._repeater.data=value,this._addDataChangedEvents(value),this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._reset(),hadFocus&&this._keyboardBehavior._focus(0))}},maxRows:{get:function(){return this._maxRows},set:function(value){value=+value===value?value:1,this._maxRows=Math.max(1,value),this._duringConstructor||(this._closeSplitIfOpen(),this._measured=!1,this._reset())}},layout:{get:function(){return this._layout},set:function(value){value===_UI.Orientation.vertical?(this._layout=_UI.Orientation.vertical,_ElementUtilities.removeClass(this.element,NavBarContainer._ClassName.horizontal),_ElementUtilities.addClass(this.element,NavBarContainer._ClassName.vertical)):(this._layout=_UI.Orientation.horizontal,_ElementUtilities.removeClass(this.element,NavBarContainer._ClassName.vertical),_ElementUtilities.addClass(this.element,NavBarContainer._ClassName.horizontal)),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._duringConstructor||(this._measured=!1,this._sizes.itemMeasured=!1,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._closeSplitIfOpen())}},currentIndex:{get:function(){return this._keyboardBehavior.currentIndex},set:function(value){if(value===+value){var hadFocus=this.element.contains(_Global.document.activeElement);this._keyboardBehavior.currentIndex=value,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),hadFocus&&this._keyboardBehavior._focus()}}},fixedSize:{get:function(){return this._fixedSize},set:function(value){this._fixedSize=!!value,this._duringConstructor||(this._closeSplitIfOpen(),this._measured?this._surfaceEl.children.length>0&&this._updateGridStyles():this._measure())}},oninvoked:createEvent(eventNames.invoked),onsplittoggle:createEvent(eventNames.splittoggle),forceLayout:function(){this._resizeHandler(),this._measured&&(this._scrollPosition=_ElementUtilities.getScrollPosition(this._viewportEl)[this.layout===_UI.Orientation.horizontal?"scrollLeft":"scrollTop"]),this._duringForceLayout=!0,this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI(),this._duringForceLayout=!1},_updateAppBarReference:function(){if(!this._appBarEl||!this._appBarEl.contains(this.element)){this._appBarEl&&(this._appBarEl.removeEventListener("beforeopen",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeopen",this._resizeImplBound),this._appBarEl.removeEventListener("afteropen",this._focusCurrentItemPassivelyBound));for(var appBarEl=this.element.parentNode;appBarEl&&!_ElementUtilities.hasClass(appBarEl,_Constants.appBarClass);)appBarEl=appBarEl.parentNode;this._appBarEl=appBarEl,this._appBarEl&&(this._appBarEl.addEventListener("beforeopen",this._closeSplitAndResetBound),this._appBarEl.addEventListener("afteropen",this._focusCurrentItemPassivelyBound))}},_closeSplitAndReset:function(){this._closeSplitIfOpen(),this._reset()},_dataChanging:function(ev){this._elementHadFocus=_Global.document.activeElement,this._currentSplitNavItem&&this._currentSplitNavItem.splitOpened&&("itemremoved"===ev.type?this._surfaceEl.children[ev.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemchanged"===ev.type?this._surfaceEl.children[ev.detail.index].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"itemmoved"===ev.type?this._surfaceEl.children[ev.detail.oldIndex].winControl===this._currentSplitNavItem&&this._closeSplitIfOpen():"reload"===ev.type&&this._closeSplitIfOpen())},_dataChanged:function(ev){this._measured=!1,"itemremoved"===ev.type?ev.detail.index<this._keyboardBehavior.currentIndex?this._keyboardBehavior.currentIndex--:ev.detail.index===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=this._keyboardBehavior.currentIndex,nobodyHasFocus()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"itemchanged"===ev.type?ev.detail.index===this._keyboardBehavior.currentIndex&&nobodyHasFocus()&&this._elementHadFocus&&this._keyboardBehavior._focus():"iteminserted"===ev.type?ev.detail.index<=this._keyboardBehavior.currentIndex&&this._keyboardBehavior.currentIndex++:"itemmoved"===ev.type?ev.detail.oldIndex===this._keyboardBehavior.currentIndex&&(this._keyboardBehavior.currentIndex=ev.detail.newIndex,nobodyHasFocus()&&this._elementHadFocus&&this._keyboardBehavior._focus()):"reload"===ev.type&&(this._keyboardBehavior.currentIndex=0,nobodyHasFocus()&&this._elementHadFocus&&this._keyboardBehavior._focus()),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI()},_focusCurrentItemPassively:function(){this.element.contains(_Global.document.activeElement)&&this._keyboardBehavior._focus()},_reset:function(){this._keyboardBehavior.currentIndex=0,this.element.contains(_Global.document.activeElement)&&this._keyboardBehavior._focus(0),this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._ensureVisible(0,!0),this._updatePageUI()},_removeDataChangedEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangedBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangedBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangedBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangedBound),this._repeater.data.removeEventListener("reload",this._dataChangedBound))},_addDataChangedEvents:function(){this._repeater&&(this._repeater.data.addEventListener("itemchanged",this._dataChangedBound),this._repeater.data.addEventListener("iteminserted",this._dataChangedBound),this._repeater.data.addEventListener("itemmoved",this._dataChangedBound),this._repeater.data.addEventListener("itemremoved",this._dataChangedBound),this._repeater.data.addEventListener("reload",this._dataChangedBound))},_removeDataChangingEvents:function(){this._repeater&&(this._repeater.data.removeEventListener("itemchanged",this._dataChangingBound),this._repeater.data.removeEventListener("iteminserted",this._dataChangingBound),this._repeater.data.removeEventListener("itemmoved",this._dataChangingBound),this._repeater.data.removeEventListener("itemremoved",this._dataChangingBound),this._repeater.data.removeEventListener("reload",this._dataChangingBound))},_addDataChangingEvents:function(bindingList){bindingList.addEventListener("itemchanged",this._dataChangingBound),bindingList.addEventListener("iteminserted",this._dataChangingBound),bindingList.addEventListener("itemmoved",this._dataChangingBound),bindingList.addEventListener("itemremoved",this._dataChangingBound),bindingList.addEventListener("reload",this._dataChangingBound)},_mouseleave:function(){this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerDown:function(ev){ev.pointerType===PT_TOUCH&&this._mouseInViewport&&(this._mouseInViewport=!1,this._updateArrows())},_MSPointerMove:function(ev){ev.pointerType!==PT_TOUCH&&(this._mouseInViewport||(this._mouseInViewport=!0,this._updateArrows()))},_setupTree:function(){this._animateNextPreviousButtons=Promise.wrap(),this._element.addEventListener("mouseleave",this._mouseleave.bind(this)),_ElementUtilities._addEventListener(this._element,"pointerdown",this._MSPointerDown.bind(this)),_ElementUtilities._addEventListener(this._element,"pointermove",this._MSPointerMove.bind(this)),_ElementUtilities._addEventListener(this._element,"focusin",this._focusHandler.bind(this),!1),this._pageindicatorsEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._pageindicatorsEl,NavBarContainer._ClassName.pageindicators),this._element.appendChild(this._pageindicatorsEl),this._ariaStartMarker=_Global.document.createElement("div"),this._element.appendChild(this._ariaStartMarker),this._viewportEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._viewportEl,NavBarContainer._ClassName.viewport),this._element.appendChild(this._viewportEl),this._viewportEl.setAttribute("role","group"),this._viewportEl.setAttribute("aria-label",strings.navBarContainerViewportAriaLabel),this._boundResizeHandler=this._resizeHandler.bind(this),_ElementUtilities._resizeNotifier.subscribe(this._element,this._boundResizeHandler),this._viewportEl.addEventListener("mselementresize",this._resizeHandler.bind(this)),this._viewportEl.addEventListener("scroll",this._scrollHandler.bind(this)),this._viewportEl.addEventListener("MSManipulationStateChanged",this._MSManipulationStateChangedHandler.bind(this)),this._ariaEndMarker=_Global.document.createElement("div"),this._element.appendChild(this._ariaEndMarker),this._surfaceEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._surfaceEl,NavBarContainer._ClassName.surface),this._viewportEl.appendChild(this._surfaceEl),this._surfaceEl.addEventListener(NavBarCommand.NavBarCommand._EventName._invoked,this._navbarCommandInvokedHandler.bind(this)),this._surfaceEl.addEventListener(NavBarCommand.NavBarCommand._EventName._splitToggle,this._navbarCommandSplitToggleHandler.bind(this)),_ElementUtilities._addEventListener(this._surfaceEl,"focusin",this._itemsFocusHandler.bind(this),!1),this._surfaceEl.addEventListener("keydown",this._keyDownHandler.bind(this));for(var tempEl=this.element.firstElementChild;tempEl!==this._pageindicatorsEl;)this._surfaceEl.appendChild(tempEl),ControlProcessor.process(tempEl),tempEl=this.element.firstElementChild;this._leftArrowEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._leftArrowEl,NavBarContainer._ClassName.navleftarrow),_ElementUtilities.addClass(this._leftArrowEl,NavBarContainer._ClassName.navarrow),this._element.appendChild(this._leftArrowEl),this._leftArrowEl.addEventListener("click",this._goLeft.bind(this)),this._leftArrowEl.style.opacity=0,this._leftArrowEl.style.visibility="hidden",this._leftArrowFadeOut=Promise.wrap(),this._rightArrowEl=_Global.document.createElement("div"),_ElementUtilities.addClass(this._rightArrowEl,NavBarContainer._ClassName.navrightarrow),_ElementUtilities.addClass(this._rightArrowEl,NavBarContainer._ClassName.navarrow),this._element.appendChild(this._rightArrowEl),this._rightArrowEl.addEventListener("click",this._goRight.bind(this)),this._rightArrowEl.style.opacity=0,this._rightArrowEl.style.visibility="hidden",this._rightArrowFadeOut=Promise.wrap(),this._keyboardBehavior=new _KeyboardBehavior._KeyboardBehavior(this._surfaceEl,{scroller:this._viewportEl}),this._winKeyboard=new _KeyboardBehavior._WinKeyboard(this._surfaceEl)},_goRight:function(){this._sizes.rtl?this._goPrev():this._goNext()},_goLeft:function(){this._sizes.rtl?this._goNext():this._goPrev()},_goNext:function(){this._measure();var itemsPerPage=this._sizes.rowsPerPage*this._sizes.columnsPerPage,targetPage=Math.min(Math.floor(this._keyboardBehavior.currentIndex/itemsPerPage)+1,this._sizes.pages-1);this._keyboardBehavior.currentIndex=Math.min(itemsPerPage*targetPage,this._surfaceEl.children.length),this._keyboardBehavior._focus()},_goPrev:function(){this._measure();var itemsPerPage=this._sizes.rowsPerPage*this._sizes.columnsPerPage,targetPage=Math.max(0,Math.floor(this._keyboardBehavior.currentIndex/itemsPerPage)-1);this._keyboardBehavior.currentIndex=Math.max(itemsPerPage*targetPage,0),this._keyboardBehavior._focus()},_currentPage:{get:function(){return this.layout===_UI.Orientation.horizontal&&(this._measure(),this._sizes.viewportOffsetWidth>0)?Math.min(this._sizes.pages-1,Math.round(this._scrollPosition/this._sizes.viewportOffsetWidth)):0}},_resizeHandler:function(){if(!this._disposed&&this._measured){var viewportResized=this.layout===_UI.Orientation.horizontal?this._sizes.viewportOffsetWidth!==parseFloat(_ElementUtilities._getComputedStyle(this._viewportEl).width):this._sizes.viewportOffsetHeight!==parseFloat(_ElementUtilities._getComputedStyle(this._viewportEl).height);viewportResized&&(this._measured=!1,this._pendingResize||(this._pendingResize=!0,this._resizeImplBound=this._resizeImplBound||this._resizeImpl.bind(this),this._updateAppBarReference(),this._appBarEl&&this._appBarEl.winControl&&!this._appBarEl.winControl.opened?(Scheduler.schedule(this._resizeImplBound,Scheduler.Priority.idle,null,"WinJS.UI.NavBarContainer._resizeImpl"),this._appBarEl.addEventListener("beforeopen",this._resizeImplBound)):this._resizeImpl()))}},_resizeImpl:function(){!this._disposed&&this._pendingResize&&(this._pendingResize=!1,this._appBarEl&&this._appBarEl.removeEventListener("beforeopen",this._resizeImplBound),this._keyboardBehavior.currentIndex=0,this.element.contains(_Global.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex),this._closeSplitIfOpen(),this._ensureVisible(this._keyboardBehavior.currentIndex,!0),this._updatePageUI())},_keyDownHandler:function(ev){var keyCode=ev.keyCode;if(!ev.altKey&&(keyCode===Key.pageUp||keyCode===Key.pageDown)){var srcElement=ev.target;if(_ElementUtilities._matchesSelector(srcElement,".win-interactive, .win-interactive *"))return;var index=this._keyboardBehavior.currentIndex;this._measure();var sizes=this._sizes,page=Math.floor(index/(sizes.columnsPerPage*sizes.rowsPerPage)),scrollPositionTarget=null;if(keyCode===Key.pageUp){if(this.layout===_UI.Orientation.horizontal){var indexOfFirstItemOnPage=page*sizes.columnsPerPage*sizes.rowsPerPage;index===indexOfFirstItemOnPage&&this._surfaceEl.children[index].winControl._buttonEl===_Global.document.activeElement?index-=sizes.columnsPerPage*sizes.rowsPerPage:index=indexOfFirstItemOnPage}else{var currentItem=this._surfaceEl.children[index],top=currentItem.offsetTop,bottom=top+currentItem.offsetHeight,scrollPosition=this._zooming?this._zoomPosition:this._scrollPosition;if(top>=scrollPosition&&bottom<scrollPosition+sizes.viewportOffsetHeight)for(;index>0&&this._surfaceEl.children[index-1].offsetTop>scrollPosition;)index--;if(this._keyboardBehavior.currentIndex===index){var scrollPositionForOnePageAboveItem=bottom-sizes.viewportOffsetHeight;for(index=Math.max(0,index-1);index>0&&this._surfaceEl.children[index-1].offsetTop>scrollPositionForOnePageAboveItem;)index--;scrollPositionTarget=index>0?this._surfaceEl.children[index].offsetTop-this._sizes.itemMarginTop:0}}index=Math.max(index,0),this._keyboardBehavior.currentIndex=index;var element=this._surfaceEl.children[index].winControl._buttonEl;null!==scrollPositionTarget&&this._scrollTo(scrollPositionTarget),_ElementUtilities._setActive(element,this._viewportEl)}else{if(this.layout===_UI.Orientation.horizontal){var indexOfLastItemOnPage=(page+1)*sizes.columnsPerPage*sizes.rowsPerPage-1;index===indexOfLastItemOnPage?index+=sizes.columnsPerPage*sizes.rowsPerPage:index=indexOfLastItemOnPage}else{var currentItem=this._surfaceEl.children[this._keyboardBehavior.currentIndex],top=currentItem.offsetTop,bottom=top+currentItem.offsetHeight,scrollPosition=this._zooming?this._zoomPosition:this._scrollPosition;if(top>=scrollPosition&&bottom<scrollPosition+sizes.viewportOffsetHeight)for(;index<this._surfaceEl.children.length-1&&this._surfaceEl.children[index+1].offsetTop+this._surfaceEl.children[index+1].offsetHeight<scrollPosition+sizes.viewportOffsetHeight;)index++;if(index===this._keyboardBehavior.currentIndex){var scrollPositionForOnePageBelowItem=top+sizes.viewportOffsetHeight;for(index=Math.min(this._surfaceEl.children.length-1,index+1);index<this._surfaceEl.children.length-1&&this._surfaceEl.children[index+1].offsetTop+this._surfaceEl.children[index+1].offsetHeight<scrollPositionForOnePageBelowItem;)index++;scrollPositionTarget=index<this._surfaceEl.children.length-1?this._surfaceEl.children[index+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight}}index=Math.min(index,this._surfaceEl.children.length-1),this._keyboardBehavior.currentIndex=index;var element=this._surfaceEl.children[index].winControl._buttonEl;null!==scrollPositionTarget&&this._scrollTo(scrollPositionTarget);try{_ElementUtilities._setActive(element,this._viewportEl)}catch(e){}}}},_focusHandler:function(ev){var srcElement=ev.target;this._surfaceEl.contains(srcElement)||(this._skipEnsureVisible=!0,this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))},_itemsFocusHandler:function(ev){var srcElement=ev.target;if(srcElement!==this._surfaceEl){for(;srcElement.parentNode!==this._surfaceEl;)srcElement=srcElement.parentNode;for(var index=-1;srcElement;)index++,srcElement=srcElement.previousSibling;this._skipEnsureVisible?this._skipEnsureVisible=!1:this._ensureVisible(index)}},_ensureVisible:function(index,withoutAnimation){if(this._measure(),this.layout===_UI.Orientation.horizontal){var page=Math.floor(index/(this._sizes.rowsPerPage*this._sizes.columnsPerPage));this._scrollTo(page*this._sizes.viewportOffsetWidth,withoutAnimation)}else{var maxScrollPosition,element=this._surfaceEl.children[index];maxScrollPosition=index>0?element.offsetTop-this._sizes.itemMarginTop:0;var minScrollPosition;minScrollPosition=index<this._surfaceEl.children.length-1?this._surfaceEl.children[index+1].offsetTop-this._sizes.viewportOffsetHeight:this._scrollLength-this._sizes.viewportOffsetHeight;var newScrollPosition=this._zooming?this._zoomPosition:this._scrollPosition;newScrollPosition=Math.max(newScrollPosition,minScrollPosition),newScrollPosition=Math.min(newScrollPosition,maxScrollPosition),this._scrollTo(newScrollPosition,withoutAnimation)}},_scrollTo:function(targetScrollPosition,withoutAnimation){if(this._measure(),targetScrollPosition=this.layout===_UI.Orientation.horizontal?Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetWidth,targetScrollPosition)):Math.max(0,Math.min(this._scrollLength-this._sizes.viewportOffsetHeight,targetScrollPosition)),withoutAnimation){if(Math.abs(this._scrollPosition-targetScrollPosition)>1){this._zooming=!1,this._scrollPosition=targetScrollPosition,this._updatePageUI(),this._duringForceLayout||this._closeSplitIfOpen();var newScrollPos={};newScrollPos[this.layout===_UI.Orientation.horizontal?"scrollLeft":"scrollTop"]=targetScrollPosition,_ElementUtilities.setScrollPosition(this._viewportEl,newScrollPos)}}else(!this._zooming&&Math.abs(this._scrollPosition-targetScrollPosition)>1||this._zooming&&Math.abs(this._zoomPosition-targetScrollPosition)>1)&&(this._zoomPosition=targetScrollPosition,this._zooming=!0,this.layout===_UI.Orientation.horizontal?(this._viewportEl.style.msScrollSnapType="none",_ElementUtilities._zoomTo(this._viewportEl,{contentX:targetScrollPosition,contentY:0,viewportX:0,viewportY:0})):_ElementUtilities._zoomTo(this._viewportEl,{contentX:0,contentY:targetScrollPosition,viewportX:0,viewportY:0}),this._closeSplitIfOpen())},_MSManipulationStateChangedHandler:function(e){this._currentManipulationState=e.currentState,e.currentState===e.MS_MANIPULATION_STATE_ACTIVE&&(this._viewportEl.style.msScrollSnapType="",this._zooming=!1),_Global.clearTimeout(this._manipulationStateTimeoutId),e.currentState===e.MS_MANIPULATION_STATE_STOPPED&&(this._manipulationStateTimeoutId=_Global.setTimeout(function(){this._viewportEl.style.msScrollSnapType="",this._zooming=!1,this._updateCurrentIndexIfPageChanged()}.bind(this),100))},_scrollHandler:function(){if(!this._disposed&&(this._measured=!1,!this._checkingScroll)){var that=this;this._checkingScroll=_BaseUtils._requestAnimationFrame(function(){if(!that._disposed){that._checkingScroll=null;var newScrollPosition=_ElementUtilities.getScrollPosition(that._viewportEl)[that.layout===_UI.Orientation.horizontal?"scrollLeft":"scrollTop"];newScrollPosition!==that._scrollPosition&&(that._scrollPosition=newScrollPosition,that._closeSplitIfOpen()),that._updatePageUI(),that._zooming||that._currentManipulationState!==MS_MANIPULATION_STATE_STOPPED||that._updateCurrentIndexIfPageChanged()}})}},_updateCurrentIndexIfPageChanged:function(){if(this.layout===_UI.Orientation.horizontal){this._measure();var currentPage=this._currentPage,firstIndexOnPage=currentPage*this._sizes.rowsPerPage*this._sizes.columnsPerPage,lastIndexOnPage=(currentPage+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1;(this._keyboardBehavior.currentIndex<firstIndexOnPage||this._keyboardBehavior.currentIndex>lastIndexOnPage)&&(this._keyboardBehavior.currentIndex=firstIndexOnPage,this.element.contains(_Global.document.activeElement)&&this._keyboardBehavior._focus(this._keyboardBehavior.currentIndex))}},_measure:function(){if(!this._measured){this._resizeImpl(),this._writeProfilerMark("measure,StartTM");var sizes=this._sizes;sizes.rtl="rtl"===_ElementUtilities._getComputedStyle(this._element).direction;var itemCount=this._surfaceEl.children.length;if(itemCount>0){if(!this._sizes.itemMeasured){this._writeProfilerMark("measureItem,StartTM");var elementToMeasure=this._surfaceEl.firstElementChild;elementToMeasure.style.margin="",elementToMeasure.style.width="";var elementComputedStyle=_ElementUtilities._getComputedStyle(elementToMeasure);sizes.itemOffsetWidth=parseFloat(_ElementUtilities._getComputedStyle(elementToMeasure).width),0===elementToMeasure.offsetWidth&&(sizes.itemOffsetWidth=0),sizes.itemMarginLeft=parseFloat(elementComputedStyle.marginLeft),sizes.itemMarginRight=parseFloat(elementComputedStyle.marginRight),sizes.itemWidth=sizes.itemOffsetWidth+sizes.itemMarginLeft+sizes.itemMarginRight,sizes.itemOffsetHeight=parseFloat(_ElementUtilities._getComputedStyle(elementToMeasure).height),0===elementToMeasure.offsetHeight&&(sizes.itemOffsetHeight=0),sizes.itemMarginTop=parseFloat(elementComputedStyle.marginTop),sizes.itemMarginBottom=parseFloat(elementComputedStyle.marginBottom),sizes.itemHeight=sizes.itemOffsetHeight+sizes.itemMarginTop+sizes.itemMarginBottom,sizes.itemOffsetWidth>0&&sizes.itemOffsetHeight>0&&(sizes.itemMeasured=!0),
this._writeProfilerMark("measureItem,StopTM")}if(sizes.viewportOffsetWidth=parseFloat(_ElementUtilities._getComputedStyle(this._viewportEl).width),0===this._viewportEl.offsetWidth&&(sizes.viewportOffsetWidth=0),sizes.viewportOffsetHeight=parseFloat(_ElementUtilities._getComputedStyle(this._viewportEl).height),0===this._viewportEl.offsetHeight&&(sizes.viewportOffsetHeight=0),0===sizes.viewportOffsetWidth||0===sizes.itemOffsetHeight?this._measured=!1:this._measured=!0,this.layout===_UI.Orientation.horizontal){this._scrollPosition=_ElementUtilities.getScrollPosition(this._viewportEl).scrollLeft,sizes.leadingEdge=this._leftArrowEl.offsetWidth+parseInt(_ElementUtilities._getComputedStyle(this._leftArrowEl).marginLeft)+parseInt(_ElementUtilities._getComputedStyle(this._leftArrowEl).marginRight);var usableSpace=sizes.viewportOffsetWidth-2*sizes.leadingEdge;sizes.maxColumns=sizes.itemWidth?Math.max(1,Math.floor(usableSpace/sizes.itemWidth)):1,sizes.rowsPerPage=Math.min(this.maxRows,Math.ceil(itemCount/sizes.maxColumns)),sizes.columnsPerPage=Math.min(sizes.maxColumns,itemCount),sizes.pages=Math.ceil(itemCount/(sizes.columnsPerPage*sizes.rowsPerPage)),sizes.trailingEdge=sizes.leadingEdge,sizes.extraSpace=usableSpace-sizes.columnsPerPage*sizes.itemWidth,this._scrollLength=sizes.viewportOffsetWidth*sizes.pages,this._keyboardBehavior.fixedSize=sizes.rowsPerPage,this._keyboardBehavior.fixedDirection=_KeyboardBehavior._KeyboardBehavior.FixedDirection.height,this._surfaceEl.style.height=sizes.itemHeight*sizes.rowsPerPage+"px",this._surfaceEl.style.width=this._scrollLength+"px"}else this._scrollPosition=this._viewportEl.scrollTop,sizes.leadingEdge=0,sizes.rowsPerPage=itemCount,sizes.columnsPerPage=1,sizes.pages=1,sizes.trailingEdge=0,this._scrollLength=this._viewportEl.scrollHeight,this._keyboardBehavior.fixedSize=sizes.columnsPerPage,this._keyboardBehavior.fixedDirection=_KeyboardBehavior._KeyboardBehavior.FixedDirection.width,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._updateGridStyles()}else sizes.pages=1,this._hasPreviousContent=!1,this._hasNextContent=!1,this._surfaceEl.style.height="",this._surfaceEl.style.width="";this._writeProfilerMark("measure,StopTM")}},_updateGridStyles:function(){for(var sizes=this._sizes,itemCount=this._surfaceEl.children.length,index=0;index<itemCount;index++){var marginRight,marginLeft,itemEl=this._surfaceEl.children[index],width="";if(this.layout===_UI.Orientation.horizontal){var column=Math.floor(index/sizes.rowsPerPage),isFirstColumnOnPage=column%sizes.columnsPerPage===0,isLastColumnOnPage=column%sizes.columnsPerPage===sizes.columnsPerPage-1,extraTrailingMargin=sizes.trailingEdge;if(this.fixedSize)extraTrailingMargin+=sizes.extraSpace;else{var spaceToDistribute=sizes.extraSpace-(sizes.maxColumns-sizes.columnsPerPage)*sizes.itemWidth;width=sizes.itemOffsetWidth+spaceToDistribute/sizes.maxColumns+"px"}var extraMarginRight,extraMarginLeft;sizes.rtl?(extraMarginRight=isFirstColumnOnPage?sizes.leadingEdge:0,extraMarginLeft=isLastColumnOnPage?extraTrailingMargin:0):(extraMarginRight=isLastColumnOnPage?extraTrailingMargin:0,extraMarginLeft=isFirstColumnOnPage?sizes.leadingEdge:0),marginRight=extraMarginRight+sizes.itemMarginRight+"px",marginLeft=extraMarginLeft+sizes.itemMarginLeft+"px"}else marginRight="",marginLeft="";itemEl.style.marginRight!==marginRight&&(itemEl.style.marginRight=marginRight),itemEl.style.marginLeft!==marginLeft&&(itemEl.style.marginLeft=marginLeft),itemEl.style.width!==width&&(itemEl.style.width=width)}},_updatePageUI:function(){this._measure();var currentPage=this._currentPage;this._hasPreviousContent=0!==currentPage,this._hasNextContent=currentPage<this._sizes.pages-1,this._updateArrows(),this._indicatorCount!==this._sizes.pages&&(this._indicatorCount=this._sizes.pages,this._pageindicatorsEl.innerHTML=new Array(this._sizes.pages+1).join('<span class="'+NavBarContainer._ClassName.indicator+'"></span>'));for(var i=0;i<this._pageindicatorsEl.children.length;i++)i===currentPage?_ElementUtilities.addClass(this._pageindicatorsEl.children[i],NavBarContainer._ClassName.currentindicator):_ElementUtilities.removeClass(this._pageindicatorsEl.children[i],NavBarContainer._ClassName.currentindicator);if(this._sizes.pages>1?(this._viewportEl.style.overflowX=this._panningDisabled?"hidden":"",this._pageindicatorsEl.style.visibility=""):(this._viewportEl.style.overflowX="hidden",this._pageindicatorsEl.style.visibility="hidden"),this._sizes.pages<=1||this._layout!==_UI.Orientation.horizontal)this._ariaStartMarker.removeAttribute("aria-flowto"),this._ariaEndMarker.removeAttribute("x-ms-aria-flowfrom");else{var firstIndexOnCurrentPage=currentPage*this._sizes.rowsPerPage*this._sizes.columnsPerPage,firstItem=this._surfaceEl.children[firstIndexOnCurrentPage].winControl._buttonEl;_ElementUtilities._ensureId(firstItem),this._ariaStartMarker.setAttribute("aria-flowto",firstItem.id);var lastIndexOnCurrentPage=Math.min(this._surfaceEl.children.length-1,(currentPage+1)*this._sizes.rowsPerPage*this._sizes.columnsPerPage-1),lastItem=this._surfaceEl.children[lastIndexOnCurrentPage].winControl._buttonEl;_ElementUtilities._ensureId(lastItem),this._ariaEndMarker.setAttribute("x-ms-aria-flowfrom",lastItem.id)}},_closeSplitIfOpen:function(){this._currentSplitNavItem&&(this._currentSplitNavItem.splitOpened&&this._currentSplitNavItem._toggleSplit(),this._currentSplitNavItem=null)},_updateArrows:function(){var hasLeftContent=this._sizes.rtl?this._hasNextContent:this._hasPreviousContent,hasRightContent=this._sizes.rtl?this._hasPreviousContent:this._hasNextContent,that=this;(this._mouseInViewport||this._panningDisabled)&&hasLeftContent?(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=null,this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeOut=null,this._leftArrowEl.style.visibility="",this._leftArrowFadeIn=this._leftArrowFadeIn||Animations.fadeIn(this._leftArrowEl)):(hasLeftContent?this._leftArrowWaitingToFadeOut=this._leftArrowWaitingToFadeOut||Promise.timeout(_TransitionAnimation._animationTimeAdjustment(buttonFadeDelay)):(this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowWaitingToFadeOut=Promise.wrap()),this._leftArrowWaitingToFadeOut.then(function(){this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._leftArrowFadeIn=null,this._leftArrowFadeOut=this._leftArrowFadeOut||Animations.fadeOut(this._leftArrowEl).then(function(){that._leftArrowEl.style.visibility="hidden"})}.bind(this))),(this._mouseInViewport||this._panningDisabled)&&hasRightContent?(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=null,this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeOut=null,this._rightArrowEl.style.visibility="",this._rightArrowFadeIn=this._rightArrowFadeIn||Animations.fadeIn(this._rightArrowEl)):(hasRightContent?this._rightArrowWaitingToFadeOut=this._rightArrowWaitingToFadeOut||Promise.timeout(_TransitionAnimation._animationTimeAdjustment(buttonFadeDelay)):(this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowWaitingToFadeOut=Promise.wrap()),this._rightArrowWaitingToFadeOut.then(function(){this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),this._rightArrowFadeIn=null,this._rightArrowFadeOut=this._rightArrowFadeOut||Animations.fadeOut(this._rightArrowEl).then(function(){that._rightArrowEl.style.visibility="hidden"})}.bind(this)))},_navbarCommandInvokedHandler:function(ev){for(var srcElement=ev.target,index=-1;srcElement;)index++,srcElement=srcElement.previousSibling;this._fireEvent(NavBarContainer._EventName.invoked,{index:index,navbarCommand:ev.target.winControl,data:this._repeater?this._repeater.data.getAt(index):null})},_navbarCommandSplitToggleHandler:function(ev){for(var srcElement=ev.target,index=-1;srcElement;)index++,srcElement=srcElement.previousSibling;var navbarCommand=ev.target.winControl;this._closeSplitIfOpen(),navbarCommand.splitOpened&&(this._currentSplitNavItem=navbarCommand),this._fireEvent(NavBarContainer._EventName.splitToggle,{opened:navbarCommand.splitOpened,index:index,navbarCommand:navbarCommand,data:this._repeater?this._repeater.data.getAt(index):null})},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(type,!0,!1,detail),this.element.dispatchEvent(event)},_writeProfilerMark:function(text){var message="WinJS.UI.NavBarContainer:"+this._id+":"+text;_WriteProfilerMark(message),_Log.log&&_Log.log(message,null,"navbarcontainerprofiler")},dispose:function(){this._disposed||(this._disposed=!0,this._appBarEl&&(this._appBarEl.removeEventListener("beforeopen",this._closeSplitAndResetBound),this._appBarEl.removeEventListener("beforeopen",this._resizeImplBound)),Navigation.removeEventListener("navigated",this._closeSplitAndResetBound),this._leftArrowWaitingToFadeOut&&this._leftArrowWaitingToFadeOut.cancel(),this._leftArrowFadeOut&&this._leftArrowFadeOut.cancel(),this._leftArrowFadeIn&&this._leftArrowFadeIn.cancel(),this._rightArrowWaitingToFadeOut&&this._rightArrowWaitingToFadeOut.cancel(),this._rightArrowFadeOut&&this._rightArrowFadeOut.cancel(),this._rightArrowFadeIn&&this._rightArrowFadeIn.cancel(),_ElementUtilities._resizeNotifier.unsubscribe(this._element,this._boundResizeHandler),this._removeDataChangingEvents(),this._removeDataChangedEvents())}},{_ClassName:{navbarcontainer:"win-navbarcontainer",pageindicators:"win-navbarcontainer-pageindicator-box",indicator:"win-navbarcontainer-pageindicator",currentindicator:"win-navbarcontainer-pageindicator-current",vertical:"win-navbarcontainer-vertical",horizontal:"win-navbarcontainer-horizontal",viewport:"win-navbarcontainer-viewport",surface:"win-navbarcontainer-surface",navarrow:"win-navbarcontainer-navarrow",navleftarrow:"win-navbarcontainer-navleft",navrightarrow:"win-navbarcontainer-navright"},_EventName:{invoked:eventNames.invoked,splitToggle:eventNames.splittoggle}});return _Base.Class.mix(NavBarContainer,_Control.DOMEventMixin),NavBarContainer})})}),define("require-style!less/styles-navbar",[],function(){}),define("require-style!less/colors-navbar",[],function(){}),define("WinJS/Controls/NavBar",["../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_BaseUtils","../Core/_Events","../Core/_WriteProfilerMark","../Promise","../Scheduler","../Utilities/_ElementUtilities","../Utilities/_Hoverable","../_Accents","./_LegacyAppBar","./NavBar/_Command","./NavBar/_Container","require-style!less/styles-navbar","require-style!less/colors-navbar"],function(_Global,_WinRT,_Base,_BaseUtils,_Events,_WriteProfilerMark,Promise,Scheduler,_ElementUtilities,_Hoverable,_Accents,_LegacyAppBar,_Command,_Container){"use strict";_Accents.createAccentRule("html.win-hoverable .win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened:hover",[{name:"background-color",value:_Accents.ColorTypes.listSelectHover}]),_Accents.createAccentRule("html.win-hoverable .win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened:hover.win-pressed",[{name:"background-color",value:_Accents.ColorTypes.listSelectPress}]),_Accents.createAccentRule(".win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened",[{name:"background-color",value:_Accents.ColorTypes.listSelectRest}]),_Accents.createAccentRule(".win-navbarcommand-splitbutton.win-navbarcommand-splitbutton-opened.win-pressed",[{name:"background-color",value:_Accents.ColorTypes.listSelectPress}]);var customLayout="custom";_Base.Namespace.define("WinJS.UI",{NavBar:_Base.Namespace._lazy(function(){var childrenProcessedEventName="childrenprocessed",createEvent=_Events._createEventProperty,NavBar=_Base.Class.derive(_LegacyAppBar._LegacyAppBar,function(element,options){_ElementUtilities._deprecated(strings.navBarIsDeprecated),options=options||{},options=_BaseUtils._shallowCopy(options),options.placement=options.placement||"top",options.layout=customLayout,options.closedDisplayMode=options.closedDisplayMode||"minimal",_LegacyAppBar._LegacyAppBar.call(this,element,options),this._element.addEventListener("beforeopen",this._handleBeforeShow.bind(this)),_ElementUtilities.addClass(this.element,NavBar._ClassName.navbar),_WinRT.Windows.ApplicationModel.DesignMode.designModeEnabled?this._processChildren():Scheduler.schedule(this._processChildren.bind(this),Scheduler.Priority.idle,null,"WinJS.UI.NavBar.processChildren")},{closedDisplayMode:{get:function(){return this._closedDisplayMode},set:function(value){var newValue="none"===value?"none":"minimal";Object.getOwnPropertyDescriptor(_LegacyAppBar._LegacyAppBar.prototype,"closedDisplayMode").set.call(this,newValue),this._closedDisplayMode=newValue}},onchildrenprocessed:createEvent(childrenProcessedEventName),_processChildren:function(){if(!this._processed){this._processed=!0,this._writeProfilerMark("processChildren,StartTM");var that=this,processed=Promise.as();return this._processors&&this._processors.forEach(function(processAll){for(var i=0,len=that.element.children.length;i<len;i++)!function(child){processed=processed.then(function(){processAll(child)})}(that.element.children[i])}),processed.then(function(){that._writeProfilerMark("processChildren,StopTM"),that._fireEvent(NavBar._EventName.childrenProcessed)},function(){that._writeProfilerMark("processChildren,StopTM"),that._fireEvent(NavBar._EventName.childrenProcessed)})}return Promise.wrap()},_show:function(){if(!this.disabled){var that=this;this._processChildren().then(function(){_LegacyAppBar._LegacyAppBar.prototype._show.call(that)})}},_handleBeforeShow:function(){if(!this._disposed)for(var navbarcontainerEls=this.element.querySelectorAll(".win-navbarcontainer"),i=0;i<navbarcontainerEls.length;i++)navbarcontainerEls[i].winControl.forceLayout()},_fireEvent:function(type,detail){var event=_Global.document.createEvent("CustomEvent");event.initCustomEvent(type,!0,!1,detail||{}),this.element.dispatchEvent(event)},_writeProfilerMark:function(text){_WriteProfilerMark("WinJS.UI.NavBar:"+this._id+":"+text)}},{_ClassName:{navbar:"win-navbar"},_EventName:{childrenProcessed:childrenProcessedEventName},isDeclarativeControlContainer:_BaseUtils.markSupportedForProcessing(function(navbar,callback){if(navbar._processed)for(var i=0,len=navbar.element.children.length;i<len;i++)callback(navbar.element.children[i]);else navbar._processors=navbar._processors||[],navbar._processors.push(callback)})}),strings={get navBarIsDeprecated(){return"NavBar is deprecated and may not be available in future releases. Instead, use a WinJS SplitView to display navigation targets within the app."}};return NavBar})})}),define("require-style!less/styles-viewbox",[],function(){}),define("WinJS/Controls/ViewBox",["../Core/_Global","../Core/_Base","../Core/_BaseUtils","../Core/_ErrorFromName","../Core/_Resources","../Scheduler","../Utilities/_Control","../Utilities/_Dispose","../Utilities/_ElementUtilities","../Utilities/_Hoverable","./ElementResizeInstrument","require-style!less/styles-viewbox"],function(_Global,_Base,_BaseUtils,_ErrorFromName,_Resources,Scheduler,_Control,_Dispose,_ElementUtilities,_Hoverable,_ElementResizeInstrument){"use strict";_Base.Namespace.define("WinJS.UI",{ViewBox:_Base.Namespace._lazy(function(){var strings={get invalidViewBoxChildren(){return"ViewBox expects to be provided with only one child element"}},ViewBox=_Base.Class.define(function(element){this._disposed=!1,this._element=element||_Global.document.createElement("div");var box=this.element;box.winControl=this,_ElementUtilities.addClass(box,"win-disposable"),_ElementUtilities.addClass(box,"win-viewbox"),this._handleResizeBound=this._handleResize.bind(this),_ElementUtilities._resizeNotifier.subscribe(box,this._handleResizeBound),this._elementResizeInstrument=new _ElementResizeInstrument._ElementResizeInstrument,box.appendChild(this._elementResizeInstrument.element),this._elementResizeInstrument.addEventListener("resize",this._handleResizeBound);var that=this;_ElementUtilities._inDom(box).then(function(){that._disposed||that._elementResizeInstrument.addedToDom()}),this.forceLayout()},{_sizer:null,_element:null,element:{get:function(){return this._element}},_rtl:{get:function(){return"rtl"===_ElementUtilities._getComputedStyle(this.element).direction}},_initialize:function(){var box=this.element,children=Array.prototype.slice.call(box.children);children.indexOf(this._elementResizeInstrument.element)===-1&&box.appendChild(this._elementResizeInstrument.element);var that=this;if(children.indexOf(this._sizer)===-1){var sizers=children.filter(function(element){return element!==that._elementResizeInstrument.element});if(_BaseUtils.validation&&1!==sizers.length)throw new _ErrorFromName("WinJS.UI.ViewBox.InvalidChildren",strings.invalidViewBoxChildren);this._sizer&&(this._sizer.onresize=null);var sizer=sizers[0];if(this._sizer=sizer,0===box.clientWidth&&0===box.clientHeight){var that=this;Scheduler.schedule(function(){that._updateLayout()},Scheduler.Priority.normal,null,"WinJS.UI.ViewBox._updateLayout")}}},_updateLayout:function(){var sizer=this._sizer;if(sizer){var box=this.element,w=sizer.clientWidth,h=sizer.clientHeight,bw=box.clientWidth,bh=box.clientHeight,wRatio=bw/w,hRatio=bh/h,mRatio=Math.min(wRatio,hRatio),transX=Math.abs(bw-w*mRatio)/2,transY=Math.abs(bh-h*mRatio)/2,rtl=this._rtl;this._sizer.style[_BaseUtils._browserStyleEquivalents.transform.scriptName]="translate("+(rtl?"-":"")+transX+"px,"+transY+"px) scale("+mRatio+")",this._sizer.style[_BaseUtils._browserStyleEquivalents["transform-origin"].scriptName]=rtl?"top right":"top left"}this._layoutCompleteCallback()},_handleResize:function(){if(!this._resizing){this._resizing=this._resizing||0,this._resizing++;try{this._updateLayout()}finally{this._resizing--}}},_layoutCompleteCallback:function(){},dispose:function(){this._disposed||(this.element&&_ElementUtilities._resizeNotifier.unsubscribe(this.element,this._handleResizeBound),this._elementResizeInstrument.dispose(),this._disposed=!0,_Dispose.disposeSubTree(this._element))},forceLayout:function(){this._initialize(),this._updateLayout()}});return _Base.Class.mix(ViewBox,_Control.DOMEventMixin),ViewBox})})}),define("require-style!less/styles-contentdialog",[],function(){}),define("require-style!less/colors-contentdialog",[],function(){}),define("WinJS/Controls/ContentDialog",["../Application","../Utilities/_Dispose","../_Accents","../Promise","../_Signal","../_LightDismissService","../Core/_BaseUtils","../Core/_Global","../Core/_WinRT","../Core/_Base","../Core/_Events","../Core/_ErrorFromName","../Core/_Resources","../Utilities/_Control","../Utilities/_ElementUtilities","../Utilities/_KeyboardInfo","../Utilities/_Hoverable","../Animations","require-style!less/styles-contentdialog","require-style!less/colors-contentdialog"],function(Application,_Dispose,_Accents,Promise,_Signal,_LightDismissService,_BaseUtils,_Global,_WinRT,_Base,_Events,_ErrorFromName,_Resources,_Control,_ElementUtilities,_KeyboardInfo,_Hoverable,_Animations){"use strict";_Accents.createAccentRule(".win-contentdialog-dialog",[{name:"outline-color",value:_Accents.ColorTypes.accent}]),_Base.Namespace.define("WinJS.UI",{ContentDialog:_Base.Namespace._lazy(function(){function supportsMsDevicedFixed(dialogRoot){if("undefined"==typeof _supportsMsDeviceFixedCached){var element=_Global.document.createElement("div");element.style.position="-ms-device-fixed",_supportsMsDeviceFixedCached="-ms-device-fixed"===_ElementUtilities._getComputedStyle(element).position}return _supportsMsDeviceFixedCached}function cancelablePromise(animationPromise){return Promise._cancelBlocker(animationPromise,function(){animationPromise.cancel()})}function onInputPaneShown(eventObject){eventObject.ensuredFocusedElementInView=!0,this.dialog._renderForInputPane(eventObject.occludedRect.height)}function onInputPaneHidden(){this.dialog._clearInputPaneRendering()}function _(){}function interruptible(object,workFn){object._interruptibleWorkPromises=object._interruptibleWorkPromises||[];var workStoredSignal=new _Signal;object._interruptibleWorkPromises.push(workFn(object,workStoredSignal.promise)),workStoredSignal.complete()}function cancelInterruptibles(){(this._interruptibleWorkPromises||[]).forEach(function(workPromise){workPromise.cancel()})}var _supportsMsDeviceFixedCached,Strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get controlDisposed(){return"Cannot interact with the control after it has been disposed"},get contentDialogAlreadyShowing(){return"Cannot show a ContentDialog if there is already a ContentDialog that is showing"}},DismissalResult={none:"none",primary:"primary",secondary:"secondary"},ClassNames={contentDialog:"win-contentdialog",backgroundOverlay:"win-contentdialog-backgroundoverlay",dialog:"win-contentdialog-dialog",title:"win-contentdialog-title",content:"win-contentdialog-content",commands:"win-contentdialog-commands",primaryCommand:"win-contentdialog-primarycommand",secondaryCommand:"win-contentdialog-secondarycommand",_verticalAlignment:"win-contentdialog-verticalalignment",_scroller:"win-contentdialog-scroller",_column0or1:"win-contentdialog-column0or1",_visible:"win-contentdialog-visible",_tabStop:"win-contentdialog-tabstop",_commandSpacer:"win-contentdialog-commandspacer",_deviceFixedSupported:"win-contentdialog-devicefixedsupported"},EventNames={beforeShow:"beforeshow",afterShow:"aftershow",beforeHide:"beforehide",afterHide:"afterhide"},States={Init:_Base.Class.define(null,{name:"Init",hidden:!0,enter:function(){var dialog=this.dialog;dialog._dismissable=new _LightDismissService.ModalElement({element:dialog._dom.root,tabIndex:dialog._dom.root.hasAttribute("tabIndex")?dialog._dom.root.tabIndex:-1,onLightDismiss:function(){dialog.hide(DismissalResult.none)},onTakeFocus:function(useSetActive){dialog._dismissable.restoreFocus()||_ElementUtilities._tryFocusOnAnyElement(dialog._dom.dialog,useSetActive)}}),this.dialog._dismissedSignal=null,this.dialog._setState(States.Hidden,!1)},exit:_,show:function(){throw"It's illegal to call show on the Init state"},hide:_,onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_}),Hidden:_Base.Class.define(null,{name:"Hidden",hidden:!0,enter:function(showIsPending){showIsPending&&this.show()},exit:_,show:function(){var dismissedSignal=this.dialog._dismissedSignal=new _Signal;return this.dialog._setState(States.BeforeShow),dismissedSignal.promise},hide:_,onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_}),BeforeShow:_Base.Class.define(null,{name:"BeforeShow",hidden:!0,enter:function(){interruptible(this,function(that,ready){return ready.then(function(){return that.dialog._fireBeforeShow()}).then(function(shouldShow){return shouldShow||that.dialog._cancelDismissalPromise(null),shouldShow}).then(function(shouldShow){shouldShow?that.dialog._setState(States.Showing):that.dialog._setState(States.Hidden,!1)})})},exit:cancelInterruptibles,show:function(){return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing))},hide:_,onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_}),Showing:_Base.Class.define(null,{name:"Showing",hidden:{get:function(){return!!this._pendingHide}},enter:function(){interruptible(this,function(that,ready){return ready.then(function(){return that._pendingHide=null,_ElementUtilities.addClass(that.dialog._dom.root,ClassNames._visible),that.dialog._addExternalListeners(),_KeyboardInfo._KeyboardInfo._visible&&that.dialog._renderForInputPane(),_LightDismissService.shown(that.dialog._dismissable),that.dialog._playEntranceAnimation()}).then(function(){that.dialog._fireEvent(EventNames.afterShow)}).then(function(){that.dialog._setState(States.Shown,that._pendingHide)})})},exit:cancelInterruptibles,show:function(){if(this._pendingHide){var dismissalResult=this._pendingHide.dismissalResult;return this._pendingHide=null,this.dialog._resetDismissalPromise(dismissalResult,new _Signal).promise}return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing))},hide:function(dismissalResult){this._pendingHide={dismissalResult:dismissalResult}},onCommandClicked:_,onInputPaneShown:onInputPaneShown,onInputPaneHidden:onInputPaneHidden}),Shown:_Base.Class.define(null,{name:"Shown",hidden:!1,enter:function(pendingHide){pendingHide&&this.hide(pendingHide.dismissalResult)},exit:_,show:function(){return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing))},hide:function(dismissalResult){this.dialog._setState(States.BeforeHide,dismissalResult)},onCommandClicked:function(dismissalResult){this.hide(dismissalResult)},onInputPaneShown:onInputPaneShown,onInputPaneHidden:onInputPaneHidden}),BeforeHide:_Base.Class.define(null,{name:"BeforeHide",hidden:!1,enter:function(dismissalResult){interruptible(this,function(that,ready){return ready.then(function(){return that.dialog._fireBeforeHide(dismissalResult)}).then(function(shouldHide){shouldHide?that.dialog._setState(States.Hiding,dismissalResult):that.dialog._setState(States.Shown,null)})})},exit:cancelInterruptibles,show:function(){return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing))},hide:_,onCommandClicked:_,onInputPaneShown:onInputPaneShown,onInputPaneHidden:onInputPaneHidden}),Hiding:_Base.Class.define(null,{name:"Hiding",hidden:{get:function(){return!this._showIsPending}},enter:function(dismissalResult){interruptible(this,function(that,ready){return ready.then(function(){that._showIsPending=!1,that.dialog._resetDismissalPromise(dismissalResult,null)}).then(function(){return that.dialog._playExitAnimation()}).then(function(){that.dialog._removeExternalListeners(),_LightDismissService.hidden(that.dialog._dismissable),_ElementUtilities.removeClass(that.dialog._dom.root,ClassNames._visible),that.dialog._clearInputPaneRendering(),that.dialog._fireAfterHide(dismissalResult)}).then(function(){that.dialog._setState(States.Hidden,that._showIsPending)})})},exit:cancelInterruptibles,show:function(){return this._showIsPending?Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ContentDialogAlreadyShowing",Strings.contentDialogAlreadyShowing)):(this._showIsPending=!0,this.dialog._dismissedSignal=new _Signal,this.dialog._dismissedSignal.promise)},hide:function(dismissalResult){this._showIsPending&&(this._showIsPending=!1,this.dialog._resetDismissalPromise(dismissalResult,null))},onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_}),Disposed:_Base.Class.define(null,{name:"Disposed",hidden:!0,enter:function(){_LightDismissService.hidden(this.dialog._dismissable),this.dialog._removeExternalListeners(),this.dialog._dismissedSignal&&this.dialog._dismissedSignal.error(new _ErrorFromName("WinJS.UI.ContentDialog.ControlDisposed",Strings.controlDisposed))},exit:_,show:function(){return Promise.wrapError(new _ErrorFromName("WinJS.UI.ContentDialog.ControlDisposed",Strings.controlDisposed))},hide:_,onCommandClicked:_,onInputPaneShown:_,onInputPaneHidden:_})},ContentDialog=_Base.Class.define(function(element,options){if(element&&element.winControl)throw new _ErrorFromName("WinJS.UI.ContentDialog.DuplicateConstruction",Strings.duplicateConstruction);options=options||{},this._onInputPaneShownBound=this._onInputPaneShown.bind(this),this._onInputPaneHiddenBound=this._onInputPaneHidden.bind(this),this._onUpdateInputPaneRenderingBound=this._onUpdateInputPaneRendering.bind(this),this._disposed=!1,this._currentFocus=null,this._rendered={registeredForResize:!1,resizedForInputPane:!1,top:"",bottom:""},this._initializeDom(element||_Global.document.createElement("div")),this._setState(States.Init),this.title="",this.primaryCommandText="",this.primaryCommandDisabled=!1,this.secondaryCommandText="",this.secondaryCommandDisabled=!1,_Control.setOptions(this,options)},{element:{get:function(){return this._dom.root}},title:{get:function(){return this._title},set:function(value){value=value||"",this._title!==value&&(this._title=value,this._dom.title.textContent=value,this._dom.title.style.display=value?"":"none")}},primaryCommandText:{get:function(){return this._primaryCommandText},set:function(value){value=value||"",this._primaryCommandText!==value&&(this._primaryCommandText=value,this._dom.commands[0].textContent=value,this._updateCommandsUI())}},secondaryCommandText:{get:function(){return this._secondaryCommandText},set:function(value){value=value||"",this._secondaryCommandText!==value&&(this._secondaryCommandText=value,this._dom.commands[1].textContent=value,this._updateCommandsUI())}},primaryCommandDisabled:{get:function(){return this._primaryCommandDisabled},set:function(value){value=!!value,this._primaryCommandDisabled!==value&&(this._primaryCommandDisabled=value,this._dom.commands[0].disabled=value)}},secondaryCommandDisabled:{get:function(){return this._secondaryCommandDisabled},set:function(value){value=!!value,this._secondaryCommandDisabled!==value&&(this._secondaryCommandDisabled=value,this._dom.commands[1].disabled=value)}},hidden:{get:function(){return this._state.hidden},set:function(hidden){if(!hidden&&this._state.hidden){var nop=function(){};this.show().done(nop,nop)}else hidden&&!this._state.hidden&&this.hide(DismissalResult.none)}},dispose:function(){this._disposed||(this._setState(States.Disposed),this._disposed=!0,_ElementUtilities._resizeNotifier.unsubscribe(this._dom.root,this._onUpdateInputPaneRenderingBound),_Dispose._disposeElement(this._dom.content))},show:function(){return this._state.show()},hide:function(result){this._state.hide(void 0===result?DismissalResult.none:result)},_initializeDom:function(root){var contentEl=_Global.document.createElement("div");contentEl.className=ClassNames.content,_ElementUtilities._reparentChildren(root,contentEl),root.winControl=this,_ElementUtilities.addClass(root,ClassNames.contentDialog),_ElementUtilities.addClass(root,ClassNames._verticalAlignment),_ElementUtilities.addClass(root,"win-disposable"),root.innerHTML='<div class="'+ClassNames.backgroundOverlay+'"></div><div class="'+ClassNames._tabStop+'"></div><div tabindex="-1" role="dialog" class="'+ClassNames.dialog+'"><h2 class="'+ClassNames.title+'" role="heading"></h2><div class="'+ClassNames._scroller+'"></div><div class="'+ClassNames.commands+'"><button type="button" class="'+ClassNames._commandSpacer+' win-button"></button><button type="button" class="'+ClassNames.primaryCommand+' win-button"></button><button type="button" class="'+ClassNames.secondaryCommand+' win-button"></button></div></div><div class="'+ClassNames._tabStop+'"></div><div class="'+ClassNames._column0or1+'"></div>';var dom={};dom.root=root,dom.backgroundOverlay=dom.root.firstElementChild,dom.startBodyTab=dom.backgroundOverlay.nextElementSibling,dom.dialog=dom.startBodyTab.nextElementSibling,dom.title=dom.dialog.firstElementChild,dom.scroller=dom.title.nextElementSibling,dom.commandContainer=dom.scroller.nextElementSibling,dom.commandSpacer=dom.commandContainer.firstElementChild,dom.commands=[],dom.commands.push(dom.commandSpacer.nextElementSibling),dom.commands.push(dom.commands[0].nextElementSibling),dom.endBodyTab=dom.dialog.nextElementSibling,dom.content=contentEl,this._dom=dom,dom.scroller.appendChild(dom.content),_ElementUtilities._ensureId(dom.title),_ElementUtilities._ensureId(dom.startBodyTab),_ElementUtilities._ensureId(dom.endBodyTab),dom.dialog.setAttribute("aria-labelledby",dom.title.id),dom.startBodyTab.setAttribute("x-ms-aria-flowfrom",dom.endBodyTab.id),dom.endBodyTab.setAttribute("aria-flowto",dom.startBodyTab.id),this._updateTabIndices(),dom.root.addEventListener("keydown",this._onKeyDownEnteringElement.bind(this),!0),_ElementUtilities._addEventListener(dom.root,"pointerdown",this._onPointerDown.bind(this)),_ElementUtilities._addEventListener(dom.root,"pointerup",this._onPointerUp.bind(this)),
dom.root.addEventListener("click",this._onClick.bind(this)),_ElementUtilities._addEventListener(dom.startBodyTab,"focusin",this._onStartBodyTabFocusIn.bind(this)),_ElementUtilities._addEventListener(dom.endBodyTab,"focusin",this._onEndBodyTabFocusIn.bind(this)),dom.commands[0].addEventListener("click",this._onCommandClicked.bind(this,DismissalResult.primary)),dom.commands[1].addEventListener("click",this._onCommandClicked.bind(this,DismissalResult.secondary)),supportsMsDevicedFixed()&&_ElementUtilities.addClass(dom.root,ClassNames._deviceFixedSupported)},_updateCommandsUI:function(){this._dom.commands[0].style.display=this.primaryCommandText?"":"none",this._dom.commands[1].style.display=this.secondaryCommandText?"":"none",this._dom.commandSpacer.style.display=this.primaryCommandText&&!this.secondaryCommandText||!this.primaryCommandText&&this.secondaryCommandText?"":"none"},_updateTabIndices:function(){this._updateTabIndicesThrottled||(this._updateTabIndicesThrottled=_BaseUtils._throttledFunction(100,this._updateTabIndicesImpl.bind(this))),this._updateTabIndicesThrottled()},_updateTabIndicesImpl:function(){var tabIndex=_ElementUtilities._getHighAndLowTabIndices(this._dom.content);this._dom.startBodyTab.tabIndex=tabIndex.lowest,this._dom.commands[0].tabIndex=tabIndex.highest,this._dom.commands[1].tabIndex=tabIndex.highest,this._dom.endBodyTab.tabIndex=tabIndex.highest},_elementInDialog:function(element){return this._dom.dialog.contains(element)||element===this._dom.startBodyTab||element===this._dom.endBodyTab},_onCommandClicked:function(dismissalResult){this._state.onCommandClicked(dismissalResult)},_onPointerDown:function(eventObject){eventObject.stopPropagation(),this._elementInDialog(eventObject.target)||eventObject.preventDefault()},_onPointerUp:function(eventObject){eventObject.stopPropagation(),this._elementInDialog(eventObject.target)||eventObject.preventDefault()},_onClick:function(eventObject){eventObject.stopPropagation(),this._elementInDialog(eventObject.target)||eventObject.preventDefault()},_onKeyDownEnteringElement:function(eventObject){eventObject.keyCode===_ElementUtilities.Key.tab&&this._updateTabIndices()},_onStartBodyTabFocusIn:function(){_ElementUtilities._focusLastFocusableElement(this._dom.dialog)},_onEndBodyTabFocusIn:function(){_ElementUtilities._focusFirstFocusableElement(this._dom.dialog)},_onInputPaneShown:function(eventObject){this._state.onInputPaneShown(eventObject.detail.originalEvent)},_onInputPaneHidden:function(){this._state.onInputPaneHidden()},_onUpdateInputPaneRendering:function(){this._renderForInputPane()},_setState:function(NewState,arg0){this._disposed||(this._state&&this._state.exit(),this._state=new NewState,this._state.dialog=this,this._state.enter(arg0))},_resetDismissalPromise:function(dismissalResult,newSignal){var dismissedSignal=this._dismissedSignal,newDismissedSignal=this._dismissedSignal=newSignal;return dismissedSignal.complete({result:dismissalResult}),newDismissedSignal},_cancelDismissalPromise:function(newSignal){var dismissedSignal=this._dismissedSignal,newDismissedSignal=this._dismissedSignal=newSignal;return dismissedSignal.cancel(),newDismissedSignal},_fireEvent:function(eventName,options){options=options||{};var detail=options.detail||null,cancelable=!!options.cancelable,eventObject=_Global.document.createEvent("CustomEvent");return eventObject.initCustomEvent(eventName,!0,cancelable,detail),this._dom.root.dispatchEvent(eventObject)},_fireBeforeShow:function(){return this._fireEvent(EventNames.beforeShow,{cancelable:!0})},_fireBeforeHide:function(dismissalResult){return this._fireEvent(EventNames.beforeHide,{detail:{result:dismissalResult},cancelable:!0})},_fireAfterHide:function(dismissalResult){this._fireEvent(EventNames.afterHide,{detail:{result:dismissalResult}})},_playEntranceAnimation:function(){return cancelablePromise(_Animations.fadeIn(this._dom.root))},_playExitAnimation:function(){return cancelablePromise(_Animations.fadeOut(this._dom.root))},_addExternalListeners:function(){_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"showing",this._onInputPaneShownBound),_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"hiding",this._onInputPaneHiddenBound)},_removeExternalListeners:function(){_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"showing",this._onInputPaneShownBound),_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"hiding",this._onInputPaneHiddenBound)},_shouldResizeForInputPane:function(){if(this._rendered.resizedForInputPane)return!0;var dialogRect=this._dom.dialog.getBoundingClientRect(),willInputPaneOccludeDialog=_KeyboardInfo._KeyboardInfo._visibleDocTop>dialogRect.top||_KeyboardInfo._KeyboardInfo._visibleDocBottom<dialogRect.bottom;return willInputPaneOccludeDialog},_renderForInputPane:function(){var rendered=this._rendered;if(rendered.registeredForResize||(_ElementUtilities._resizeNotifier.subscribe(this._dom.root,this._onUpdateInputPaneRenderingBound),rendered.registeredForResize=!0),this._shouldResizeForInputPane()){var top=_KeyboardInfo._KeyboardInfo._visibleDocTop+"px",bottom=_KeyboardInfo._KeyboardInfo._visibleDocBottomOffset+"px";if(rendered.top!==top&&(this._dom.root.style.top=top,rendered.top=top),rendered.bottom!==bottom&&(this._dom.root.style.bottom=bottom,rendered.bottom=bottom),!rendered.resizedForInputPane){this._dom.scroller.insertBefore(this._dom.title,this._dom.content),this._dom.root.style.height="auto";var activeElement=_Global.document.activeElement;activeElement&&this._dom.scroller.contains(activeElement)&&activeElement.scrollIntoView(),rendered.resizedForInputPane=!0}}},_clearInputPaneRendering:function(){var rendered=this._rendered;rendered.registeredForResize&&(_ElementUtilities._resizeNotifier.unsubscribe(this._dom.root,this._onUpdateInputPaneRenderingBound),rendered.registeredForResize=!1),""!==rendered.top&&(this._dom.root.style.top="",rendered.top=""),""!==rendered.bottom&&(this._dom.root.style.bottom="",rendered.bottom=""),rendered.resizedForInputPane&&(this._dom.dialog.insertBefore(this._dom.title,this._dom.scroller),this._dom.root.style.height="",rendered.resizedForInputPane=!1)}},{DismissalResult:DismissalResult,_ClassNames:ClassNames});return _Base.Class.mix(ContentDialog,_Events.createEventProperties("beforeshow","aftershow","beforehide","afterhide")),_Base.Class.mix(ContentDialog,_Control.DOMEventMixin),ContentDialog})})}),define("require-style!less/styles-splitview",[],function(){}),define("require-style!less/colors-splitview",[],function(){}),define("WinJS/Controls/SplitView/_SplitView",["require","exports","../../Animations","../../Core/_Base","../../Core/_BaseUtils","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../_LightDismissService","../../Utilities/_OpenCloseMachine"],function(require,exports,Animations,_Base,_BaseUtils,_Control,_Dispose,_ElementUtilities,_ErrorFromName,_Events,_Global,_LightDismissService,_OpenCloseMachine){function addClass(element,className){className&&_ElementUtilities.addClass(element,className)}function removeClass(element,className){className&&_ElementUtilities.removeClass(element,className)}function rectToThickness(rect,dimension){return dimension===Dimension.width?{content:rect.contentWidth,total:rect.totalWidth}:{content:rect.contentHeight,total:rect.totalHeight}}require(["require-style!less/styles-splitview"]),require(["require-style!less/colors-splitview"]);var transformNames=_BaseUtils._browserStyleEquivalents.transform,Strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},ClassNames={splitView:"win-splitview",pane:"win-splitview-pane",content:"win-splitview-content",paneClosed:"win-splitview-pane-closed",paneOpened:"win-splitview-pane-opened",_panePlaceholder:"win-splitview-paneplaceholder",_paneOutline:"win-splitview-paneoutline",_tabStop:"win-splitview-tabstop",_paneWrapper:"win-splitview-panewrapper",_contentWrapper:"win-splitview-contentwrapper",_animating:"win-splitview-animating",_placementLeft:"win-splitview-placementleft",_placementRight:"win-splitview-placementright",_placementTop:"win-splitview-placementtop",_placementBottom:"win-splitview-placementbottom",_closedDisplayNone:"win-splitview-closeddisplaynone",_closedDisplayInline:"win-splitview-closeddisplayinline",_openedDisplayInline:"win-splitview-openeddisplayinline",_openedDisplayOverlay:"win-splitview-openeddisplayoverlay"},EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose"},Dimension={width:"width",height:"height"},ClosedDisplayMode={none:"none",inline:"inline"},OpenedDisplayMode={inline:"inline",overlay:"overlay"},PanePlacement={left:"left",right:"right",top:"top",bottom:"bottom"},closedDisplayModeClassMap={};closedDisplayModeClassMap[ClosedDisplayMode.none]=ClassNames._closedDisplayNone,closedDisplayModeClassMap[ClosedDisplayMode.inline]=ClassNames._closedDisplayInline;var openedDisplayModeClassMap={};openedDisplayModeClassMap[OpenedDisplayMode.overlay]=ClassNames._openedDisplayOverlay,openedDisplayModeClassMap[OpenedDisplayMode.inline]=ClassNames._openedDisplayInline;var panePlacementClassMap={};panePlacementClassMap[PanePlacement.left]=ClassNames._placementLeft,panePlacementClassMap[PanePlacement.right]=ClassNames._placementRight,panePlacementClassMap[PanePlacement.top]=ClassNames._placementTop,panePlacementClassMap[PanePlacement.bottom]=ClassNames._placementBottom;var SplitView=function(){function SplitView(element,options){var _this=this;if(void 0===options&&(options={}),this._updateDomImpl_rendered={paneIsFirst:void 0,isOpenedMode:void 0,closedDisplayMode:void 0,openedDisplayMode:void 0,panePlacement:void 0,panePlaceholderWidth:void 0,panePlaceholderHeight:void 0,isOverlayShown:void 0,startPaneTabIndex:void 0,endPaneTabIndex:void 0},element&&element.winControl)throw new _ErrorFromName("WinJS.UI.SplitView.DuplicateConstruction",Strings.duplicateConstruction);this._initializeDom(element||_Global.document.createElement("div")),this._machine=new _OpenCloseMachine.OpenCloseMachine({eventElement:this._dom.root,onOpen:function(){_this._cachedHiddenPaneThickness=null;var hiddenPaneThickness=_this._getHiddenPaneThickness();return _this._isOpenedMode=!0,_this._updateDomImpl(),_ElementUtilities.addClass(_this._dom.root,ClassNames._animating),_this._playShowAnimation(hiddenPaneThickness).then(function(){_ElementUtilities.removeClass(_this._dom.root,ClassNames._animating)})},onClose:function(){return _ElementUtilities.addClass(_this._dom.root,ClassNames._animating),_this._playHideAnimation(_this._getHiddenPaneThickness()).then(function(){_ElementUtilities.removeClass(_this._dom.root,ClassNames._animating),_this._isOpenedMode=!1,_this._updateDomImpl()})},onUpdateDom:function(){_this._updateDomImpl()},onUpdateDomWithIsOpened:function(isOpened){_this._isOpenedMode=isOpened,_this._updateDomImpl()}}),this._disposed=!1,this._dismissable=new _LightDismissService.LightDismissableElement({element:this._dom.paneWrapper,tabIndex:-1,onLightDismiss:function(){_this.closePane()},onTakeFocus:function(useSetActive){_this._dismissable.restoreFocus()||_ElementUtilities._tryFocusOnAnyElement(_this._dom.pane,useSetActive)}}),this._cachedHiddenPaneThickness=null,this.paneOpened=!1,this.closedDisplayMode=ClosedDisplayMode.inline,this.openedDisplayMode=OpenedDisplayMode.overlay,this.panePlacement=PanePlacement.left,_Control.setOptions(this,options),_ElementUtilities._inDom(this._dom.root).then(function(){_this._rtl="rtl"===_ElementUtilities._getComputedStyle(_this._dom.root).direction,_this._updateTabIndices(),_this._machine.exitInit()})}return Object.defineProperty(SplitView.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"paneElement",{get:function(){return this._dom.pane},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"contentElement",{get:function(){return this._dom.content},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"closedDisplayMode",{get:function(){return this._closedDisplayMode},set:function(value){ClosedDisplayMode[value]&&this._closedDisplayMode!==value&&(this._closedDisplayMode=value,this._cachedHiddenPaneThickness=null,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"openedDisplayMode",{get:function(){return this._openedDisplayMode},set:function(value){OpenedDisplayMode[value]&&this._openedDisplayMode!==value&&(this._openedDisplayMode=value,this._cachedHiddenPaneThickness=null,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"panePlacement",{get:function(){return this._panePlacement},set:function(value){PanePlacement[value]&&this._panePlacement!==value&&(this._panePlacement=value,this._cachedHiddenPaneThickness=null,this._machine.updateDom())},enumerable:!0,configurable:!0}),Object.defineProperty(SplitView.prototype,"paneOpened",{get:function(){return this._machine.opened},set:function(value){this._machine.opened=value},enumerable:!0,configurable:!0}),SplitView.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._machine.dispose(),_LightDismissService.hidden(this._dismissable),_Dispose._disposeElement(this._dom.pane),_Dispose._disposeElement(this._dom.content))},SplitView.prototype.openPane=function(){this._machine.open()},SplitView.prototype.closePane=function(){this._machine.close()},SplitView.prototype._initializeDom=function(root){var paneEl=root.firstElementChild||_Global.document.createElement("div");_ElementUtilities.addClass(paneEl,ClassNames.pane),paneEl.hasAttribute("tabIndex")||(paneEl.tabIndex=-1);var contentEl=_Global.document.createElement("div");_ElementUtilities.addClass(contentEl,ClassNames.content);for(var child=paneEl.nextSibling;child;){var sibling=child.nextSibling;contentEl.appendChild(child),child=sibling}var startPaneTabEl=_Global.document.createElement("div");startPaneTabEl.className=ClassNames._tabStop,_ElementUtilities._ensureId(startPaneTabEl);var endPaneTabEl=_Global.document.createElement("div");endPaneTabEl.className=ClassNames._tabStop,_ElementUtilities._ensureId(endPaneTabEl);var paneOutlineEl=_Global.document.createElement("div");paneOutlineEl.className=ClassNames._paneOutline;var paneWrapperEl=_Global.document.createElement("div");paneWrapperEl.className=ClassNames._paneWrapper,paneWrapperEl.appendChild(startPaneTabEl),paneWrapperEl.appendChild(paneEl),paneWrapperEl.appendChild(paneOutlineEl),paneWrapperEl.appendChild(endPaneTabEl);var panePlaceholderEl=_Global.document.createElement("div");panePlaceholderEl.className=ClassNames._panePlaceholder;var contentWrapperEl=_Global.document.createElement("div");contentWrapperEl.className=ClassNames._contentWrapper,contentWrapperEl.appendChild(contentEl),root.winControl=this,_ElementUtilities.addClass(root,ClassNames.splitView),_ElementUtilities.addClass(root,"win-disposable"),this._dom={root:root,pane:paneEl,startPaneTab:startPaneTabEl,endPaneTab:endPaneTabEl,paneOutline:paneOutlineEl,paneWrapper:paneWrapperEl,panePlaceholder:panePlaceholderEl,content:contentEl,contentWrapper:contentWrapperEl},_ElementUtilities._addEventListener(paneEl,"keydown",this._onKeyDown.bind(this)),_ElementUtilities._addEventListener(startPaneTabEl,"focusin",this._onStartPaneTabFocusIn.bind(this)),_ElementUtilities._addEventListener(endPaneTabEl,"focusin",this._onEndPaneTabFocusIn.bind(this))},SplitView.prototype._onKeyDown=function(eventObject){eventObject.keyCode===_ElementUtilities.Key.tab&&this._updateTabIndices()},SplitView.prototype._onStartPaneTabFocusIn=function(eventObject){_ElementUtilities._focusLastFocusableElement(this._dom.pane)},SplitView.prototype._onEndPaneTabFocusIn=function(eventObject){_ElementUtilities._focusFirstFocusableElement(this._dom.pane)},SplitView.prototype._measureElement=function(element){var style=_ElementUtilities._getComputedStyle(element),position=_ElementUtilities._getPositionRelativeTo(element,this._dom.root),marginLeft=parseInt(style.marginLeft,10),marginTop=parseInt(style.marginTop,10);return{left:position.left-marginLeft,top:position.top-marginTop,contentWidth:_ElementUtilities.getContentWidth(element),contentHeight:_ElementUtilities.getContentHeight(element),totalWidth:_ElementUtilities.getTotalWidth(element),totalHeight:_ElementUtilities.getTotalHeight(element)}},SplitView.prototype._setContentRect=function(contentRect){var contentWrapperStyle=this._dom.contentWrapper.style;contentWrapperStyle.left=contentRect.left+"px",contentWrapperStyle.top=contentRect.top+"px",contentWrapperStyle.height=contentRect.contentHeight+"px",contentWrapperStyle.width=contentRect.contentWidth+"px"},SplitView.prototype._prepareAnimation=function(paneRect,contentRect){var paneWrapperStyle=this._dom.paneWrapper.style;paneWrapperStyle.position="absolute",paneWrapperStyle.left=paneRect.left+"px",paneWrapperStyle.top=paneRect.top+"px",paneWrapperStyle.height=paneRect.totalHeight+"px",paneWrapperStyle.width=paneRect.totalWidth+"px";var contentWrapperStyle=this._dom.contentWrapper.style;contentWrapperStyle.position="absolute",this._setContentRect(contentRect)},SplitView.prototype._clearAnimation=function(){var paneWrapperStyle=this._dom.paneWrapper.style;paneWrapperStyle.position="",paneWrapperStyle.left="",paneWrapperStyle.top="",paneWrapperStyle.height="",paneWrapperStyle.width="",paneWrapperStyle[transformNames.scriptName]="";var contentWrapperStyle=this._dom.contentWrapper.style;contentWrapperStyle.position="",contentWrapperStyle.left="",contentWrapperStyle.top="",contentWrapperStyle.height="",contentWrapperStyle.width="",contentWrapperStyle[transformNames.scriptName]="";var paneStyle=this._dom.pane.style;paneStyle.height="",paneStyle.width="",paneStyle[transformNames.scriptName]=""},SplitView.prototype._getHiddenContentRect=function(shownContentRect,hiddenPaneThickness,shownPaneThickness){if(this.openedDisplayMode===OpenedDisplayMode.overlay)return shownContentRect;var placementRight=this._rtl?PanePlacement.left:PanePlacement.right,multiplier=this.panePlacement===placementRight||this.panePlacement===PanePlacement.bottom?0:1,paneDiff={content:shownPaneThickness.content-hiddenPaneThickness.content,total:shownPaneThickness.total-hiddenPaneThickness.total};return this._horizontal?{left:shownContentRect.left-multiplier*paneDiff.total,top:shownContentRect.top,contentWidth:shownContentRect.contentWidth+paneDiff.content,contentHeight:shownContentRect.contentHeight,totalWidth:shownContentRect.totalWidth+paneDiff.total,totalHeight:shownContentRect.totalHeight}:{left:shownContentRect.left,top:shownContentRect.top-multiplier*paneDiff.total,contentWidth:shownContentRect.contentWidth,contentHeight:shownContentRect.contentHeight+paneDiff.content,totalWidth:shownContentRect.totalWidth,totalHeight:shownContentRect.totalHeight+paneDiff.total}},Object.defineProperty(SplitView.prototype,"_horizontal",{get:function(){return this.panePlacement===PanePlacement.left||this.panePlacement===PanePlacement.right},enumerable:!0,configurable:!0}),SplitView.prototype._getHiddenPaneThickness=function(){if(null===this._cachedHiddenPaneThickness)if(this._closedDisplayMode===ClosedDisplayMode.none)this._cachedHiddenPaneThickness={content:0,total:0};else{this._isOpenedMode&&(_ElementUtilities.removeClass(this._dom.root,ClassNames.paneOpened),_ElementUtilities.addClass(this._dom.root,ClassNames.paneClosed));var size=this._measureElement(this._dom.pane);this._cachedHiddenPaneThickness=rectToThickness(size,this._horizontal?Dimension.width:Dimension.height),this._isOpenedMode&&(_ElementUtilities.removeClass(this._dom.root,ClassNames.paneClosed),_ElementUtilities.addClass(this._dom.root,ClassNames.paneOpened))}return this._cachedHiddenPaneThickness},SplitView.prototype._playShowAnimation=function(hiddenPaneThickness){var _this=this,dim=this._horizontal?Dimension.width:Dimension.height,shownPaneRect=this._measureElement(this._dom.pane),shownContentRect=this._measureElement(this._dom.content),shownPaneThickness=rectToThickness(shownPaneRect,dim),hiddenContentRect=this._getHiddenContentRect(shownContentRect,hiddenPaneThickness,shownPaneThickness);this._prepareAnimation(shownPaneRect,hiddenContentRect);var playPaneAnimation=function(){var placementRight=_this._rtl?PanePlacement.left:PanePlacement.right,animationOffsetFactor=.3,from=hiddenPaneThickness.total+animationOffsetFactor*(shownPaneThickness.total-hiddenPaneThickness.total);return Animations._resizeTransition(_this._dom.paneWrapper,_this._dom.pane,{from:from,to:shownPaneThickness.total,actualSize:shownPaneThickness.total,dimension:dim,anchorTrailingEdge:_this.panePlacement===placementRight||_this.panePlacement===PanePlacement.bottom})},playShowAnimation=function(){return _this.openedDisplayMode===OpenedDisplayMode.inline&&_this._setContentRect(shownContentRect),playPaneAnimation()};return playShowAnimation().then(function(){_this._clearAnimation()})},SplitView.prototype._playHideAnimation=function(hiddenPaneThickness){var _this=this,dim=this._horizontal?Dimension.width:Dimension.height,shownPaneRect=this._measureElement(this._dom.pane),shownContentRect=this._measureElement(this._dom.content),shownPaneThickness=rectToThickness(shownPaneRect,dim),hiddenContentRect=this._getHiddenContentRect(shownContentRect,hiddenPaneThickness,shownPaneThickness);this._prepareAnimation(shownPaneRect,shownContentRect);var playPaneAnimation=function(){var placementRight=_this._rtl?PanePlacement.left:PanePlacement.right,animationOffsetFactor=.3,from=shownPaneThickness.total-animationOffsetFactor*(shownPaneThickness.total-hiddenPaneThickness.total);return Animations._resizeTransition(_this._dom.paneWrapper,_this._dom.pane,{from:from,to:hiddenPaneThickness.total,actualSize:shownPaneThickness.total,dimension:dim,anchorTrailingEdge:_this.panePlacement===placementRight||_this.panePlacement===PanePlacement.bottom})},playHideAnimation=function(){return _this.openedDisplayMode===OpenedDisplayMode.inline&&_this._setContentRect(hiddenContentRect),playPaneAnimation()};return playHideAnimation().then(function(){_this._clearAnimation()})},SplitView.prototype._updateTabIndices=function(){this._updateTabIndicesThrottled||(this._updateTabIndicesThrottled=_BaseUtils._throttledFunction(100,this._updateTabIndicesImpl.bind(this))),this._updateTabIndicesThrottled()},SplitView.prototype._updateTabIndicesImpl=function(){var tabIndex=_ElementUtilities._getHighAndLowTabIndices(this._dom.pane);this._highestPaneTabIndex=tabIndex.highest,this._lowestPaneTabIndex=tabIndex.lowest,this._machine.updateDom()},SplitView.prototype._updateDomImpl=function(){var rendered=this._updateDomImpl_rendered,paneShouldBeFirst=this.panePlacement===PanePlacement.left||this.panePlacement===PanePlacement.top;paneShouldBeFirst!==rendered.paneIsFirst&&(paneShouldBeFirst?(this._dom.root.appendChild(this._dom.panePlaceholder),this._dom.root.appendChild(this._dom.paneWrapper),this._dom.root.appendChild(this._dom.contentWrapper)):(this._dom.root.appendChild(this._dom.contentWrapper),this._dom.root.appendChild(this._dom.paneWrapper),this._dom.root.appendChild(this._dom.panePlaceholder))),rendered.paneIsFirst=paneShouldBeFirst,rendered.isOpenedMode!==this._isOpenedMode&&(this._isOpenedMode?(_ElementUtilities.removeClass(this._dom.root,ClassNames.paneClosed),_ElementUtilities.addClass(this._dom.root,ClassNames.paneOpened)):(_ElementUtilities.removeClass(this._dom.root,ClassNames.paneOpened),_ElementUtilities.addClass(this._dom.root,ClassNames.paneClosed))),rendered.isOpenedMode=this._isOpenedMode,rendered.panePlacement!==this.panePlacement&&(removeClass(this._dom.root,panePlacementClassMap[rendered.panePlacement]),addClass(this._dom.root,panePlacementClassMap[this.panePlacement]),rendered.panePlacement=this.panePlacement),rendered.closedDisplayMode!==this.closedDisplayMode&&(removeClass(this._dom.root,closedDisplayModeClassMap[rendered.closedDisplayMode]),addClass(this._dom.root,closedDisplayModeClassMap[this.closedDisplayMode]),rendered.closedDisplayMode=this.closedDisplayMode),rendered.openedDisplayMode!==this.openedDisplayMode&&(removeClass(this._dom.root,openedDisplayModeClassMap[rendered.openedDisplayMode]),addClass(this._dom.root,openedDisplayModeClassMap[this.openedDisplayMode]),rendered.openedDisplayMode=this.openedDisplayMode);var isOverlayShown=this._isOpenedMode&&this.openedDisplayMode===OpenedDisplayMode.overlay,startPaneTabIndex=isOverlayShown?this._lowestPaneTabIndex:-1,endPaneTabIndex=isOverlayShown?this._highestPaneTabIndex:-1;rendered.startPaneTabIndex!==startPaneTabIndex&&(this._dom.startPaneTab.tabIndex=startPaneTabIndex,startPaneTabIndex===-1?this._dom.startPaneTab.removeAttribute("x-ms-aria-flowfrom"):this._dom.startPaneTab.setAttribute("x-ms-aria-flowfrom",this._dom.endPaneTab.id),rendered.startPaneTabIndex=startPaneTabIndex),rendered.endPaneTabIndex!==endPaneTabIndex&&(this._dom.endPaneTab.tabIndex=endPaneTabIndex,endPaneTabIndex===-1?this._dom.endPaneTab.removeAttribute("aria-flowto"):this._dom.endPaneTab.setAttribute("aria-flowto",this._dom.startPaneTab.id),rendered.endPaneTabIndex=endPaneTabIndex);var width,height;if(isOverlayShown){var hiddenPaneThickness=this._getHiddenPaneThickness();this._horizontal?(width=hiddenPaneThickness.total+"px",height=""):(width="",height=hiddenPaneThickness.total+"px")}else width="",height="";if(rendered.panePlaceholderWidth!==width||rendered.panePlaceholderHeight!==height){var style=this._dom.panePlaceholder.style;style.width=width,style.height=height,rendered.panePlaceholderWidth=width,rendered.panePlaceholderHeight=height}rendered.isOverlayShown!==isOverlayShown&&(isOverlayShown?_LightDismissService.shown(this._dismissable):_LightDismissService.hidden(this._dismissable),rendered.isOverlayShown=isOverlayShown)},SplitView.ClosedDisplayMode=ClosedDisplayMode,SplitView.OpenedDisplayMode=OpenedDisplayMode,SplitView.PanePlacement=PanePlacement,SplitView.supportedForProcessing=!0,SplitView._ClassNames=ClassNames,SplitView}();exports.SplitView=SplitView,_Base.Class.mix(SplitView,_Events.createEventProperties(EventNames.beforeOpen,EventNames.afterOpen,EventNames.beforeClose,EventNames.afterClose)),_Base.Class.mix(SplitView,_Control.DOMEventMixin)}),define("WinJS/Controls/SplitView",["require","exports","../Core/_Base"],function(require,exports,_Base){var module=null;_Base.Namespace.define("WinJS.UI",{SplitView:{get:function(){return module||require(["./SplitView/_SplitView"],function(m){module=m}),module.SplitView}}})}),define("require-style!less/styles-splitviewpanetoggle",[],function(){}),define("require-style!less/colors-splitviewpanetoggle",[],function(){}),define("WinJS/Controls/SplitViewPaneToggle/_SplitViewPaneToggle",["require","exports","../../Core/_Base","../../Utilities/_Control","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../Utilities/_KeyboardBehavior","../../Utilities/_Hoverable"],function(require,exports,_Base,_Control,_ElementUtilities,_ErrorFromName,_Events,_Global,_KeyboardBehavior,_Hoverable){function getSplitViewControl(splitViewElement){return splitViewElement&&splitViewElement.winControl}function getPaneOpened(splitViewElement){var splitViewControl=getSplitViewControl(splitViewElement);return!!splitViewControl&&splitViewControl.paneOpened}_Hoverable.isHoverable,require(["require-style!less/styles-splitviewpanetoggle"]),require(["require-style!less/colors-splitviewpanetoggle"]);var ClassNames={splitViewPaneToggle:"win-splitviewpanetoggle"},EventNames={invoked:"invoked"},Strings={get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"},get badButtonElement(){return"Invalid argument: The SplitViewPaneToggle's element must be a button element"}},SplitViewPaneToggle=function(){function SplitViewPaneToggle(element,options){if(void 0===options&&(options={}),this._updateDom_rendered={splitView:void 0},element&&element.winControl)throw new _ErrorFromName("WinJS.UI.SplitViewPaneToggle.DuplicateConstruction",Strings.duplicateConstruction);this._onPaneStateSettledBound=this._onPaneStateSettled.bind(this),this._ariaExpandedMutationObserver=new _ElementUtilities._MutationObserver(this._onAriaExpandedPropertyChanged.bind(this)),this._initializeDom(element||_Global.document.createElement("button")),this._disposed=!1,this.splitView=null,_Control.setOptions(this,options),this._initialized=!0,this._updateDom()}return Object.defineProperty(SplitViewPaneToggle.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(SplitViewPaneToggle.prototype,"splitView",{get:function(){return this._splitView},set:function(splitView){this._splitView=splitView,splitView&&(this._opened=getPaneOpened(splitView)),this._updateDom()},enumerable:!0,configurable:!0}),SplitViewPaneToggle.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._splitView&&this._removeListeners(this._splitView))},SplitViewPaneToggle.prototype._initializeDom=function(root){if("BUTTON"!==root.tagName)throw new _ErrorFromName("WinJS.UI.SplitViewPaneToggle.BadButtonElement",Strings.badButtonElement);root.winControl=this,_ElementUtilities.addClass(root,ClassNames.splitViewPaneToggle),_ElementUtilities.addClass(root,"win-disposable"),root.hasAttribute("type")||(root.type="button"),new _KeyboardBehavior._WinKeyboard(root),root.addEventListener("click",this._onClick.bind(this)),this._dom={root:root}},SplitViewPaneToggle.prototype._updateDom=function(){if(this._initialized&&!this._disposed){var rendered=this._updateDom_rendered;if(this._splitView!==rendered.splitView&&(rendered.splitView&&(this._dom.root.removeAttribute("aria-controls"),this._removeListeners(rendered.splitView)),this._splitView&&(_ElementUtilities._ensureId(this._splitView),this._dom.root.setAttribute("aria-controls",this._splitView.id),this._addListeners(this._splitView)),rendered.splitView=this._splitView),this._splitView){var expanded=this._opened?"true":"false";_ElementUtilities._setAttribute(this._dom.root,"aria-expanded",expanded);var splitViewControl=getSplitViewControl(this._splitView);splitViewControl&&(splitViewControl.paneOpened=this._opened)}}},SplitViewPaneToggle.prototype._addListeners=function(splitViewElement){splitViewElement.addEventListener("_openCloseStateSettled",this._onPaneStateSettledBound),this._ariaExpandedMutationObserver.observe(this._dom.root,{attributes:!0,attributeFilter:["aria-expanded"]})},SplitViewPaneToggle.prototype._removeListeners=function(splitViewElement){splitViewElement.removeEventListener("_openCloseStateSettled",this._onPaneStateSettledBound),this._ariaExpandedMutationObserver.disconnect()},SplitViewPaneToggle.prototype._fireEvent=function(eventName){var eventObject=_Global.document.createEvent("CustomEvent");return eventObject.initCustomEvent(eventName,!0,!1,null),this._dom.root.dispatchEvent(eventObject)},SplitViewPaneToggle.prototype._onPaneStateSettled=function(eventObject){eventObject.target===this._splitView&&(this._opened=getPaneOpened(this._splitView),this._updateDom())},SplitViewPaneToggle.prototype._onAriaExpandedPropertyChanged=function(mutations){var ariaExpanded="true"===this._dom.root.getAttribute("aria-expanded");this._opened=ariaExpanded,this._updateDom()},SplitViewPaneToggle.prototype._onClick=function(eventObject){this._invoked()},SplitViewPaneToggle.prototype._invoked=function(){this._disposed||(this._splitView&&(this._opened=!this._opened,this._updateDom()),this._fireEvent(EventNames.invoked))},SplitViewPaneToggle._ClassNames=ClassNames,SplitViewPaneToggle.supportedForProcessing=!0,SplitViewPaneToggle}();exports.SplitViewPaneToggle=SplitViewPaneToggle,_Base.Class.mix(SplitViewPaneToggle,_Events.createEventProperties(EventNames.invoked)),_Base.Class.mix(SplitViewPaneToggle,_Control.DOMEventMixin);
}),define("WinJS/Controls/SplitViewPaneToggle",["require","exports","../Core/_Base"],function(require,exports,_Base){var module=null;_Base.Namespace.define("WinJS.UI",{SplitViewPaneToggle:{get:function(){return module||require(["./SplitViewPaneToggle/_SplitViewPaneToggle"],function(m){module=m}),module.SplitViewPaneToggle}}})}),define("WinJS/Controls/AppBar/_Constants",["require","exports","../CommandingSurface/_Constants"],function(require,exports,_CommandingSurfaceConstants){exports.ClassNames={controlCssClass:"win-appbar",disposableCssClass:"win-disposable",actionAreaCssClass:"win-appbar-actionarea",overflowButtonCssClass:"win-appbar-overflowbutton",spacerCssClass:"win-appbar-spacer",ellipsisCssClass:"win-appbar-ellipsis",overflowAreaCssClass:"win-appbar-overflowarea",contentFlyoutCssClass:"win-appbar-contentflyout",emptyappbarCssClass:"win-appbar-empty",menuCssClass:"win-menu",menuContainsToggleCommandClass:"win-menu-containstogglecommand",openedClass:"win-appbar-opened",closedClass:"win-appbar-closed",noneClass:"win-appbar-closeddisplaynone",minimalClass:"win-appbar-closeddisplayminimal",compactClass:"win-appbar-closeddisplaycompact",fullClass:"win-appbar-closeddisplayfull",placementTopClass:"win-appbar-top",placementBottomClass:"win-appbar-bottom"},exports.EventNames={beforeOpen:"beforeopen",afterOpen:"afteropen",beforeClose:"beforeclose",afterClose:"afterclose",commandPropertyMutated:"_commandpropertymutated"},exports.controlMinWidth=_CommandingSurfaceConstants.controlMinWidth,exports.defaultClosedDisplayMode="compact",exports.defaultOpened=!1,exports.defaultPlacement="bottom",exports.typeSeparator="separator",exports.typeContent="content",exports.typeButton="button",exports.typeToggle="toggle",exports.typeFlyout="flyout",exports.commandSelector=".win-command",exports.primaryCommandSection="primary",exports.secondaryCommandSection="secondary"}),define("require-style!less/styles-appbar",[],function(){}),define("WinJS/Controls/AppBar/_AppBar",["require","exports","../../Core/_Base","../AppBar/_Constants","../CommandingSurface","../../Utilities/_Control","../../Utilities/_Dispose","../../Utilities/_ElementUtilities","../../Core/_ErrorFromName","../../Core/_Events","../../Core/_Global","../../Utilities/_KeyboardInfo","../../_LightDismissService","../../Promise","../../Core/_Resources","../../Utilities/_OpenCloseMachine","../../Core/_WriteProfilerMark"],function(require,exports,_Base,_Constants,_CommandingSurface,_Control,_Dispose,_ElementUtilities,_ErrorFromName,_Events,_Global,_KeyboardInfo,_LightDismissService,Promise,_Resources,_OpenCloseMachine,_WriteProfilerMark){function addClass(element,className){className&&_ElementUtilities.addClass(element,className)}function removeClass(element,className){className&&_ElementUtilities.removeClass(element,className)}require(["require-style!less/styles-appbar"]);var keyboardInfo=_KeyboardInfo._KeyboardInfo,strings={get ariaLabel(){return _Resources._getWinJSString("ui/appBarAriaLabel").value},get overflowButtonAriaLabel(){return _Resources._getWinJSString("ui/appBarOverflowButtonAriaLabel").value},get mustContainCommands(){return"The AppBar can only contain WinJS.UI.Command or WinJS.UI.AppBarCommand controls"},get duplicateConstruction(){return"Invalid argument: Controls may only be instantiated one time for each DOM element"}},ClosedDisplayMode={none:"none",minimal:"minimal",compact:"compact",full:"full"},closedDisplayModeClassMap={};closedDisplayModeClassMap[ClosedDisplayMode.none]=_Constants.ClassNames.noneClass,closedDisplayModeClassMap[ClosedDisplayMode.minimal]=_Constants.ClassNames.minimalClass,closedDisplayModeClassMap[ClosedDisplayMode.compact]=_Constants.ClassNames.compactClass,closedDisplayModeClassMap[ClosedDisplayMode.full]=_Constants.ClassNames.fullClass;var Placement={top:"top",bottom:"bottom"},placementClassMap={};placementClassMap[Placement.top]=_Constants.ClassNames.placementTopClass,placementClassMap[Placement.bottom]=_Constants.ClassNames.placementBottomClass;var AppBar=function(){function AppBar(element,options){var _this=this;if(void 0===options&&(options={}),this._updateDomImpl_renderedState={isOpenedMode:void 0,placement:void 0,closedDisplayMode:void 0,adjustedOffsets:{top:void 0,bottom:void 0}},this._writeProfilerMark("constructor,StartTM"),element&&element.winControl)throw new _ErrorFromName("WinJS.UI.AppBar.DuplicateConstruction",strings.duplicateConstruction);this._initializeDom(element||_Global.document.createElement("div"));var stateMachine=new _OpenCloseMachine.OpenCloseMachine({eventElement:this.element,onOpen:function(){var openAnimation=_this._commandingSurface.createOpenAnimation(_this._getClosedHeight());return _this.element.style.position="fixed",_this._placement===AppBar.Placement.top?_this.element.style.top=_KeyboardInfo._KeyboardInfo._layoutViewportCoords.visibleDocTop+"px":_this.element.style.bottom=_KeyboardInfo._KeyboardInfo._layoutViewportCoords.visibleDocBottom+"px",_this._synchronousOpen(),openAnimation.execute().then(function(){_this.element.style.position="",_this.element.style.top=_this._adjustedOffsets.top,_this.element.style.bottom=_this._adjustedOffsets.bottom})},onClose:function(){var closeAnimation=_this._commandingSurface.createCloseAnimation(_this._getClosedHeight());return _this.element.style.position="fixed",_this._placement===AppBar.Placement.top?_this.element.style.top=_KeyboardInfo._KeyboardInfo._layoutViewportCoords.visibleDocTop+"px":_this.element.style.bottom=_KeyboardInfo._KeyboardInfo._layoutViewportCoords.visibleDocBottom+"px",closeAnimation.execute().then(function(){_this._synchronousClose(),_this.element.style.position="",_this.element.style.top=_this._adjustedOffsets.top,_this.element.style.bottom=_this._adjustedOffsets.bottom})},onUpdateDom:function(){_this._updateDomImpl()},onUpdateDomWithIsOpened:function(isOpened){_this._isOpenedMode=isOpened,_this._updateDomImpl()}});this._handleShowingKeyboardBound=this._handleShowingKeyboard.bind(this),this._handleHidingKeyboardBound=this._handleHidingKeyboard.bind(this),_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),_ElementUtilities._inputPaneListener.addEventListener(this._dom.root,"hiding",this._handleHidingKeyboardBound),this._disposed=!1,this._cachedClosedHeight=null,this._commandingSurface=new _CommandingSurface._CommandingSurface(this._dom.commandingSurfaceEl,{openCloseMachine:stateMachine}),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-actionarea"),_Constants.ClassNames.actionAreaCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowarea"),_Constants.ClassNames.overflowAreaCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-overflowbutton"),_Constants.ClassNames.overflowButtonCssClass),addClass(this._dom.commandingSurfaceEl.querySelector(".win-commandingsurface-ellipsis"),_Constants.ClassNames.ellipsisCssClass),this._isOpenedMode=_Constants.defaultOpened,this._dismissable=new _LightDismissService.LightDismissableElement({element:this._dom.root,tabIndex:this._dom.root.hasAttribute("tabIndex")?this._dom.root.tabIndex:-1,onLightDismiss:function(){_this.close()},onTakeFocus:function(useSetActive){_this._dismissable.restoreFocus()||_this._commandingSurface.takeFocus(useSetActive)}}),this.closedDisplayMode=_Constants.defaultClosedDisplayMode,this.placement=_Constants.defaultPlacement,this.opened=this._isOpenedMode,_Control.setOptions(this,options),_ElementUtilities._inDom(this.element).then(function(){return _this._commandingSurface.initialized}).then(function(){stateMachine.exitInit(),_this._writeProfilerMark("constructor,StopTM")})}return Object.defineProperty(AppBar.prototype,"element",{get:function(){return this._dom.root},enumerable:!0,configurable:!0}),Object.defineProperty(AppBar.prototype,"data",{get:function(){return this._commandingSurface.data},set:function(value){this._commandingSurface.data=value},enumerable:!0,configurable:!0}),Object.defineProperty(AppBar.prototype,"closedDisplayMode",{get:function(){return this._commandingSurface.closedDisplayMode},set:function(value){ClosedDisplayMode[value]&&(this._commandingSurface.closedDisplayMode=value,this._cachedClosedHeight=null)},enumerable:!0,configurable:!0}),Object.defineProperty(AppBar.prototype,"placement",{get:function(){return this._placement},set:function(value){if(Placement[value]&&this._placement!==value){switch(this._placement=value,value){case Placement.top:this._commandingSurface.overflowDirection="bottom";break;case Placement.bottom:this._commandingSurface.overflowDirection="top"}this._adjustedOffsets=this._computeAdjustedOffsets(),this._commandingSurface.deferredDomUpate()}},enumerable:!0,configurable:!0}),Object.defineProperty(AppBar.prototype,"opened",{get:function(){return this._commandingSurface.opened},set:function(value){this._commandingSurface.opened=value},enumerable:!0,configurable:!0}),AppBar.prototype.open=function(){this._commandingSurface.open()},AppBar.prototype.close=function(){this._commandingSurface.close()},AppBar.prototype.dispose=function(){this._disposed||(this._disposed=!0,_LightDismissService.hidden(this._dismissable),this._commandingSurface.dispose(),_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"showing",this._handleShowingKeyboardBound),_ElementUtilities._inputPaneListener.removeEventListener(this._dom.root,"hiding",this._handleHidingKeyboardBound),_Dispose.disposeSubTree(this.element))},AppBar.prototype.forceLayout=function(){this._commandingSurface.forceLayout()},AppBar.prototype.getCommandById=function(id){return this._commandingSurface.getCommandById(id)},AppBar.prototype.showOnlyCommands=function(commands){return this._commandingSurface.showOnlyCommands(commands)},AppBar.prototype._writeProfilerMark=function(text){_WriteProfilerMark("WinJS.UI.AppBar:"+this._id+":"+text)},AppBar.prototype._initializeDom=function(root){this._writeProfilerMark("_intializeDom,info"),root.winControl=this,this._id=root.id||_ElementUtilities._uniqueID(root),_ElementUtilities.addClass(root,_Constants.ClassNames.controlCssClass),_ElementUtilities.addClass(root,_Constants.ClassNames.disposableCssClass);var role=root.getAttribute("role");role||root.setAttribute("role","menubar");var label=root.getAttribute("aria-label");label||root.setAttribute("aria-label",strings.ariaLabel);var commandingSurfaceEl=document.createElement("DIV");_ElementUtilities._reparentChildren(root,commandingSurfaceEl),root.appendChild(commandingSurfaceEl),this._dom={root:root,commandingSurfaceEl:commandingSurfaceEl}},AppBar.prototype._handleShowingKeyboard=function(event){var _this=this;if(this._dom.root.contains(_Global.document.activeElement)){var inputPaneEvent=event.detail.originalEvent;inputPaneEvent.ensuredFocusedElementInView=!0}var duration=keyboardInfo._animationShowLength+keyboardInfo._scrollTimeout;return Promise.timeout(duration).then(function(){_this._shouldAdjustForShowingKeyboard()&&!_this._disposed&&(_this._adjustedOffsets=_this._computeAdjustedOffsets(),_this._commandingSurface.deferredDomUpate())})},AppBar.prototype._shouldAdjustForShowingKeyboard=function(){return keyboardInfo._visible&&!keyboardInfo._isResized},AppBar.prototype._handleHidingKeyboard=function(){this._adjustedOffsets=this._computeAdjustedOffsets(),this._commandingSurface.deferredDomUpate()},AppBar.prototype._computeAdjustedOffsets=function(){var offsets={top:"",bottom:""};return this._placement===Placement.bottom?offsets.bottom=keyboardInfo._visibleDocBottomOffset+"px":this._placement===Placement.top&&(offsets.top=keyboardInfo._visibleDocTop+"px"),offsets},AppBar.prototype._synchronousOpen=function(){this._isOpenedMode=!0,this._updateDomImpl()},AppBar.prototype._synchronousClose=function(){this._isOpenedMode=!1,this._updateDomImpl()},AppBar.prototype._updateDomImpl=function(){var rendered=this._updateDomImpl_renderedState;rendered.isOpenedMode!==this._isOpenedMode&&(this._isOpenedMode?this._updateDomImpl_renderOpened():this._updateDomImpl_renderClosed(),rendered.isOpenedMode=this._isOpenedMode),rendered.placement!==this.placement&&(removeClass(this._dom.root,placementClassMap[rendered.placement]),addClass(this._dom.root,placementClassMap[this.placement]),rendered.placement=this.placement),rendered.closedDisplayMode!==this.closedDisplayMode&&(removeClass(this._dom.root,closedDisplayModeClassMap[rendered.closedDisplayMode]),addClass(this._dom.root,closedDisplayModeClassMap[this.closedDisplayMode]),rendered.closedDisplayMode=this.closedDisplayMode),rendered.adjustedOffsets.top!==this._adjustedOffsets.top&&(this._dom.root.style.top=this._adjustedOffsets.top,rendered.adjustedOffsets.top=this._adjustedOffsets.top),rendered.adjustedOffsets.bottom!==this._adjustedOffsets.bottom&&(this._dom.root.style.bottom=this._adjustedOffsets.bottom,rendered.adjustedOffsets.bottom=this._adjustedOffsets.bottom),this._commandingSurface.updateDom()},AppBar.prototype._getClosedHeight=function(){if(null===this._cachedClosedHeight){var wasOpen=this._isOpenedMode;this._isOpenedMode&&this._synchronousClose(),this._cachedClosedHeight=this._commandingSurface.getBoundingRects().commandingSurface.height,wasOpen&&this._synchronousOpen()}return this._cachedClosedHeight},AppBar.prototype._updateDomImpl_renderOpened=function(){addClass(this._dom.root,_Constants.ClassNames.openedClass),removeClass(this._dom.root,_Constants.ClassNames.closedClass),this._commandingSurface.synchronousOpen(),_LightDismissService.shown(this._dismissable)},AppBar.prototype._updateDomImpl_renderClosed=function(){addClass(this._dom.root,_Constants.ClassNames.closedClass),removeClass(this._dom.root,_Constants.ClassNames.openedClass),this._commandingSurface.synchronousClose(),_LightDismissService.hidden(this._dismissable)},AppBar.ClosedDisplayMode=ClosedDisplayMode,AppBar.Placement=Placement,AppBar.supportedForProcessing=!0,AppBar}();exports.AppBar=AppBar,_Base.Class.mix(AppBar,_Events.createEventProperties(_Constants.EventNames.beforeOpen,_Constants.EventNames.afterOpen,_Constants.EventNames.beforeClose,_Constants.EventNames.afterClose)),_Base.Class.mix(AppBar,_Control.DOMEventMixin)}),define("WinJS/Controls/AppBar",["require","exports","../Core/_Base"],function(require,exports,_Base){var module=null;_Base.Namespace.define("WinJS.UI",{AppBar:{get:function(){return module||require(["./AppBar/_AppBar"],function(m){module=m}),module.AppBar}}})}),define("ui",["WinJS/Core/_WinJS","WinJS/VirtualizedDataSource","WinJS/Vui","WinJS/Controls/IntrinsicControls","WinJS/Controls/ListView","WinJS/Controls/FlipView","WinJS/Controls/ItemContainer","WinJS/Controls/Repeater","WinJS/Controls/DatePicker","WinJS/Controls/TimePicker","WinJS/Controls/BackButton","WinJS/Controls/Rating","WinJS/Controls/ToggleSwitch","WinJS/Controls/SemanticZoom","WinJS/Controls/Pivot","WinJS/Controls/Hub","WinJS/Controls/Flyout","WinJS/Controls/_LegacyAppBar","WinJS/Controls/Menu","WinJS/Controls/SearchBox","WinJS/Controls/SettingsFlyout","WinJS/Controls/NavBar","WinJS/Controls/Tooltip","WinJS/Controls/ViewBox","WinJS/Controls/ContentDialog","WinJS/Controls/SplitView","WinJS/Controls/SplitViewPaneToggle","WinJS/Controls/SplitView/Command","WinJS/Controls/ToolBar","WinJS/Controls/AppBar"],function(_WinJS){"use strict";return _WinJS}),require(["WinJS/Core/_WinJS","ui"],function(_WinJS){globalObject.WinJS=_WinJS,"undefined"!=typeof module&&(module.exports=_WinJS)}),globalObject.WinJS})}();