var WinJSContrib;!function(WinJSContrib){"use strict";!function(Bindings){function _setPic(dest,url){"img"==dest.nodeName.toLowerCase()?dest.src=url:dest.style.backgroundImage='url("'+url+'")',dest.classList.add("imageLoaded")}WinJSContrib.Bindings.pictureUnavailable="/images/unavailable.png",WinJSContrib.Bindings.bindingArguments=function(elt,argname){var data;if(WinJS.UI._optionsParser){var text=elt.getAttribute("data-win-bind-args");text&&(data=WinJS.UI.optionsParser(text,window))}else data=elt.dataset.winBindArgs;if(data)return argname?data[argname]:data};var bindingArguments=WinJSContrib.Bindings.bindingArguments;WinJSContrib.Bindings.removeHTML=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){var data=WinJSContrib.Utils.readProperty(source,sourceProperty),elt=document.createElement("DIV");elt.innerHTML=data,WinJS.Binding.oneTime({value:elt.innerText},["value"],dest,[destProperty])}),WinJSContrib.Bindings.removeHTMLAndEllipsisize=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){var data=WinJSContrib.Utils.readProperty(source,sourceProperty),elt=document.createElement("DIV");elt.innerHTML=data;var textRes=elt.innerText,size=bindingArguments(dest,"ellipsisize");size&&(textRes=toStaticHTML(WinJSContrib.Utils.ellipsisizeString(elt.innerText,size,!0))),WinJS.Binding.oneTime({value:textRes},["value"],dest,[destProperty])}),WinJSContrib.Bindings.staticHTML=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);dest[destProperty]=toStaticHTML(data)}),WinJSContrib.Bindings.dataAttr=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);dest.setAttribute("data-"+destProperty,data)}),WinJSContrib.Bindings.addClass=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setClass(newval,oldval){var data=WinJSContrib.Utils.readProperty(source,sourceProperty),formatParameter=bindingArguments(dest,"format");formatParameter?(dest.classList.remove(formatParameter.format(oldval)),dest.classList.add(formatParameter.format(data))):(dest.classList.remove(oldval),dest.classList.add(data))}var bindingDesc={};return bindingDesc[sourceProperty]=setClass,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.asClass=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setClass(newval,oldval){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);dest.classList.remove(destProperty+"-"+oldval),dest.classList.add(destProperty+"-"+data)}var bindingDesc={};return bindingDesc[sourceProperty]=setClass,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.showClassIf=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setClass(newval,oldval){var data=WinJSContrib.Utils.readProperty(source,sourceProperty),className=bindingArguments(dest,"className");dest.classList.remove(className),data&&dest.classList.add(className)}var bindingDesc={};return bindingDesc[sourceProperty]=setClass,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.toBgImage=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setImage(){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);return data&&data.length?void(dest.style.backgroundImage='url("'+data+'")'):void(dest.style.backgroundImage="")}var bindingDesc={};return bindingDesc[sourceProperty]=setImage,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.ToRealDate=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){var date=new Date(1e3*source.date);dest.innerHTML=date.toLocaleDateString()}),WinJSContrib.Bindings.picture=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setImage(){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);data&&data.length||(data=Bindings.pictureUnavailable),dest.classList.remove("imageLoaded"),setTimeout(function(){WinJSContrib.UI.loadImage(data).done(function(){_setPic(dest,data)},function(){_setPic(dest,Bindings.pictureUnavailable),WinJS.Utilities.addClass(dest,"imageLoaded")})},200)}var bindingDesc={};return bindingDesc[sourceProperty]=setImage,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.toSmartBgImage=WinJSContrib.Bindings.picture,WinJSContrib.Bindings.showIf=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setVisibility(){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);data?(dest.classList.remove("mcn-hide"),dest.classList.add("mcn-show"),"opacity"===destProperty[0]||"opacity"===destProperty[1]?dest.style.opacity="":"visibility"===destProperty[0]||"visibility"===destProperty[1]?dest.style.visibility="":dest.style.display=""):(dest.classList.remove("mcn-show"),dest.classList.add("mcn-hide"),"opacity"===destProperty[0]||"opacity"===destProperty[1]?dest.style.opacity="0":"visibility"===destProperty[0]||"visibility"===destProperty[1]?dest.style.visibility="hidden":dest.style.display="none")}var bindingDesc={};return bindingDesc[sourceProperty]=setVisibility,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.hideIfNot=WinJSContrib.Bindings.showIf,WinJSContrib.Bindings.hideIfNotDefined=WinJSContrib.Bindings.showIf,WinJSContrib.Bindings.hideIf=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setVisibility(){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);data?(dest.classList.remove("mcn-show"),dest.classList.add("mcn-hide"),"opacity"===destProperty[0]||"opacity"===destProperty[1]?dest.style.opacity="0":"visibility"===destProperty[0]||"visibility"===destProperty[1]?dest.style.visibility="hidden":dest.style.display="none"):(dest.classList.remove("mcn-hide"),dest.classList.add("mcn-show"),"opacity"===destProperty[0]||"opacity"===destProperty[1]?dest.style.opacity="":"visibility"===destProperty[0]||"visibility"===destProperty[1]?dest.style.visibility="":dest.style.display="")}var bindingDesc={};return bindingDesc[sourceProperty]=setVisibility,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.showIfNot=WinJSContrib.Bindings.hideIf,WinJSContrib.Bindings.showIfNotDefined=WinJSContrib.Bindings.hideIf,WinJSContrib.Bindings.enableIf=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setVisibility(){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);data?dest.disabled=!1:dest.disabled=!0}var bindingDesc={};return bindingDesc[sourceProperty]=setVisibility,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.disableIfNot=WinJSContrib.Bindings.enableIf,WinJSContrib.Bindings.disableIf=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setVisibility(){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);data?dest.disabled=!0:dest.disabled=!1}var bindingDesc={};return bindingDesc[sourceProperty]=setVisibility,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.enableIfNot=WinJSContrib.Bindings.disableIf,WinJSContrib.Bindings.toWidth=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setWidth(){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);data?dest.style.width=data+"%":dest.style.width=""}var bindingDesc={};return bindingDesc[sourceProperty]=setWidth,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.ellipsisize=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){var sourcedata=WinJSContrib.Utils.readProperty(source,sourceProperty),size=bindingArguments(dest,"ellipsisize");dest[destProperty]=toStaticHTML(WinJSContrib.Utils.ellipsisizeString(sourcedata,size,!0))}),WinJSContrib.Bindings.toEllipsisized=WinJSContrib.Bindings.ellipsisize,WinJSContrib.Bindings.emptyIfNull=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);"undefined"==typeof data||null===data?dest[destProperty]="":dest[destProperty]=data}),WinJSContrib.Bindings.twoWayOnChange=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function setVal(){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);WinJSContrib.Utils.writeProperty(dest,destProperty,data||"")}function getVal(){var val=WinJSContrib.Utils.getProperty(dest,destProperty);WinJSContrib.Utils.writeProperty(source,sourceProperty,val.propValue)}dest.addEventListener("change",getVal,!1),dest.winControl||(dest.classList.add("win-disposable"),dest.winControl={dispose:function(){dest.removeEventListener("change",getVal)}});var bindingDesc={};return bindingDesc[sourceProperty]=setVal,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.itemTap=WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){setImmediate(function(){var scope=WinJSContrib.Utils.getScopeControl(dest);if(scope){var tapCallback=WinJSContrib.Utils.readProperty(scope,destProperty),lockpointer=dest.hasAttribute("lockpointer");tapCallback&&"function"==typeof tapCallback&&WinJSContrib.UI.tap(dest,function(arg){var item=WinJSContrib.Utils.readProperty(source,sourceProperty);tapCallback.call(scope,{target:arg,detail:{element:arg,item:item}})},{lock:lockpointer})}})}),Bindings.cleanUpBindingList=function(bindingList){var result=[];return bindingList.forEach(function(item){var unwrappedItem=WinJS.Binding.unwrap(item);result.push(unwrappedItem)}),result}}(WinJSContrib.Bindings||(WinJSContrib.Bindings={}));WinJSContrib.Bindings}(WinJSContrib||(WinJSContrib={}));
var WinJSContrib;WinJSContrib.Utils=WinJSContrib.Utils||{},WinJSContrib.Bindings=WinJSContrib.Bindings||{},function(){"use strict";function daysSince(m,d,y){if(""!=d&&""!=m&&""!=y&&!(isNaN(m)||isNaN(y)||isNaN(d))){var myDate=new Date,yourDate=new Date(y,m-1,d),secondsInADay=864e5,diff=Math.floor((myDate.getTime()-yourDate.getTime())/secondsInADay);return diff}}WinJSContrib.Bindings.formatDate=WinJS.Utilities.markSupportedForProcessing(function(source,sourceProperty,dest,destProperty){function setDate(){var sourcedata=WinJSContrib.Utils.readProperty(source,sourceProperty);if(sourcedata){var arg=WinJSContrib.Bindings.bindingArguments(dest,"formatDate")||"L";dest.innerText=moment(sourcedata).format(arg)}else dest.innerText=""}var bindingDesc={};return bindingDesc[sourceProperty]=setDate,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.calendar=WinJS.Utilities.markSupportedForProcessing(function(source,sourceProperty,dest,destProperty){function setDate(){var sourcedata=WinJSContrib.Utils.readProperty(source,sourceProperty);sourcedata?dest.innerText=moment(sourcedata).calendar():dest.innerText=""}var bindingDesc={};return bindingDesc[sourceProperty]=setDate,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.daysSinceDate=WinJS.Utilities.markSupportedForProcessing(function(source,sourceProperty,dest,destProperty){function setDate(){var sourcedata=WinJSContrib.Utils.readProperty(source,sourceProperty);if(sourcedata){sourcedata=new Date(sourcedata);var m=sourcedata.getMonth()+1,d=sourcedata.getDate(),y=sourcedata.getFullYear(),fromdate=daysSince(m,d,y);dest.innerText=fromdate}else dest.innerText=""}var bindingDesc={};return bindingDesc[sourceProperty]=setDate,WinJS.Binding.bind(source,bindingDesc)}),WinJSContrib.Bindings.humanizeDate=WinJS.Utilities.markSupportedForProcessing(function(source,sourceProperty,dest,destProperty){function setDate(){var sourcedata=WinJSContrib.Utils.readProperty(source,sourceProperty);if(sourcedata){var arg=WinJSContrib.Bindings.bindingArguments(dest,"humanizeFormat"),addSuffix=WinJSContrib.Bindings.bindingArguments(dest,"addSuffix");dest.innerText=moment.duration(sourcedata,arg).humanize(addSuffix)}else dest.innerText=""}var bindingDesc={};return bindingDesc[sourceProperty]=setDate,WinJS.Binding.bind(source,bindingDesc)})}();
function HSL(hVal,sVal,lVal){var res={h:hVal,s:sVal,l:lVal,addH:function(increment){this.h=this.h+increment},addS:function(increment){this.s=this.s+increment},addL:function(increment){this.l=this.l+increment},toString:function(){return"hsl("+this.h+","+this.s+"%, "+this.l+"%)"},clone:function(hInc,sInc,lInc){var res=new HSL(this.h,this.s,this.l);return res.addH(hInc),res.addS(sInc),res.addL(lInc),res}};return res}var WinJSContrib=WinJSContrib||{};WinJSContrib.UI=WinJSContrib.UI||{},WinJSContrib.Utils=WinJSContrib.Utils||{},function($){$.fn.winControl=function(){return this[0].winControl}}(jQuery),function($){$.fn.tap=function(callback,options){return this.each(function(){WinJSContrib.UI.tap(this,callback,options)})},$.fn.untap=function(callback){return this.each(function(){WinJSContrib.UI.untap(this)})},jQuery.fn.hatchShow=function(){$(".hsjs").css("visibility","hidden").css("font-size","").css("display","inner-block").css("white-space","pre").each(function(){var t=$(this),parent=t.parent();parent.hasClass("hatchshow_temp")?parent=parent.parent():t.wrap("<span class='hatchshow_temp' style='display:block'>");var pw=parent.width();for(t.width();t.width()<pw;){var fsize=t.fontSize();if(fsize>200)break;t.css("font-size",fsize+1+"px"),function(){for(;t.width()>pw;){var fsize=t.fontSize();if(fsize<8)break;t.css("font-size",fsize-.1+"px")}}}}).hide().css("visibility","").fadeIn()},jQuery.fn.fontSize=function(){return parseInt($(this).css("font-size").replace("px",""))}}(jQuery),function($){$.fn.pressEnterDefaultTo=function(eltSelector,scope){return this.each(function(){var $this=$(this);$this.keypress(function(e){var key=e.which?e.which:e.keyCode;if(13==key){var $elt=scope?$(eltSelector,scope):$(eltSelector);jQuery(this).blur(),e.preventDefault(),e.stopPropagation(),$elt[0].mcnTapTracking&&$elt[0].mcnTapTracking.callback&&$elt[0].mcnTapTracking.callback($elt[0]),$elt.focus().click()}})})},$.fn.onPressEnter=function(callback){return this.each(function(){var $this=$(this);$this.keypress(function(e){var key=e.which?e.which:e.keyCode;13==key&&(jQuery(this).blur(),e.preventDefault(),callback&&callback())})})},$.fn.throttleTextChanged=function(throttling,callback){return this.each(function(){var elt=this,$this=$(this),lastval=elt.value;$this.keydown(function(e){clearTimeout(elt.mcnTxtThrottling),elt.mcnTxtThrottling=setTimeout(function(){lastval=elt.value,callback(elt,elt.value)},throttling)}),$this.blur(function(e){lastval!=elt.value&&(lastval=elt.value,callback(elt,elt.value))})})}}(jQuery),function($){$.fn.transitionProperties=function(properties,delay,targetValueCallback){var that=$(this);return new WinJS.Promise(function(complete,error){var val=properties+" "+delay+"ms ease-out",res=that.css("transition",val);targetValueCallback&&targetValueCallback(res),res.delay(delay+10).promise().done(function(){that.css("-ms-transition",""),complete(res)},function(){that.css("-ms-transition",""),error(res)})})}}(jQuery),function($){$.fn.toWinJSPromise=function(){return new WinJS.Promise(function(complete,error){var res=this.promise().done(function(){complete(res)},function(){error(res)})})}}(jQuery),function($){$.fn.renderWith=function(templateSelector,object){var template=$(templateSelector).get(0);return template&&(template=template.winControl),this.each(function(){var $this=$(this);template&&template.render(null,object).done(function(elt){$this.append(elt.children[0])})})}}(jQuery),function($){$.fn.renderWithEach=function(templateSelector,objectArray,itemCallback){var template=$(templateSelector).get(0);return template&&(template=template.winControl),this.each(function(){var $this=$(this);template&&objectArray.forEach(function(element,index){template.render(null,element).done(function(elt){var templatedElt=elt.children[0];$this.append(templatedElt),itemCallback&&itemCallback(element,templatedElt)})})})}}(jQuery),function($){$.fn.scrollInView=function(offset,animate){var viewState=Windows.UI.ViewManagement.ApplicationView.value,horizontal=!0;return viewState!==Windows.UI.ViewManagement.ApplicationViewState.snapped&&viewState!==Windows.UI.ViewManagement.ApplicationViewState.fullScreenPortrait||(horizontal=!1),this.each(function(){$(this);horizontal?this.offsetParent.scrollLeft=this.offsetLeft-(offset?offset:0):this.offsetParent.scrollTop=this.offsetTop-(offset?offset:0)})}}(jQuery),function($){$.fn.scrollInParentView=function(offset,animate){var viewState=Windows.UI.ViewManagement.ApplicationView.value,horizontal=!0;return viewState!==Windows.UI.ViewManagement.ApplicationViewState.snapped&&viewState!==Windows.UI.ViewManagement.ApplicationViewState.fullScreenPortrait||(horizontal=!1),this.each(function(){horizontal?this.offsetParent.offsetParent.scrollLeft=this.offsetLeft-(offset?offset:0):this.offsetParent.offsetParent.scrollTop=this.offsetTop-(offset?offset:0)})}}(jQuery),function($){$.fn.loadedPromises=function(callback){var res=[];return this.each(function(){var that=($(this),this),promise=new WinJS.Promise(function(complete,error){function onerror(e){that.removeEventListener("error",onerror),that.removeEventListener("load",onloaded),error({message:"element not loaded",elt:e.currentTarget})}function onloaded(){that.removeEventListener("error",onerror),that.removeEventListener("load",onloaded),complete(that),callback&&callback(that)}that.addEventListener("error",onerror),that.addEventListener("load",onloaded,!1),that.naturalWidth>0&&onloaded()});res.push(promise)}),res},$.fn.whenLoaded=function(callback){var promises=this.loadedPromises();return callback?void WinJS.Promise.join(promises).done(function(res){callback(res)}):WinJS.Promise.join(promises)},$.fn.afterTransition=function(callback,timeout){var promises=[],completed=!1;this.each(function(){var currentElement=this,prom=new WinJS.Promise(function(complete,error){var onaftertransition=function(event){event.srcElement===currentElement&&close()},close=function(){clearTimeout(timeOutRef),currentElement.removeEventListener("transitionend",onaftertransition,!1),complete()};currentElement.addEventListener("transitionend",onaftertransition,!1),timeOutRef=setTimeout(close,timeout||1e3)});promises.push(prom)});var success=null,error=null,resultPromise=new WinJS.Promise(function(c,e){success=c,error=e}),p=WinJS.Promise.join(promises);return p.done(function(){return completed?(p.cancel(),void error()):(completed=!0,callback&&callback(),void success())},error),resultPromise},$.fn.afterAnimation=function(callback){var promises=[];return this.each(function(){var ctrl=this,prom=new WinJS.Promise(function(complete,error){function ontransition(event){event.srcElement===currentElement&&(ctrl.removeEventListener("animationend",ontransition),complete())}ctrl.addEventListener("animationend",ontransition)});promises.push(prom)}),WinJS.Promise.join(promises).done(function(){callback&&callback()}),this},$.fn.classBasedAnimation=function(classname){return this.each(function(){var ctrl=this;$(ctrl).afterAnimation(function(){$(ctrl).removeClass(classname)}),$(ctrl).addClass(classname)})}}(jQuery);
var WinJSContrib;!function(WinJSContrib){var UI;!function(UI){var Animation;!function(Animation){function getOpt(options){return options&&"number"==typeof options?{duration:options}:options||{}}function fadeOut(elements,options){options=getOpt(options);var args={property:"opacity",delay:staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),duration:options.duration||167,timing:options.easing||"ease-in-out",to:0};return WinJS.UI.executeTransition(elements,args)}function fadeIn(elements,options){return options=getOpt(options),WinJS.UI.executeTransition(elements,{property:"opacity",delay:staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),duration:options.duration||167,timing:options.easing||"ease-in-out",to:1})}function staggerDelay(initialDelay,extraDelay,delayFactor,delayCap){return function(i){for(var ret=initialDelay,j=0;j<i;j++)extraDelay*=delayFactor,ret+=extraDelay;return delayCap&&(ret=Math.min(ret,delayCap)),ret}}function pageExit(elements,options){options=getOpt(options);var args={property:"opacity",delay:staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),duration:options.duration||160,timing:options.easing||"ease-in",to:0};return WinJS.UI.executeTransition(elements,args)}function enterPage(elements,options){options=getOpt(options);var stagger=staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:120,1,void 0!==options.maxdelay?options.maxdelay:333),animationParams={keyframe:"WinJSContrib-EnterPage",property:equivalents.transform.cssName,delay:stagger,duration:options.duration||600,timing:options.easing||"cubic-bezier(0.1, 0.9, 0.2, 1)"},promise1=WinJS.UI.executeAnimation(elements,animationParams),args={property:"opacity",delay:stagger,duration:options.duration||600,timing:options.easing||"ease-out",to:1},promise2=WinJS.UI.executeTransition(elements,args);return WinJS.Promise.join([promise1,promise2])}function slideAnim(element,keyframeName,isIn,options){options=getOpt(options);var duration=options.duration||isIn?250:150,stagger=(options.delay||5,staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333)),easing=WinJSContrib.UI.Animation.Easings.easeInQuad;isIn&&(easing=WinJSContrib.UI.Animation.Easings.easeOutQuad);var animationParams={keyframe:keyframeName,property:equivalents.transform.cssName,delay:stagger,duration:duration,timing:options.easing||easing},promise1=WinJS.UI.executeAnimation(element,animationParams),transitionParams={property:"opacity",delay:stagger,duration:duration/2,timing:easing,from:0,to:1};isIn||(transitionParams.from=1,transitionParams.to=0,transitionParams.delay<duration/2&&(transitionParams.delay=duration/2));var promise2=WinJS.UI.executeTransition(element,transitionParams);return WinJS.Promise.join([promise1,promise2])}function slideFromBottom(elements,options){return slideAnim(elements,"WinJSContrib-slideFromBottom",!0,options)}function slideFromTop(elements,options){return slideAnim(elements,"WinJSContrib-slideFromTop",!0,options)}function slideFromLeft(elements,options){return slideAnim(elements,"WinJSContrib-slideFromLeft",!0,options)}function slideFromRight(elements,options){return slideAnim(elements,"WinJSContrib-slideFromRight",!0,options)}function slideToBottom(elements,options){return slideAnim(elements,"WinJSContrib-slideToBottom",!1,options)}function slideToTop(elements,options){return slideAnim(elements,"WinJSContrib-slideToTop",!1,options)}function slideToLeft(elements,options){return slideAnim(elements,"WinJSContrib-slideToLeft",!1,options)}function slideToRight(elements,options){return slideAnim(elements,"WinJSContrib-slideToRight",!1,options)}function tabExitPage(elements,options){options=getOpt(options);var stagger=staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),animationParams={keyframe:"WinJSContrib-tabExitPage",property:equivalents.transform.cssName,delay:stagger,duration:options.duration||160,timing:"ease-in"},promise1=WinJS.UI.executeAnimation(elements,animationParams),transitionParams={property:"opacity",delay:stagger,duration:options.duration||160,timing:"linear",from:1,to:0},promise2=WinJS.UI.executeTransition(elements,transitionParams);return WinJS.Promise.join([promise1,promise2])}function tabEnterPage(elements,options){options=getOpt(options);var stagger=staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),promise1=WinJS.UI.executeAnimation(elements,{keyframe:"WinJSContrib-tabEnterPage",property:equivalents.transform.cssName,delay:stagger,duration:options.duration||250,timing:WinJSContrib.UI.Animation.Easings.easeOutQuad}),promise2=WinJS.UI.executeTransition(elements,{property:"opacity",delay:stagger,duration:options.duration||250,timing:"ease-out",from:0,to:1});return WinJS.Promise.join([promise1,promise2])}function exitGrow(elements,options){options=getOpt(options);var keyframeName="WinJSContrib-exitGrow";options.exagerated&&(keyframeName+="-exagerated");var stagger=staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),dur=options.duration||250,promise1=WinJS.UI.executeAnimation(elements,{keyframe:keyframeName,property:equivalents.transform.cssName,delay:stagger,duration:dur,timing:options.easing||WinJSContrib.UI.Animation.Easings.easeInQuad}),promise2=WinJS.UI.executeTransition(elements,{property:"opacity",delay:stagger,duration:dur,timing:options.easing||WinJSContrib.UI.Animation.Easings.easeInQuint,from:1,to:0});return WinJS.Promise.join([promise1,promise2])}function exitShrink(elements,options){options=getOpt(options);var keyframeName="WinJSContrib-exitShrink";options.exagerated&&(keyframeName+="-exagerated");var dur=options.duration||250,stagger=staggerDelay(void 0!==options.delay?options.delay:10,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),promise1=WinJS.UI.executeAnimation(elements,{keyframe:keyframeName,property:equivalents.transform.cssName,delay:stagger,duration:dur,timing:options.easing||WinJSContrib.UI.Animation.Easings.easeInQuad}),promise2=WinJS.UI.executeTransition(elements,{property:"opacity",delay:stagger,duration:dur,timing:WinJSContrib.UI.Animation.Easings.easeInQuint,from:1,to:0});return WinJS.Promise.join([promise1,promise2])}function shrinkAndFall(elements,options){options=getOpt(options);var stagger=staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),dur=options.duration||250,promise1=WinJS.UI.executeAnimation(elements,{keyframe:"WinJSContrib-shrinkAndFall",property:equivalents.transform.cssName,delay:stagger,duration:dur,timing:options.easing||"ease-in"}),promise2=WinJS.UI.executeTransition(elements,{property:"opacity",delay:stagger,duration:dur,timing:"ease-in",from:1,to:0});return WinJS.Promise.join([promise1,promise2])}function enterShrink(elements,options){options=getOpt(options);var keyframeName="WinJSContrib-enterShrink";options.exagerated&&(keyframeName+="-exagerated");var dur=options.duration||350,stagger=staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),promise1=WinJS.UI.executeAnimation(elements,{keyframe:keyframeName,property:equivalents.transform.cssName,delay:stagger,duration:dur,timing:options.easing||WinJSContrib.UI.Animation.Easings.easeOutQuad}),promise2=WinJS.UI.executeTransition(elements,{property:"opacity",delay:stagger,duration:dur,timing:options.easing||WinJSContrib.UI.Animation.Easings.easeOutQuint,from:0,to:1});return WinJS.Promise.join([promise1,promise2])}function enterGrow(elements,options){options=getOpt(options);var keyframeName="WinJSContrib-enterGrow";options.exagerated&&(keyframeName+="-exagerated");var dur=options.duration||350,stagger=staggerDelay(void 0!==options.delay?options.delay:5,void 0!==options.itemdelay?options.itemdelay:83,1,void 0!==options.maxdelay?options.maxdelay:333),promise1=WinJS.UI.executeAnimation(elements,{keyframe:keyframeName,property:equivalents.transform.cssName,delay:stagger,duration:dur,timing:options.easing||WinJSContrib.UI.Animation.Easings.easeOutQuad}),promise2=WinJS.UI.executeTransition(elements,{property:"opacity",delay:stagger,duration:dur,timing:WinJSContrib.UI.Animation.Easings.easeOutQuint,from:0,to:1});return WinJS.Promise.join([promise1,promise2])}Animation.Easings={easeInQuad:"cubic-bezier(0.550, 0.085, 0.680, 0.530)",easeInCubic:"cubic-bezier(0.550, 0.055, 0.675, 0.190)",easeInQuart:"cubic-bezier(0.895, 0.030, 0.685, 0.220)",easeInQuint:"cubic-bezier(0.755, 0.050, 0.855, 0.060)",easeInSine:"cubic-bezier(0.470, 0.000, 0.745, 0.715)",easeInExpo:"cubic-bezier(0.950, 0.050, 0.795, 0.035)",easeInCirc:"cubic-bezier(0.600, 0.040, 0.980, 0.335)",easeInBack:"cubic-bezier(0.600, -0.280, 0.735, 0.045)",easeOutQuad:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",easeOutCubic:"cubic-bezier(0.215, 0.610, 0.355, 1.000)",easeOutQuart:"cubic-bezier(0.165, 0.840, 0.440, 1.000)",easeOutQuint:"cubic-bezier(0.230, 1.000, 0.320, 1.000)",easeOutSine:"cubic-bezier(0.390, 0.575, 0.565, 1.000)",easeOutExpo:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",easeOutCirc:"cubic-bezier(0.075, 0.820, 0.165, 1.000)",easeOutBack:"cubic-bezier(0.175, 0.885, 0.320, 1.275)",easeInOutQuad:"cubic-bezier(0.455, 0.030, 0.515, 0.955)",easeInOutCubic:"cubic-bezier(0.645, 0.045, 0.355, 1.000)",easeInOutQuart:"cubic-bezier(0.770, 0.000, 0.175, 1.000)",easeInOutQuint:"cubic-bezier(0.860, 0.000, 0.070, 1.000)",easeInOutSine:"cubic-bezier(0.445, 0.050, 0.550, 0.950)",easeInOutExpo:"cubic-bezier(1.000, 0.000, 0.000, 1.000)",easeInOutCirc:"cubic-bezier(0.785, 0.135, 0.150, 0.860)",easeInOutBack:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"};var equivalents=WinJS.Utilities._browserStyleEquivalents||{transform:{cssName:"transform"}};Animation.fadeOut=fadeOut,Animation.fadeIn=fadeIn,Animation.pageExit=pageExit,Animation.enterPage=enterPage,Animation.slideFromBottom=slideFromBottom,Animation.slideFromTop=slideFromTop,Animation.slideFromLeft=slideFromLeft,Animation.slideFromRight=slideFromRight,Animation.slideToBottom=slideToBottom,Animation.slideToTop=slideToTop,Animation.slideToLeft=slideToLeft,Animation.slideToRight=slideToRight,Animation.tabExitPage=tabExitPage,Animation.tabEnterPage=tabEnterPage,Animation.exitGrow=exitGrow,Animation.exitShrink=exitShrink,Animation.shrinkAndFall=shrinkAndFall,Animation.enterShrink=enterShrink,Animation.enterGrow=enterGrow}(Animation=UI.Animation||(UI.Animation={}))}(UI=WinJSContrib.UI||(WinJSContrib.UI={}))}(WinJSContrib||(WinJSContrib={}));
!function(){"use strict";var appView=null;window.Windows&&window.Windows.UI&&window.Windows.UI.ViewManagement&&window.Windows.UI.ViewManagement.ApplicationView&&(appView=window.Windows.UI.ViewManagement.ApplicationView);var nav=WinJS.Navigation,defaultExitPageAnimation=function(elt){return WinJS.UI.Animation.exitPage(elt)},defaultEnterPageAnimation=function(elt){return WinJS.UI.Animation.enterPage(elt)};WinJS.Namespace.define("WinJSContrib.UI",{parentNavigator:function(element){for(var current=element.parentNode;current;){if(current.mcnNavigator)return current.winControl;current=current.parentNode}},PageControlNavigator:WinJS.Class.mix(WinJS.Class.define(function(element,options){var options=options||{},navigator=this;if(this.element=element||document.createElement("div"),this.element.winControl=this,this.element.mcnNavigator=!0,this.element.classList.add("mcn-navigator"),this.element.classList.add("mcn-navigation-ctrl"),this.eventTracker=new WinJSContrib.UI.EventTracker,this.delay=options.delay||0,this.disableHistory=options.disableHistory||!1,this.animationWaitForPreviousPageClose=options.animationWaitForPreviousPageClose||!0,this.animations={},this.locks=0,options.enterPageAnimation&&(this.animations.enterPage=WinJSContrib.Utils.resolveMethod(element,options.enterPageAnimation)),this.animations.enterPage||(this.animations.enterPage=defaultEnterPageAnimation),options.exitPageAnimation&&(this.animations.exitPage=WinJSContrib.Utils.resolveMethod(element,options.exitPageAnimation)),this.animations.exitPage||(this.animations.exitPage=defaultExitPageAnimation),this.home=options.home,appView&&(this._lastViewstate=appView.value),this.global=void 0===options.global||options.global,this.global){document.body.onkeyup=this._keyupHandler.bind(this),document.body.onkeypress=this._keypressHandler.bind(this),document.body.onmspointerup=this._mspointerupHandler.bind(this),WinJSContrib.UI.Application=WinJSContrib.UI.Application||{},WinJSContrib.UI.Application.navigator=this,this.eventTracker.addEvent(nav,"beforenavigate",this._beforeNavigate.bind(this)),this.eventTracker.addEvent(nav,"navigated",this._navigated.bind(this));var systemNavigationManager=null;WinJSContrib.UI.enableSystemBackButton&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(systemNavigationManager=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView()),systemNavigationManager&&WinJSContrib.UI.enableSystemBackButton&&this.eventTracker.addEvent(systemNavigationManager,"backrequested",function(arg){WinJS.Navigation.canGoBack&&(navigator.back(),arg.handled=!0)})}else options.navigationEvents&&this.addNavigationEvents(),this._history={backstack:[]};this.eventTracker.addEvent(window,"resize",function(args){navigator.resizeHandler&&cancelAnimationFrame(navigator.resizeHandler),navigator.resizeHandler=requestAnimationFrame(function(){navigator.resizeHandler=null,navigator._resized(args)})})},{home:"",element:null,_lastNavigationPromise:WinJS.Promise.as(),_lastViewstate:0,pageControl:{get:function(){return this.pageElement?this.pageElement.winControl:null}},pagesCount:{get:function(){var count=0;if(this.pageElement)for(var i=0;i<this.element.children.length;i++){var child=this.element.children[i];child&&child.winControl&&!child.winControl.mcnPageClosing&&count++}return count}},pageElement:{get:function(){for(var elt=this.element.lastElementChild;elt&&elt.winControl&&elt.winControl.mcnPageClosing;)elt=elt.previousSibling;return elt}},history:{get:function(){return this.global?WinJS.Navigation.history:this._history}},addLock:function(){this.locks++},removeLock:function(){this.locks--},_createPageElement:function(){var element=document.createElement("div");return element.setAttribute("dir",window.getComputedStyle(this.element,null).direction),element},dispose:function(){this._disposed||(this._disposed=!0,this.removeNavigationEvents(),WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(this.element),this.eventTracker.dispose())},_checkBackNavigation:function(arg){var navigator=this,currentPage=navigator.pageControl,confirm=function(){arg.handled=!0,arg.preventDefault&&arg.preventDefault()},check=function(){if(navigator.canGoBack)return navigator.back(),confirm(),!0};if(!currentPage.canClose)return check();var res=currentPage.canClose();return WinJS.Promise.is(res)?void res.then(function(canClose){return canClose?check():(confirm(),!0)}):res?check():(confirm(),!0)},addNavigationEvents:function(){var navigator=this;this.navigationEvents=WinJSContrib.UI.registerNavigationEvents(this,function(arg){navigator._checkBackNavigation(arg)})},removeNavigationEvents:function(){this.navigationEvents&&(this.navigationEvents(),this.navigationEvents=null)},_getAnimationElements:function(isExit){return this.pageControl&&this.pageControl.getAnimationElements?this.pageControl.getAnimationElements(isExit):this.pageElement},_keypressHandler:function(args){this.locks>0||"Backspace"===args.key&&this.back()},_keyupHandler:function(args){this.locks>0||("Left"===args.key&&args.altKey||"BrowserBack"===args.key)&&this.back()},_mspointerupHandler:function(args){3===args.button?nav.back():4===args.button&&nav.forward()},navigate:function(location,initialState,skipHistory,isback,stacked){var nav=this;if(this.global)return WinJS.Navigation.navigate(location,initialState);var arg={skipHistory:skipHistory,detail:{location:location,state:initialState,navigateStacked:stacked,setPromise:function(promise){this.pagePromise=promise}}};return nav._beforeNavigate(arg),arg.detail.pagePromise=arg.detail.pagePromise||WinJS.Promise.wrap(),nav._history.current={state:initialState,location:location},arg.detail.pagePromise.then(function(){return isback&&nav._history.backstack.splice(nav._history.backstack.length-1,1),nav._navigated(arg),arg.detail.pagePromise})},clearHistory:function(){this.global?WinJS.Navigation.history.backStack=[]:(this._history.backstack=[],this._history.current=null)},closeAllPages:function(){for(var navigator=this,pages=navigator.element.children,i=pages.length-1;i>=0;i--){var page=pages[i];page&&page.classList.contains("pagecontrol")&&(navigator.element.removeChild(page),page.winControl.dispose())}},clear:function(){this.clearHistory(),this.closeAllPages(),this.element.innerHTML=""},open:function(uri,options){return this.navigate(uri,options)},pick:function(uri,options){return options=options||{},options.navigateStacked=!0,this.navigate(uri,options)},canGoBack:{get:function(){return this.global?nav.canGoBack:this._history.backstack.length>0}},_handleStackedBack:function(){var navigator=this;if(navigator.global){var isStacked=1==navigator.stackNavigation||WinJS.Navigation.history.current.state&&WinJS.Navigation.history.current.state.navigateStacked;if(isStacked){var previousPage=navigator.element.children[navigator.element.children.length-2];if(previousPage)return WinJS.Navigation.history.backStack.splice(WinJS.Navigation.history.backStack.length-1,1),navigator.triggerPageExit(),navigator.closePage(navigator.pageControl.element).then(function(){navigator._updateBackButton(previousPage.winControl.element),previousPage.winControl&&previousPage.winControl.navactivate&&previousPage.winControl.navactivate(),WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide()})}}},back:function(distance){var navigator=this;if(navigator.global)return WinJS.Navigation.back(distance);if(navigator._history.backstack.length){var pageindex=navigator._history.backstack.length-1,previousPage=navigator._history.backstack[pageindex];return navigator.navigate(previousPage.location,previousPage.state,!0,!0)}},_beforeNavigate:function(args){var navigator=this,page=this.pageElement,navlocation=args.detail.location,navstate=args.detail.state;args.detail.state=args.detail.state||{};var openStacked=1==navigator.stackNavigation||args.detail.navigateStacked||args.detail.state.navigateStacked;if(navigator.global&&page&&page.winControl&&page.winControl.navigationState&&page.winControl.navigationState.state&&page.winControl.navigationState.state.navigateStacked){var history=WinJS.Navigation.history.backStack[WinJS.Navigation.history.backStack.length-1];if(navlocation==history.location&&navstate==history.state){var res=navigator._handleStackedBack();if(WinJS.Promise.is(res))return WinJS.Navigation.history.current=history,void args.detail.setPromise(res.then(function(){var p=new WinJS.Promise(function(c){});return args.detail.setPromise(p),p.cancel(),p}))}}if(this.locks>0){var p=new WinJS.Promise(function(c){});return args.detail.setPromise(p),void p.cancel()}if(page&&page.winControl&&!openStacked&&page.winControl.canClose){var completeCallback=null,p=new WinJS.Promise(function(c){completeCallback=c});return setImmediate(function(){WinJS.Promise.wrap(page.winControl.canClose()).then(function(res){res?(navigator.triggerPageExit(openStacked),completeCallback()):p.cancel()})}),void args.detail.setPromise(p)}if(openStacked&&!args.detail.state.mcnNavigationDetails&&page&&page.winControl){if(page.winControl.navdeactivate)return void args.detail.setPromise(WinJS.Promise.as(page.winControl.navdeactivate.apply(page.winControl)))}else{if(navigator.global&&!openStacked&&WinJS.Navigation.history.current.state&&WinJS.Navigation.history.current.state.navigateStacked){navigator.closeAllPages();for(var backstack=WinJS.Navigation.history.backStack,i=backstack.length-1;i>=0;i--)backstack[i].state&&backstack[i].state.navigateStacked&&backstack.splice(i,1)}navigator.triggerPageExit()}},triggerPageExit:function(openStacked){var navigator=this,page=this.pageElement;if(openStacked)return void(page.winControl.navdeactivate?page.winControl.exitPagePromise=WinJS.Promise.as(page.winControl.navdeactivate()):page.winControl.exitPagePromise=WinJS.Promise.wrap());var hidepage=function(){};if(page&&page.winControl&&!page.winControl.exitPagePromise){if(page.winControl.exitPage){var exitPageResult=page.winControl.exitPage();if(exitPageResult){var res=WinJS.Promise.as(exitPageResult);page.winControl.exitPagePromise=res.then(function(){if(page.winControl.exitPageAnimation)return WinJS.Promise.as(page.winControl.exitPageAnimation())}).then(hidepage)}else page.winControl.exitPageAnimation?page.winControl.exitPagePromise=WinJS.Promise.as(page.winControl.exitPageAnimation()).then(hidepage):page.winControl.exitPagePromise=WinJS.Promise.as(navigator.animations.exitPage(navigator._getAnimationElements(!0))).then(hidepage)}else page.winControl.exitPageAnimation?page.winControl.exitPagePromise=WinJS.Promise.as(page.winControl.exitPageAnimation()).then(hidepage):page.winControl.exitPagePromise=WinJS.Promise.as(navigator.animations.exitPage(navigator._getAnimationElements(!0))).then(hidepage);var layoutCtrls=page.querySelectorAll(".mcn-layout-ctrl");if(layoutCtrls&&layoutCtrls.length)for(var i=0;i<layoutCtrls.length;i++){var ctrl=layoutCtrls[i].winControl;ctrl.exitPage&&ctrl.exitPage()}WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.show()}},closePage:function(pageElementToClose,args){var navigator=this;args=args||{};var oldElement=(navigator.element,pageElementToClose||this.pageElement);oldElement&&WinJSContrib.UI.untapAll(oldElement);var oldPageExitPromise=oldElement&&oldElement.winControl&&oldElement.winControl.exitPagePromise?oldElement.winControl.exitPagePromise:WinJS.Promise.wrap();return navigator.dispatchEvent("closingPage",{page:oldElement}),oldElement&&oldElement.winControl&&(oldElement.winControl.mcnPageClosing=!0,oldElement.winControl.pageLifeCycle.stop(),oldElement.winControl.dispatchEvent("closing",{youpla:"boom"}),oldElement.winControl.cancelPromises&&oldElement.winControl.cancelPromises()),!navigator.global&&!navigator.disableHistory&&oldElement&&oldElement.winControl&&oldElement.winControl.navigationState&&!args.skipHistory&&navigator._history.backstack.push(oldElement.winControl.navigationState),setImmediate(function(){var p=navigator._lastNavigationPromise?navigator._lastNavigationPromise.then(function(){},function(){}):WinJS.Promise.wrap();p.then(function(){return oldPageExitPromise}).then(function(){return WinJS.Promise.timeout(200)}).then(function(){WinJS.Utilities.Scheduler.schedule(function(){navigator.destroyOldPage(oldElement)})})},1e3),WinJS.Promise.wrap()},destroyOldPage:function(oldElement){if(oldElement){oldElement.style.opacity="0",oldElement.style.display="none",oldElement.winControl&&(oldElement.winControl.stackedOn=null,oldElement.winControl.stackedBy=null,oldElement.winControl.eventTracker&&oldElement.winControl.eventTracker.dispose(),oldElement.winControl.unload&&oldElement.winControl.unload()),WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(oldElement);try{oldElement.parentElement&&oldElement.parentElement.removeChild(oldElement)}catch(exception){console.log("cannot remove page, WTF ????????")}}},_navigated:function(args){var navigator=this;args.detail.state=args.detail.state||{};var pagecontainer=navigator.element,oldPage=this.pageControl,oldElement=this.pageElement,openStacked=1==navigator.stackNavigation||args.detail.navigateStacked||args.detail.state&&args.detail.state.navigateStacked;if(this._lastNavigationPromise&&(this._lastNavigationPromise.cancel(),WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide()),oldPage&&oldPage.stackedOn&&args.detail.state.mcnNavigationDetails){var closeOldPagePromise=navigator.closePage(oldElement,args);return this._lastNavigationPromise=closeOldPagePromise,args.detail.setPromise(closeOldPagePromise),void(WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide())}if(openStacked){!navigator.global&&!navigator.disableHistory&&oldElement&&oldElement.winControl&&oldElement.winControl.navigationState&&!args.skipHistory&&navigator._history.backstack.push(oldElement.winControl.navigationState);var closeOldPagePromise=WinJS.Promise.wrap()}else var closeOldPagePromise=navigator.closePage(oldElement,args);if(navigator.global&&!openStacked)for(var backstack=WinJS.Navigation.history.backStack,i=backstack.length-1;i>=0;i--)backstack[i].state&&backstack[i].state.navigateStacked&&backstack.splice(i,1);args.detail.state.mcnNavigationDetails={id:WinJSContrib.Utils.guid(),date:new Date};var parentedComplete;new WinJS.Promise(function(c){parentedComplete=c});navigator.currentPageDetails=args.detail;var openNewPagePromise=WinJSContrib.UI.Pages.renderFragment(pagecontainer,args.detail.location,args.detail.state,{enterPage:navigator.animations.enterPage,getFragmentElement:navigator.fragmentInjector,closeOldPagePromise:closeOldPagePromise.then(function(){},function(){}),oninit:function(element,options){if(element){var control=element.winControl;control.navigator=navigator,control.element.mcnPage=!0,openStacked&&(control.stackedOn=oldPage,oldPage&&(oldPage.stackedBy=control)),control.renderComplete=control.renderComplete.then(function(){parentedComplete()})}},onrender:function(element,options){if(args.detail.state&&args.detail.state.clearNavigationHistory)if(navigator.global){WinJS.Navigation.history.backStack=[];var systemNavigationManager=null;WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(systemNavigationManager=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView(),systemNavigationManager&&(systemNavigationManager.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed))}else navigator._history.backstack=[];navigator._updateBackButton(element)},onready:function(element,options){navigator.dispatchEvent("pageContentReady",{page:element.winControl}),WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide()}}).then(function(){navigator._lastNavigationPromise==openNewPagePromise&&(navigator._lastNavigationPromise=void 0)});this._lastNavigationPromise=openNewPagePromise,args.detail.setPromise(WinJS.Promise.join([closeOldPagePromise,openNewPagePromise]))},_resized:function(args){var navigator=this;if(this.pageControl&&this.pageControl.element){var navigator=this,control=this.pageControl,element=control.element;cancelAnimationFrame(navigator.layoutProcess),navigator.layoutProcess=requestAnimationFrame(function(){for(var vw=appView?appView.value:null,i=0,l=navigator.element.children.length;i<l;i++){var control=navigator.element.children[i].winControl;if(control)if(control.__checkLayout)control.__checkLayout(element,vw,navigator._lastViewstate);else{control.updateLayout&&control.updateLayout.call(control,element,vw,navigator._lastViewstate);var layoutCtrls=element.querySelectorAll(".mcn-layout-ctrl");if(layoutCtrls&&layoutCtrls.length)for(var i=0;i<layoutCtrls.length;i++){var ctrl=layoutCtrls[i].winControl;ctrl.updateLayout&&ctrl.updateLayout(ctrl.element,vw,navigator._lastViewstate)}}}})}this._lastViewstate=appView?appView.value:null},_handleBack:function(){nav.back()},_updateBackButton:function(element){var ctrl=this,canGoBack=ctrl.canGoBack,systemNavigationManager=null;WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(systemNavigationManager=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView()),ctrl.global&&systemNavigationManager&&WinJSContrib.UI.enableSystemBackButtonVisibility&&(canGoBack?systemNavigationManager.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.visible:systemNavigationManager.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed);var backButtons=element.querySelectorAll(".win-backbutton, .back-button, .win-navigation-backbutton");if(backButtons&&backButtons.length>0)for(var clearNav=!1,i=0,l=backButtons.length;i<l;i++){var btn=backButtons[i];btn&&(canGoBack&&!clearNav?(btn.classList.remove("disabled"),btn.disabled=!1):(btn.classList.add("disabled"),btn.disabled=!0),btn.onclick=function(arg){if(!arg.currentTarget.classList.contains("win-navigation-backbutton"))if(ctrl.global)nav.back();else{var navigator=WinJSContrib.UI.parentNavigator(arg.currentTarget);navigator.back()}})}}}),WinJS.Utilities.eventMixin)}),WinJSContrib.UI.WebComponents&&WinJSContrib.UI.WebComponents.register("mcn-navigator",WinJSContrib.UI.PageControlNavigator,{properties:["global"],map:{ENTERPAGEANIMATION:{attribute:"enterPageAnimation",property:"animations.enterPage",resolve:!0},EXITPAGEANIMATION:{attribute:"exitPageAnimation",property:"animations.exitPage",resolve:!0}}})}();
!function(){"use strict";WinJS.Navigation;WinJS.Namespace.define("WinJSContrib.UI",{ExtendedSplash:WinJS.Class.define(function(element,options){var ctrl=this;options=options||{},ctrl.element=element||document.createElement("div"),ctrl.enterAnimation=options.enterAnimation||function(){var ctrl=this;return WinJSContrib.UI.Animation.fadeIn(ctrl.splashLoader,{duration:500})},ctrl.exitAnimation=options.enterAnimation||function(){var ctrl=this,prom1=WinJSContrib.UI.Animation.fadeOut(ctrl.element.querySelector("#mcn-splashscreen-loader"),{duration:500}),prom2=WinJSContrib.UI.Animation.fadeOut(ctrl.element,{duration:500,delay:200});return WinJS.Promise.join([prom1,prom2]).then(function(){ctrl.element.style.display="none"})},ctrl.isVisible=!1,WinJSContrib.UI.Application=WinJSContrib.UI.Application||{},WinJSContrib.UI.Application.splashscreen=ctrl,ctrl.element.className="mcn-splashscreen "+ctrl.element.className,WinJSContrib.CrossPlatform&&WinJSContrib.CrossPlatform.crossPlatformClass&&WinJSContrib.CrossPlatform.crossPlatformClass(ctrl.element),ctrl.splashImageFile=options.image||"/images/splashscreen.png",ctrl.element.innerHTML||ctrl.defaultSplashContent(options.text||"chargement en cours",options.description),console.log(ctrl.element.innerHTML),ctrl.textElement||(ctrl.textElement=ctrl.element.querySelector(".mcn-splashscreen-loader-text")),ctrl.splashImage||(ctrl.splashImage=ctrl.element.querySelector("#mcn-splashscreen-image")),ctrl.splashLoader||(ctrl.splashLoader=ctrl.element.querySelector("#mcn-splashscreen-loader")),ctrl.handleResizeBinded=ctrl.handleResize.bind(ctrl),ctrl.handleDismissedBinded=ctrl.handleDismissed.bind(ctrl)},{defaultSplashContent:function(text){var ctrl=this;if(WinJSContrib.CrossPlatform&&(WinJSContrib.CrossPlatform.isMobile.Android()||WinJSContrib.CrossPlatform.isMobile.iOS())){ctrl.splashImage=document.createElement("img"),ctrl.splashImage.src=this.splashImageFile,ctrl.splashImage.id="mcn-splashscreen-image",ctrl.element.appendChild(ctrl.splashImage),ctrl.splashLoader=document.createElement("div"),ctrl.splashLoader.style.opacity=0,ctrl.splashLoader.id="mcn-splashscreen-loader",ctrl.splashLoader.className="mcn-cordova-spalsh";var cordova=document.createElement("div");cordova.className="cordova-ring",cordova.innerHTML='<div class="wBall" id="wBall_1"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_2"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_3"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_4"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_5"><div class="wInnerBall"></div></div></div>',ctrl.textElement=document.createElement("div"),ctrl.textElement.className="mcn-splashscreen-loader-text",ctrl.textElement.innerText=text||"",ctrl.splashLoader.appendChild(cordova),ctrl.splashLoader.appendChild(ctrl.textElement),ctrl.element.appendChild(ctrl.splashLoader)}else ctrl.element.innerHTML='<img id="mcn-splashscreen-image" src="'+this.splashImageFile+'" alt="Splash screen image" /><div id="mcn-splashscreen-loader" style="opacity: 0"><progress class="win-ring"></progress><div class="mcn-splashscreen-loader-text">'+(text||"")+"</div></div>"},handleResize:function(){this.setLocation()},handleDismissed:function(arg){arg.target.removeEventListener("dismissed",this.handleDismissedBinded)},init:function(arg){var ctrl=this;return WinJS.Promise.timeout().then(function(){arg&&arg.detail&&arg.detail.splashScreen&&ctrl.setLocation(arg.detail.splashScreen),ctrl.element.style.display=""})},show:function(dataLoadPromise,arg){console.log("show splash");var ctrl=this;return arg&&ctrl.init(arg),ctrl&&console.log("ctrl"),console.log(ctrl),ctrl.splashLoader&&console.log("ctrl.splashLoader"),ctrl.splashLoader.style&&console.log("ctrl.splashLoader.style"),ctrl.element&&console.log("ctrl.element"),ctrl.splashLoader.style.opacity=0,ctrl.element.style.display="",ctrl.element.style.opacity="",setImmediate&&console.log("setImmediate"),new WinJS.Promise(function(complete,error){setImmediate(function(){window.addEventListener("resize",ctrl.handleResizeBinded,!1),ctrl.enterAnimation.bind(ctrl)()}),WinJS.Promise.join([dataLoadPromise,WinJS.Promise.timeout(200)]).done(function(){console.log("show splash complete"),complete()},function(){console.log("show splash error"),error()})})},setLocation:function(splash){var ctrl=this;splash&&splash.imageLocation?(ctrl.splashImage.style.position="absolute",ctrl.splashImage.style.top=splash.imageLocation.y+"px",ctrl.splashImage.style.left=splash.imageLocation.x+"px",ctrl.splashImage.style.width=splash.imageLocation.width+"px",ctrl.splashImage.style.position="absolute",ctrl.splashLoader.style.top=splash.imageLocation.y+splash.imageLocation.height+20+"px",ctrl.splashLoader.style.left=splash.imageLocation.x+"px"):(ctrl.splashImage.style.position="",ctrl.splashImage.style.top="",ctrl.splashImage.style.left="",ctrl.splashImage.style.height="",ctrl.splashImage.style.width="",ctrl.splashImage.style.position="",ctrl.splashLoader.style.top="",ctrl.splashLoader.style.left="",ctrl.splashLoader.style.height="",ctrl.splashLoader.style.width="")},hide:function(){var ctrl=this;return WinJSContrib.UI.appbarsEnable(),window.removeEventListener("resize",ctrl.handleResizeBinded),ctrl.exitAnimation.bind(ctrl)()}})})}();
!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{GlobalProgress:WinJS.Class.define(function(element,options){var ctrl=this;options=options||{},ctrl.element=element||document.createElement("div"),ctrl.throttlingDelay=void 0!=options.delay?options.delay:200,ctrl.isVisible=!1,ctrl.refCount=0,WinJSContrib.UI.Application=WinJSContrib.UI.Application||{},options.global&&(WinJSContrib.UI.Application.progress=ctrl),ctrl.element.className="mcn-globalprogress-ctrl "+element.className,WinJSContrib.CrossPlatform&&WinJSContrib.CrossPlatform.crossPlatformClass&&WinJSContrib.CrossPlatform.crossPlatformClass(ctrl.element),ctrl.element.style.display="none",ctrl.element.style.opacity="0",element.innerHTML='<div class="mcn-globalprogress-content"><progress class="bar"></progress><div class="mcn-globalprogress-text">'+(options.text||"")+"</div></div>"},{show:function(timeout){var ctrl=this;return ctrl.isVisible||ctrl.throttling?void(ctrl.refCount=ctrl.refCount+1):void(0==timeout?ctrl.showNow():this.throttling=setTimeout(ctrl.showNow.bind(this),timeout||ctrl.throttlingDelay))},showNow:function(){var ctrl=this;ctrl.refCount=ctrl.refCount+1,ctrl.isVisible||(ctrl.element.style.display="",WinJS.UI.Animation.fadeIn(ctrl.element),ctrl.isVisible=!0)},hide:function(force){var ctrl=this;force&&(ctrl.refCount=0),ctrl.refCount>0&&(ctrl.refCount=ctrl.refCount-1),ctrl.throttling&&(clearTimeout(ctrl.throttling),ctrl.throttling=void 0),0==ctrl.refCount&&(ctrl.isVisible=!1,WinJS.UI.Animation.fadeOut(ctrl.element).done(function(){ctrl.element.style.display="none"}))}})})}();
!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{Hamburger:WinJS.Class.define(function(element,options){var ctrl=this;options=options||{},ctrl.element=element||document.createElement("div"),ctrl.element.classList.add("menu-button"),ctrl.element.classList.add("active"),ctrl.element.innerHTML='<div class="menu-button-wrapper"><span class="menu-global menu-top"></span><span class="menu-global menu-middle"></span><span class="menu-global menu-bottom"></span></div>'},{activate:function(){this.element.classList.add("active")},deactivate:function(){this.element.classList.remove("active")},on:function(){for(var ctrl=this,list=ctrl.element.querySelectorAll(".menu-global"),i=0;i<list.length;i++)list[i].classList.add("activated")},off:function(){for(var ctrl=this,list=ctrl.element.querySelectorAll(".menu-global"),i=0;i<list.length;i++)list[i].classList.remove("activated")},tap:function(callBack){callBack?WinJSContrib.UI.tap(this.element,callBack):WinJSContrib.UI.untap(this.element)}})})}();
!function(){WinJS.Namespace.define("WinJSContrib.UI",{parentChildView:function(element){for(var current=element.parentNode;current;){if(current.mcnChildnav)return current.winControl;current=current.parentNode}},ChildViewFlyout:WinJS.Class.mix(WinJS.Class.define(function(element,options){element.winControl=this,options=options||{},this.element=element||document.createElement("div"),options.inplace?this.rootElement=this.element:(this.rootElement=document.createElement("div"),this.rootElement.mcnChildnav=!0,this.rootElement.winControl=this,this.element.style.display="none"),document.body.appendChild(this.rootElement),this.navigationEvents=options.navigationEvents,this.element.mcnChildnav=!0,this.element.classList.add("mcn-childview"),this.element.classList.add("win-disposable"),this.rootElement.classList.add("childNavigator"),this.rootElement.classList.add("hidden"),this.element.classList.add("mcn-navigation-ctrl"),this.target=options.target||null,this._createContent(options),this.isOpened=!1,this.hardwareBackBtnPressedBinded=this.hardwareBackBtnPressed.bind(this),this.childContentKeyUp=this._childContentKeyUp.bind(this)},{_createContent:function(options){var that=this,FD=WinJSContrib.UI.FluentDOM;new FD("DIV");that.overlay=new FD("DIV").addClass("childNavigator-overlay").appendTo(that.rootElement).tap(that.hide.bind(that),{disableAnimation:!0,disableAria:!0}).element,that.contentPlaceholder=new FD("DIV","childNavigator-contentPlaceholder",that.rootElement).append("DIV",null,function(nav){that.navigator=new WinJSContrib.UI.PageControlNavigator(nav.element,{global:!1}),that.navigator.animations.enterPage=WinJS.UI.Animation.fadeIn,that.navigator.hide=function(arg){return that.hide(arg)}}).element,options&&options.closeBtn&&options.closeBtn.active&&(that.closebtn=new FD("DIV","mcn-close-btn",that.contentPlaceholder),options.closeBtn.templatetext&&that.closebtn.html(options.closeBtn.templatetext),options.closeBtn["class"]?that.closebtn.className(that.closebtn.element.className+" "+options.closeBtn["class"]):options.closeBtn.templatetext||that.closebtn.className(that.closebtn.element.className+" default-icon"),WinJSContrib.UI.tap(that.closebtn.element,function(){that.closePage()}))},navigate:function(uri,options,skipHistory){var that=this;return that.navigator.navigate(uri,options)},pageControl:{get:function(){return this.container&&this.container.winControl}},clear:function(forceClose){var that=this;return new WinJS.Promise(function(complete,error){WinJS.Promise.wrap(that.closePage(null,null,forceClose)).done(function(){that.navigator.clear(),that.navigator.element.innerText="",that.location=void 0,complete()})})},closePage:function(arg,pageElement,forceClose){var that=this,check=forceClose?WinJS.Promise.wrap(!0):that.canClose(),currentpageclose=check.then(function(canClose){if(!canClose)return WinJS.Promise.wrapError();that.navigator.pagesCount;return 1==that.navigator.pagesCount?that.hide(arg,null,!0):(that.navigator.triggerPageExit(),that.navigator.closePage(pageElement).then(function(){WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide()}))});return that.closePagePromise?that.closePagePromise=that.closePagePromise.then(function(){return currentpageclose},function(){}).then(function(){return forceClose?WinJS.Promise.wrap(!0):that.canClose()}):that.closePagePromise=currentpageclose,currentpageclose},back:function(distance){var that=this;return that.navigator.back(distance)},canGoBack:function(){return that.navigator.canGoBack},_childContentKeyUp:function(args){"Esc"===args.key&&this.hide()},hardwareBackBtnPressed:function(arg){var ctrl=this;ctrl.navigator._checkBackNavigation(arg)||(ctrl.hide(),arg.handled=!0)},show:function(skipshowcontainer){var that=this;return that.target&&that.target.classList.add("childview-target"),that.isOpened?WinJS.Promise.wrap():(WinJSContrib.UI&&WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(systemNavigationManager=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView(),systemNavigationManager.appViewBackButtonVisibility===window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed&&(systemNavigationManager.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.visible)),document.body.addEventListener("keyup",that.childContentKeyUp),that.isOpened=!0,this.addDismissableClass("visible"),this.addDismissableClass("enter"),this.removeDismissableClass("leave"),this.removeDismissableClass("hidden"),that.rootElement.getBoundingClientRect(),that.navEventsHandler=WinJSContrib.UI.registerNavigationEvents(that,this.hardwareBackBtnPressedBinded),that.navigationEvents&&that.navigator.addNavigationEvents(),that.hideChildViewPromise=null,that.showChildViewPromise=WinJS.Promise.timeout().then(function(){return that.addDismissableClass("enter-active"),WinJSContrib.UI.afterTransition(that.contentPlaceholder).then(function(){that.contentPlaceholder.classList.contains("enter")})}),that.showChildViewPromise)},addDismissableClass:function(classname){var that=this;that.overlay.classList.add(classname),that.contentPlaceholder.classList.add(classname),that.rootElement.classList.add(classname),that.target&&that.target.classList.add("childview-"+classname)},removeDismissableClass:function(classname){var that=this;that.overlay.classList.remove(classname),that.overlay.classList.remove(classname+"-active"),that.contentPlaceholder.classList.remove(classname),that.contentPlaceholder.classList.remove(classname+"-active"),that.rootElement.classList.remove(classname),that.rootElement.classList.remove(classname+"-active"),that.target&&(that.target.classList.remove("childview-"+classname),that.target.classList.remove("childview-"+classname+"-active"))},pick:function(uri,options,skipHistory){var ctrl=this;options=options||{},ctrl.pickPromises=ctrl.pickPromises||[];var pickPromise=new WinJS.Promise(function(complete,error){var completed=!1,page=null,manageClose=function(arg){try{removePromise(),page&&page.removeEventListener("closing",manageClose),ctrl.removeEventListener("beforehide",manageClose),completed||(completed=!0,complete({completed:!1,data:null}))}catch(e){complete({completed:!1,data:null})}};options.navigateStacked=!0,options.injectToPage={close:function(arg){removePromise(),completed=!0,manageClose(),page&&page.removeEventListener("closing",manageClose),ctrl.removeEventListener("beforehide",manageClose),ctrl.closePage(arg,this.element||this.rootElement).then(function(){complete({completed:!0,data:arg})})},cancel:function(){manageClose(),ctrl.closePage()}};var arg=JSON.parse(JSON.stringify(options));arg.navigateStacked=!0,ctrl.open(uri,options,skipHistory).then(function(arg){page=ctrl.navigator.pageControl,page&&page.addEventListener("closing",manageClose),ctrl.addEventListener("beforehide",manageClose,!1)})}),removePromise=function(){var idx=ctrl.pickPromises.indexOf(pickPromise);ctrl.pickPromises.splice(idx,1)};return ctrl.pickPromises.push(pickPromise),pickPromise.then(removePromise),pickPromise},open:function(uri,options,skipHistory){var that=this;that.rootElement.classList.add("visible"),that.dispatchEvent("beforeshow");var p=WinJS.Promise.wrap();return that.isOpened||(p=that.show(!0)),that.openChildViewPromise=WinJS.Promise.join({show:WinJSContrib.UI.afterTransition(that.contentPlaceholder),navigate:that.navigate(uri,options,skipHistory).done(function(e){that.dispatchEvent("aftershow")})}),that.openChildViewPromise},canClose:function(){return this.navigator.pageControl&&this.navigator.pageControl.canClose?WinJS.Promise.as(this.navigator.pageControl.canClose()).then(function(canclose){return canclose}):WinJS.Promise.wrap(!0)},hide:function(arg,event,forceClose){var that=this;if(that.isOpened){that.isOpened=!1,that.showChildViewPromise=null,that.closePagePromise=null,that.openChildViewPromise=null;var check=forceClose?WinJS.Promise.wrap(!0):that.canClose();return that.hideChildViewPromise=check.then(function(canclose){if(that.contentPlaceholder.classList.contains("enter")||that.contentPlaceholder.classList.contains("enter-active"))return that.addDismissableClass("leave"),!!canclose&&(that.pickPromises&&that.pickPromises.forEach(function(p){p.cancel()}),document.body.removeEventListener("keyup",that.childContentKeyUp),that.dispatchEvent("beforehide",arg),that.navigator.canGoBack||WinJS.Navigation.canGoBack||WinJSContrib.UI&&WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(systemNavigationManager=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView(),systemNavigationManager.appViewBackButtonVisibility===window.Windows.UI.Core.AppViewBackButtonVisibility.visible&&(systemNavigationManager.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed)),that.navEventsHandler&&(that.navEventsHandler(),that.navigator.removeNavigationEvents(),that.navEventsHandler=null),WinJS.Promise.timeout().then(function(){return that.removeDismissableClass("enter"),that.addDismissableClass("leave-active"),WinJS.Promise.join({overlay:WinJSContrib.UI.afterTransition(that.overlay,1e3),content:WinJSContrib.UI.afterTransition(that.contentPlaceholder,1e3)}).then(function(){that.contentPlaceholder.classList.contains("leave")&&(that.clear(!0),that.removeDismissableClass("visible"),that.addDismissableClass("hidden"),that.removeDismissableClass("leave"),that.dispatchEvent("afterhide",arg))})}))}),that.hideChildViewPromise}return WinJS.Promise.wrap(!0)},dispose:function(){this.rootElement.winControl=null,WinJS.Utilities.disposeSubTree(this.rootElement),WinJS.Utilities.disposeSubTree(this.element),this.rootElement.parentElement.removeChild(this.rootElement)}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("beforeshow","beforehide","aftershow","afterhide"))})}();
!function(){"use strict";var DataFormState=WinJS.Class.mix(WinJS.Class.define(function(){this._initObservable()},{}),WinJS.Binding.mixin,WinJS.Binding.expandProperties({isValid:!1,updated:!1}));WinJS.Namespace.define("WinJSContrib.UI",{DataForm:WinJS.Class.mix(WinJS.Class.define(function(element,options){var ctrl=this;this.element=element||document.createElement("FORM"),options=options||{},this.groups=options.groups,this.messages=options.messages,this.rules=options.rules,this.state=new DataFormState,this.state.item={},this.allowTooltip=options.allowTooltip||!0,this.workOnCopy=options.workOnCopy||!0,this.tooltipDelay=options.tooltipDelay||4e3,this.tooltipPosition=options.tooltipPosition||"right",this.tooltipTheme=options.tooltipTheme||"tooltipster-error",this.initValidator(),this.element.winControl=this,this.element.mcnDataForm=!0,this.element.classList.add("win-disposable"),WinJSContrib.CrossPlatform&&WinJSContrib.CrossPlatform.crossPlatformClass&&WinJSContrib.CrossPlatform.crossPlatformClass(this.element),WinJS.UI.setOptions(this,options),WinJS.UI.processAll(this.element).done(function(){WinJS.Binding.processAll(ctrl.element,ctrl.state)}),$(".mcn-dataform-cancel",this.element).click(function(arg){arg.preventDefault(),ctrl.cancel()})},{messages:{get:function(){return this._messages},set:function(val){this._messages=val}},rules:{get:function(){return this._rules},set:function(val){this._rules=val}},groups:{get:function(){return this._groups},set:function(val){this._groups=val}},item:{get:function(){return this.state.item},set:function(val){var dataform=this;dataform.workOnCopy?(dataform.state.item=$.extend(!0,{},val),dataform.state.refItem=val):dataform.state.item=val,dataform.validator.resetForm(),dataform.autobindFields(),WinJS.Binding.processAll(this.element,this.state).done(function(){var tooltips=dataform.allowTooltip;dataform.allowTooltip=!1,dataform.validator.form(),dataform.allowTooltip=tooltips,dataform.checkState(),dataform.initValidator(),dataform.state.updated=!1}),dataform.dispatchEvent("itemchanged",{dataform:this,item:val})}},updated:{get:function(){return this.state.updated},set:function(val){this.state.updated=val,this.dispatchEvent("haschanges")}},autobindFields:function(){var ctrl=this;$("[data-formfield]",ctrl.element).each(function(){var fieldElt=this,srcProperty=$(fieldElt).data("formfield"),destFieldType="value";"checkbox"==fieldElt.type&&(destFieldType="checked"),WinJSContrib.UI.DataFormBinding(ctrl.state.item,srcProperty.split("."),fieldElt,[destFieldType])})},checkState:function(){var nbInvalids=this.validator.numberOfInvalids();this.state.isValid=0==nbInvalids},cancel:function(){var dataform=this;dataform.workOnCopy&&(dataform.item=$.extend(!0,{},dataform.state.refItem))},save:function(){var dataform=this;dataform.workOnCopy&&(dataform.state.updated=!1,dataform.state.refItem=$.extend(!0,{},dataform.state.item))},initValidator:function(){var dataform=this;this.validator=$(this.element).validate({groups:this.groups,rules:this.rules,submitHandler:function(form){dataform.dispatchEvent("submitted",{item:dataform.state.item})},invalidHandler:function(form,validator){dataform.checkState()},errorPlacement:function(error,element){if(dataform.checkState(),dataform.allowTooltip){var $e=$(element);$e.tooltipster({trigger:"custom",onlyOne:!1,position:dataform.tooltipPosition,theme:dataform.tooltipTheme});var lastError=$e.data("lastError"),newError=$(error).text();$e.data("lastError",newError),""!==newError&&newError!==lastError&&($e.tooltipster("content",newError),$e.tooltipster("show"),$e[0].tooltipsterValidationTimeout=setTimeout(function(){$e[0].tooltipsterValidationTimeout=null,$e.hasClass("tooltipster")&&$e.tooltipster("hide")},dataform.tooltipDelay))}},success:function(label,element){dataform.checkState();var $e=$(element);$e[0].tooltipsterValidationTimeout&&(clearTimeout($e[0].tooltipsterValidationTimeout),$e[0].tooltipsterValidationTimeout=null),$e.hasClass("tooltipstered")&&$e.tooltipster("hide")}})},validate:function(){var res=this.validator.form();return res},dispose:function(){WinJS.Utilities.disposeSubTree(this.element)}},{DefaultBindingOptions:{trimText:!0,convertEmptyToNull:!0},Converters:{none:{fromObject:function(val,options){return val.toString()},fromInput:function(val,options){return val}},text:{fromObject:function(val,options){if("undefined"==typeof val||null===val)return"";var res=val.toString();return res},fromInput:function(val,options){var res=val;return res&&options&&options.trimText&&(res=res.trim()),options&&options.convertEmptyToNull&&(res=""===res?null:res),res}},number:{fromObject:function(val,options){return"number"!=typeof val?"":val.toString()},fromInput:function(val,options){return"undefined"!=typeof val&&null!==val?parseFloat(val.toString().replace(",",".").replace(" ","")):null}},"boolean":{fromObject:function(val,options){return"undefined"==typeof val||null===val?"":val.toString()},fromInput:function(val,options){return"true"===val||"false"!==val&&null}},object:{fromObject:function(val,options){return val},fromInput:function(val,options){return val}},stringifiedObject:{fromObject:function(val,options){return JSON.stringify(val)},fromInput:function(val,options){return JSON.parse(val)}}}}),WinJS.UI.DOMEventMixin,WinJS.Utilities.createEventProperties("itemchanged","haschanges","submitted")),parentDataForm:function(element){for(var current=element.parentNode;current;){if(current.mcnDataForm)return current.winControl;current=current.parentNode}},DataFormBinding:WinJS.Binding.initializer(function(source,sourceProperty,dest,destProperty){function updateInputFromObject(){var data=WinJSContrib.Utils.readProperty(source,sourceProperty);if("undefined"==typeof data&&(data=null),"INPUT"==dest.nodeName&&"radio"==dest.type){dest.name;dest.value==data&&(dest.checked=!0)}else data=converter.fromObject(data,options),WinJSContrib.Utils.writeProperty(dest,destProperty,data)}function updateObjectFromInput(){if(dataform.checkState(),!dest.id||dataform.validator.element(dest)){var val=null;if("INPUT"==dest.nodeName&&"radio"==dest.type){var fieldname=dest.name;if(dest.form&&dest.form[fieldname]&&dest.form[fieldname].length)for(var i=0,l=dest.form[fieldname].length;i<l;i++){var field=dest.form[fieldname][i];if(field.checked){val=field.value;break}}}else val=WinJSContrib.Utils.getProperty(dest,destProperty).propValue;void 0!==val&&(val=converter.fromInput(val,options)),WinJSContrib.Utils.writeProperty(source,sourceProperty,val)}dataform.updated=!0}function validateObjectOnBlur(){fieldUpdated&&dataform.validator.element(dest)}var dataform=WinJSContrib.UI.parentDataForm(dest),options=WinJSContrib.UI.DataForm.DefaultBindingOptions,optionsText=dest.getAttribute("data-formfield-options");optionsText&&(options=WinJS.UI.optionsParser(optionsText,window));var inputType="",inputOption=dest.getAttribute("data-forminput");inputOption&&(inputType=inputOption);var fieldUpdated=!1;dest.classList.add("mcn-dataform-field"),dest.form||(dest.form=dataform.element);var inputType="text";$(dest).data("formfield-type")?inputType=$(dest).data("formfield-type"):"TEXTAREA"!==dest.nodeName&&"undefined"!=typeof dest.type&&(inputType=dest.type);var converter=WinJSContrib.UI.DataForm.Converters[inputType]||WinJSContrib.UI.DataForm.Converters.text;dest.binded||(dest.binded=!0),dest.winControl||(dest.classList.add("win-disposable"),dest.winControl={dispose:function(){dest.removeEventListener("change",dest.winControl.updateObjectFromInput),dest.removeEventListener("blur",dest.winControl.validateObjectOnBlur),inputType&&dest.removeEventListener(inputType,dest.winControl.updateObjectFromInput)}}),dest.winControl.updateObjectFromInput=updateObjectFromInput,dest.winControl.validateObjectOnBlur=validateObjectOnBlur,inputType&&dest.addEventListener(inputType,dest.winControl.updateObjectFromInput),dest.addEventListener("change",dest.winControl.updateObjectFromInput),dest.id&&dest.addEventListener("blur",validateObjectOnBlur);var bindingDesc={};return bindingDesc[sourceProperty]=updateInputFromObject,WinJS.Binding.bind(source,bindingDesc)})})}();
!function(){"use strict";function debugLog(msg){}WinJS.Namespace.define("WinJSContrib.UI",{SwipeSlide:WinJS.Class.mix(WinJS.Class.define(function(element,options){this.element=element||document.createElement("DIV"),options=options||{},this.moveDivider=options.moveDivider||1,this.threshold=options.threshold||40,this.touchOnly=!1,this.minSwipeDistance=options.minSwipeDistance||100,this.direction=options.direction||"horizontal",this.element.winControl||(this.element.winControl=this),this.element.classList.add("mcn-swipeslide"),this.element.classList.add("win-disposable"),this.target=this.element,this.eventTracker=new WinJSContrib.UI.EventTracker,this.ptDown=null,this.registerEvents(),this.allowed=options.allowed||{left:!0,right:!0,top:!1,bottom:!1},this.disabled=!1,WinJS.UI.setOptions(this,options),this.thresholdFactor=this.thresholdFactor||4},{registerEvents:function(){void 0!==this.element.onpointerdown?(this.eventTracker.addEvent(this.element,"pointerdown",this._processDown.bind(this),!1),this.eventTracker.addEvent(this.element,"pointerup",this._processUp.bind(this),!1),this.eventTracker.addEvent(this.element,"pointercancel",this._processCancel.bind(this),!1),this.eventTracker.addEvent(this.element,"pointermove",this._processMove.bind(this),!1)):window.Touch?(this.eventTracker.addEvent(this.element,"touchstart",this._processDown.bind(this),!0),this.eventTracker.addEvent(this.element,"touchend",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"touchcancel",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"touchmove",this._processMove.bind(this),!0)):(this.eventTracker.addEvent(this.element,"mousedown",this._processDown.bind(this),!0),this.eventTracker.addEvent(this.element,"mouseup",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"mouseleave",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"mousemove",this._processMove.bind(this),!0))},_initPtDown:function(event){var transformOffsetX=0,transformOffsetY=0;if(event.changedTouches){if(window.WebKitCSSMatrix){var matrix=new window.WebKitCSSMatrix(this.target.style.transform||this.target.style.webkitTransform||"");transformOffsetX=matrix.m41,transformOffsetY=matrix.m42}this.ptDown={x:event.changedTouches[0].screenX,y:event.changedTouches[0].screenY,confirmed:!1,transformOffsetX:transformOffsetX,transformOffsetY:transformOffsetY}}else{if(window.MSCSSMatrix){var matrix=new window.MSCSSMatrix(this.target.style.transform);transformOffsetX=matrix.m41,transformOffsetY=matrix.m42}this.ptDown={x:event.screenX,y:event.screenY,confirmed:!1,transformOffsetX:transformOffsetX,transformOffsetY:transformOffsetY,maxDX:0,maxDY:0}}},_processDown:function(event){this.disabled||(this.capturePointerOnDown&&(event.preventDefault(),event.stopPropagation()),this._initPtDown(event))},_processLeave:function(event){var ctrl=this;event.currentTarget||event.target;console.log("pointer leave"),ctrl._processUp(event)},_processCancel:function(event){var ctrl=this;event.currentTarget||event.target;console.log("pointer cancel");event.currentTarget||event.target;if(event.pointerId&&ctrl.element.releasePointerCapture)try{ctrl.element.releasePointerCapture(event.pointerId)}catch(exception){}ctrl._cancelMove(),ctrl.ptDown=null,ctrl.dispatchEvent("swipeend")},_processUp:function(event){var ctrl=this;event.currentTarget||event.target;if(event.pointerId&&ctrl.element.releasePointerCapture)try{ctrl.element.releasePointerCapture(event.pointerId)}catch(exception){}if(ctrl.ptDown){if(event.changedTouches)var dX=ctrl.ptDown.x-event.changedTouches[0].screenX,dY=ctrl.ptDown.y-event.changedTouches[0].screenY;else var dX=ctrl.ptDown.x-event.screenX,dY=ctrl.ptDown.y-event.screenY;var moveval=this.ptDown.transformOffsetX+(-dX-this.threshold)/(window.devicePixelRatio*this.moveDivider);"vertical"==ctrl.direction&&(moveval=this.ptDown.transformOffsetY+(-dY-this.threshold)/(window.devicePixelRatio*this.moveDivider));var enableSwipe=!0;if(event.pointerId&&this.touchOnly&&"touch"!=event.pointerType&&(enableSwipe=!1),enableSwipe&&ctrl._acceptSwipe(moveval)){this.setMoveIntent&&cancelAnimationFrame(this.setMoveIntent);var arg={dX:dX,dY:dY,move:-dX-ctrl.threshold,screenMove:ctrl.ptDown.screenMove,direction:dX>0?"left":"right",handled:!1};"vertical"==ctrl.direction&&(arg.move=-dY-ctrl.threshold,arg.direction=dY>0?"top":"bottom"),"left"==arg.direction&&ctrl.allowed.left||"right"==arg.direction&&ctrl.allowed.right||"top"==arg.direction&&ctrl.allowed.top||"bottom"==arg.direction&&ctrl.allowed.bottom?(ctrl.dispatchEvent("swipe",arg),debugLog("swipe slide, swipeHandled "+ctrl.swipeHandled+"/"+arg.handled+"/"+ctrl.zurgl),ctrl.swipeHandled||ctrl._cancelMove()):ctrl._cancelMove()}else this.ptDown.maxDX<ctrl.threshold&&this.ptDown.maxDY<ctrl.threshold?(ctrl.dispatchEvent("invoked",arg),ctrl.swipeHandled||ctrl._cancelMove()):ctrl._cancelMove()}else ctrl._cancelMove();ctrl.ptDown=null,ctrl.dispatchEvent("swipeend")},_acceptSwipe:function(move){var ctrl=this,abs=Math.abs(move);return!(abs<ctrl.minSwipeDistance)&&("vertical"==ctrl.direction?abs>ctrl.element.clientHeight/ctrl.thresholdFactor:abs>ctrl.element.clientWidth/ctrl.thresholdFactor)},_toSize:function(x){return 0!==x?x+"px":"0px"},_cancelMove:function(){var ctrl=this,target=this.target,x=0,y=0;this.ptDown&&(x=this.ptDown.transformOffsetX,y=this.ptDown.transformOffsetY),this.setMoveIntent&&cancelAnimationFrame(this.setMoveIntent),debugLog("swipe slide, cancel move "+x+"/"+y),target&&(target.style.transition="transform 120ms ease-out",target.style.hasOwnProperty("webkitTransition")&&(target.style.webkitTransition="transform 90ms ease-out"),setImmediate(function(){target.style.transform="translate3d("+ctrl._toSize(x)+", "+ctrl._toSize(y)+", 0px)",target.style.hasOwnProperty("webkitTransform")&&(target.style.webkitTransform="translate3d("+ctrl._toSize(x)+", "+ctrl._toSize(y)+", 0px)"),setTimeout(function(){target.style.transition="",target.style.hasOwnProperty("webkitTransition")&&(target.style.webkitTransition="")},100)}))},_processMove:function(event){var ctrl=this;if(!this.disabled)if(!this.ptDown&&event.changedTouches&&this._initPtDown(event),this.ptDown){var enableSwipe=!0;if(event.pointerId&&this.touchOnly&&"touch"!=event.pointerType&&(enableSwipe=!1),!enableSwipe)return;if(event.changedTouches)var dX=this.ptDown.x-event.changedTouches[0].screenX,dY=this.ptDown.y-event.changedTouches[0].screenY;else var dX=this.ptDown.x-event.screenX,dY=this.ptDown.y-event.screenY;var adX=Math.abs(dX),adY=Math.abs(dY);this.ptDown.maxDX=Math.max(this.ptDown.maxDX,adX),this.ptDown.maxDY=Math.max(this.ptDown.maxDY,adY),"vertical"==ctrl.direction?adY>5&&adY>adX&&(event.preventDefault(),event.stopPropagation()):adX>5&&adX>adY&&(event.preventDefault(),event.stopPropagation());var moveval=0;if(moveval="vertical"==ctrl.direction?this.ptDown.transformOffsetY+(-dY-this.threshold)/(window.devicePixelRatio*this.moveDivider):this.ptDown.transformOffsetX+(-dX-this.threshold)/(window.devicePixelRatio*this.moveDivider),!this.ptDown.confirmed)if("vertical"==ctrl.direction){if(adX>this.threshold)return void(this.ptDown=null);if(adY>this.threshold){this.ptDown.confirmed=!0,this.swipeHandled=!1,debugLog("start swipe");var arg={dX:dX,dY:dY,move:-dY-ctrl.threshold,screenMove:ctrl.ptDown.screenMove,direction:dY>0?"top":"bottom",handled:!1};this.dispatchEvent("swipestart",arg);event.currentTarget||event.target;event.pointerId&&this.element.setPointerCapture&&this.element.setPointerCapture(event.pointerId)}}else{if(adY>this.threshold)return void(this.ptDown=null);if(adX>this.threshold){this.ptDown.confirmed=!0,this.swipeHandled=!1,debugLog("start swipe");var arg={dX:dX,dY:dY,move:-dX-ctrl.threshold,screenMove:ctrl.ptDown.screenMove,direction:dX>0?"left":"right",handled:!1};this.dispatchEvent("swipestart",arg);event.currentTarget||event.target;event.pointerId&&this.element.setPointerCapture&&this.element.setPointerCapture(event.pointerId)}}if(this.ptDown.confirmed){if("vertical"==ctrl.direction){debugLog("swipe move "+dY+" / "+moveval);var screenMove=this.setMove(moveval,-dY),arg={screenMove:screenMove,move:-dY-this.threshold,direction:dY>0?"top":"bottom",accept:ctrl._acceptSwipe(moveval),dX:dX,dY:dY}}else{debugLog("swipe move "+dX+" / "+moveval);var screenMove=this.setMove(moveval,-dX),arg={screenMove:screenMove,move:-dX-this.threshold,direction:dX>0?"left":"right",accept:ctrl._acceptSwipe(moveval),dX:dX,dY:dY}}this.dispatchEvent("swipeprogress",arg)}}else debugLog("swipe move")},setMove:function(move,dX){var ctrl=this;if("vertical"==ctrl.direction){var elementRef=this.element.clientHeight;dX>0&&!this.allowed.bottom?(move=Math.sqrt(move),move>elementRef/6&&(move=elementRef/6)):dX<0&&!this.allowed.top&&(move=-Math.sqrt(-move),move<-(elementRef/6)&&(move=-(elementRef/6)))}else{var elementRef=this.element.clientWidth;dX>0&&!this.allowed.right?(move=Math.sqrt(move),move>elementRef/6&&(move=elementRef/6)):dX<0&&!this.allowed.left&&(move=-Math.sqrt(-move),move<-(elementRef/6)&&(move=-(elementRef/6)))}return this.minMoveBounds&&move<this.minMoveBounds&&(move=this.minMoveBounds),this.maxMoveBounds&&move>this.maxMoveBounds&&(move=this.maxMoveBounds),this.setMoveIntent&&cancelAnimationFrame(this.setMoveIntent),ctrl.ptDown&&(ctrl.ptDown.screenMove=move),this.setMoveIntent=requestAnimationFrame(function(){this.setMoveIntent=null,debugLog("transform to "+move);var translation="translate3d("+ctrl._toSize(move)+", 0px, 0px)";"vertical"==ctrl.direction&&(translation="translate3d(0px, "+ctrl._toSize(move)+", 0px)"),void 0!==ctrl.target.style.webkitTransform?ctrl.target.style.webkitTransform=translation:ctrl.target.style.transform=translation}),move},dispose:function(){this.eventTracker.dispose();try{WinJS.Utilities.disposeSubTree(this.element)}catch(exception){}}}),WinJS.UI.DOMEventMixin,WinJS.Utilities.createEventProperties("swipe","swipeprogress","swipestart"))})}();
!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{VisualState:WinJS.Class.mix(WinJS.Class.define(function(element,options){this.element=element||document.createElement("DIV"),options=options||{},this.cssprefix="state",this.isDirty=!1,this.element.winControl=this,this.element.style.display="none",this.element.classList.add("mcn-visualstate"),this.element.classList.add("mcn-layout-ctrl"),this.element.classList.add("win-disposable"),WinJS.UI.setOptions(this,options)},{states:{get:function(){return this._states},set:function(val){this._states=val}},target:{get:function(){return this._target},set:function(val){this._target=val}},checkAllStates:function(name,state){var ctrl=this;if(ctrl.states){for(var n in ctrl.states)ctrl.checkState(n,ctrl.states[n]);ctrl.isDirty&&(ctrl.isDirty=!1,ctrl.dispatchEvent("statechanged",{sender:this}))}},checkState:function(name,state){var ctrl=this;if(ctrl.element){var target=ctrl.target||ctrl.element.parentElement,targetW=target.clientWidth,targetH=target.clientHeight,evaluate=!0;state.wGt&&(evaluate=evaluate&&targetW>state.wGt),state.wGtE&&(evaluate=evaluate&&targetW>=state.wGtE),state.wLt&&(evaluate=evaluate&&targetW<state.wLt),state.wLtE&&(evaluate=evaluate&&targetW<=state.wLtE),state.hGt&&(evaluate=evaluate&&targetH>state.hGt),state.hGtE&&(evaluate=evaluate&&targetH>=state.hGtE),state.hLt&&(evaluate=evaluate&&targetH<state.hLt),state.hLtE&&(evaluate=evaluate&&targetH<=state.hLtE),evaluate?state.active||(state.active=!0,ctrl.isDirty=!0,target.classList.add(ctrl.cssprefix+"-"+name)):state.active&&(state.active=!1,ctrl.isDirty=!0,target.classList.remove(ctrl.cssprefix+"-"+name))}},isInState:function(statename){var state=this.states[statename];return!(!state||!state.active)},pageLayout:function(){var ctrl=this;ctrl.checkAllStates()},updateLayout:function(){var ctrl=this;ctrl.checkAllStates()},dispose:function(){WinJS.Utilities.disposeSubTree(this.element),this.element=null}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("statechanged"))})}();
var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},WinJSContrib;!function(WinJSContrib){var UI;!function(UI){var DatePickerControl=function(){function DatePickerControl(element,options){var _this=this;this.element=element||document.createElement("DIV"),options=options||{},this.element.winControl=this,this.element.classList.add("mcn-datepicker"),this.element.classList.add("win-disposable"),this.flyout=new WinJS.UI.Flyout,this.flyout.element.classList.add("mcn-datepicker-flyout"),this.element.appendChild(this.flyout.element),this.flyout.onbeforeshow=function(){setImmediate(function(){_this.calendar.focusSelected()})},this.flyout.onaftershow=function(){WinJS.UI&&WinJS.UI._LightDismissService&&WinJS.UI._LightDismissService._service&&WinJS.UI._LightDismissService._service._clickEaterEl&&WinJS.UI._LightDismissService._service._clickEaterEl.style&&WinJS.UI._LightDismissService._service._clickEaterEl.style.zIndex<1006&&(WinJS.UI._LightDismissService._service._clickEaterEl.style.zIndex="1006")},options.hasOwnProperty("deferRendering")||(options.deferRendering=!0);var elt=document.createElement("DIV");this.flyout.element.appendChild(elt);var calendaroptions=JSON.parse(JSON.stringify(options));calendaroptions.flyout=this.flyout,this.calendar=new WinJSContrib.UI.Calendar(elt,calendaroptions),this.calendar.onchange=function(){_this.value=_this.calendar.value,_this.dispatchEvent("change")},this.textElement=document.createElement("DIV"),this.textElement.className="mcn-datepicker-text tap",this.element.appendChild(this.textElement),this.textElement.tabIndex=0,this.textElement.setAttribute("role","button"),this.textElement.onclick=function(arg){arg.preventDefault(),arg.stopPropagation(),window.innerWidth<500?_this.flyout.show(document.body,"top","left"):_this.flyout.show(_this.textElement)},WinJS.UI.setOptions(this,options),this.value||(this.value=new Date)}return Object.defineProperty(DatePickerControl.prototype,"value",{get:function(){return this._value},set:function(val){this._value=val,this.calendar.value=val,this.textElement.innerText=moment(val).format("ll"),this.flyout.hide()},enumerable:!0,configurable:!0}),DatePickerControl.prototype.dispose=function(){WinJS.Utilities.disposeSubTree(this.element)},DatePickerControl.prototype.dispatchEvent=function(type,data){},DatePickerControl.prototype.addEventListener=function(type,callback){},DatePickerControl}();UI.DatePickerControl=DatePickerControl,UI.DatePicker=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(DatePickerControl),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var CalendarControl=function(){function CalendarControl(element,options){var _this=this;if(this.element=element||document.createElement("DIV"),options=options||{},this._startDayOfWeek=1,this.eventTracker=new WinJSContrib.UI.EventTracker,this.element.winControl=this,this.element.classList.add("mcn-calendar"),this.element.classList.add("win-disposable"),this.onmousewheelPromise=WinJS.Promise.wrap(),WinJS.UI.setOptions(this,options),this.flyout&&(this.element.classList.add("win-xyfocus-suspended"),this.eventTracker.addEvent(this.element,"keydown",this.onkeydown.bind(this),!0)),this._ready=!1,options.deferRendering){var control=WinJSContrib.Utils.getScopeControl(this.element);control?control.readyComplete&&control.readyComplete.then(function(){return WinJS.Promise.timeout(200)}).then(function(){WinJS.Utilities.Scheduler.schedule(function(){_this.render()},WinJS.Utilities.Scheduler.Priority.idle)}):setTimeout(function(){WinJS.Utilities.Scheduler.schedule(function(){_this.render()},WinJS.Utilities.Scheduler.Priority.idle)},2e3)}else this.render()}return Object.defineProperty(CalendarControl.prototype,"value",{get:function(){return this._value},set:function(val){"string"==typeof val&&(val=moment(val).toDate()),this._value=val,this._currentPanel&&(this._currentPanel._currentDate=new Date(val.getFullYear(),val.getMonth(),1),this._currentPanel.ensureValue())},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarControl.prototype,"startDayOfWeek",{get:function(){return this._startDayOfWeek},set:function(val){this._startDayOfWeek=val},enumerable:!0,configurable:!0}),CalendarControl.prototype.focusSelected=function(){var selected=this.element.querySelector(".day-item.selected");selected&&selected.focus()},CalendarControl.prototype.getFocusedDay=function(){var focused=this.element.querySelector("*:focus");if(focused.classList.contains("day-item")){var date=focused.mcnCalendarDay;return date}},CalendarControl.prototype.onkeydown=function(arg){if("PageDown"==arg.key)this._currentPanel.next(!0),arg.preventDefault(),arg.stopPropagation();else if("PageUp"==arg.key)this._currentPanel.previous(!0),arg.preventDefault(),arg.stopPropagation();else if("Down"==arg.key){var nextelt=WinJS.UI.XYFocus.findNextFocusElement("down",{focusRoot:this.element});nextelt?nextelt.focus():this._currentPanel.next(!0),arg.preventDefault(),arg.stopPropagation()}else if("Up"==arg.key){var nextelt=WinJS.UI.XYFocus.findNextFocusElement("up",{focusRoot:this.element});nextelt?nextelt.focus():this._currentPanel.previous(!0),arg.preventDefault(),arg.stopPropagation()}else if("Left"==arg.key){var nextelt=WinJS.UI.XYFocus.findNextFocusElement("left",{focusRoot:this.element});nextelt&&nextelt.focus(),arg.preventDefault(),arg.stopPropagation()}else if("Right"==arg.key){var nextelt=WinJS.UI.XYFocus.findNextFocusElement("right",{focusRoot:this.element});nextelt&&nextelt.focus(),arg.preventDefault(),arg.stopPropagation()}},CalendarControl.prototype.render=function(){var _this=this;if(!this._ready){this._ready=!0,this.wrapper=document.createElement("DIV"),this.wrapper.className="mcn-calendar-wrapper",this.element.appendChild(this.wrapper),this.panelsContainer=document.createElement("DIV"),this.panelsContainer.className="mcn-calendar-panels",this.wrapper.appendChild(this.panelsContainer),this.navbuttons=document.createElement("DIV"),this.navbuttons.className="navbuttons",this.wrapper.appendChild(this.navbuttons),this.navbuttonPrevious=document.createElement("BUTTON"),this.navbuttonPrevious.className="navbutton navbutton-previous",this.navbuttons.appendChild(this.navbuttonPrevious),WinJSContrib.UI.tap(this.navbuttonPrevious,function(){_this._currentPanel&&_this._currentPanel.previous()}),this.navbuttonNext=document.createElement("BUTTON"),this.navbuttonNext.className="navbutton navbutton-next",this.navbuttons.appendChild(this.navbuttonNext),WinJSContrib.UI.tap(this.navbuttonNext,function(){_this._currentPanel&&_this._currentPanel.next()});var dateToRender=this.value;dateToRender||(dateToRender=this.mindate?moment(this.mindate).toDate():new Date),this._daysPanel=new CalendarDayPanelControl(this,dateToRender),this._currentPanel=this._daysPanel,this._currentPanel.currentChanged=function(){_this.checkState()},this.checkState(),this.element.onmousewheel=function(arg){arg.preventDefault(),arg.stopPropagation(),_this.onmousewheelPromise._state&&"success"!==_this.onmousewheelPromise._state.name||_this.onmousewheelPromise.then(function(){arg.wheelDelta<0?_this._currentPanel.allowNext()&&_this._currentPanel.next():_this._currentPanel.allowPrevious()&&_this._currentPanel.previous(),_this.onmousewheelPromise=WinJS.Promise.timeout(160)})},this._currentPanel.setNavButtonsLabels()}},CalendarControl.prototype.checkState=function(){this._currentPanel.allowNext()?this.navbuttonNext.disabled=!1:this.navbuttonNext.disabled=!0,this._currentPanel.allowPrevious()?this.navbuttonPrevious.disabled=!1:this.navbuttonPrevious.disabled=!0},CalendarControl.prototype.dispatchEvent=function(type,data){},CalendarControl.prototype.addEventListener=function(type,callback){},CalendarControl.prototype.switchToYear=function(){this._currentPanel!=this._yearPanel&&this._currentPanel.hide(),this._yearPanel?(this._yearPanel._currentDate=this._currentPanel._currentDate,this._yearPanel.ensureValue(!0)):this._yearPanel=new CalendarYearPanelControl(this,this._currentPanel._currentDate),this._yearPanel.show(),this._currentPanel=this._yearPanel,this.checkState(),this._currentPanel.setNavButtonsLabels()},CalendarControl.prototype.switchToMonth=function(){this._currentPanel!=this._monthsPanel&&this._currentPanel.hide(),this._monthsPanel?(this._monthsPanel._currentDate=this._currentPanel._currentDate,this._monthsPanel.ensureValue(!0)):this._monthsPanel=new CalendarMonthPanelControl(this,this._currentPanel._currentDate),this._monthsPanel.show(),this._currentPanel=this._monthsPanel,this.checkState(),this._currentPanel.setNavButtonsLabels()},CalendarControl.prototype.switchToDays=function(){this._currentPanel!=this._daysPanel&&this._currentPanel.hide(),this._daysPanel._currentDate=this._currentPanel._currentDate,this._daysPanel.ensureValue(!0),this._daysPanel.show(),this._currentPanel=this._daysPanel,this.checkState(),this._currentPanel.setNavButtonsLabels()},CalendarControl.prototype.dispose=function(){this.eventTracker.dispose(),WinJS.Utilities.disposeSubTree(this.element)},CalendarControl}();UI.CalendarControl=CalendarControl,UI.Calendar=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(CalendarControl),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var CalendarPanelControl=function(){function CalendarPanelControl(parent,currentDate){this.parent=parent,this.element=document.createElement("DIV"),this.element.className="calendar-panel",this.element.tabIndex=-1,this.parent.panelsContainer.appendChild(this.element),this._currentDate=new Date(currentDate.getFullYear(),currentDate.getMonth(),1)}return CalendarPanelControl.prototype.next=function(focusItem){},CalendarPanelControl.prototype.previous=function(focusItem){},CalendarPanelControl.prototype.allowNext=function(){return!1},CalendarPanelControl.prototype.allowPrevious=function(){return!1},CalendarPanelControl.prototype.ensureValue=function(immediate,focusItem){},CalendarPanelControl.prototype.hide=function(){var _this=this;return WinJS.UI.Animation.drillInOutgoing(this.element).then(function(){_this.element.classList.add("disabled")})},CalendarPanelControl.prototype.show=function(){return this.element.classList.remove("disabled"),WinJS.UI.Animation.drillInIncoming(this.element)},CalendarPanelControl.prototype.setNavButtonsLabels=function(){},CalendarPanelControl}();UI.CalendarPanelControl=CalendarPanelControl;var CalendarDayPanelControl=function(_super){function CalendarDayPanelControl(parent,currentDate){_super.call(this,parent,currentDate),this.element.classList.add("day-panel"),this.elementContent=document.createElement("DIV"),this.elementContent.className="calendar-panel-content",this.element.appendChild(this.elementContent),this._currentItem=new CalendarDayPanelContentControl(this,this.currentDate)}return __extends(CalendarDayPanelControl,_super),Object.defineProperty(CalendarDayPanelControl.prototype,"currentDate",{get:function(){return this._currentDate},enumerable:!0,configurable:!0}),CalendarDayPanelControl.prototype.setNavButtonsLabels=function(){var arianext=WinJS.Resources.getString("mcncalendar.nextmonth.arialabel"),ariaprevious=WinJS.Resources.getString("mcncalendar.previousmonth.arialabel");arianext.empty||ariaprevious.empty||(this.parent.navbuttonNext.setAttribute("aria-label",arianext.value),this.parent.navbuttonPrevious.setAttribute("aria-label",ariaprevious.value))},CalendarDayPanelControl.prototype.ensureValue=function(immediate,focusItem){if(0!=moment(this.currentDate).diff(this._currentItem.currentDate))this.update(focusItem,function(elt){return WinJS.UI.Animation.drillInIncoming(elt)},function(elt){return WinJS.UI.Animation.drillInOutgoing(elt)},immediate);else{$(".selected",this.element).removeClass("selected");var selectedid="day-"+moment(this.parent.value).format("YYYY-MM-DD");$("#"+selectedid,this.element).addClass("selected")}},CalendarDayPanelControl.prototype.update=function(focusItem,animIn,animOut,immediate){this._currentItem.currentDate=moment(this._currentDate),this._currentItem.generateDays(focusItem,animIn,animOut,immediate),this.parent.checkState()},CalendarDayPanelControl.prototype.next=function(focusItem){this.allowNext()&&(this._currentDate=moment(this._currentDate).add(1,"M").toDate(),this.update(focusItem,function(elt){return WinJSContrib.UI.Animation.slideFromBottom(elt,{duration:160})},function(elt){return WinJSContrib.UI.Animation.slideToTop(elt,{duration:160})}))},CalendarDayPanelControl.prototype.previous=function(focusItem){this.allowPrevious()&&(this._currentDate=moment(this._currentDate).add(-1,"M").toDate(),this._currentItem.currentDate=moment(this._currentDate),this.update(focusItem,function(elt){return WinJSContrib.UI.Animation.slideFromTop(elt,{duration:160})},function(elt){return WinJSContrib.UI.Animation.slideToBottom(elt,{duration:160})}))},CalendarDayPanelControl.prototype.allowNext=function(){if(!this.parent.maxdate)return!0;var lastDay=moment(this._currentDate).add(1,"M").add(-1,"d").toDate();return lastDay<moment(this.parent.maxdate).toDate()},CalendarDayPanelControl.prototype.allowPrevious=function(){return!this.parent.mindate||this._currentDate>moment(this.parent.mindate).toDate()},CalendarDayPanelControl}(CalendarPanelControl);UI.CalendarDayPanelControl=CalendarDayPanelControl;var CalendarDayPanelContentControl=function(){function CalendarDayPanelContentControl(parent,currentDate){this.parent=parent,this.currentDate=moment(new Date(currentDate.getFullYear(),currentDate.getMonth(),1)),this.element=document.createElement("DIV"),this.element.className="calendar-panel-item day-panel-item",this.element.id="month"+this.currentDate.toDate().toISOString(),this.parent.elementContent.appendChild(this.element),this.renderContent()}return CalendarDayPanelContentControl.prototype.enter=function(anim){return(anim=anim||WinJS.UI.Animation.drillOutIncoming)(this.element)},CalendarDayPanelContentControl.prototype.renderContent=function(){var _this=this,startdate=this.currentDate.clone().day(this.parent.parent.startDayOfWeek);this.element.innerHTML='<header role="button" tabIndex="0" data-win-focus=\'{ bottom: ".dayitem.tap" }\'>\n\t\t\t\t\t<div class="month">'+this.currentDate.format("MMMM")+'</div>\n\t\t\t\t\t<div class="year">'+this.currentDate.format("YYYY")+'</div>\n\t\t\t\t</header>\n\t\t\t\t<section class="day-items">\n\t\t\t\t\t<header>\n\t\t\t\t\t</header>\n\t\t\t\t\t<section>\n\t\t\t\t\t</section>\n\t\t\t\t</section>',this.monthTxt=this.element.querySelector(".month"),this.yearTxt=this.element.querySelector(".year");var panelheader=this.element.querySelector("header"),arialabel=WinJS.Resources.getString("mcncalendar.daystitle.arialabel");arialabel.empty||panelheader.setAttribute("aria-label",arialabel.value),WinJSContrib.UI.tap(panelheader,function(){_this.parent.parent.switchToMonth()}),this.header=this.element.querySelector(".day-items > header");for(var headerdate=startdate.clone(),i=0;i<7;i++){var head=document.createElement("DIV");head.className="day-item day-header",head.innerText=headerdate.format("ddd");var dow=headerdate.day();0!=dow&&6!=dow||head.classList.add("weekend"),this._lastdow=headerdate.day(),headerdate.add(1,"d"),this.header.appendChild(head)}this.content=this.element.querySelector(".day-items > section"),this.days=this.renderDaysWrapper(this.content)},CalendarDayPanelContentControl.prototype.destroyPanel=function(dayspanel){WinJS.Utilities.disposeSubTree(dayspanel),dayspanel.winControl.dispose(),dayspanel.parentElement.removeChild(dayspanel)},CalendarDayPanelContentControl.prototype.generateDays=function(focusItem,animIn,animOut,immediate){var _this=this;if(this.days){var currentDays=this.days;immediate?this.destroyPanel(currentDays):animOut(currentDays).then(function(){_this.destroyPanel(currentDays)})}this.selected=null,this.days=this.renderDaysWrapper(this.content);var handleFocus=function(){if(focusItem){var selected=_this.content.querySelector(".day-item.selected:not(:disabled)");selected||(selected=_this.content.querySelector(".day-item.thismonth:not(:disabled)")),selected&&selected.focus()}};immediate?(this.monthTxt.innerText=this.currentDate.format("MMMM"),this.yearTxt.innerText=this.currentDate.format("YYYY"),handleFocus()):animIn(this.days).then(function(){_this.monthTxt.innerText=_this.currentDate.format("MMMM"),_this.yearTxt.innerText=_this.currentDate.format("YYYY"),handleFocus()})},CalendarDayPanelContentControl.prototype.renderDaysWrapper=function(container){var _this=this,itemsWrapper=document.createElement("DIV");itemsWrapper.className="day-items-wrapper";var swipe=new WinJSContrib.UI.SwipeSlide(itemsWrapper,{direction:"vertical",allowed:{top:this.parent.allowNext(),bottom:this.parent.allowPrevious()}});return swipe.onswipe=function(arg){swipe.swipeHandled=!0,"top"==arg.direction?_this.parent.next(!0):"bottom"==arg.direction&&_this.parent.previous(!0)},this.renderDays(itemsWrapper),container.appendChild(itemsWrapper),itemsWrapper},CalendarDayPanelContentControl.prototype.renderDays=function(container){var _this=this,startdate=this.currentDate.clone().day(this.parent.parent.startDayOfWeek),currentMonth=this.currentDate.month(),currentvalue=this.parent.parent.value,currentValueDate=moment(currentvalue).hour(0).minute(0).second(0).millisecond(0),minDate=(moment(this.parent.parent.value).hour(0).minute(0).second(0).millisecond(0),null),today=moment().hour(0).minute(0).second(0).millisecond(0);this.parent.parent.mindate&&(minDate=moment(this.parent.parent.mindate).hour(0).minute(0).second(0).millisecond(0));var maxDate=null;this.parent.parent.maxdate&&(maxDate=moment(this.parent.parent.maxdate).hour(0).minute(0).second(0).millisecond(0));var contentdate=startdate.clone(),lastday=this.currentDate.clone().add(1,"M").add(-1,"d");lastday.day()!=this._lastdow&&lastday.day(this._lastdow+7);for(;contentdate<=lastday;){var day=document.createElement("BUTTON");day.className="day-item tap",day.id="day-"+contentdate.format("YYYY-MM-DD"),day.innerText=contentdate.format("DD"),day.setAttribute("aria-label",contentdate.format("L")),0==contentdate.diff(today)&&day.classList.add("today"),currentvalue&&0==contentdate.diff(currentValueDate)&&(day.classList.add("selected"),this.selected=day);var dow=contentdate.day();0!=dow&&6!=dow||day.classList.add("weekend"),contentdate.month()!=currentMonth?day.classList.add("notthismonth"):day.classList.add("thismonth"),minDate&&contentdate<minDate&&(day.disabled=!0),maxDate&&contentdate>maxDate&&(day.disabled=!0),day.mcnCalendarDay=contentdate.clone(),day.onclick=function(arg){var date=arg.target.mcnCalendarDay;arg.target.classList.add("selected"),_this.selected&&_this.selected.classList.remove("selected"),_this.selected=arg.target,_this.parent.parent.value=date.toDate(),_this.parent.parent.dispatchEvent("change")},contentdate.add(1,"d"),container.appendChild(day)}},CalendarDayPanelContentControl.prototype.remove=function(anim){var _this=this;return anim=anim||WinJS.UI.Animation.drillOutOutgoing,this.element?anim(this.element).then(function(){WinJSContrib.UI.untapAll(_this.element),_this.element.parentElement.removeChild(_this.element),_this.element=null}):WinJS.Promise.wrap()},CalendarDayPanelContentControl}();UI.CalendarDayPanelContentControl=CalendarDayPanelContentControl;var CalendarMonthPanelControl=function(_super){function CalendarMonthPanelControl(parent,currentDate){_super.call(this,parent,currentDate),this.element.classList.add("month-panel"),this.renderContent()}return __extends(CalendarMonthPanelControl,_super),CalendarMonthPanelControl.prototype.setNavButtonsLabels=function(){var arianext=WinJS.Resources.getString("mcncalendar.nextyear.arialabel"),ariaprevious=WinJS.Resources.getString("mcncalendar.previousyear.arialabel");arianext.empty||ariaprevious.empty||(this.parent.navbuttonNext.setAttribute("aria-label",arianext.value),this.parent.navbuttonPrevious.setAttribute("aria-label",ariaprevious.value))},CalendarMonthPanelControl.prototype.next=function(focusItem){this.allowNext()&&(this._currentDate=moment(this._currentDate).add(1,"Y").toDate(),this.update(focusItem,function(elt){return WinJSContrib.UI.Animation.slideFromBottom(elt,{duration:160})},function(elt){return WinJSContrib.UI.Animation.slideToTop(elt,{duration:160})}))},CalendarMonthPanelControl.prototype.previous=function(focusItem){this.allowPrevious()&&(this._currentDate=moment(this._currentDate).add(-1,"Y").toDate(),this.update(focusItem,function(elt){return WinJSContrib.UI.Animation.slideFromTop(elt,{duration:160})},function(elt){return WinJSContrib.UI.Animation.slideToBottom(elt,{duration:160})}))},CalendarMonthPanelControl.prototype.allowNext=function(){var lastday=new Date(this._currentDate.getFullYear(),11,31);return!this.parent.maxdate||lastday<moment(this.parent.maxdate).toDate()},CalendarMonthPanelControl.prototype.allowPrevious=function(){var firstday=new Date(this._currentDate.getFullYear(),0,1);return!this.parent.mindate||firstday>moment(this.parent.mindate).month(0).date(1).toDate()},CalendarMonthPanelControl.prototype.ensureValue=function(immediate,focusItem){0!=moment(this._currentDate).diff(moment(this.renderedDate))&&this.update(focusItem,function(elt){return WinJS.UI.Animation.drillInIncoming(elt)},function(elt){return WinJS.UI.Animation.drillInOutgoing(elt)},immediate)},CalendarMonthPanelControl.prototype.update=function(focusItem,animIn,animOut,immediate){var _this=this,previouspanel=this.monthesPanel;immediate?previouspanel.parentElement.removeChild(previouspanel):animOut(this.monthesPanel).then(function(){previouspanel.parentElement.removeChild(previouspanel)}),this.monthesPanel=this.renderMonthPanel(this.content);var handleFocus=function(){if(focusItem){var selected=_this.content.querySelector(".month-item.selected:not(:disabled)");selected||(selected=_this.content.querySelector(".month-item:not(:disabled)")),selected&&selected.focus()}};immediate?(this.yearTxt.innerText=""+this._currentDate.getFullYear(),handleFocus()):animIn(this.monthesPanel).then(function(){_this.yearTxt.innerText=""+_this._currentDate.getFullYear(),handleFocus()}),this.parent.checkState()},CalendarMonthPanelControl.prototype.renderContent=function(){var _this=this;this.element.innerHTML='<header>\n\t\t\t\t\t<div class="year">'+this._currentDate.getFullYear()+'</div>\n\t\t\t\t</header>\n\t\t\t\t<section class="month-items">\n\t\t\t\t\t\n\t\t\t\t</section>',this.yearTxt=this.element.querySelector(".year"),this.content=this.element.querySelector(".month-items"),this.monthesPanel=this.renderMonthPanel(this.content),WinJSContrib.UI.tap(this.element.querySelector("header"),function(){_this.parent.switchToYear()})},CalendarMonthPanelControl.prototype.renderMonthPanel=function(container){var _this=this,panel=document.createElement("DIV");panel.className="month-itemspanel";var swipe=new WinJSContrib.UI.SwipeSlide(panel,{direction:"vertical",allowed:{top:this.allowNext(),bottom:this.allowPrevious()}});swipe.onswipe=function(arg){swipe.swipeHandled=!0,"top"==arg.direction?_this.next():"bottom"==arg.direction&&_this.previous()};var start=moment(new Date(this._currentDate.getFullYear(),0,1)),now=moment().hour(0).minute(0).second(0).millisecond(0),thismonth=now.clone().date(1),minDate=null;this.parent.mindate&&(minDate=moment(this.parent.mindate).date(1).hour(0).minute(0).second(0).millisecond(0));var maxDate=null;this.parent.maxdate&&(maxDate=moment(this.parent.maxdate).date(1).hour(0).minute(0).second(0).millisecond(0));for(var i=0;i<12;i++){var month=document.createElement("BUTTON");month.className="month-item tap";var currentMonthDate=start.clone();month.mcnMonthDate=currentMonthDate,month.innerText=currentMonthDate.format("MMM"),month.setAttribute("aria-label",currentMonthDate.format("MMMM YYYY")),0==currentMonthDate.diff(thismonth)?month.classList.add("today"):start<now&&month.classList.add("pastmonth"),minDate&&start<minDate&&(month.disabled=!0),maxDate&&start>maxDate&&(month.disabled=!0),month.onclick=function(arg){var elt=arg.target,date=elt.mcnMonthDate;_this._currentDate=date.toDate(),_this.parent.switchToDays()},panel.appendChild(month),start.add(1,"M")}return container.appendChild(panel),this.renderedDate=this._currentDate,panel},CalendarMonthPanelControl}(CalendarPanelControl);UI.CalendarMonthPanelControl=CalendarMonthPanelControl;var CalendarYearPanelControl=function(_super){function CalendarYearPanelControl(parent,currentDate){_super.call(this,parent,currentDate),this.element.classList.add("month-panel"),this.renderContent()}return __extends(CalendarYearPanelControl,_super),CalendarYearPanelControl.prototype.setNavButtonsLabels=function(){var arianext=WinJS.Resources.getString("mcncalendar.nextyears.arialabel"),ariaprevious=WinJS.Resources.getString("mcncalendar.previousyears.arialabel");arianext.empty||ariaprevious.empty||(this.parent.navbuttonNext.setAttribute("aria-label",arianext.value),this.parent.navbuttonPrevious.setAttribute("aria-label",ariaprevious.value))},CalendarYearPanelControl.prototype.next=function(focusItem){this.allowNext()&&(this._currentDate=moment(this._currentDate).add(12,"Y").toDate(),this.update(focusItem,function(elt){return WinJSContrib.UI.Animation.slideFromBottom(elt,{duration:160})},function(elt){return WinJSContrib.UI.Animation.slideToTop(elt,{duration:160})}))},CalendarYearPanelControl.prototype.previous=function(focusItem){this.allowPrevious()&&(this._currentDate=moment(this._currentDate).add(-12,"Y").toDate(),this.update(focusItem,function(elt){return WinJSContrib.UI.Animation.slideFromTop(elt,{duration:160})},function(elt){return WinJSContrib.UI.Animation.slideToBottom(elt,{duration:160})}))},CalendarYearPanelControl.prototype.allowNext=function(){var lastday=new Date(this._currentDate.getFullYear(),11,31);return!this.parent.maxdate||lastday<moment(this.parent.maxdate).toDate()},CalendarYearPanelControl.prototype.allowPrevious=function(){var firstday=new Date(this._currentDate.getFullYear(),0,1);return!this.parent.mindate||firstday>moment(this.parent.mindate).month(0).date(1).toDate()},CalendarYearPanelControl.prototype.ensureValue=function(immediate,focusItem){0!=moment(this._currentDate).diff(moment(this.renderedDate))&&this.update(focusItem,function(elt){return WinJS.UI.Animation.drillInIncoming(elt)},function(elt){return WinJS.UI.Animation.drillInOutgoing(elt)},immediate)},CalendarYearPanelControl.prototype.update=function(focusItem,animIn,animOut,immediate){var _this=this,previouspanel=this.yearsPanel;immediate?previouspanel.parentElement.removeChild(previouspanel):animOut(this.yearsPanel).then(function(){previouspanel.parentElement.removeChild(previouspanel)}),this.yearsPanel=this.renderYearPanel(this.content);var handleFocus=function(){if(focusItem){var selected=_this.content.querySelector(".month-item.selected:not(:disabled)");selected||(selected=_this.content.querySelector(".month-item:not(:disabled)")),selected&&selected.focus()}};immediate?(this.yearTxt.innerText=""+this._currentDate.getFullYear()+" - "+moment(this._currentDate).add("Y",11).toDate().getFullYear(),handleFocus()):animIn(this.yearsPanel).then(function(){_this.yearTxt.innerText=""+_this._currentDate.getFullYear()+" - "+moment(_this._currentDate).add("Y",11).toDate().getFullYear(),handleFocus()}),this.parent.checkState()},CalendarYearPanelControl.prototype.renderContent=function(){this.element.innerHTML='<header>\n\t\t\t\t\t<div class="year">'+this._currentDate.getFullYear()+" - "+moment(this._currentDate).add("Y",11).toDate().getFullYear()+'</div>\n\t\t\t\t</header>\n\t\t\t\t<section class="month-items">\n\t\t\t\t\t\n\t\t\t\t</section>',this.yearTxt=this.element.querySelector(".year"),this.content=this.element.querySelector(".month-items"),this.yearsPanel=this.renderYearPanel(this.content)},CalendarYearPanelControl.prototype.renderYearPanel=function(container){var _this=this,panel=document.createElement("DIV");panel.className="month-itemspanel";var swipe=new WinJSContrib.UI.SwipeSlide(panel,{direction:"vertical",allowed:{top:this.allowNext(),bottom:this.allowPrevious()}});swipe.onswipe=function(arg){swipe.swipeHandled=!0,"top"==arg.direction?_this.next():"bottom"==arg.direction&&_this.previous()};var start=moment(new Date(this._currentDate.getFullYear(),0,1)),now=moment().hour(0).minute(0).second(0).millisecond(0),thismonth=now.clone().date(1),minDate=null;this.parent.mindate&&(minDate=moment(this.parent.mindate).date(1).hour(0).minute(0).second(0).millisecond(0));var maxDate=null;this.parent.maxdate&&(maxDate=moment(this.parent.maxdate).date(1).hour(0).minute(0).second(0).millisecond(0));for(var i=0;i<12;i++){var year=document.createElement("BUTTON");year.className="month-item tap";var currentMonthDate=start.clone();year.mcnMonthDate=currentMonthDate,year.innerText=currentMonthDate.format("YYYY"),year.setAttribute("aria-label",currentMonthDate.format("YYYY")),0==currentMonthDate.diff(thismonth)?year.classList.add("today"):start<now&&year.classList.add("pastmonth"),minDate&&start<minDate&&(year.disabled=!0),maxDate&&start>maxDate&&(year.disabled=!0),year.onclick=function(arg){var elt=arg.target,date=elt.mcnMonthDate;_this._currentDate=date.toDate(),_this.parent.switchToMonth()},panel.appendChild(year),start.add(1,"Y")}return container.appendChild(panel),this.renderedDate=this._currentDate,panel},CalendarYearPanelControl}(CalendarPanelControl);UI.CalendarYearPanelControl=CalendarYearPanelControl}(UI=WinJSContrib.UI||(WinJSContrib.UI={}))}(WinJSContrib||(WinJSContrib={}));
var __extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},WinJSContrib;!function(WinJSContrib){var UI;!function(UI){var amHoursList=[1,2,3,4,5,6,7,8,9,10,11,12],amRadialHoursList=[12,1,2,3,4,5,6,7,8,9,10,11],pmHoursList=[13,14,15,16,17,18,19,20,21,22,23,0],pmRadialHoursList=[0,13,14,15,16,17,18,19,20,21,22,23],minutesList=[5,10,15,20,25,30,35,40,45,50,55,0],radialMinutesList=[0,5,10,15,20,25,30,35,40,45,50,55],TimePickerControl=function(){function TimePickerControl(element,options){var _this=this;this.element=element||document.createElement("DIV"),options=options||{},this.element.winControl=this,this.element.classList.add("mcn-timepicker"),this.element.classList.add("win-disposable"),this.flyout=new WinJS.UI.Flyout,this.flyout.element.classList.add("mcn-timepicker-flyout");var flr=WinJS.Resources.getString("mcntimepicker.flyout.arialabel");this.flyout.element.setAttribute("aria-label",flr.empty?"":flr.value),this.element.appendChild(this.flyout.element),options.hasOwnProperty("deferRendering")||(options.deferRendering=!0);var elt=document.createElement("DIV");this.flyout.element.appendChild(elt);var calendaroptions=JSON.parse(JSON.stringify(options));calendaroptions.flyout=this.flyout,this.timeclock=new WinJSContrib.UI.TimeClock(elt,calendaroptions),this.timeclock.element.onmousewheel=function(arg){arg.preventDefault(),arg.stopPropagation()},this.timeclock.onchange=function(){_this.value=_this.timeclock.value,_this.flyout.hide(),_this.dispatchEvent("change")},this.timeclock.onhourchange=function(){_this.value=_this.timeclock.value},this.flyout.onbeforeshow=function(){setImmediate(function(){_this.timeclock.setFocus()})},this.flyout.onaftershow=function(){WinJS.UI&&WinJS.UI._LightDismissService&&WinJS.UI._LightDismissService._service&&WinJS.UI._LightDismissService._service._clickEaterEl&&WinJS.UI._LightDismissService._service._clickEaterEl.style&&WinJS.UI._LightDismissService._service._clickEaterEl.style.zIndex<1006&&(WinJS.UI._LightDismissService._service._clickEaterEl.style.zIndex="1006")},this.flyout.onafterhide=function(){_this.timeclock.switchToHours()},this.textElement=document.createElement("DIV"),this.textElement.className="mcn-timepicker-text tap",this.element.appendChild(this.textElement),this.textElement.tabIndex=0,this.textElement.setAttribute("role","button"),this.textElement.onclick=function(arg){arg.preventDefault(),arg.stopPropagation(),window.innerWidth<500?_this.flyout.show(document.body,"top","left"):_this.flyout.show(_this.textElement)},this.textElement.innerText=this.timeclock.value,WinJS.UI.setOptions(this,options)}return Object.defineProperty(TimePickerControl.prototype,"value",{get:function(){return this.timeclock.value},set:function(val){try{this.timeclock.value=val}catch(exception){console.error(exception)}this.textElement.innerText=this.timeclock.value},enumerable:!0,configurable:!0}),Object.defineProperty(TimePickerControl.prototype,"valueAsDate",{get:function(){return this.timeclock.valueAsDate},set:function(val){this.timeclock.valueAsDate=val,this.textElement.innerText=this.timeclock.value},enumerable:!0,configurable:!0}),TimePickerControl.prototype.dispose=function(){WinJS.Utilities.disposeSubTree(this.element)},TimePickerControl.prototype.dispatchEvent=function(type,data){},TimePickerControl.prototype.addEventListener=function(type,callback){},TimePickerControl}();UI.TimePickerControl=TimePickerControl,UI.TimePicker=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(TimePickerControl),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var TimeClockControl=function(){function TimeClockControl(element,options){var _this=this;if(this.element=element||document.createElement("DIV"),options=options||{},this.element.winControl=this,this.element.classList.add("mcn-timeclock"),this.element.classList.add("win-disposable"),this.eventTracker=new WinJSContrib.UI.EventTracker,options.radial&&this.element.classList.add("radial"),options.value||(this.valueAsDate=new Date),WinJS.UI.setOptions(this,options),this.flyout&&(this.element.classList.add("win-xyfocus-suspended"),this.eventTracker.addEvent(this.element,"keydown",this.onkeydown.bind(this),!0)),options.deferRendering){var control=WinJSContrib.Utils.getScopeControl(this.element);control?control.readyComplete&&control.readyComplete.then(function(){return WinJS.Promise.timeout(200)}).then(function(){WinJS.Utilities.Scheduler.schedule(function(){_this.render()},WinJS.Utilities.Scheduler.Priority.idle)}):setTimeout(function(){WinJS.Utilities.Scheduler.schedule(function(){_this.render()},WinJS.Utilities.Scheduler.Priority.idle)},2e3)}else this.render()}return TimeClockControl.prototype.render=function(){var _this=this,arialabelminutes=WinJS.Resources.getString("mcntimepicker.mainminutes.arialabel"),arialabelhour=WinJS.Resources.getString("mcntimepicker.mainhour.arialabel");this.element.innerHTML='<header>\n                    <button class="hours current" aria-label="'+(arialabelhour.empty?"":arialabelhour.value.format(this.hour))+'">'+WinJSContrib.Utils.pad2(this.hour)+'</button>\n                    <div class="sep">:</div>\n                    <button class="minutes"  aria-label="'+(arialabelhour.empty?"":arialabelminutes.value.format(this.minutes))+'">'+WinJSContrib.Utils.pad2(this.minutes)+"</button>\n                </header>\n                <section>\n                </section>",this.header=this.element.querySelector("header"),this.content=this.element.querySelector("section"),this.hoursElt=this.element.querySelector(".hours"),WinJSContrib.UI.tap(this.hoursElt,function(){_this.switchToHours()}),this.minutesElt=this.element.querySelector(".minutes"),WinJSContrib.UI.tap(this.minutesElt,function(){_this.switchToMinutes()}),this.amLabel=this.amLabel||"AM",this.pmLabel=this.pmLabel||"PM",this.hoursPanel=new HoursPanel(this),this.currentPanel=this.hoursPanel},TimeClockControl.prototype.onkeydown=function(arg){if("PageDown"==arg.key)this.toggleDisplay(),arg.preventDefault(),arg.stopPropagation();else if("PageUp"==arg.key)this.toggleDisplay(),arg.preventDefault(),arg.stopPropagation();else if("Down"==arg.key){var nextelt=WinJS.UI.XYFocus.findNextFocusElement("down",{focusRoot:this.element});nextelt?nextelt.focus():this.currentPanel==this.hoursPanel&&this.hoursPanel.toggleView(),arg.preventDefault(),arg.stopPropagation()}else if("Up"==arg.key){var nextelt=WinJS.UI.XYFocus.findNextFocusElement("up",{focusRoot:this.element});nextelt?nextelt.focus():this.currentPanel==this.hoursPanel&&this.hoursPanel.toggleView(),arg.preventDefault(),arg.stopPropagation()}else if("Left"==arg.key){var nextelt=WinJS.UI.XYFocus.findNextFocusElement("left",{focusRoot:this.element});nextelt&&nextelt.focus(),arg.preventDefault(),arg.stopPropagation()}else if("Right"==arg.key){var nextelt=WinJS.UI.XYFocus.findNextFocusElement("right",{focusRoot:this.element});nextelt&&nextelt.focus(),arg.preventDefault(),arg.stopPropagation()}},Object.defineProperty(TimeClockControl.prototype,"value",{get:function(){return WinJSContrib.Utils.pad2(this.hour)+":"+WinJSContrib.Utils.pad2(this.minutes)},set:function(val){var items=val.split(":");this._value=moment(this._value).hour(parseInt(items[0],10)).minute(parseInt(items[1],10)).toDate(),this.updateDisplay()},enumerable:!0,configurable:!0}),Object.defineProperty(TimeClockControl.prototype,"valueAsDate",{get:function(){return this._value},set:function(val){this._value=moment(val).toDate(),this.updateDisplay()},enumerable:!0,configurable:!0}),Object.defineProperty(TimeClockControl.prototype,"hour",{get:function(){return this._value.getHours()},set:function(val){this._value=moment(this._value).hour(val).toDate(),this.updateDisplay(),this.dispatchEvent("hourchange")},enumerable:!0,configurable:!0}),Object.defineProperty(TimeClockControl.prototype,"minutes",{get:function(){return this._value.getMinutes()},set:function(val){this._value=moment(this._value).minute(val).toDate(),this.updateDisplay(),this.dispatchEvent("change"),this.dispatchEvent("minutechange")},enumerable:!0,configurable:!0}),TimeClockControl.prototype.conformMinutes=function(){for(var minutes=this._value.getMinutes()||0,count=0;count<10&&minutes%5!=0;)minutes-=1,count++;this._value=moment(this._value).minute(minutes).toDate()},TimeClockControl.prototype.updateDisplay=function(){if(this.conformMinutes(),this.hoursElt){this.hoursElt.innerText=WinJSContrib.Utils.pad2(this.hour),this.minutesElt.innerText=WinJSContrib.Utils.pad2(this.minutes);var arialabelminutes=WinJS.Resources.getString("mcntimepicker.mainminutes.arialabel"),arialabelhour=WinJS.Resources.getString("mcntimepicker.mainhour.arialabel");arialabelhour.empty||this.hoursElt.setAttribute("aria-label",arialabelhour.value.format(this.hour)),arialabelminutes.empty||this.minutesElt.setAttribute("aria-label",arialabelminutes.value.format(this.minutes))}this.currentPanel&&this.currentPanel.ensureValue()},TimeClockControl.prototype.toggleDisplay=function(){this.currentPanel==this.hoursPanel?this.switchToMinutes():this.switchToHours()},TimeClockControl.prototype.setFocus=function(){this.currentPanel&&this.currentPanel.setFocus()},TimeClockControl.prototype.switchToHours=function(){return this.currentPanel==this.hoursPanel?void this.hoursPanel.ensureValue():(this.currentPanel&&this.currentPanel!=this.hoursPanel&&this.currentPanel.remove(),this.hoursPanel?this.hoursPanel.ensureValue():this.hoursPanel=new HoursPanel(this),this.minutesElt.classList.remove("current"),this.hoursElt.classList.add("current"),this.hoursPanel.show(),this.hoursPanel.setFocus(),void(this.currentPanel=this.hoursPanel))},TimeClockControl.prototype.switchToMinutes=function(){return this.currentPanel==this.minutesPanel?void this.minutesPanel.ensureValue():(this.currentPanel&&this.currentPanel!=this.minutesPanel&&this.currentPanel.remove(),this.minutesPanel?this.minutesPanel.ensureValue():this.minutesPanel=new MinutesPanel(this),this.minutesElt.classList.add("current"),this.hoursElt.classList.remove("current"),this.minutesPanel.show(),this.minutesPanel.setFocus(),void(this.currentPanel=this.minutesPanel))},TimeClockControl.prototype.dispatchEvent=function(type,data){},TimeClockControl.prototype.addEventListener=function(type,callback){},TimeClockControl.prototype.dispose=function(){this.eventTracker.dispose()},TimeClockControl}();UI.TimeClockControl=TimeClockControl,UI.TimeClock=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(TimeClockControl),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change","hourchange","minutechange"));var TimePanel=function(){function TimePanel(parent){this.parent=parent,this.element=document.createElement("DIV"),this.element.className="timepanel",this.element.innerHTML="<header>\n                </header>\n                <section>\n                </section>",this.header=this.element.querySelector("header"),this.content=this.element.querySelector("section"),this.parent.content.appendChild(this.element)}return TimePanel.prototype.renderItems=function(items,name,current,callback,itemcallback){var itempanel=document.createElement("DIV");itempanel.className="itemspanel";var itemscontainer=document.createElement("DIV");itemscontainer.className="items",itempanel.appendChild(itemscontainer);var arialabelhour=WinJS.Resources.getString("mcntimepicker.hour.arialabel"),arialabelminutes=WinJS.Resources.getString("mcntimepicker.minutes.arialabel");return items.forEach(function(n){var item=document.createElement("BUTTON");item.className="timeitem item-"+name,item.id=name+n,"hour"!=name||arialabelhour.empty?"min"!=name||arialabelminutes.empty||item.setAttribute("aria-label",n+" "+arialabelminutes.value):item.setAttribute("aria-label",n+" "+arialabelhour.value),item.dataset.val=""+n,item.innerText=WinJSContrib.Utils.pad2(n),n==current&&item.classList.add("selected"),item.onclick=callback,itemscontainer.appendChild(item)}),this.parent.radial&&this.radialLayout(itemscontainer),itempanel},TimePanel.prototype.radialLayout=function(itemcontainer){for(var radian,radius,outerRadius=80,dialRadius=130,tickRadius=38,i=0;i<12;i++){var tick=itemcontainer.children[i];radian=i/6*Math.PI,radius=outerRadius,tick.style.left=dialRadius+Math.sin(radian)*radius-tickRadius+"px",tick.style.top=dialRadius-Math.cos(radian)*radius-tickRadius+"px"}},TimePanel.prototype.remove=function(){var _this=this;return WinJS.UI.Animation.drillInOutgoing(this.element).then(function(){_this.element.classList.add("hidden"),_this.element.style.display="none"})},TimePanel.prototype.show=function(){return this.element.classList.remove("hidden"),this.element.style.display="",WinJS.UI.Animation.drillInIncoming(this.element)},TimePanel.prototype.ensureValue=function(){},TimePanel.prototype.setFocus=function(){},TimePanel}();UI.TimePanel=TimePanel;var HoursPanel=function(_super){function HoursPanel(parent){_super.call(this,parent),this.element.classList.add("hourspanel"),this.header.innerHTML='<button class="hoursel am">'+this.parent.amLabel+'</button>\n                <button class="hoursel pm">'+this.parent.pmLabel+"</button>",this.amButton=this.header.querySelector(".hoursel.am"),this.pmButton=this.header.querySelector(".hoursel.pm"),WinJSContrib.UI.tap(this.amButton,this.setAM.bind(this)),WinJSContrib.UI.tap(this.pmButton,this.setPM.bind(this)),this.init()}return __extends(HoursPanel,_super),HoursPanel.prototype.init=function(){var currentHour=this.parent.hour;if(0==currentHour||currentHour>12){var hourslist=this.parent.radial?pmRadialHoursList:pmHoursList;this.pmButton.classList.add("selected"),this.isAm=!1}else{var hourslist=this.parent.radial?amRadialHoursList:amHoursList;this.amButton.classList.add("selected"),this.isAm=!0}this.currentHours=this.renderItems(hourslist,"hour",currentHour,this.hourClicked.bind(this)),this.content.appendChild(this.currentHours)},HoursPanel.prototype.ensureValue=function(){var selecteditem=this.element.querySelector(".item-hour.selected");if(selecteditem){var selectedhour=parseInt(selecteditem.dataset.val,10);selectedhour!=this.parent.hour&&(selecteditem.classList.remove("selected"),this.currentHours.parentElement.removeChild(this.currentHours),this.init())}},HoursPanel.prototype.toggleView=function(){this.isAm?this.setPM():this.setAM()},HoursPanel.prototype.setFocus=function(){var focusing=this.currentHours.querySelector(".item-hour.selected");focusing||(focusing=focusing=this.currentHours.querySelector(".item-hour")),focusing&&focusing.focus()},HoursPanel.prototype.setPM=function(){if(this.isAm){var previous=this.currentHours;WinJS.UI.Animation.drillInOutgoing(previous).then(function(){previous.parentElement.removeChild(previous)}),this.isAm=!1;var hourslist=this.parent.radial?pmRadialHoursList:pmHoursList;this.pmButton.classList.add("selected"),this.amButton.classList.remove("selected"),this.currentHours=this.renderItems(hourslist,"hour",this.parent.hour,this.hourClicked.bind(this)),this.content.appendChild(this.currentHours),this.setFocus(),WinJS.UI.Animation.drillInIncoming(this.currentHours)}},HoursPanel.prototype.setAM=function(){if(!this.isAm){var previous=this.currentHours;WinJS.UI.Animation.drillInOutgoing(previous).then(function(){previous.parentElement.removeChild(previous)}),this.isAm=!0;var hourslist=this.parent.radial?amRadialHoursList:amHoursList;this.pmButton.classList.remove("selected"),this.amButton.classList.add("selected"),this.currentHours=this.renderItems(hourslist,"hour",this.parent.hour,this.hourClicked.bind(this)),this.content.appendChild(this.currentHours),this.setFocus(),WinJS.UI.Animation.drillInIncoming(this.currentHours)}},HoursPanel.prototype.hourClicked=function(arg){var elt=arg.target,selecteditem=this.parent.element.querySelector(".item-hour.selected");selecteditem&&selecteditem.classList.remove("selected"),elt.classList.add("selected"),this.parent.hour=parseInt(elt.dataset.val,10),this.parent.switchToMinutes()},HoursPanel}(TimePanel);UI.HoursPanel=HoursPanel;var MinutesPanel=function(_super){function MinutesPanel(parent){_super.call(this,parent),this.element.classList.add("minutespanel");var list=minutesList;this.parent.radial&&(list=radialMinutesList);var timeitems=this.renderItems(list,"min",this.parent.minutes,this.minuteClicked.bind(this));this.content.appendChild(timeitems)}return __extends(MinutesPanel,_super),MinutesPanel.prototype.minuteClicked=function(arg){var elt=arg.target,selecteditem=this.parent.element.querySelector(".item-min.selected");selecteditem&&selecteditem.classList.remove("selected"),elt.classList.add("selected");var val=parseInt(elt.dataset.val,10);this.parent.minutes=val},MinutesPanel.prototype.setFocus=function(){var focusing=this.content.querySelector(".item-min.selected");focusing||(focusing=focusing=this.content.querySelector(".item-min")),focusing&&focusing.focus()},MinutesPanel}(TimePanel);UI.MinutesPanel=MinutesPanel}(UI=WinJSContrib.UI||(WinJSContrib.UI={}))}(WinJSContrib||(WinJSContrib={}));
!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{FlipSnap:WinJS.Class.mix(WinJS.Class.define(function(element,options){var ctrl=this;this.element=element||document.createElement("DIV"),options=options||{},this.element.winControl=this,this.element.classList.add("win-disposable"),this.element.classList.add("mcn-layout-ctrl"),this.element.classList.add("flipsnapcontainer"),this.list=document.createElement("DIV"),this.list.classList.add("flipsnaplist"),this.element.appendChild(this.list),this._navPromises=[],WinJS.UI.setOptions(this,options),ctrl._itemTemplate=options.itemTemplate,ctrl._itemMaxWidth=options.itemMaxWidth,ctrl._itemMaxWidth||(ctrl._itemMaxWidth=800),ctrl._itemMaxMarge=options.itemMaxMarge,ctrl._itemMaxMarge||(ctrl._itemMaxMarge=10),ctrl._itemClassName=options.itemClassName,ctrl._currentPosition=options.currentPosition,ctrl._currentPosition||(ctrl._currentPosition=0),ctrl.style=document.createElement("style"),ctrl.listOnscrollbinded=ctrl.listOnscroll.bind(ctrl),ctrl.element.appendChild(ctrl.style),ctrl.list.addEventListener("scroll",ctrl.listOnscrollbinded),ctrl._itemListRendred=[],ctrl.updateLayout(),ctrl._navBtns()},{_navBtns:function(){var ctrl=this;ctrl.next=document.createElement("button"),ctrl.next.innerHTML="&#57571;",ctrl.next.className="navbutton navbutton-right hide",ctrl.prev=document.createElement("button"),ctrl.prev.innerHTML="&#57570;",ctrl.prev.className="navbutton navbutton-left hide",ctrl.element.appendChild(ctrl.next),ctrl.element.appendChild(ctrl.prev),WinJSContrib.UI.tap(ctrl.next,function(){ctrl.toNext()}),WinJSContrib.UI.tap(ctrl.prev,function(){ctrl.toPrev()})},listOnscroll:function(){var ctrl=this;ctrl._timeout&&clearTimeout(ctrl._timeout),ctrl._timeout=setTimeout(function(){var newPosition=Math.round(ctrl.list.scrollLeft/(ctrl._itemw+ctrl._margeItem()));if(ctrl._currentPosition!==newPosition){ctrl._currentPosition=newPosition;for(var selectedItems=ctrl.list.querySelectorAll(".selected"),i=0,l=selectedItems.length;i<l;i++)selectedItems[i].classList.remove("selected");ctrl._setStateNavBtns(),ctrl.list.children[ctrl._currentPosition].classList.add("selected"),ctrl.dispatchEvent("positionchanged",{currentPosition:ctrl._currentPosition}),ctrl.renderItems(),console.log(ctrl._currentPosition)}},0)},_setStateNavBtns:function(){var ctrl=this;ctrl.canGoForward?ctrl.next.classList.remove("hide"):ctrl.next.classList.add("hide"),ctrl.canGoBack?ctrl.prev.classList.remove("hide"):ctrl.prev.classList.add("hide")},toNext:function(){var ctrl=this;WinJS.Promise.join(ctrl._navPromises).then(function(){ctrl._navPromises.push(ctrl._smooth_scroll_to(ctrl.list,(ctrl._itemw+ctrl._margeItem())*(ctrl._currentPosition+1),300))},function(){})},toPrev:function(){var ctrl=this;WinJS.Promise.join(ctrl._navPromises).then(function(){var index=ctrl._currentPosition-1;index<0&&(index=0),ctrl._navPromises.push(ctrl._smooth_scroll_to(ctrl.list,(ctrl._itemw+ctrl._margeItem())*index,300))},function(){})},_smooth_scroll_to:function(element,target,duration){if(target=Math.round(target),duration=Math.round(duration),duration<0)return Promise.reject("bad duration");if(0===duration)return element.scrollLeft=target,Promise.resolve();var start_time=Date.now(),end_time=start_time+duration,start_top=element.scrollLeft,distance=target-start_top,smooth_step=function(start,end,point){if(point<=start)return 0;if(point>=end)return 1;var x=(point-start)/(end-start);return x*x*(3-2*x)};return new WinJS.Promise(function(resolve,reject){try{var previous_top=element.scrollLeft,scroll_frame=function(){if(element.scrollLeft!=previous_top)return void resolve();var now=Date.now(),point=smooth_step(start_time,end_time,now),frameTop=Math.round(start_top+distance*point);return element.scrollLeft=frameTop,now>=end_time?void resolve():element.scrollLeft===previous_top&&element.scrollLeft!==frameTop?void resolve():(previous_top=element.scrollLeft,void requestAnimationFrame(scroll_frame))};requestAnimationFrame(scroll_frame)}catch(e){}})},initList:function(list,itemHandling){var ctrl=this,template=ctrl._itemTemplate;if(!template)throw"Where is the tempalte ?";template=WinJSContrib.Utils.getTemplate(template);list&&list.length&&(ctrl._dataList=list,list.length>1&&ctrl.next.classList.remove("hide"),list.forEach(function(fipitem,index){if(fipitem){fipitem.rendred=!1;var emptyElt=document.createElement("div");0==index&&emptyElt.classList.add("flipsnapfistitem"),index==ctrl._currentPosition&&emptyElt.classList.add("selected"),ctrl._itemClassName&&emptyElt.classList.add(ctrl._itemClassName),emptyElt.classList.add("flipsnapitem"),ctrl.list.appendChild(emptyElt),ctrl._itemListRendred.push(function(){return fipitem.rendred?WinJS.Promise.wrap({}):(fipitem.rendred=!0,template.render(fipitem,emptyElt).done(function(rendered){var elt=rendered;if(itemHandling(elt,fipitem,index),index+1===list.length){var lastitem=document.createElement("div");lastitem.className="flipsnaplastitem",ctrl.list.appendChild(lastitem)}}))})}})),ctrl.renderItems().then(function(){setImmediate(function(){requestAnimationFrame(function(){ctrl._setStateNavBtns(),ctrl.list.scrollLeft=(ctrl._itemw+ctrl._margeItem())*ctrl._currentPosition,ctrl.dispatchEvent("positionchanged",{currentPosition:ctrl._currentPosition})})})})},renderItems:function(){var ctrl=this,promises=[];return 0==ctrl._currentPosition?(promises.push(ctrl._itemListRendred[0]()),ctrl._itemListRendred.length>1&&promises.push(ctrl._itemListRendred[1]()),ctrl._itemListRendred.length>2&&promises.push(ctrl._itemListRendred[2]())):(ctrl._itemListRendred[ctrl._currentPosition]&&promises.push(ctrl._itemListRendred[ctrl._currentPosition]()),ctrl._itemListRendred[ctrl._currentPosition-1]&&promises.push(ctrl._itemListRendred[ctrl._currentPosition-1]()),ctrl._itemListRendred[ctrl._currentPosition-2]&&promises.push(ctrl._itemListRendred[ctrl._currentPosition-2]()),ctrl._itemListRendred[ctrl._currentPosition+1]&&promises.push(ctrl._itemListRendred[ctrl._currentPosition+1]()),ctrl._itemListRendred[ctrl._currentPosition+2]&&promises.push(ctrl._itemListRendred[ctrl._currentPosition+2]())),WinJS.Promise.join(promises)},itemTemplate:{get:function(){return this._itemTemplate},set:function(val){this._itemTemplate=val}},canGoBack:{get:function(){return 0!=this._currentPosition}},canGoForward:{get:function(){return this._currentPosition+1<this.dataList.length}},dataList:{get:function(){return this._dataList?this._dataList:[]}},currentPosition:{get:function(){return this._currentPosition},set:function(val){var ctrl=this;ctrl._currentPosition=val,ctrl._navPromises.push(ctrl._smooth_scroll_to(ctrl.list,(ctrl._itemw+ctrl._margeItem())*ctrl._currentPosition,300))}},itemMaxWidth:{get:function(){return this._itemMaxWidth},set:function(val){this._itemMaxWidth=val}},_margeItem:function(){var ctrl=this,margeitem=ctrl._itemMaxMarge;return window.innerWidth<800&&(ctrl._itemw=window.innerWidth,margeitem=0),margeitem},updateLayout:function(){var ctrl=this,windowInnerWidth=window.innerWidth;ctrl._itemw=ctrl._itemMaxWidth;var marge=(windowInnerWidth-ctrl._itemMaxWidth)/2;windowInnerWidth<800&&(marge=0);var margeitem=ctrl._margeItem();ctrl.currentPosition&&(ctrl.list.scrollLeft=(ctrl._itemw+margeitem)*ctrl.currentPosition),ctrl.style.innerHTML=".flipsnapcontainer .flipsnaplist{ -ms-scroll-snap-points-x: snapInterval(0%, "+(ctrl._itemw+margeitem)+"px); } .flipsnapcontainer  .flipsnaplist .flipsnapitem.flipsnapfistitem { margin-left:"+marge+"px } .flipsnaplist .flipsnapitem{ min-width:"+ctrl._itemw+"px;  width:"+ctrl._itemw+"px }  .flipsnapcontainer .flipsnaplist .flipsnaplastitem { max-width:"+marge+"px ; min-width:"+marge+"px } .flipsnapcontainer .flipsnaplist .flipsnapitem {margin-right:"+margeitem+"px }"},dispose:function(){var ctrl=this;ctrl.list.removeEventListener("scroll",ctrl.listOnscroll),WinJS.Utilities.disposeSubTree(this.element),this.element=null}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("positionchanged"))})}();
!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{FlipViewPager:WinJS.Class.mix(WinJS.Class.define(function(element,options){this.element=element||document.createElement("DIV"),options=options||{},this.element.className="mcn-flipviewpager",this.element.winControl=this,this.element.classList.add("win-disposable"),this.isFlipping=!1,this.flipviewPagerContextGroup=options.flipviewPagerContextGroupName||"flipviewPagerContextGroup",this.flipviewPageVisibilityChangeBinded=this.flipviewPageVisibilityChange.bind(this),this.pageSelectedBinded=this.pageSelected.bind(this),this.countChangedBinded=this.countChanged.bind(this),WinJS.UI.setOptions(this,options)},{flipView:{get:function(){return this._flipView},set:function(val){this.unregisterFlipViewEvents(),val?(this._flipView=val,val.winControl&&(this._flipView=val.winControl),this.registerFlipViewEvents(),this.initControl()):this._flipView=void 0}},initControl:function(){var ctrl=this;this._flipView.count().done(function(count){ctrl.initButtons(count)})},buttonClicked:function(eventObject){if(this._flipView)if(this.isFlipping){var currentPage=this._flipView.currentPage;this.radioButtons[currentPage].checked=!0}else{var targetPage=eventObject.srcElement.getAttribute("value");this._flipView.currentPage=parseInt(targetPage,10)}},countChanged:function(){this.initControl()},pageChange:function(){var currentPage=this._flipView.currentPage,btn=this.radioButtons[currentPage];btn?btn.checked=!0:this.initControl()},pageSelected:function(){this.isFlipping=!1,this.pageChange()},flipviewPageVisibilityChange:function(eventObject){eventObject.detail.visible===!0&&(this.isFlipping=!0),this.pageChange()},registerFlipViewEvents:function(){this._flipView&&(this._flipView.addEventListener("pagevisibilitychanged",this.flipviewPageVisibilityChangeBinded,!1),this._flipView.addEventListener("pageselected",this.pageSelectedBinded,!1),this._flipView.addEventListener("datasourcecountchanged",this.countChangedBinded,!1))},unregisterFlipViewEvents:function(){this._flipView&&(this._flipView.removeEventListener("pagevisibilitychanged",this.flipviewPageVisibilityChangeBinded),this._flipView.removeEventListener("pageselected",this.pageSelectedBinded),this._flipView.removeEventListener("datasourcecountchanged",this.countChangedBinded))},initButtons:function(count){var ctrl=this;this.radioButtons=[],this.element.innerHTML="";for(var i=0;i<count;++i){var radioButton=document.createElement("input");radioButton.setAttribute("type","radio"),radioButton.setAttribute("name",ctrl.flipviewPagerContextGroup),radioButton.setAttribute("value",i),radioButton.setAttribute("aria-label",i+1+" of "+count),radioButton.onclick=this.buttonClicked.bind(this),this.radioButtons.push(radioButton),this.element.appendChild(radioButton)}count>0&&(this.radioButtons[this._flipView.currentPage].checked=!0)},dispose:function(){this.unregisterFlipViewEvents(),WinJS.Utilities.disposeSubTree(this.element)}}),WinJS.UI.DOMEventMixin)})}();
var WinJSContrib=WinJSContrib||{};!function(){function initDownloads(){return new WinJS.Promise(function(complete,error){Windows.Networking.BackgroundTransfer.BackgroundDownloader.getCurrentDownloadsAsync().then(function(downloads){for(var downloadOperations=new WinJS.Binding.List,i=0;i<downloads.size;i++){var download=new WinJSContrib.BgDownloads.Download;download.load(downloads[i]),downloadOperations.push(download)}logger.info(downloadOperations.length+" pending downloads"),WinJSContrib.BgDownloads.currentDownloads=downloadOperations,WinJS.Application.queueEvent({type:"mcnbgdownload.init",downloads:downloadOperations}),complete(downloadOperations)},function(err){var downloadOperations=new WinJS.Binding.List;WinJSContrib.BgDownloads.currentDownloads=downloadOperations,complete(downloadOperations)})})}function initUploads(){return new WinJS.Promise(function(complete,error){Windows.Networking.BackgroundTransfer.BackgroundUploader.getCurrentUploadsAsync().then(function(uploads){for(var uploadOperations=new WinJS.Binding.List,i=0;i<uploads.size;i++){var upload=new WinJSContrib.BgDownloads.Upload;upload.load(uploads[i]),uploadOperations.push(upload)}logger.info(uploadOperations.length+" pending uploads"),WinJSContrib.BgDownloads.currentUploads=uploadOperations,WinJS.Application.queueEvent({type:"mcnbgupload.init",uploads:uploadOperations}),complete(uploadOperations)},function(err){var uploadOperations=new WinJS.Binding.List;WinJSContrib.BgDownloads.currentUploads=uploadOperations,complete(uploadOperations)})})}var logger=WinJSContrib.Logs.getLogger("WinJSContrib.BgDownload");WinJSContrib.BgDownloads=WinJSContrib.BgDownloads||{},WinJSContrib.BgDownloads.currentDownloads=new WinJS.Binding.List,WinJSContrib.BgDownloads.currentUploads=new WinJS.Binding.List,WinJSContrib.BgDownloads.initDownloads=initDownloads,WinJSContrib.BgDownloads.initUploads=initUploads,WinJSContrib.BgDownloads.init=function(){return WinJS.Promise.join([initDownloads(),initUploads()])},WinJSContrib.BgDownloads.Download=WinJS.Class.mix(WinJS.Class.define(function(){this._initObservable(),this.progress=0,this.download=null,this.promise=null,this.imageStream=null,this.oncomplete=null,this.onerror=null,this._completeCallbackBinded=this._completeCallback.bind(this),this._progressCallbackBinded=this._progressCallback.bind(this),this._errorCallbackBinded=this._errorCallback.bind(this)},{start:function(uri,fileName,folder,collision,priority,disablePowerSavingLimitations){var operation=this;return"string"==typeof uri&&(uri=new Windows.Foundation.Uri(uri)),folder=folder||Windows.Storage.ApplicationData.current.localFolder,priority=priority||Windows.Networking.BackgroundTransfer.BackgroundTransferPriority["default"],collision=collision||Windows.Storage.CreationCollisionOption.failIfExists,new WinJS.Promise(function(complete,error){var onerror=function(err){try{operation._errorCallback(err)}catch(exception){console.error(exception)}error(err)};folder.createFileAsync(fileName,collision).then(function(newFile){var downloader=new Windows.Networking.BackgroundTransfer.BackgroundDownloader;if(logger.verbose("bg download using URI: "+uri.absoluteUri),operation.download=downloader.createDownload(uri,newFile),operation.download.priority=priority,WinJSContrib.BgDownloads.currentDownloads.push(operation),operation.file=operation.download.resultFile.path,operation.progress=0,disablePowerSavingLimitations)return Windows.Networking.BackgroundTransfer.BackgroundDownloader.requestUnconstrainedDownloadsAsync([operation.download]).then(function(result){try{logger.verbose("Request for unconstrained downloads has been "+(result.isUnconstrained?"granted":"denied")),operation.promise=operation.download.startAsync().then(operation._completeCallbackBinded,operation._errorCallbackBinded,operation._progressCallbackBinded),complete(operation)}catch(exception){onerror(exception)}},onerror);try{operation.promise=operation.download.startAsync().then(operation._completeCallbackBinded,operation._errorCallbackBinded,operation._progressCallbackBinded),complete(operation)}catch(exception){onerror(exception)}},onerror)})},load:function(loadedDownload){var operation=this;operation.download=loadedDownload,logger.debug("Found download: "+operation.download.guid+" from previous application run."),operation.promise=operation.download.attachAsync().then(operation._completeCallbackBinded,operation._errorCallbackBinded,operation._progressCallbackBinded),operation.file=operation.download.resultFile.path,operation.progress=0},cancel:function(){var operation=this;operation.promise?(operation.promise.cancel(),operation.promise=null,logger.verbose("Canceling download: "+operation.download.guid)):logger.verbose("Download "+operation.download.guid+" already canceled.")},resume:function(){var operation=this;operation.download&&(download.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.pausedByApplication?(operation.download.resume(),logger.debug("Resuming download: "+operation.download.guid)):logger.debug("Download "+operation.download.guid+" is not paused, it may be running, completed, canceled or in error."))},pause:function(){var operation=this;operation.download&&(operation.download.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.running?(operation.download.pause(),logger.debug("Pausing download: "+operation.download.guid)):logger.debug("Download "+operation.download.guid+" is not running, it may be paused, completed, canceled or in error."))},hasGuid:function(guid){var operation=this;return operation.download.guid===guid},removeDownload:function(guid){WinJSContrib.BgDownloads.currentDownloads&&WinJSContrib.BgDownloads.currentDownloads.forEach(function(op,index){op.hasGuid(guid)&&WinJSContrib.BgDownloads.currentDownloads.splice(index,1)})},_progressCallback:function(arg){var operation=this;operation.progress=100*operation.download.progress.bytesReceived/operation.download.progress.totalBytesToReceive<<0,operation.onprogress&&operation.onprogress(operation.progress)},_completeCallback:function(){var operation=this;if(operation.ended=!0,operation.download&&operation.download.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.completed?(WinJS.Application.queueEvent({type:"mcnbgdownload.success",uploadId:operation.download.guid,operation:operation}),operation.oncomplete?(operation.oncomplete(),operation.oncomplete=null,operation.onerror=null):operation.notify("complete")):(operation.download&&WinJS.Application.queueEvent({type:"mcnbgdownload.error",uploadId:operation.download.guid,operation:operation}),operation._errorCallback("transfert problem")),operation.download){try{var responseInfo=operation.download.getResponseInformation();logger.verbose(operation.download.guid+" - download complete. Status code: "+responseInfo.statusCode),WinJS.Application.queueEvent({type:"McnBgDownload",error:!1,id:operation.download.guid,operation:operation})}catch(err){logger.error(err)}operation.removeDownload(operation.download.guid)}},_errorCallback:function(err){var operation=this;operation.ended=!0,operation.error=err,operation.download&&(WinJS.Application.queueEvent({type:"mcnbgdownload.error",uploadId:operation.download.guid,operation:operation}),operation.download.resultFile.deleteAsync().done(function(){},function(){}),operation.removeDownload(operation.download.guid),WinJS.Application.queueEvent({type:"McnBgDownload",error:!0,id:operation.download.guid,operation:operation}),logger.warn(operation.download.guid+" - download completed with error.")),operation.onerror?(operation.onerror(err),operation.onerror=null):operation.notify("error"),logger.warn(err)}}),WinJS.Binding.mixin,WinJS.Binding.expandProperties({progress:0})),WinJSContrib.BgDownloads.Download.run=function(uri,fileName,folder,collision,priority,requestUnconstrainedDownload){var operation=null;return WinJSContrib.BgDownloads.currentDownloads.forEach(function(op){op.download.requestedUri.toString()==uri.toString()&&(operation=op)}),operation?WinJS.Promise.wrap(operation):(operation=new WinJSContrib.BgDownloads.Download,operation.start(uri,fileName,folder,collision,priority,requestUnconstrainedDownload).then(function(){return operation}))},WinJSContrib.BgDownloads.Upload=WinJS.Class.mix(WinJS.Class.define(function(){this._initObservable(),this.progress=0,this.download=null,this.promise=null,this.imageStream=null,this.oncomplete=null,this.onerror=null,this._completeCallbackBinded=this._completeCallback.bind(this),this._progressCallbackBinded=this._progressCallback.bind(this),this._errorCallbackBinded=this._errorCallback.bind(this)},{start:function(uri,uploadedFile,priority,disablePowerSavingLimitations){var operation=this;return priority=priority||Windows.Networking.BackgroundTransfer.BackgroundTransferPriority["default"],new WinJS.Promise(function(complete,error){var onerror=function(err){operation._errorCallback(err),error(err)},uploader=new Windows.Networking.BackgroundTransfer.BackgroundUploader;return logger.verbose("bg upload using URI: "+uri.absoluteUri),operation.upload=uploader.createUpload(uri,uploadedFile),operation.upload.priority=priority,WinJSContrib.BgDownloads.currentUploads.push(operation),operation.file=operation.upload.sourceFile.path,operation.progress=0,disablePowerSavingLimitations?Windows.Networking.BackgroundTransfer.BackgroundUploader.requestUnconstrainedUploadsAsync([operation.upload]).then(function(result){logger.verbose("Request for unconstrained uploads has been "+(result.isUnconstrained?"granted":"denied")),operation.promise=operation.upload.startAsync().then(operation._completeCallbackBinded,operation._errorCallbackBinded,operation._progressCallbackBinded),complete(operation)},onerror):(operation.promise=operation.upload.startAsync().then(operation._completeCallbackBinded,operation._errorCallbackBinded,operation._progressCallbackBinded),void complete(operation))})},load:function(loadedUpload){var operation=this;operation.upload=loadedUpload,logger.debug("Found upload: "+operation.upload.guid+" from previous application run."),operation.promise=operation.upload.attachAsync().then(operation._completeCallbackBinded,operation._errorCallbackBinded,operation._progressCallbackBinded),operation.file=operation.upload.sourceFile.path,operation.progress=0},cancel:function(){var operation=this;operation.promise?(operation.promise.cancel(),operation.promise=null,logger.debug("Canceling upload: "+operation.upload.guid)):logger.debug("upload "+operation.upload.guid+" already canceled.")},resume:function(){var operation=this;operation.upload&&(operation.upload.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.pausedByApplication?(operation.upload.resume(),logger.debug("Resuming upload: "+operation.upload.guid)):logger.debug("upload "+operation.upload.guid+" is not paused, it may be running, completed, canceled or in error."))},pause:function(){var operation=this;operation.upload&&(operation.upload.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.running?(operation.upload.pause(),logger.debug("Pausing upload: "+operation.upload.guid)):logger.debug("upload "+operation.upload.guid+" is not running, it may be paused, completed, canceled or in error."))},hasGuid:function(guid){var operation=this;return operation.upload.guid===guid},removeUpload:function(guid){WinJSContrib.BgDownloads.currentUploads&&WinJSContrib.BgDownloads.currentUploads.forEach(function(op,index){op.hasGuid(guid)&&WinJSContrib.BgDownloads.currentUploads.splice(index,1)})},_progressCallback:function(arg){var operation=this;operation.progress=100*operation.upload.progress.bytesSended/operation.upload.progress.totalBytesToSend<<0},_completeCallback:function(){var operation=this;if(operation.ended=!0,operation.upload&&operation.upload.progress.status===Windows.Networking.BackgroundTransfer.BackgroundTransferStatus.completed?(WinJS.Application.queueEvent({type:"mcnbgupload.success",uploadId:operation.upload.guid,file:operation.upload.sourceFile.path,operation:operation}),operation.oncomplete?(operation.oncomplete(),operation.oncomplete=null,operation.onerror=null):operation.notify("complete")):(operation.upload&&WinJS.Application.queueEvent({type:"mcnbgupload.error",uploadId:operation.upload.guid,file:operation.upload.sourceFile.path,uri:operation.upload.requestedUri,operation:operation}),operation._errorCallback("transfert problem")),operation.upload){try{var responseInfo=operation.upload.getResponseInformation();logger.verbose(operation.upload.guid+" - upload complete. Status code: "+responseInfo.statusCode)}catch(err){logger.error(err)}operation.removeUpload(operation.upload.guid)}},_errorCallback:function(err){var operation=this;operation.ended=!0,operation.error=err,operation.upload&&(WinJS.Application.queueEvent({type:"mcnbgupload.error",uploadId:operation.upload.guid,file:operation.upload.sourceFile.path,uri:operation.upload.requestedUri,operation:operation}),operation.removeUpload(operation.upload.guid),logger.warn(operation.upload.guid+" - upload completed with error.")),operation.onerror?(operation.onerror(err),operation.onerror=null):operation.notify("error"),logger.warn(err)}}),WinJS.Binding.mixin,WinJS.Binding.expandProperties({progress:0})),WinJSContrib.BgDownloads.Upload.run=function(uri,uploadedFile,priority,requestUnconstrainedUpload){var operation=null;return WinJSContrib.BgDownloads.currentUploads.forEach(function(op){op.upload.requestedUri.toString()==uri.toString()&&(operation=op)}),operation?WinJS.Promise.wrap(operation):(operation=new WinJSContrib.BgDownloads.Upload,operation.start(uri,uploadedFile,priority,requestUnconstrainedUpload).then(function(){return operation}))}}();